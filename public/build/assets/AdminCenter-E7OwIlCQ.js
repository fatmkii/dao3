import{w as A,L as Z,n as e,R as L,$ as z,T as ne,b as G,ao as W,h as Y,A as m,M as x,p as a,I as V,H as t,t as _,z as o,F as w,a0 as H,Q as E,K as M,q as ie,y as T,v as c,a_ as se,az as ee,W as ae,X as te,ay as R,ax as oe,aw as ue,e as j,ac as re,ad as de,b0 as me,aH as pe,bi as le,bj as ge,S as B,at as F,bl as q,x as N,ak as fe,b4 as ve,b3 as ce,a9 as _e}from"./vendor-DK937lF0.js";import{a as I,u as O,b as C,_ as D,c as X}from"./app-Am_RzsK3.js";import{s as be,g as ye,h as he,i as xe,j as ke,k as Se}from"./admin-DvyOy2Zz.js";import{u as Q}from"./forums-De22175i.js";import{i as ze,a as $e}from"./inputNumberFormat-DaYmlx6U.js";const we={class:"banner-box-sm"},Me=["src"],Ne=["src","onClick"],Te=A({__name:"TabBanners",setup(P){Z(r=>({"6a1c8eac":e(y).textColor1}));const v=I();O();const b=Q(),y=L(),l=z(0);ne(()=>{i.value.length>0&&(l.value=i.value[0].value)});const i=G(()=>v.binggan===null||v.userData.binggan.admin_forums===void 0?[]:b.forumsData.reduce((r,n)=>(v.checkAdminForums(n.id)&&r.push({value:n.id,label:n.name,forumId:n.id}),r),[])),d=z([]);W(l,r=>{var n,S;r===void 0?d.value=[]:d.value=[...(S=(n=b.forumData(r))==null?void 0:n.banners)!=null?S:[]]});const u=z(!1),p=z(),g=G(()=>{var r,n;return(n=(r=p.value)==null?void 0:r.split(/[\n,，]+/).filter(S=>S!=""))!=null?n:[]});function U(){u.value=!1,d.value=d.value.concat(g.value),p.value=void 0,s()}function k(r){var n;(n=d.value)==null||n.splice(r,1)}const{loading:f,send:h,onSuccess:$}=Y(r=>be(r),{immediate:!1});$(()=>{b.getForumsData()});function s(){const r={binggan:v.binggan,forum_id:l.value,banners:d.value};h(r)}return(r,n)=>(m(),x(e(_),{vertical:""},{default:a(()=>[u.value?(m(),x(e(V),{key:0,title:"待追加的版头",size:"small",class:"dash-line"},{"header-extra":a(()=>[t(e(_),{size:"small"},{default:a(()=>[t(e(C),{type:"primary",onClick:U},{default:a(()=>[o("追加")]),_:1}),t(e(C),{type:"default",onClick:n[0]||(n[0]=S=>{u.value=!1,p.value=void 0})},{default:a(()=>[o("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(_),{size:"small"},{default:a(()=>[(m(!0),w(H,null,E(g.value,(S,J,K)=>(m(),w("div",we,[M("img",{src:S,style:{width:"100%"}},null,8,Me)]))),256))]),_:1}),t(e(ie),{type:"textarea",value:p.value,"onUpdate:value":n[1]||(n[1]=S=>p.value=S),placeholder:"在这里贴网址追加版头。可以一次多个，每行一个。",style:{"border-radius":"10px","margin-top":"6px"},autosize:{minRows:3,maxRows:5}},null,8,["value"])]),_:1})):T("",!0),t(e(V),{title:"版头设定",size:"small"},{"header-extra":a(()=>[t(e(_),{size:"small",align:"center",wrap:!0},{default:a(()=>[t(e(c),{depth:3},{default:a(()=>[o("选择小岛")]),_:1}),t(e(se),{value:l.value,"onUpdate:value":n[2]||(n[2]=S=>l.value=S),options:i.value,"consistent-menu-width":!1,style:{width:"100px"}},null,8,["value","options"]),u.value?T("",!0):(m(),x(e(C),{key:0,type:"primary",onClick:n[3]||(n[3]=S=>u.value=!0)},{default:a(()=>[o("追加")]),_:1}))]),_:1})]),default:a(()=>[t(e(c),{depth:3},{default:a(()=>[o("点击图片移除")]),_:1}),t(e(_),{wrap:!0,size:[4,4]},{default:a(()=>[(m(!0),w(H,null,E(d.value,(S,J)=>{var K;return m(),w("div",{key:J+((K=l.value)!=null?K:0)*1e3,class:"banner-box"},[M("img",{src:S,class:"banner-img",onClick:Ye=>k(J)},null,8,Ne)])}),128))]),_:1})]),_:1}),t(e(_),{align:"center",justify:"end"},{default:a(()=>[t(e(c),{depth:3,style:{"font-size":"0.875rem"}},{default:a(()=>[o("各个小岛的变更要分别提交喔")]),_:1}),t(e(C),{type:"primary",loading:e(f),disable:e(f),onClick:s},{default:a(()=>[o("提交")]),_:1},8,["loading","disable"])]),_:1})]),_:1}))}}),Ue=D(Te,[["__scopeId","data-v-35893c7d"]]),Ce=A({__name:"TabGlobal",setup(P){Z(u=>({a7c75f86:e(b).textColor1}));const v=I();O(),Q();const b=L(),y=z(!1),l=z(!1),i=z(!1);v.admin.isSuperAdmin===!0&&ye().then(u=>{y.value=u.new_binggan,l.value=u.new_loudspeaker,i.value=!0});function d(u,p){const g={binggan:v.binggan,key:u,value:JSON.stringify(p)};he(g).then()}return(u,p)=>(m(),x(e(_),{vertical:"",size:[6,12]},{default:a(()=>[t(e(_),{size:"small"},{default:a(()=>[t(e(c),{style:{width:"6.2rem"}},{default:a(()=>[o("领取饼干开关")]),_:1}),t(e(ee),{value:y.value,"onUpdate:value":p[0]||(p[0]=g=>y.value=g),disabled:!i.value,onUpdateValue:p[1]||(p[1]=g=>d("new_binggan",g))},null,8,["value","disabled"]),ae(t(e(c),{depth:3},{default:a(()=>[o("读取中")]),_:1},512),[[te,!i.value]])]),_:1}),t(e(_),{size:"small"},{default:a(()=>[t(e(c),{style:{width:"6.2rem"}},{default:a(()=>[o("大喇叭开关")]),_:1}),t(e(ee),{value:l.value,"onUpdate:value":p[2]||(p[2]=g=>l.value=g),disabled:!i.value,onUpdateValue:p[3]||(p[3]=g=>d("new_loudspeaker",g))},null,8,["value","disabled"]),ae(t(e(c),{depth:3},{default:a(()=>[o("读取中")]),_:1},512),[[te,!i.value]])]),_:1})]),_:1}))}}),Ae=D(Ce,[["__scopeId","data-v-44dcccc7"]]),Ie=A({__name:"TabMedal",setup(P){const v=I(),b=O();Q(),L();const y=z(null),l=z({binggan:"",medalId:181}),i={binggan:{required:!0,message:"请填写目标饼干",trigger:"blur"},medalId:{required:!0,message:"请选择要发放的成就",type:"number",trigger:"blur"}},d=[{value:181,label:"皇家御用画宗"},{value:182,label:"小火锅守护者"}],{loading:u,send:p,onSuccess:g,onError:U}=Y(f=>xe(f),{immediate:!1});g(()=>{l.value.binggan=""}),U(()=>{l.value.binggan=""});function k(){var f;(f=y.value)==null||f.validate(h=>{if(h){window.$message.error("请确认信息填写完整");return}else{const $={binggan:v.binggan,binggan_target:l.value.binggan,medal_id:l.value.medalId},s=d.find(n=>n.value===l.value.medalId),r={title:"发放成就",closable:!1,content:`对象饼干：${l.value.binggan}  发放成就：${s==null?void 0:s.label}`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{p($)}};window.$dialog.warning(r)}})}return(f,h)=>(m(),x(e(oe),{ref_key:"formRef",ref:y,model:l.value,"label-placement":"left","label-width":"auto",rules:i,size:e(b).isMobile?"small":"medium",style:{"max-width":"300px"}},{default:a(()=>[t(e(R),{label:"目标饼干",path:"binggan"},{default:a(()=>[t(e(X),{value:l.value.binggan,"onUpdate:value":h[0]||(h[0]=$=>l.value.binggan=$)},null,8,["value"])]),_:1}),t(e(R),{label:"发放成就",path:"medalId"},{default:a(()=>[t(e(se),{value:l.value.medalId,"onUpdate:value":h[1]||(h[1]=$=>l.value.medalId=$),options:d,"menu-props":{style:{borderRadius:"10px"}}},null,8,["value"])]),_:1}),t(e(C),{type:"primary",loading:e(u),disabled:e(u),onClick:k},{default:a(()=>[o("提交")]),_:1},8,["loading","disabled"])]),_:1},8,["model","size"]))}}),Oe=A({__name:"TabCoin",setup(P){const v=I(),b=O(),y=z(null),l=z({binggan:"",olo:void 0,message:""}),i={binggan:{required:!0,message:"请填写目标饼干",trigger:"blur"},message:{required:!1},olo:{required:!0,message:"请选择要奖罚的olo",type:"number",trigger:"blur"}},{loading:d,send:u,onSuccess:p,onError:g}=Y(k=>ke(k),{immediate:!1});p(()=>{l.value.binggan=""}),g(()=>{l.value.binggan=""});function U(){var k;(k=y.value)==null||k.validate(f=>{if(f){window.$message.error("请确认信息填写完整");return}else{const h={binggan:v.binggan,binggan_target:l.value.binggan,olo_num:l.value.olo,olo_message:l.value.message},$=l.value.olo>0?"奖励":"罚款",s={title:"奖罚olo",closable:!1,content:`对象饼干：${l.value.binggan} ${$}${l.value.olo}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{u(h)}};window.$dialog.warning(s)}})}return(k,f)=>(m(),x(e(oe),{ref_key:"formRef",ref:y,model:l.value,"label-placement":"left","label-width":"auto",rules:i,size:e(b).isMobile?"small":"medium",style:{"max-width":"300px"}},{default:a(()=>[t(e(R),{label:"目标饼干",path:"binggan"},{default:a(()=>[t(e(X),{value:l.value.binggan,"onUpdate:value":f[0]||(f[0]=h=>l.value.binggan=h)},null,8,["value"])]),_:1}),t(e(R),{label:"奖罚olo",path:"olo"},{default:a(()=>[t(e(ue),{value:l.value.olo,"onUpdate:value":f[1]||(f[1]=h=>l.value.olo=h),max:1e6,min:-1e6,step:1e3,parse:e(ze),format:e($e),placeholder:"正数是奖励，负数是罚款"},null,8,["value","parse","format"])]),_:1}),t(e(R),{label:"附带留言",path:"message"},{default:a(()=>[t(e(X),{value:l.value.message,"onUpdate:value":f[2]||(f[2]=h=>l.value.message=h),placeholder:"将显示在收支记录"},null,8,["value"])]),_:1}),t(e(C),{type:"primary",loading:e(d),disabled:e(d),onClick:U},{default:a(()=>[o("提交")]),_:1},8,["loading","disabled"])]),_:1},8,["model","size"]))}}),Pe={class:"actives-item"},Be={style:{"margin-left":"auto"}},Fe={key:0,style:{"margin-top":"6px"}},He={style:{"margin-top":"6px"}},Re={style:{"margin-top":"6px"}},Ee=A({__name:"TabActives",setup(P){Z(s=>({a0198f68:e(y).dividerColor})),j.extend(re),j.extend(de);const v=I(),b=O(),y=L(),l=z(j().tz("Asia/Shanghai").format("YYYY-MM-DD"));W(l,()=>k());const i=z(1);W(i,()=>k()),ne(()=>k());function d(s){return j().add(1,"day").isBefore(s)}const u=[{title:"时间",key:"created_at",resizable:!0},{title:"管理员",key:"name",resizable:!0},{title:"罚款",key:"olo",resizable:!0},{title:"操作",key:"active",resizable:!0},{title:"原因",key:"content",resizable:!0},{title:"主题",key:"thread_title",render:h,resizable:!0},{title:"回复",key:"post_content",render:$,resizable:!0}],{loading:p,data:g,send:U}=Y(s=>Se(s),{immediate:!1,initialData:{data:[],last_page:1}});function k(){const s={binggan:v.binggan,date:l.value,page:i.value};U(s)}function f(s){return{name:"thread",params:{threadId:s.thread_id,page:s.floor===null?1:Math.ceil((s.floor+1)/200)},hash:s.floor===null?void 0:"#f_"+s.floor}}function h(s,r){return s.thread_id!==null?B(q,{to:f(s),target:"_blank"},()=>B(F,{style:"max-width: 120px"},()=>s.thread_title)):B(F,{style:"max-width: 120px"},()=>s.thread_title)}function $(s,r){return s.thread_id!==null?B(q,{to:f(s),target:"_blank"},()=>B(F,{style:"max-width: 120px"},()=>s.post_content)):B(F,{style:"max-width: 120px"},()=>s.post_content)}return(s,r)=>(m(),x(e(_),{size:"small"},{default:a(()=>[t(e(me),{"formatted-value":l.value,"onUpdate:formattedValue":r[0]||(r[0]=n=>l.value=n),"value-format":"yyyy-MM-dd",type:"date",size:e(b).isMobile?"small":"medium","is-date-disabled":d},null,8,["formatted-value","size"]),t(e(C),{type:"primary",onClick:r[1]||(r[1]=n=>k())},{default:a(()=>[o(" 查询 ")]),_:1}),t(e(V),{title:"管理员操作记录",size:"small"},{default:a(()=>[e(b).isMobile?T("",!0):(m(),x(e(_),{key:0},{default:a(()=>[t(e(pe),{columns:u,data:e(g).data,bordered:!1,loading:e(p),style:{height:"100%"}},null,8,["data","loading"]),t(e(le),{page:i.value,"onUpdate:page":r[2]||(r[2]=n=>i.value=n),"page-count":e(g).last_page,size:"medium",style:{"margin-left":"auto"}},null,8,["page","page-count"])]),_:1})),e(b).isMobile?(m(),w(H,{key:1},[e(g).data.length>0?(m(),x(e(_),{key:0,vertical:"",align:"start",size:"small"},{default:a(()=>[e(p)?T("",!0):(m(!0),w(H,{key:0},E(e(g).data,n=>(m(),w("div",Pe,[t(e(_),null,{default:a(()=>[M("div",null,[t(e(c),{depth:3},{default:a(()=>[o("时间：")]),_:1}),t(e(c),null,{default:a(()=>[o(N(n.created_at),1)]),_:2},1024)]),M("div",Be,[t(e(c),{depth:3},{default:a(()=>[o("管理员：")]),_:1}),t(e(c),null,{default:a(()=>[o(N(n.name),1)]),_:2},1024)])]),_:2},1024),n.olo?(m(),w("div",Fe,[t(e(c),{depth:3},{default:a(()=>[o("罚款：")]),_:1}),t(e(c),null,{default:a(()=>[o(N(n.olo),1)]),_:2},1024)])):T("",!0),M("div",He,[t(e(c),{depth:3},{default:a(()=>[o("操作：")]),_:1}),t(e(c),null,{default:a(()=>[o(N(n.active),1)]),_:2},1024)]),M("div",Re,[t(e(c),{depth:3},{default:a(()=>[o("原因：")]),_:1}),t(e(c),null,{default:a(()=>[o(N(n.content),1)]),_:2},1024)]),n.thread_title!==null?(m(),x(e(_),{key:1,style:{"margin-top":"6px"},wrap:!1},{default:a(()=>[t(e(c),{depth:3},{default:a(()=>[o("主题：")]),_:1}),t(e(q),{to:f(n),style:{"max-width":"80%"}},{default:a(()=>[t(e(F),null,{default:a(()=>[o(N(n.thread_title),1)]),_:2},1024)]),_:2},1032,["to"])]),_:2},1024)):T("",!0),n.post_content!==null?(m(),x(e(_),{key:2,style:{"margin-top":"6px"},wrap:!1},{default:a(()=>[t(e(c),{depth:3},{default:a(()=>[o("主题：")]),_:1}),t(e(q),{to:f(n),style:{"max-width":"80%"}},{default:a(()=>[t(e(F),null,{default:a(()=>[o(N(n.post_content),1)]),_:2},1024)]),_:2},1032,["to"])]),_:2},1024)):T("",!0)]))),256)),t(e(le),{page:i.value,"onUpdate:page":r[3]||(r[3]=n=>i.value=n),"page-count":e(g).last_page,size:"small",style:{"margin-left":"auto"}},null,8,["page","page-count"])]),_:1})):(m(),x(e(ge),{key:1}))],64)):T("",!0)]),_:1})]),_:1}))}}),je=D(Ee,[["__scopeId","data-v-a35e3f42"]]),qe=M("img",{src:"https://www.freeimg.cn/i/2024/05/15/6644aedee642d.png",style:{"max-width":"50px","max-height":"50px"}},null,-1),Ge=M("span",null,"管理员中心",-1),Ve=A({__name:"AdminCard",setup(P){const v=I(),b=O(),y=Q(),l=G(()=>v.binggan===null||v.userData.binggan.admin_forums===void 0?[]:y.forumsData.reduce((i,d)=>(v.checkAdminForums(d.id)&&i.push({value:d.id,label:d.name,forumId:d.id}),i),[]));return(i,d)=>(m(),x(e(V),{hoverable:"",size:"small"},{default:a(()=>[t(e(_),{vertical:e(b).isMobile},{default:a(()=>[t(e(_),{size:"small",align:"center"},{default:a(()=>[qe,Ge]),_:1}),M("div",null,[t(e(c),{depth:3},{default:a(()=>[o("我管理的板块")]),_:1}),t(e(_),null,{default:a(()=>[(m(!0),w(H,null,E(l.value,u=>(m(),x(e(fe),null,{default:a(()=>[o(N(u.forumId)+". "+N(u.label),1)]),_:2},1024))),256))]),_:1})])]),_:1},8,["vertical"])]),_:1}))}}),Le=M("div",{style:{height:"50px"}},null,-1),Ze=A({__name:"AdminCenter",setup(P){const v=I(),b=O(),y=z();document.title="管理员中心";const l=G(()=>{const i=[{name:"banners",tab:"版头设定",component:Ue}];return v.admin.isNormalAdmin&&i.unshift({name:"actives",tab:"管理状况",component:je}),v.admin.isSuperAdmin?i.concat([{name:"global",tab:"全局设置",component:Ae},{name:"medals",tab:"发放成就",component:Ie},{name:"olo",tab:"奖罚olo",component:Oe}]):i});return(i,d)=>(m(),x(e(_),{vertical:"",style:{"margin-top":"8px"}},{default:a(()=>[t(e(Ve)),t(e(ve),{type:"line","bar-width":e(b).isMobile?0:void 0,animated:"",size:e(b).isMobile?"small":"large",value:y.value,"onUpdate:value":d[0]||(d[0]=u=>y.value=u)},{default:a(()=>[(m(!0),w(H,null,E(l.value,u=>(m(),x(e(ce),{name:u.name,tab:u.tab,key:u.name},{default:a(()=>[(m(),x(_e(u.component)))]),_:2},1032,["name","tab"]))),128))]),_:1},8,["bar-width","size","value"]),Le]),_:1}))}});export{Ze as default};
