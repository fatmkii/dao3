var ro=Object.defineProperty,io=Object.defineProperties;var uo=Object.getOwnPropertyDescriptors;var wt=Object.getOwnPropertySymbols;var mo=Object.prototype.hasOwnProperty,co=Object.prototype.propertyIsEnumerable;var Ye=(c,n,i)=>n in c?ro(c,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[n]=i,yt=(c,n)=>{for(var i in n||(n={}))mo.call(n,i)&&Ye(c,i,n[i]);if(wt)for(var i of wt(n))co.call(n,i)&&Ye(c,i,n[i]);return c},Ct=(c,n)=>io(c,uo(n));var kt=(c,n,i)=>Ye(c,typeof n!="symbol"?n+"":n,i);import{as as fo,o as po,at as he,x as re,b as y,F as b,A as r,K as t,R as o,t as e,S as ue,T as ce,U as k,V as G,a1 as P,X as l,_ as T,Q as Te,a6 as et,Y as Je,au as Ve,Z as ye,q as z,W as w,av as go,aw as It,ax as Tt,w as ee,a7 as Rt,i as Le,n as Xe,ay as De,az as be,a2 as Ht,aA as vo,aB as ho,a4 as At,a5 as qt,aC as ke,N as _e,z as F,aD as tt,aa as Fe,aE as Nt,aF as bo,$ as le,J as ze,aG as _o,ar as wo,P as yo,an as Co,ao as ko,a8 as St,a0 as Io,a9 as Pt,ap as $t,aq as So,am as Po,C as Ue,aH as $o}from"./vendor-DKSliaeX.js";import{h as xo,a as Mo,g as Gt,n as Do,_ as xt,p as Lo}from"./emojiData-Cp3MIFP-.js";import{t as zo,p as Mt}from"./showDialog-CR-FesH4.js";import{u as de,d as B,g as Ze,c as te,e as Ce,h as To,i as me,j as W,r as we,C as Ro,R as Et,_ as Re,G as Ho,k as Ao,V as qo,b as Z,S as No,D as Go,B as Eo,f as Dt,U as Oo,l as jo}from"./app-BS5C2Xv4.js";import{_ as Lt}from"./loudspeaker-BZnNu3IF.js";import{_ as Uo,a as Fo}from"./PostInput.vue_vue_type_script_setup_true_lang-BelQEMHU.js";import{L as Qe,S as Vo}from"./LoudspeakerComponent-HY2Oj6HI.js";import{u as Bo,t as Wo,a as Ko,d as Yo,r as Qo,b as Jo,c as Xo,e as Zo,f as ea}from"./admin-Di1jog18.js";import{i as ta,a as oa}from"./inputNumberFormat-BPxWRFt_.js";import{u as aa}from"./browseLogger-Dw9qxaZF.js";import{D as na}from"./Delete-D3xRQ076.js";import"./forums-BKK4zFtC.js";var sa=fo();const la=po(sa);window.Pusher=la;class ra{constructor(){kt(this,"_echoConnector");this._echoConnector=null}connect(){if(this._echoConnector===null){const n=window.location.hostname;this._echoConnector=new he({broadcaster:"reverb",key:"h1gdqae9h4rihjohv1vv",wsHost:n,wsPort:"8090",wssPort:"8090",forceTLS:!0,enabledTransports:["ws","wss"],namespace:""})}else throw new Error("Echo实例已经连接过了")}disconnect(){if(this._echoConnector instanceof he)this._echoConnector.disconnect(),this._echoConnector=null;else throw new Error("Echo实例已经删除过了")}channel(n){if(this._echoConnector instanceof he)return this._echoConnector.channel(n);throw new Error("Echo实例需要先连接.connect()")}leaveChannel(n){if(this._echoConnector instanceof he)this._echoConnector.leaveChannel(n);else throw new Error("Echo实例需要先连接.connect()")}leaveAllChannels(){if(this._echoConnector instanceof he)this._echoConnector.leaveAllChannels();else throw new Error("Echo实例需要先连接.connect()")}get isConnected(){return this._echoConnector instanceof he}get pusher(){return this._echoConnector instanceof he?this._echoConnector.connector.pusher:null}}function ia(){return new ra}const ua={0:{name:"空白占位",ImgSrc:""},23410:{name:"已日清",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97cf647.png"},23401:{name:"olo不足",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef9811f04.png"},234011:{name:"私密主题",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97ce810.png"},23404:{name:"板块or主题不存在",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef9818836.png"},21404:{name:"需要饼干",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97e42d8.png"}},da=["src"],ma=re({__name:"ForbiddenModal",setup(c,{expose:n}){const i=y(0),R=y(""),v=de(),h=y(!1);function I(p){i.value=p.errorCode,R.value=p.message,h.value=!0}return n({show:I}),(p,u)=>(r(),b(e(Te),{show:h.value,"onUpdate:show":u[2]||(u[2]=g=>h.value=g),"display-directive":"if"},{default:t(()=>[o(e(ue),{style:ce({maxWidth:e(v).modalMaxWidth}),closable:"",onClose:u[1]||(u[1]=g=>h.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[o(e(B),{onClick:u[0]||(u[0]=g=>h.value=!1)},{default:t(()=>[...u[3]||(u[3]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[G("img",{style:{width:"100%"},src:e(ua)[i.value].ImgSrc},null,8,da),o(e(P),null,{default:t(()=>[l(T(R.value),1)]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),ca=re({__name:"JumpModal",props:{threadId:{},postsNum:{},page:{}},setup(c,{expose:n}){const i=de(),R=et(),v=c,h=y(),I=y(!1);function p(){I.value=!0}n({show:p});function u(){if(h.value!==void 0){const g=Math.ceil((h.value+1)/200),C="#f_"+h.value;if(R.push({name:"thread",params:{threadId:v.threadId,page:g},hash:C}),g===v.page){const S=document.querySelector(C);S==null||S.scrollIntoView({block:"center",behavior:"auto"}),S==null||S.classList.add("on-focus")}I.value=!1}}return(g,C)=>(r(),b(e(Te),{show:I.value,"onUpdate:show":C[3]||(C[3]=S=>I.value=S),"display-directive":"if"},{default:t(()=>[o(e(ue),{style:ce({maxWidth:e(i).modalMaxWidth}),title:"跳楼机",closable:"",onClose:C[2]||(C[2]=S=>I.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[o(e(B),{type:"primary",onClick:u,disabled:!h.value},{default:t(()=>[...C[5]||(C[5]=[l("Jump!",-1)])]),_:1},8,["disabled"]),o(e(B),{onClick:C[1]||(C[1]=S=>I.value=!1)},{default:t(()=>[...C[6]||(C[6]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[o(e(P),null,{default:t(()=>[l(" 最大高度："+T(g.postsNum)+"楼 ",1)]),_:1}),o(e(Je),null,{default:t(()=>[o(e(Ze),{style:{width:"3.2rem"},class:"round"},{default:t(()=>[...C[4]||(C[4]=[l("跳楼",-1)])]),_:1}),o(e(Ve),{placeholder:"请输入楼层号",max:g.postsNum,value:h.value,"onUpdate:value":C[0]||(C[0]=S=>h.value=S),onKeyup:ye(u,["enter"])},null,8,["max","value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),fa=re({__name:"AdminActionModal",props:{threadId:{},forumId:{default:0}},emits:["refreshPostsList"],setup(c,{expose:n,emit:i}){const R=de(),v=te(),h=et(),I=y(null),p=c,u=y({contentInput:void 0,switchInput:!1}),g=y("hint"),C=y(!0),S=y();let _;const O=z(()=>({contentInput:{required:x.value.requireContent,message:"请填写理由"},switchInput:{required:!1}})),K={hint:{requireContent:!1,contentMessage:!1,requireSwitch:!1},ban:{requireContent:!0,contentMessage:"你要永久粉碎这个饼干吗？",requireSwitch:!1},lock:{requireContent:!0,contentMessage:`要封禁这个饼干吗？
第1次3天、2次6天、3次9天、4次碎饼`,requireSwitch:!1},deleteAll:{requireContent:!0,contentMessage:`要用管理员权限删除该饼干全部回复吗？
此功能请谨慎使用，仅在有恶意刷屏时。`,requireSwitch:!0},delete:{requireContent:!0,contentMessage:"要用管理员权限删除这个回复吗？",requireSwitch:!0},recovery:{requireContent:!0,contentMessage:"要用管理员权限恢复这个回复吗？",requireSwitch:!1},deleteThread:{requireContent:!0,contentMessage:"要用管理员权限删除这个主题吗？",requireSwitch:!1},setTop:{requireContent:!1,contentMessage:"要设为置顶吗？",requireSwitch:!1},cancelTop:{requireContent:!1,contentMessage:"要取消置顶吗？",requireSwitch:!1}},x=z(()=>K[g.value]),d=y(!1);function M(L){var m;g.value=L.action,_=(m=L.postId)!=null?m:0,S.value=void 0,d.value=!0,L.action==="hint"?(C.value=!1,q("hint")):C.value=!0}n({show:M});const $=i;function q(L){var m;if(L==="hint"){S.value="查询中……";const f={binggan:v.binggan,thread_id:p.threadId,post_id:_};Bo(f).then(H=>{S.value=`此饼干状态：${H.user_status}。已被锁定过${H.locked_count}次。`});return}(m=I.value)==null||m.validate(f=>{if(f){window.$message.error("请确认信息填写完整");return}else switch(L){case"ban":const H={binggan:v.binggan,thread_id:p.threadId,post_id:_,content:u.value.contentInput};ea(H).then(()=>{d.value=!1,$("refreshPostsList")});break;case"lock":const oe={binggan:v.binggan,thread_id:p.threadId,post_id:_,content:u.value.contentInput};Zo(oe).then(()=>{d.value=!1,$("refreshPostsList")});break;case"deleteAll":const j={binggan:v.binggan,thread_id:p.threadId,post_id:_,content:u.value.contentInput,reduce_olo:u.value.switchInput};Xo(j).then(()=>{d.value=!1,$("refreshPostsList")});break;case"delete":const E={binggan:v.binggan,thread_id:p.threadId,post_id:_,content:u.value.contentInput,reduce_olo:u.value.switchInput};Jo(E).then(()=>{d.value=!1,$("refreshPostsList")});break;case"recovery":const ae={binggan:v.binggan,thread_id:p.threadId,post_id:_,content:u.value.contentInput};Qo(ae).then(()=>{d.value=!1,$("refreshPostsList")});break;case"deleteThread":const N={binggan:v.binggan,thread_id:p.threadId,content:u.value.contentInput};Yo(N).then(()=>{d.value=!1,h.push({name:"forum",params:{forumId:p.forumId,page:1}})});break;case"setTop":const D={binggan:v.binggan,thread_id:p.threadId};Ko(D).then(()=>{d.value=!1,$("refreshPostsList")});break;case"cancelTop":const A={binggan:v.binggan,thread_id:p.threadId};Wo(A).then(()=>{d.value=!1,$("refreshPostsList")});break}})}return(L,m)=>(r(),b(e(Te),{show:d.value,"onUpdate:show":m[5]||(m[5]=f=>d.value=f),"display-directive":"if",size:"small"},{default:t(()=>[o(e(ue),{style:ce({maxWidth:e(R).modalMaxWidth}),title:"管理员操作",closable:"",onClose:m[4]||(m[4]=f=>d.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[C.value?(r(),b(e(B),{key:0,type:"warning",onClick:m[2]||(m[2]=f=>q(g.value))},{default:t(()=>[...m[7]||(m[7]=[l("提交",-1)])]),_:1})):w("",!0),o(e(B),{onClick:m[3]||(m[3]=f=>d.value=!1)},{default:t(()=>[...m[8]||(m[8]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[x.value.contentMessage?(r(),b(e(P),{key:0,style:{"white-space":"pre-wrap"}},{default:t(()=>[l(T(x.value.contentMessage),1)]),_:1})):w("",!0),S.value?(r(),b(e(P),{key:1},{default:t(()=>[l(T(S.value),1)]),_:1})):w("",!0),o(e(go),{ref_key:"formRef",ref:I,model:u.value,"label-placement":"left","label-width":"auto",rules:O.value,size:e(R).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:t(()=>[x.value.requireContent?(r(),b(e(It),{key:0,label:"理由",path:"contentInput"},{default:t(()=>[o(e(Ce),{placeholder:"必填",value:u.value.contentInput,"onUpdate:value":m[0]||(m[0]=f=>u.value.contentInput=f)},null,8,["value"])]),_:1})):w("",!0),x.value.requireSwitch?(r(),b(e(It),{key:1,label:"罚款olo",path:"switchInput"},{default:t(()=>[o(e(Tt),{value:u.value.switchInput,"onUpdate:value":m[1]||(m[1]=f=>u.value.switchInput=f)},null,8,["value"]),o(e(P),{style:{"margin-left":"6px"}},{default:t(()=>[...m[6]||(m[6]=[l("每个帖子罚款500，封顶5000个olo",-1)])]),_:1})]),_:1})):w("",!0)]),_:1},8,["model","rules","size"])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),pa=re({__name:"RewardModal",emits:["refreshPostsList"],setup(c,{expose:n,emit:i}){const R=de(),v=te(),h=y(100),I=y(),p=y(!1),u=y();function g(x){u.value=x,p.value=!0}n({show:g});const C=i;function S(){const x={binggan:v.binggan,post_floor_message:"@"+u.value.postFloorMessage,forum_id:u.value.forumId,thread_id:u.value.threadId,post_id:u.value.postId,coin:h.value,content:I.value};O(x)}const{loading:_,send:O,onSuccess:K}=ee(x=>To(x),{immediate:!1});return K(()=>{p.value=!1,C("refreshPostsList")}),(x,d)=>(r(),b(e(Te),{show:p.value,"onUpdate:show":d[4]||(d[4]=M=>p.value=M),"display-directive":"if"},{default:t(()=>{var M;return[o(e(ue),{style:ce({maxWidth:e(R).modalMaxWidth}),title:`打赏给№${(M=u.value)==null?void 0:M.floor}`,closable:"",onClose:d[3]||(d[3]=$=>p.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[o(e(B),{type:"primary",onClick:S,loading:e(_)},{default:t(()=>[...d[12]||(d[12]=[l("打赏",-1)])]),_:1},8,["loading"]),o(e(B),{onClick:d[2]||(d[2]=$=>p.value=!1)},{default:t(()=>[...d[13]||(d[13]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[G("div",null,[e(R).isDouble11?(r(),b(e(P),{key:1},{default:t(()=>[...d[6]||(d[6]=[G("del",null,"友情提示：在打赏额以外，会追加扣除7%手续费。",-1),G("br",null,null,-1),l(" 活动期间限时手续费2%！ ",-1)])]),_:1})):(r(),b(e(P),{key:0},{default:t(()=>[...d[5]||(d[5]=[l(" 友情提示：在打赏额以外，会追加扣除7%手续费。",-1)])]),_:1})),d[9]||(d[9]=G("br",null,null,-1)),o(e(P),null,{default:t(()=>[...d[7]||(d[7]=[l("总共扣除：",-1)])]),_:1}),o(e(P),{type:"error"},{default:t(()=>[l(T(Math.ceil(h.value*(e(R).isDouble11?1.02:1.07))),1)]),_:1}),o(e(P),null,{default:t(()=>[...d[8]||(d[8]=[l("块奥利奥。",-1)])]),_:1})]),o(e(Je),null,{default:t(()=>[o(e(Ze),{style:{width:"3.2rem"}},{default:t(()=>[...d[10]||(d[10]=[l("打赏",-1)])]),_:1}),o(e(Ve),{type:"password",placeholder:"olo数量","show-password-on":"mousedown",clearable:"",value:h.value,"onUpdate:value":d[0]||(d[0]=$=>h.value=$),onKeyup:ye(S,["enter"]),max:1e6,min:1,step:1e3,parse:e(oa),format:e(ta)},null,8,["value","parse","format"])]),_:1}),o(e(Je),null,{default:t(()=>[o(e(Ze),{style:{width:"3.2rem"},class:"round"},{default:t(()=>[...d[11]||(d[11]=[l("留言",-1)])]),_:1}),o(e(Ce),{value:I.value,"onUpdate:value":d[1]||(d[1]=$=>I.value=$),placeholder:"（可留空）",onKeyup:ye(S,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style","title"])]}),_:1},8,["show"]))}});let zt;function ga(c,n=500){return function(...i){clearTimeout(zt),zt=setTimeout(()=>{c(...i)},n)}}const va=re({__name:"BrowseLogger",props:{postsListLoading:{type:Boolean},disableScroll:{type:Boolean,default:!1},isSearch:{type:Boolean},threadId:{},page:{}},setup(c){const n=c,i=y(!1),R=Rt(),v=aa();function h(){function p(){const g=window.innerWidth/2;return document.elementsFromPoint(g,100)}ga(()=>{const g=p(),C=v.get(n.threadId);g.forEach(S=>{const _=Number(S.getAttribute("floor"));_&&_>C.floor&&v.log(n.threadId,_)})},100)()}function I(){if(!R.hash&&v.get(n.threadId)){const p=v.get(n.threadId),u=Math.ceil((p.floor+1)/200);if(u===n.page&&p.floor!==0){const g=document.getElementById("f_"+p.floor);g!==null&&(g.scrollIntoView({behavior:"auto",block:"center"}),window.$message.success(`已自动滚到上次浏览进度${p.floor}楼`))}u>n.page&&(i.value=!0)}}return Le(()=>n.postsListLoading,p=>{p===!1&&!n.disableScroll&&Xe(()=>I())}),De(()=>{v.initThread(n.threadId),window.addEventListener("scroll",h)}),be(()=>{i.value=!1,window.removeEventListener("scroll",h)}),(p,u)=>{const g=Ht("router-link");return i.value&&!p.isSearch?(r(),b(e(vo),{key:0,type:"success",closable:"",style:{"border-radius":"10px"}},{default:t(()=>[l(" 你上次已经浏览到"+T(e(v).get(p.threadId).floor)+"楼， ",1),o(g,{onClick:u[0]||(u[0]=C=>i.value=!1),to:{name:"thread",params:{threadId:p.threadId,page:Math.ceil((e(v).get(p.threadId).floor+1)/200)}}},{default:t(()=>[...u[1]||(u[1]=[l(" 点击这里 ",-1)])]),_:1},8,["to"]),u[2]||(u[2]=l(" 跳转 ",-1))]),_:1})):w("",!0)}}}),ha=re({__name:"ChangeColorModal",props:{threadId:{}},emits:["refreshPostsList"],setup(c,{expose:n,emit:i}){const R=de(),v=te(),h=c,I=y(),p=["#b65954","#c78878","#9b7e70","#de7562","#fca44b","#f1c727","#f6da79","#fbda97","#9fc778","#78c79f","#8ab185","#98c0d9","#8691db","#7878c7","#566b7c","#9678c7","#9f78c7","#ca95e9","#ecacc6","#a86fa2","#7e3749"],u=y(!1);function g(){u.value=!0}n({show:g});const{loading:C,send:S,onSuccess:_}=ee(K=>zo(K),{immediate:!1});function O(){if(!I.value){window.$message.error("颜色输入不能为空");return}const K={binggan:v.binggan,thread_id:h.threadId,color:I.value};S(K),_(()=>u.value=!1)}return(K,x)=>(r(),b(e(Te),{show:u.value,"onUpdate:show":x[3]||(x[3]=d=>u.value=d),"display-directive":"if"},{default:t(()=>[o(e(ue),{style:ce({maxWidth:e(R).modalMaxWidth}),title:"标题改色",closable:"",onClose:x[2]||(x[2]=d=>u.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[o(e(B),{type:"primary",onClick:O,disabled:e(C),loading:e(C)},{default:t(()=>[...x[5]||(x[5]=[l("提交",-1)])]),_:1},8,["disabled","loading"]),o(e(B),{onClick:x[1]||(x[1]=d=>u.value=!1)},{default:t(()=>[...x[6]||(x[6]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[o(e(P),null,{default:t(()=>[...x[4]||(x[4]=[l(" 要更换标题颜色吗？每次收费500个olo喔 ",-1)])]),_:1}),o(e(ho),{value:I.value,"onUpdate:value":x[0]||(x[0]=d=>I.value=d),modes:["hex"],"show-alpha":!1,style:{"max-width":"8.2rem"},swatches:p},null,8,["value"])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),ba=te(),_a=c=>{const n=me.Get("api/crowds/"+c,{name:"crowdDataGetter-"+c,params:{binggan:ba.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},wa=c=>{const n=me.Post("api/crowds/",c,{name:"userCrowdPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},ya=c=>{const n=me.Post("api/crowds/repeal",c,{name:"adminCrowdRepealPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Ca={style:{"text-align":"center"}},ka={key:0},Ia={key:1},Sa={key:2},Pa={key:3},$a=re({__name:"CrowdComponent",props:{crowdId:{},forumId:{}},setup(c){At(j=>({"02a8d6e9":e(v).dividerColor}));const n=c,i=te(),R=de(),v=qt(),h=y(1e3),I=z(()=>{const j=W.tz(M.value.end_date),E=W(),ae=j.diff(E,"hour");return ae>=1?`${ae}小时后`:`${j.diff(E,"minute")}分钟后`}),p=z(()=>W.tz(M.value.end_date).format("YY年M月D日 HH:mm")),u=z(()=>W().isAfter(W.tz(M.value.end_date))),g=[{label:"中止",key:"repeal",icon:we(Et,{size:"1.5rem"})}];function C(j){switch(j){case"repeal":oe();break}}const S=[{title:"我支持的olo",key:"olo",resizable:!0},{title:"参与时间",key:"created_at",resizable:!0}],{data:_,loading:O,send:K,onSuccess:x}=ee(_a(n.crowdId),{immediate:!1});function d(){K({binggan:i.binggan})}i.binggan&&d();const M=z(()=>{var j;return(j=_.value)==null?void 0:j.crowd}),$=z(()=>{var j,E;return(E=(j=_.value)==null?void 0:j.crowd_record)!=null?E:[]}),q=z(()=>Math.round(M.value.olo_total/M.value.olo_target*100)),{loading:L,send:m,onSuccess:f}=ee(j=>wa(j),{immediate:!1});f(()=>{d()});function H(){if(!h.value){window.$message.error("请输入众筹金额喔");return}const j={binggan:i.binggan,crowd_olo:h.value,crowd_id:n.crowdId},E={title:"参加众筹",closable:!1,content:`确定要参加众筹吗？将消耗${h.value}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{m(j)}};window.$dialog.warning(E)}function oe(){const j={binggan:i.binggan,crowd_id:n.crowdId},E={title:"中止众筹",closable:!1,content:"确定要中止众筹吗？已投注的olo将会退回",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{ya(j).then(()=>{d()})}};window.$dialog.warning(E)}return(j,E)=>(r(),b(e(ue),{size:"small",bordered:!0},{default:t(()=>[o(e(ke),{show:e(O)},{default:t(()=>[M.value!==void 0?(r(),b(e(k),{key:0,vertical:""},{default:t(()=>[o(e(k),{size:"small",align:"center",class:"crowd-title"},{default:t(()=>[o(e(_e),{size:e(R).isMobile?24:32},{default:t(()=>[o(e(Ro))]),_:1},8,["size"]),G("span",null,T(M.value.title),1)]),_:1}),o(e(k),{vertical:"",align:"center"},{default:t(()=>[o(e(tt),{type:"dashboard",status:"success",percentage:q.value},{default:t(()=>[G("span",Ca,"进度"+T(q.value)+"% ",1)]),_:1},8,["percentage"]),u.value&&M.value.is_closed===0?(r(),F("span",ka,"众筹已经过期了")):w("",!0),M.value.is_closed===1?(r(),F("span",Ia,"众筹已达成目标！谢谢各位参与~")):w("",!0),M.value.is_closed===2?(r(),F("span",Sa,"众筹已经被管理员中止，olo已退回")):w("",!0),!u.value&&M.value.is_closed===0?(r(),F("div",Pa,[o(e(P),{depth:3},{default:t(()=>[...E[1]||(E[1]=[l("结束时间：",-1)])]),_:1}),G("span",null,T(p.value)+" ("+T(I.value)+")",1)])):w("",!0),G("div",null,[o(e(P),{depth:3},{default:t(()=>[...E[2]||(E[2]=[l("众筹目标：",-1)])]),_:1}),G("span",null,T(`${M.value.olo_target.toLocaleString("en-us")} 个olo`),1)]),G("div",null,[o(e(P),{depth:3},{default:t(()=>[...E[3]||(E[3]=[l("已众筹到：",-1)])]),_:1}),G("span",null,T(`${M.value.olo_total.toLocaleString("en-us")} 个olo`),1)]),o(e(k),{size:"small",align:"center"},{default:t(()=>[o(e(Ve),{max:1e6,min:1,step:1e3,placeholder:"投入额",disabled:u.value||M.value.is_closed!==0,value:h.value,"onUpdate:value":E[0]||(E[0]=ae=>h.value=ae)},null,8,["disabled","value"]),o(e(B),{type:"primary",onClick:H,loading:e(L),disabled:e(L)||u.value||M.value.is_closed!==0},{default:t(()=>[...E[4]||(E[4]=[l("投入",-1)])]),_:1},8,["loading","disabled"]),e(i).checkAdminForums(j.forumId)&&M.value.is_closed===0?(r(),b(e(Fe),{key:0,trigger:e(R).isMobile?"click":"hover",options:g,onSelect:C,placement:"bottom-start"},{default:t(()=>[o(e(B),{type:"warning"},{default:t(()=>[...E[5]||(E[5]=[l("管理",-1)])]),_:1})]),_:1},8,["trigger"])):w("",!0)]),_:1})]),_:1}),$.value.length>0?(r(),b(e(Nt),{key:0,columns:S,data:$.value,bordered:!1},null,8,["data"])):w("",!0)]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),xa=Re($a,[["__scopeId","data-v-c8ea6852"]]),Ma=te(),Da=c=>{const n=me.Get("api/gambles/"+c,{name:"gambleDataGetter-"+c,params:{binggan:Ma.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},La=c=>{const n=me.Post("api/gambles/",c,{name:"userGamblePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},za=c=>{const n=me.Post("api/gambles/close",c,{name:"adminGambleClosePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Ta=c=>{const n=me.Post("api/gambles/repeal",c,{name:"adminGambleRepealPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Ra={key:0},Ha={key:1},Aa={key:2},qa={key:3},Na={class:"gamble-item"},Ga={style:{"margin-left":"auto"}},Ea=re({__name:"GambleComponent",props:{gambleId:{},forumId:{}},setup(c){At(N=>({"8196b06e":e(v).dividerColor}));const n=c,i=te(),R=de(),v=qt(),h=y(),I=y(1e3),p=z(()=>{const N=W.tz($.value.end_date),D=W(),A=N.diff(D,"hour");return A>=1?`${A}小时后`:`${N.diff(D,"minute")}分钟后`}),u=z(()=>W.tz($.value.end_date).format("YY年M月D日 HH:mm")),g=z(()=>W().isAfter(W.tz($.value.end_date))),C=[{label:"开奖",key:"close",icon:we(Ao,{size:"1.5rem"})},{label:"中止",key:"repeal",icon:we(Et,{size:"1.5rem"})}];function S(N){switch(N){case"close":E();break;case"repeal":ae();break}}const _=[{title:"我的投注",key:"option_text",resizable:!0},{title:"投注额",key:"betting_olo",resizable:!0},{title:"赔率",key:"odds",render:N=>{var D,A;return(A=(D=N.odds)==null?void 0:D.toFixed(2))!=null?A:"（开奖时确定）"},resizable:!0},{title:"奖金",key:"win_olo",resizable:!0}],{data:O,loading:K,send:x,onSuccess:d}=ee(Da(n.gambleId),{immediate:!1});function M(){x({binggan:i.binggan})}i.binggan&&M();const $=z(()=>O.value.gamble_question),q=z(()=>O.value.gamble_options),L=z(()=>{var N,D;return(D=(N=O.value.user_choices)==null?void 0:N.map(A=>{var ne;return Ct(yt({},A),{option_text:(ne=q.value.find(He=>He.id===A.option_id))==null?void 0:ne.option_text})}))!=null?D:[]}),m=z(()=>{var N;return(N=q.value.find(D=>D.id===$.value.result_option_id))==null?void 0:N.option_text}),{loading:f,send:H,onSuccess:oe}=ee(N=>La(N),{immediate:!1});oe(()=>{M()});function j(){if(!h.value||!I.value){window.$message.error("请选择选项和输入投注额喔");return}const N={binggan:i.binggan,gamble_question_id:n.gambleId,bet_option:h.value,betting_olo:I.value},D={title:"参加菠菜",closable:!1,content:`确定要参加菠菜吗？将消耗${I.value}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{H(N)}};window.$dialog.warning(D)}function E(){var A;if(!h.value){window.$message.error("请选择选项喔");return}const N={binggan:i.binggan,gamble_question_id:n.gambleId,result_option:h.value},D={title:"开奖菠菜",closable:!1,content:`确定要开奖吗？开奖选项是：${(A=q.value.find(ne=>ne.id===h.value))==null?void 0:A.option_text}`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{za(N).then(()=>{M()})}};window.$dialog.warning(D)}function ae(){const N={binggan:i.binggan,gamble_question_id:n.gambleId},D={title:"中止菠菜",closable:!1,content:"确定要中止菠菜吗？已投注的olo将会退回",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Ta(N).then(()=>{M()})}};window.$dialog.warning(D)}return(N,D)=>(r(),b(e(ue),{size:"small",bordered:!0},{default:t(()=>[o(e(ke),{show:e(K)},{default:t(()=>[e(O)!==void 0?(r(),b(e(k),{key:0,vertical:""},{default:t(()=>[o(e(k),{size:"small",align:"center",class:"gamble-title"},{default:t(()=>[o(e(_e),{size:e(R).isMobile?24:32},{default:t(()=>[o(e(Ho))]),_:1},8,["size"]),G("span",null,T($.value.title),1)]),_:1}),o(e(bo),{value:h.value,"onUpdate:value":D[0]||(D[0]=A=>h.value=A)},{default:t(()=>[o(e(k),{vertical:"",size:"large"},{default:t(()=>[(r(!0),F(le,null,ze(q.value,(A,ne)=>(r(),F("div",{key:A.id},[o(e(_o),{value:A.id,label:`（当前赔率 ${A.odds.toFixed(2)}）： ${A.id==$.value.result_option_id?"⭐":""} ${A.option_text}`},null,8,["value","label"]),o(e(tt),{status:"success",type:"line",height:e(R).isMobile?20:24,percentage:Math.floor(A.olo_total/$.value.olo_total*100),"indicator-placement":"inside"},{default:t(()=>[l(T(A.olo_total),1)]),_:2},1032,["height","percentage"])]))),128))]),_:1})]),_:1},8,["value"]),g.value&&$.value.is_closed===0?(r(),F("span",Ra,"菠菜已经关闭投注")):w("",!0),$.value.is_closed===1?(r(),F("span",Ha,T(`菠菜已开奖，奖金已发放。中奖项是：${m.value}`),1)):w("",!0),$.value.is_closed===2?(r(),F("span",Aa,"菠菜已经被管理员中止，投注olo已退回")):w("",!0),!g.value&&$.value.is_closed===0?(r(),F("div",qa,[o(e(P),{depth:3},{default:t(()=>[...D[2]||(D[2]=[l("结束时间：",-1)])]),_:1}),G("span",null,T(u.value)+" ("+T(p.value)+")",1)])):w("",!0),o(e(k),{size:"small",align:"center"},{default:t(()=>[o(e(Ve),{max:1e6,min:1,step:1e3,placeholder:"投注额",disabled:g.value||$.value.is_closed!==0,value:I.value,"onUpdate:value":D[1]||(D[1]=A=>I.value=A)},null,8,["disabled","value"]),o(e(B),{type:"primary",onClick:j,loading:e(f),disabled:e(f)||g.value||$.value.is_closed!==0},{default:t(()=>[...D[3]||(D[3]=[l("投注",-1)])]),_:1},8,["loading","disabled"]),e(i).checkAdminForums(N.forumId)&&$.value.is_closed===0?(r(),b(e(Fe),{key:0,trigger:e(R).isMobile?"click":"hover",options:C,onSelect:S,placement:"bottom-start"},{default:t(()=>[o(e(B),{type:"warning"},{default:t(()=>[...D[4]||(D[4]=[l("管理",-1)])]),_:1})]),_:1},8,["trigger"])):w("",!0)]),_:1}),!e(R).isMobile&&L.value.length>0?(r(),b(e(Nt),{key:4,columns:_,data:L.value,bordered:!1},null,8,["data"])):w("",!0),e(R).isMobile?(r(),F(le,{key:5},[L.value.length>0?(r(),b(e(k),{key:0,vertical:"",align:"start",size:"small"},{default:t(()=>[(r(!0),F(le,null,ze(L.value,A=>(r(),F("div",Na,[o(e(k),{style:{"margin-bottom":"6px"}},{default:t(()=>[G("div",null,[o(e(P),{depth:3},{default:t(()=>[...D[5]||(D[5]=[l("我的投注：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[l(T(A.option_text),1)]),_:2},1024)])]),_:2},1024),o(e(k),{style:{"margin-bottom":"6px"}},{default:t(()=>[G("div",null,[o(e(P),{depth:3},{default:t(()=>[...D[6]||(D[6]=[l("投注额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[l(T(A.betting_olo),1)]),_:2},1024)])]),_:2},1024),A.win_olo?(r(),b(e(k),{key:0,style:{"margin-bottom":"6px"}},{default:t(()=>[G("div",null,[o(e(P),{depth:3},{default:t(()=>[...D[7]||(D[7]=[l("赔率：",-1)])]),_:1}),o(e(P),null,{default:t(()=>{var ne;return[l(T((ne=A.odds)==null?void 0:ne.toFixed(2)),1)]}),_:2},1024)]),G("div",Ga,[o(e(P),{depth:3},{default:t(()=>[...D[8]||(D[8]=[l("奖金：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[l(T(A.win_olo),1)]),_:2},1024)])]),_:2},1024)):w("",!0)]))),256))]),_:1})):w("",!0)],64)):w("",!0)]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),Oa=Re(Ea,[["__scopeId","data-v-d08fb987"]]),ja={key:0},Ua=re({__name:"HongbaoComponent",props:{hongbaoId:{},threadId:{},forumId:{},noHongbaoPicMode:{type:Boolean}},emits:["refreshPostsList"],setup(c,{emit:n}){const i=te(),R=de(),v=c,h=z(()=>g.value.pic_url&&!v.noHongbaoPicMode),I=z(()=>h.value?{backgroundImage:`linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)), url(${g.value.pic_url})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{}),p=y(),u=z(()=>({1:"随机olo",2:"定额olo"})[g.value.type]),{data:g,loading:C,send:S,onSuccess:_}=ee(xo(v.hongbaoId),{immediate:!1,initialData:{}});_(q=>{p.value=q.data.key_word});function O(){S({binggan:i.binggan})}i.binggan&&O();const{loading:K,send:x,onSuccess:d}=ee(q=>Mo(q),{immediate:!1});d(()=>{$("refreshPostsList")});function M(q){if(!q.isTrusted){const H={title:"错误",closable:!1,content:"请不要用脚本抢红包喔",positiveText:"确定"};window.$dialog.warning(H);return}const{timestamp:L,newPostKey:m}=Gt(q.isTrusted,v.threadId,i.binggan),f={binggan:i.binggan,forum_id:v.forumId,thread_id:v.threadId,content:"--红包口令: "+p.value,nickname:"= =",post_with_admin:!1,new_post_key:m,timestamp:L,hongbao_id:v.hongbaoId,hongbao_key_word:p.value};x(f).then(()=>{O()})}const $=n;return(q,L)=>(r(),b(e(ue),{size:"small",bordered:!0,class:"hongbao-card",style:ce(I.value)},{default:t(()=>[o(e(ke),{show:e(C)},{default:t(()=>[o(e(k),{vertical:"",align:"center"},{default:t(()=>[o(e(k),{align:"center",size:"small"},{default:t(()=>[o(e(P),{style:{"font-size":"1rem"}},{default:t(()=>[...L[1]||(L[1]=[l("口令红包",-1)])]),_:1}),h.value?w("",!0):(r(),F("img",{key:0,src:"/hongbao.svg",style:ce({height:e(R).isMobile?"30px":"36px"})},null,4))]),_:1}),G("div",null,[e(g).key_word?(r(),b(e(P),{key:0,depth:3},{default:t(()=>[...L[2]||(L[2]=[l("口令：",-1)])]),_:1})):w("",!0),o(e(P),null,{default:t(()=>[l(T(e(g).key_word),1)]),_:1})]),G("div",null,[o(e(P),{depth:3},{default:t(()=>[...L[3]||(L[3]=[l("数量：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[l(T(e(g).num_remains)+" /"+T(e(g).num_total)+" （"+T(u.value)+"）",1)]),_:1})]),e(g).olo_hide?w("",!0):(r(),F("div",ja,[o(e(P),{depth:3},{default:t(()=>[...L[4]||(L[4]=[l("总额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>{var m;return[l(T((m=e(g).olo_total)==null?void 0:m.toLocaleString("en-us"))+" olo ",1)]}),_:1})])),o(e(k),{size:"small",wrap:!1},{default:t(()=>{var m;return[e(g).hongbao_user===null?(r(),b(e(Ce),{key:0,value:p.value,"onUpdate:value":L[0]||(L[0]=f=>p.value=f),maxlength:255,onKeyup:ye(M,["enter"]),style:{"max-width":"328px"},placeholder:e(g).num_remains===0?"已经抢光啦":"请输入口令","auto-size":"",disabled:e(g).hongbao_user!==null||e(g).num_remains===0},null,8,["value","placeholder","disabled"])):(r(),b(e(Ce),{key:1,value:`你抢到了${(m=e(g).hongbao_user)==null?void 0:m.olo.toLocaleString("en-us")}个olo`,maxlength:255,style:{"max-width":"328px"},"auto-size":"",disabled:""},null,8,["value"])),o(e(B),{type:"primary",onClick:M,disabled:e(g).hongbao_user!==null||e(K)||e(g).num_remains===0},{default:t(()=>[...L[5]||(L[5]=[l("抢！",-1)])]),_:1},8,["disabled"])]}),_:1})]),_:1})]),_:1},8,["show"])]),_:1},8,["style"]))}}),Fa=Re(Ua,[["__scopeId","data-v-d0fedc06"]]),Va=te(),Ba=c=>{const n=me.Get("api/votes/"+c,{name:"voteDataGetter-"+c,params:{binggan:Va.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},Wa=c=>{const n=me.Post("api/votes/",c,{name:"userVotePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Ka={key:0},Ya=re({__name:"VoteComponent",props:{voteId:{}},setup(c){const n=c,i=te(),R=de(),v=y([]);Le(v,(m,f)=>{m.length>O.value.max_choices&&(window.$message.error(`最多只能选择${O.value.max_choices}个选项喔`),v.value=f)});const h=z(()=>{const m=W.tz(O.value.end_date),f=W(),H=m.diff(f,"hour");return H>=1?`${H}小时后`:`${m.diff(f,"minute")}分钟后`}),I=z(()=>W.tz(O.value.end_date).format("YY年M月D日 HH:mm")),p=z(()=>W().isAfter(W.tz(O.value.end_date))),{data:u,loading:g,send:C,onSuccess:S}=ee(Ba(n.voteId),{immediate:!1});S(m=>{m.data.user_choices&&(v.value=m.data.user_choices.options_id)});function _(){C({binggan:i.binggan})}i.binggan&&_();const O=z(()=>u.value.vote_question),K=z(()=>u.value.vote_options),x=z(()=>u.value.user_choices),d=z(()=>x.value!==null),{loading:M,send:$,onSuccess:q}=ee(m=>Wa(m),{immediate:!1});q(()=>{_()});function L(){const m={binggan:i.binggan,vote_question_id:n.voteId,vote_options:v.value};$(m)}return(m,f)=>(r(),b(e(ue),{size:"small",bordered:!0},{default:t(()=>[o(e(ke),{show:e(g)},{default:t(()=>[e(u)!==void 0?(r(),b(e(k),{key:0,vertical:""},{default:t(()=>[o(e(k),{size:"small",align:"center",class:"vote-title"},{default:t(()=>[o(e(_e),{size:e(R).isMobile?24:32},{default:t(()=>[o(e(qo))]),_:1},8,["size"]),G("span",null,T(e(u).vote_question.title),1)]),_:1}),o(e(wo),{value:v.value,"onUpdate:value":f[0]||(f[0]=H=>v.value=H),disabled:d.value},{default:t(()=>[o(e(k),{vertical:"",size:"large"},{default:t(()=>[(r(!0),F(le,null,ze(K.value,(H,oe)=>(r(),F("div",{key:H.id},[o(e(yo),{value:H.id,label:`${oe+1}. ${H.option_text}`},null,8,["value","label"]),o(e(tt),{status:"success",type:"line",height:e(R).isMobile?20:24,percentage:Math.floor(H.vote_total/O.value.vote_total*100),"indicator-placement":"inside"},{default:t(()=>[l(T(H.vote_total)+"票 ",1)]),_:2},1032,["height","percentage"])]))),128))]),_:1})]),_:1},8,["value","disabled"]),p.value?(r(),F("span",Ka,"投票已经结束了")):(r(),F(le,{key:1},[G("div",null,[o(e(P),{depth:3},{default:t(()=>[...f[1]||(f[1]=[l("最多选择：",-1)])]),_:1}),G("span",null,T(O.value.max_choices)+"个选项",1)]),G("div",null,[o(e(P),{depth:3},{default:t(()=>[...f[2]||(f[2]=[l("结束时间：",-1)])]),_:1}),G("span",null,T(I.value)+" ("+T(h.value)+")",1)])],64)),o(e(k),{size:"small",align:"center"},{default:t(()=>[o(e(B),{type:"primary",onClick:L,loading:e(M),disabled:e(M)||d.value||p.value},{default:t(()=>[...f[3]||(f[3]=[l("投票",-1)])]),_:1},8,["loading","disabled"]),d.value?(r(),b(e(P),{key:0,depth:3},{default:t(()=>[...f[4]||(f[4]=[l("你已经投过票了，谢谢参与！",-1)])]),_:1})):w("",!0)]),_:1})]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),Qa=Re(Ya,[["__scopeId","data-v-467006fa"]]),Ja=te(),Xa=c=>{const n=me.Post("api/store_pool",c,{name:"poolStorePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Za=()=>{const c=me.Get("api/get_pool",{name:"poolDataGetter",params:{binggan:Ja.binggan},localCache:null,hitSource:[]});return c.meta={shouldRemind:!1},c},en=re({__name:"PoolComponent",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(c,{emit:n}){const i=c,R=te(),v=de(),h=W.tz("2025-1-29 00:00"),I=W.tz("2025-2-1 00:00"),p=z(()=>{const m=W.tz();return m<h?0:m>I?2:1}),u=z(()=>({0:`活动将于 ${h.format("M月D日H点")} 开始`,1:`请投入你的祝福~~，活动将于${I.format("M月D日H点")}结束。（${g.value}）`,2:"祝福池已关闭，请等待开奖。"})[p.value]),g=z(()=>{const m=W.tz(),f=I.diff(m,"hour"),H=I.diff(m,"minute")-60*f;return`剩余${f}小时${H}分钟`}),C=y(),{data:S,loading:_,send:O,onSuccess:K}=ee(Za(),{immediate:!1,initialData:{}});function x(){O()}R.binggan&&x();const{loading:d,send:M,onSuccess:$}=ee(m=>Xa(m),{immediate:!1});function q(m){if(C.value===void 0){const H={title:"错误",closable:!1,content:"请输入祝福语喔",positiveText:"确定"};window.$dialog.warning(H);return}const f={binggan:R.binggan,forum_id:i.forumId,thread_id:i.threadId,message:C.value,olo:m?3e5:1e3,admin:m};M(f).then(()=>{x(),L("refreshPostsList")})}const L=n;return(m,f)=>(r(),b(e(ue),{size:"small",bordered:!0},{default:t(()=>[o(e(ke),{show:e(_)},{default:t(()=>[o(e(k),{vertical:"",align:"center"},{default:t(()=>[o(e(k),{align:"center",size:"small"},{default:t(()=>[o(e(P),{style:{"font-size":"1rem"}},{default:t(()=>[...f[4]||(f[4]=[l("祝福池",-1)])]),_:1}),G("img",{src:"/hongbao.svg",style:ce({height:e(v).isMobile?"30px":"36px"})},null,4)]),_:1}),G("div",null,[o(e(P),{depth:3},{default:t(()=>[...f[5]||(f[5]=[l("祝福池总额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>{var H;return[l(T((H=e(S).olo_total)==null?void 0:H.toLocaleString("en-us"))+" olo ",1)]}),_:1})]),o(e(k),{size:"small",wrap:!1},{default:t(()=>[o(e(Ce),{value:C.value,"onUpdate:value":f[0]||(f[0]=H=>C.value=H),maxlength:255,onKeyup:f[1]||(f[1]=ye(H=>q(!1),["enter"])),style:{"max-width":"328px"},placeholder:e(S).user_pool===null?"请留下祝福语":"已经投过祝福啦","auto-size":"",disabled:e(S).user_pool!==null},null,8,["value","placeholder","disabled"]),o(e(B),{type:"primary",onClick:f[2]||(f[2]=H=>q(!1)),disabled:e(S).user_pool!==null||e(d)||p.value!==1},{default:t(()=>[...f[6]||(f[6]=[l("投入祝福",-1)])]),_:1},8,["disabled"]),e(R).admin.isSuperAdmin?(r(),b(e(B),{key:0,type:"warning",onClick:f[3]||(f[3]=H=>q(!0))},{default:t(()=>[...f[7]||(f[7]=[l("投入30w",-1)])]),_:1})):w("",!0)]),_:1}),o(e(k),{align:"center",size:"small"},{default:t(()=>[G("span",null,T(u.value),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1}))}}),tn={bordered:!0,class:"post-item-skeleton"},on=re({__name:"ThreadPage",props:{threadId:{},page:{},search:{}},setup(c){const n=te(),i=de(),R=Rt(),v=et(),h=y(null),I=y([]),p=y(null),u=y(null),g=y(null),C=y(null),S=y(null);De(()=>{i.showTopbarNav=!1}),be(()=>{i.showTopbarNav=!0});const _=c,O=y(null),K=y(null),x=y(null),d=y(null),M=y(null),$=y(null),q=y(!0),L=y(!1);De(()=>{L.value=!0}),be(()=>{L.value=!1});const m=z(()=>{const s=W.tz(V.value.nissin_date),a=W(),Y=s.diff(a,"hour"),J=s.diff(a,"minute")-60*Y;return`${Y}小时${J}分钟后`}),f=y(!1),H=y(!1),oe=Z("no_video_mode",!1),j=Z("no_image_mode",!1),E=Z("no_emoji_mode",!1),ae=Z("no_custom_emoji_mode",!1),N=Z("no_head_mode",!1),D=Z("no_battle_mode",!1),A=Z("no_roll_mode",!1),ne=Z("no_reward_mode",!1),He=Z("no_hongbao_mode",!1),Ae=Z("no_hongbao_pic_mode",!1),qe=Z("no_mention_mode",!1),Ne=Z("use_url_mode",!1),ot=Z("no_pailou_mode",!1),Ot=z(()=>{const s=[{ref:oe,label:"音频视频"},{ref:j,label:"图片"},{ref:E,label:"一般表情包"},{ref:ae,label:"自定义表情包"},{ref:N,label:"头像"},{ref:D,label:"大乱斗"},{ref:A,label:"roll点"},{ref:ne,label:"打赏"},{ref:He,label:"红包结果"},{ref:Ae,label:"红包封面"},{ref:qe,label:"关闭@标注"},{ref:ot,label:"无内容排楼"}];return n.admin.isSuperAdmin?s.unshift({ref:f,label:"超管模式启动！"}):n.admin.isNormalAdmin&&s.unshift({ref:H,label:"让代码失效"}),s});function jt(){return Ue(k,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(Ot.value).map(s=>Ue(Dt,{checked:s.ref.value,"onUpdate:checked":a=>s.ref.value=a,label:s.label})),Ue($o,{keepAliveOnHover:!1,placement:"bottom",style:{width:"max-content"}},{trigger:()=>Ue(Dt,{checked:Ne.value,"onUpdate:checked":s=>Ne.value=s,label:"自动转换超链接"}),default:()=>"实验性功能，可能会导致回复显示出错"})])}const Ut=[{type:"group",key:"header",label:"屏蔽"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:jt}],Ft=z(()=>{const s=[{label:"删除主题",key:"deleteThread",icon:we(na,{size:"1.5rem"})}];return V.value.sub_id===0?s.push({label:"设为置顶",key:"setTop",icon:we(Oo,{size:"1.5rem"})}):s.push({label:"取消置顶",key:"cancelTop",icon:we(jo,{size:"1.5rem"})}),s});function Vt(s){var a;(a=$.value)==null||a.show({action:s})}const Ie=y(_.page);function at(s){v.push({name:"thread",params:{threadId:_.threadId,page:s},query:{search:_.search}})}Le(()=>_.page,s=>Ie.value=s);const nt=z(()=>({threadId:_.threadId,binggan:n.binggan,page:_.page,searchContent:_.search,noMentionMode:qe.value})),{loading:fe,data:pe,onSuccess:Bt,onError:Wt,send:Kt}=Co(()=>Mt(nt.value),[()=>_.threadId,()=>_.page,()=>_.search],{initialData:{},immediate:!0});Bt(s=>{document.title=s.data.thread_data.title,Xe(()=>{if(R.hash){const a=document.querySelector(R.hash);a==null||a.scrollIntoView({block:"center",behavior:"auto"}),a==null||a.classList.add("on-focus")}})}),Wt(s=>{var a;q.value=!1,s.error.cause!==void 0&&s.error.cause.code!==401&&((a=d.value)==null||a.show({errorCode:s.error.cause.code,message:s.error.message}))}),De(()=>{Kt(),q.value=!0}),be(()=>{var s;fe.value=!0,(s=h.value)==null||s.resetInput()});const st=y(!1),{fetching:Be,onSuccess:Yt,onError:Qt,fetch:Jt}=ko();function se(s=!1){Be.value!==!0&&(st.value=s,Jt(Mt(nt.value)))}Yt(()=>{I.value.forEach(s=>{s.refreshBattleData()}),st.value&&!i.userCustom.lessToast&&window.$message.success("已刷新数据")}),Qt(s=>{var a;q.value=!1,s.error.cause!==void 0&&((a=d.value)==null||a.show({errorCode:s.error.cause.code,message:s.error.message}))});const Xt=z(()=>pe.value.posts_data.data),V=z(()=>pe.value.thread_data),Q=z(()=>pe.value.forum_data),Ge=z(()=>pe.value.your_post_floors),lt=z(()=>{let s;return s=Xt.value.filter(a=>{var Y;if(D.value===!0&&a.battle_id!==null||A.value===!0&&a.created_by_admin===2&&a.nickname==="Roll点系统")return!1;if(ne.value===!0&&a.created_by_admin===2&&a.nickname==="奥利奥打赏系统"&&!a.is_your_post){if(Ge.value.length>0){const J=a.content.match(/@№[0-9]+/g);if(J===null)return!1;const X=Number(J[0].slice(2));if(Ge.value.includes(X))return!0}return!1}if(He.value===!0){const J=a.created_by_admin==2&&a.nickname=="红包结果"&&!a.is_your_post,X=/^--红包口令: /.test(a.content)&&!a.is_your_post;if(J||X)return!1}if(ot.value===!0&&!a.is_your_post&&new RegExp("^<span(.*?)<\\/span>$","s").test(a.content))return!1;if((Y=n.userData)!=null&&Y.binggan.use_pingbici&&i.userCustom.hidePingbiciFloor){const J=i.userCustom.pingbiciIngnoreCase?"gi":"g";for(let X of n.userData.pingbici.content_pingbici)if(new RegExp(X,J).test(a.content))return!1;if(V.value.anti_jingfen){for(let X of n.userData.pingbici.fjf_pingbici)if(new RegExp(X,"g").test(a.created_binggan_hash.slice(0,5)))return!1}for(let X of n.userData.pingbici.fjf_pingbici)if(new RegExp(X,J).test(a.nickname))return!1}return!0}),s}),Ee=y(_.search),Oe=y(!!_.search);function rt(){v.push({name:"thread",params:{threadId:_.threadId,page:1},query:{search:Ee.value||void 0}})}function Zt(){Ee.value=void 0,Oe.value=!1,v.push({name:"thread",params:{threadId:_.threadId,page:1}})}const ge=y(!1),je=y(!1),it=z(()=>_.page===(fe.value?_.page:pe.value.posts_data.lastPage)),Se=ia();function eo(s){s.post_floor>=_.page*200?(ge.value=!1,je.value=!0):pe.value.posts_data.data.find(Y=>Y.id===s.post_id)||to(s.thread_id,s.post_id)}function to(s,a){const Y={binggan:n.binggan,post_id:a,thread_id:s};Lo(Y).then(J=>{pe.value.posts_data.data.push(J),i.userCustom.hongbaoThenStop&&J.hongbao_id!==null&&(window.$message.info("有红包！停止涮锅！（个人中心开启了红包自动停止涮锅）"),ge.value=!1);const X=document.body.clientHeight-document.documentElement.scrollTop;Xe(()=>{var ve;((ve=h.value)!=null&&ve.isTyping||i.userCustom.holdPageWhenListening)&&(document.documentElement.scrollTop=document.body.clientHeight-X)})})}Le(ge,s=>{var a;if(s===!0)try{se(!1),Se.connect(),Se.channel("thread_"+_.threadId).listen("NewPost",Y=>eo(Y)),(a=Se.pusher)==null||a.connection.bind("state_change",Y=>{Y.current==="unavailable"&&(window.$message.error("嗷……服务器的自动涮锅服务好像出问题了，暂时不能使用"),ge.value=!1)})}catch(Y){window.$message.error("嗷……服务器的自动涮锅服务好像出问题了，暂时不能使用"),ge.value=!1}else Se.isConnected&&Se.disconnect()}),be(()=>{ge.value=!1}),Le([()=>_.threadId,()=>_.page,()=>_.search],()=>{ge.value=!1,je.value=!1});let ut,We;function dt(s,a){const{timestamp:Y,newPostKey:J}=Gt(s.ist,V.value.id,n.binggan),X={binggan:n.binggan,forum_id:Q.value.id,thread_id:V.value.id,content:s.contentInput,nickname:s.nicknameInput,post_with_admin:s.postWithAdmin,new_post_key:J,timestamp:Y};We=a,ut=s,no(X)}function oo(){dt(ut,We)}const{loading:ao,send:no,onSuccess:so,onError:lo}=ee(s=>Do(s),{immediate:!1});so(()=>{We("success"),se(!1)}),lo(s=>{var a;s.error.cause!==void 0&&s.error.cause.code===244291&&((a=K.value)==null||a.show())});function mt(s){s.ctrlKey&&s.key==="x"&&se(!0)}return De(()=>{window.addEventListener("keyup",mt)}),be(()=>{window.removeEventListener("keyup",mt)}),(s,a)=>{var J,X;const Y=Ht("router-link");return r(),F(le,null,[o(e(k),{vertical:""},{default:t(()=>{var ve,ct,ft;return[q.value?(r(),F(le,{key:0},[o(e(k),{align:"center",style:{"margin-top":"8px"}},{default:t(()=>[o(e(_e),{size:e(i).isMobile?28:34},{default:t(()=>[o(e(No),{style:{cursor:"pointer"},onClick:a[0]||(a[0]=U=>Oe.value=!Oe.value)})]),_:1},8,["size"]),o(Lt,{page:Ie.value,"onUpdate:page":[a[1]||(a[1]=U=>Ie.value=U),at],"last-page":e(fe)?1:e(pe).posts_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),Oe.value?(r(),b(e(k),{key:0,wrap:!1},{default:t(()=>[o(e(Ce),{value:Ee.value,"onUpdate:value":a[2]||(a[2]=U=>Ee.value=U),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索回复内容","auto-size":"",onKeyup:ye(rt,["enter"])},null,8,["value"]),o(e(B),{type:"primary",onClick:rt},{default:t(()=>[...a[15]||(a[15]=[l("搜索",-1)])]),_:1}),o(e(B),{type:"default",onClick:Zt},{default:t(()=>[...a[16]||(a[16]=[l("清空",-1)])]),_:1})]),_:1})):w("",!0),e(i).userCustom.loudspeakerPosition==="top"?(r(),b(Qe,{key:1})):w("",!0),o(va,{page:s.page,"thread-id":s.threadId,"posts-list-loading":e(fe),"disable-scroll":!!s.search,"is-search":!!s.search},null,8,["page","thread-id","posts-list-loading","disable-scroll","is-search"])],64)):w("",!0),!e(fe)&&q.value?(r(),F(le,{key:1},[o(e(ue),{class:"thread-title-container",size:"small",key:"title-card"},{default:t(()=>{var U,ie,Pe,$e;return[G("span",{class:"thread-title",style:ce({fontSize:e(i).userCustom.fontSizeThreadList+"px"})},T((U=V.value)==null?void 0:U.title)+" ["+T((ie=V.value)==null?void 0:ie.posts_num)+"] ",5),e(n).checkAdminForums((Pe=Q.value)==null?void 0:Pe.id)?(r(),b(e(Fe),{key:0,trigger:"click",options:Ft.value,onSelect:Vt,size:e(i).isMobile?"medium":"large"},{default:t(()=>[o(e(_e),{size:e(i).isMobile?20:24,style:{cursor:"pointer",float:"right","margin-left":"0.5rem"}},{default:t(()=>[o(e(Go))]),_:1},8,["size"])]),_:1},8,["options","size"])):w("",!0),($e=V.value)!=null&&$e.is_your_thread?(r(),b(e(B),{key:1,size:"small",type:"primary",style:{float:"right","margin-left":"0.5rem"},onClick:a[3]||(a[3]=Ke=>{var xe;return(xe=O.value)==null?void 0:xe.show()})},{default:t(()=>[...a[17]||(a[17]=[l(" 变色 ",-1)])]),_:1})):w("",!0)]}),_:1}),o(e(k),{vertical:"",size:2},{default:t(()=>{var U,ie,Pe,$e,Ke,xe,pt,gt;return[o(xt,{"post-data":lt.value[0],"your-posts-list":Ge.value,"anti-jingfen":(U=V.value)==null?void 0:U.anti_jingfen,"forum-id":Q.value.id,"no-custom-emoji-mode":e(ae),"no-emoji-mode":e(E),"no-head-mode":e(N),"no-image-mode":e(j),"no-video-mode":e(oe),"use-url-mode":e(Ne),"random-head-group-index":V.value.random_heads_group,"super-admin-mode":f.value,"no-mention-mode":e(qe),onShowRewardModal:(ie=M.value)==null?void 0:ie.show,"no-hongbao-pic-mode":e(Ae),onQuoteClick:(Pe=h.value)==null?void 0:Pe.quoteHandle,onRefreshPostsList:a[4]||(a[4]=Me=>se(!1)),onAdminHandle:($e=$.value)==null?void 0:$e.show},null,8,["post-data","your-posts-list","anti-jingfen","forum-id","no-custom-emoji-mode","no-emoji-mode","no-head-mode","no-image-mode","no-video-mode","use-url-mode","random-head-group-index","super-admin-mode","no-mention-mode","onShowRewardModal","no-hongbao-pic-mode","onQuoteClick","onAdminHandle"]),V.value.vote_question_id!==null?(r(),b(Qa,{key:0,ref_key:"VoteComponentCom",ref:p,"vote-id":V.value.vote_question_id},null,8,["vote-id"])):w("",!0),V.value.gamble_question_id!==null?(r(),b(Oa,{key:1,ref_key:"GambleComponentCom",ref:u,"gamble-id":V.value.gamble_question_id,"forum-id":(Ke=Q.value)==null?void 0:Ke.id},null,8,["gamble-id","forum-id"])):w("",!0),V.value.crowd_id!==null?(r(),b(xa,{key:2,ref_key:"CrowdComponentCom",ref:g,"crowd-id":V.value.crowd_id,"forum-id":(xe=Q.value)==null?void 0:xe.id},null,8,["crowd-id","forum-id"])):w("",!0),V.value.hongbao_id!==null?(r(),b(Fa,{key:3,ref_key:"HongbaoComponentCom",ref:C,"hongbao-id":V.value.hongbao_id,"thread-id":s.threadId,"forum-id":(pt=Q.value)==null?void 0:pt.id,"no-hongbao-pic-mode":e(Ae),onRefreshPostsList:a[5]||(a[5]=Me=>se(!1))},null,8,["hongbao-id","thread-id","forum-id","no-hongbao-pic-mode"])):w("",!0),s.threadId===138549?(r(),b(en,{key:4,ref_key:"PoolComponentCom",ref:S,"thread-id":s.threadId,"forum-id":(gt=Q.value)==null?void 0:gt.id,onRefreshPostsList:a[6]||(a[6]=Me=>se(!1))},null,8,["thread-id","forum-id"])):w("",!0),(r(!0),F(le,null,ze(lt.value.slice(1),Me=>{var vt,ht,bt,_t;return r(),b(xt,{key:Me.id,"post-data":Me,"your-posts-list":Ge.value,"anti-jingfen":(vt=V.value)==null?void 0:vt.anti_jingfen,"forum-id":Q.value.id,"no-custom-emoji-mode":e(ae),"no-emoji-mode":e(E),"no-head-mode":e(N),"no-image-mode":e(j),"no-video-mode":e(oe),"use-url-mode":e(Ne),"random-head-group-index":V.value.random_heads_group,"super-admin-mode":f.value,"admin-mode":H.value,"no-mention-mode":e(qe),onShowRewardModal:(ht=M.value)==null?void 0:ht.show,"no-hongbao-pic-mode":e(Ae),onQuoteClick:(bt=h.value)==null?void 0:bt.quoteHandle,onRefreshPostsList:a[7]||(a[7]=an=>se(!1)),onAdminHandle:(_t=$.value)==null?void 0:_t.show,ref_for:!0,ref_key:"PostItemComs",ref:I},null,8,["post-data","your-posts-list","anti-jingfen","forum-id","no-custom-emoji-mode","no-emoji-mode","no-head-mode","no-image-mode","no-video-mode","use-url-mode","random-head-group-index","super-admin-mode","admin-mode","no-mention-mode","onShowRewardModal","no-hongbao-pic-mode","onQuoteClick","onAdminHandle"])}),128))]}),_:1}),o(e(k),{align:"center",style:{"margin-top":"8px"}},{default:t(()=>[o(e(B),{type:"primary",loading:e(Be),disabled:e(Be),onClick:a[8]||(a[8]=U=>se(!0))},{default:t(()=>[...a[18]||(a[18]=[l("刷新",-1)])]),_:1},8,["loading","disabled"]),o(e(Tt),{value:ge.value,"onUpdate:value":a[9]||(a[9]=U=>ge.value=U),disabled:!it.value||je.value},{checked:t(()=>[...a[19]||(a[19]=[l(" 涮锅中 ",-1)])]),unchecked:t(()=>[...a[20]||(a[20]=[l(" 自动涮锅 ",-1)])]),_:1},8,["value","disabled"]),je.value?(r(),b(Y,{key:0,to:{name:"thread",params:{threadId:s.threadId,page:s.page+1}}},{default:t(()=>[...a[21]||(a[21]=[l("回帖已经翻页、点击前往 ",-1)])]),_:1},8,["to"])):w("",!0),it.value?w("",!0):(r(),b(e(P),{key:1},{default:t(()=>[...a[22]||(a[22]=[l("在最新一页才能自动涮锅",-1)])]),_:1}))]),_:1}),o(e(k),{align:"center",style:ce([{"margin-top":"8px"},{paddingRight:e(i).isMobile?"24px":"0px"}])},{default:t(()=>[o(e(Io),{placement:"bottom-start",trigger:"hover"},{trigger:t(()=>[o(e(_e),{size:34},{default:t(()=>[o(e(Eo),{onClick:a[10]||(a[10]=U=>{var ie;return e(v).push({name:"forum",params:{forumId:(ie=Q.value)==null?void 0:ie.id}})}),style:{cursor:"pointer"}})]),_:1})]),default:t(()=>[o(e(P),null,{default:t(()=>[...a[23]||(a[23]=[l("返回小岛",-1)])]),_:1})]),_:1}),o(Lt,{page:Ie.value,"onUpdate:page":[a[11]||(a[11]=U=>Ie.value=U),at],"last-page":e(fe)?1:e(pe).posts_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1},8,["style"]),e(i).userCustom.loudspeakerPosition==="center"?(r(),b(Qe,{key:0})):w("",!0)],64)):(r(),b(e(k),{key:2,vertical:"",size:2},{default:t(()=>[(r(),F(le,null,ze(200,U=>G("div",tn)),64))]),_:1})),St(o(Uo,{ref_key:"postInputCom",ref:h,mode:"post","forum-id":(ve=Q.value)==null?void 0:ve.id,"thread-id":s.threadId,disabled:!1,handling:e(ao),"random-heads-group":(ct=V.value)==null?void 0:ct.random_heads_group,onContentCommit:dt,onRefreshPostsList:se},null,8,["forum-id","thread-id","handling","random-heads-group"]),[[Pt,!e(fe)&&q.value]]),!e(fe)&&q.value?(r(),F(le,{key:3},[o(e(k),{justify:"end"},{default:t(()=>[Q.value.is_nissin===2&&V.value.sub_id===0?(r(),b(e(P),{key:0},{default:t(()=>[a[24]||(a[24]=l(" 本贴将于 ",-1)),o(e(P),{type:"error"},{default:t(()=>[l(T(m.value),1)]),_:1}),a[25]||(a[25]=l(" 日清，请及时更换帖子喔 ",-1))]),_:1})):w("",!0),Q.value.is_nissin===1&&V.value.sub_id===0?(r(),b(e(P),{key:1},{default:t(()=>[a[27]||(a[27]=l(" 本小岛 ",-1)),o(e(P),{type:"error"},{default:t(()=>[...a[26]||(a[26]=[l(" 每日早上8:00 ",-1)])]),_:1}),a[28]||(a[28]=l(" 日清，请及时更换帖子喔 ",-1))]),_:1})):w("",!0)]),_:1}),o(e(k),null,{default:t(()=>[o(e(B),{type:"primary",onClick:a[12]||(a[12]=U=>{var ie;return e(v).push({name:"forum",params:{forumId:(ie=Q.value)==null?void 0:ie.id}})})},{default:t(()=>[...a[29]||(a[29]=[l("返回小岛",-1)])]),_:1})]),_:1}),e(i).userCustom.loudspeakerPosition==="bottom"?(r(),b(Qe,{key:0})):w("",!0),a[31]||(a[31]=G("div",{style:{height:"50px"}},null,-1)),L.value?(r(),F(le,{key:1},[(r(),b($t,{to:"#topbar-nav"},[o(Y,{to:{name:"forum",params:{forumId:(ft=Q.value)==null?void 0:ft.id}},class:"flex-item-center"},{default:t(()=>[o(e(So),{tooltip:!1},{default:t(()=>{var U;return[l(T((U=Q.value)==null?void 0:U.name),1)]}),_:1}),o(e(Po),{round:"",class:"forum-tag",size:e(i).isMobile?"small":"medium"},{default:t(()=>{var U;return[l(T((U=Q.value)==null?void 0:U.id),1)]}),_:1},8,["size"])]),_:1},8,["to"])])),(r(),b($t,{to:"#topbar-func"},[o(e(Fe),{trigger:e(i).isMobile?"click":"hover",options:Ut,placement:"bottom-start"},{default:t(()=>[o(e(B),null,{default:t(()=>[...a[30]||(a[30]=[l("屏蔽",-1)])]),_:1})]),_:1},8,["trigger"])]))],64)):w("",!0),o(ha,{ref_key:"ChangeColorModalCom",ref:O,"thread-id":s.threadId},null,8,["thread-id"]),o(Fo,{ref_key:"CaptchaModalCom",ref:K,onWaterUnlockOnSuccess:oo},null,512),o(ca,{ref_key:"JumpModalCom",ref:x,"thread-id":s.threadId,"posts-num":V.value.posts_num,page:s.page},null,8,["thread-id","posts-num","page"]),o(pa,{ref_key:"RewardModalCom",ref:M,onRefreshPostsList:se},null,512)],64)):w("",!0),o(Vo,{mode:"thread",onRefresh:a[13]||(a[13]=U=>se(!0)),onShowJumpModal:a[14]||(a[14]=U=>x.value.show())})]}),_:1}),St(o(e(ke),{size:"large",class:"spin"},null,512),[[Pt,e(fe)]]),o(ma,{ref_key:"ForbiddenModalCom",ref:d},null,512),e(n).checkAdminForums((J=Q.value)==null?void 0:J.id)?(r(),b(fa,{key:0,ref_key:"AdminActionModalCom",ref:$,onRefreshPostsList:se,"thread-id":s.threadId,"forum-id":(X=Q.value)==null?void 0:X.id},null,8,["thread-id","forum-id"])):w("",!0)],64)}}}),bn=Re(on,[["__scopeId","data-v-31ce79c6"]]);export{bn as default};
