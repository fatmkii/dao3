import{R as se,ak as oe,w as ne,$ as p,u as $,b as F,al as ue,am as le,an as ie,A as d,M as _,o,m as e,K as de,L as pe,U as ce,F as b,H as r,af as me,x as k,ag as fe,_ as he,Q as ge,X as A,z as u,N as ve,ao as ye,s as m,B as _e,v as N,ap as be,aq as ke,ah as we,ai as Ie,aj as Se,J as Ce,S as f,ar as Te}from"./vendor-B725aRmw.js";import{u as De,t as G}from"./forums-BfiVd4TM.js";import{s as z}from"./subtitles-DW7M559j.js";import{u as H,a as xe,b as c,c as Le,d as O,_ as $e}from"./app-BSPSecjX.js";import{_ as Fe}from"./loudspeaker-CI4gPjzG.js";import{L as Ne,S as ze}from"./LoudspeakerComponent-DccJPYAD.js";import{T as Oe}from"./ThreadList-BxnkRQAv.js";import"./showDialog-D1fxnozu.js";import"./browseLogger-CFnKZSj3.js";function Ue(){const l=H();se(()=>{l.showTopbarNav=!1}),oe(()=>{l.showTopbarNav=!0})}const Me=l=>(Ie("data-v-6d75751d"),l=l(),Se(),l),Pe={key:0,class:"carousel-box"},Re={key:0,class:"carousel-box"},qe=["src"],je=Me(()=>Ce("div",{style:{height:"50px"}},null,-1)),Be=ne({__name:"ForumPage",props:{forumId:{},page:{},search:{},delay:{type:Boolean}},setup(l){var B,E;de(a=>({"1d5dd39e":e(i).bannerHeight}));const w=xe(),i=H(),h=De(),g=pe(),W=p(null);p();const U=p();Ue();const t=l;document.title=(E=(B=h.forumData(t.forumId))==null?void 0:B.name)!=null?E:"小火锅";const I=$("banner_hiden",!1),S=$("new_window_to_post",!1);function K(){return f(m,{style:"padding:6px 8px",vertical:!0},()=>[f(O,{checked:I.value,"onUpdate:checked":a=>I.value=a,label:"隐藏版头"}),f(O,{checked:S.value,"onUpdate:checked":a=>S.value=a,label:"新窗口打开"})])}const Q=[{type:"group",key:"header",label:"功能"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:K}],C=$("subtitles_included",z),M=F(()=>z.filter(a=>!C.value.includes(a)));function J(){return f(Te,{value:C.value,"onUpdate:value":a=>C.value=a},()=>[f(m,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(z).map(a=>f(O,{value:a,label:a}))])])}const X=[{type:"group",key:"header",label:"筛选"},{key:"header-divider",type:"divider"},{key:"filterOptions",type:"render",render:J}],v=p(t.search),y=p(!!t.search);function P(){g.push({name:"forum",params:{forumId:t.forumId,page:1},query:{search:v.value||void 0}})}function V(){v.value=void 0,y.value=!1,g.push({name:"forum",params:{forumId:t.forumId,page:1}})}function Y(){g.push({name:"forum",params:{forumId:t.forumId,page:1},query:{delay:t.delay?void 0:"true"}})}const T=p(t.page);function Z(a){g.push({name:"forum",params:{forumId:t.forumId,page:a},query:{search:t.search,delay:t.delay?"true":void 0}})}ue(()=>t.page,a=>T.value=a);const R=F(()=>({forumId:t.forumId,binggan:w.binggan,page:t.page,threadsPerPage:50,subtitlesExcluded:M.value,searchTitle:t.search,delay:t.delay})),{loading:D,data:x,onSuccess:Ee}=le(()=>G(R.value),[()=>t.forumId,()=>t.page,()=>t.search,()=>t.delay,M],{initialData:[],immediate:!0}),q=p(!1),{fetching:Ae,onSuccess:ee,fetch:ae}=ie();function j(a=!1){var s;q.value=a,ae(G(R.value)),(s=U.value)==null||s.reloadBrowseLogger()}ee(()=>{q.value&&!i.userCustom.lessToast&&window.$message.success("已刷新数据")});const te=F(()=>{if(D.value)return[];if(w.userData.binggan.use_pingbici){const a=i.userCustom.pingbiciIngnoreCase?"gi":"g";return x.value.threads_data.data.filter(s=>{for(let L of w.userData.pingbici.title_pingbici)if(new RegExp(L,a).test(s.title))return!1;return!0})}else return x.value.threads_data.data});return(a,s)=>{const L=ce("router-link");return d(),_(e(m),{vertical:""},{default:o(()=>[e(I)?k("",!0):(d(),b("div",Pe,[e(h).forumsDataLoading?(d(),b("div",Re,[r(e(me),{class:"carousel-skeleton",sharp:""})])):k("",!0),e(h).forumsDataLoading?k("",!0):(d(),_(e(fe),{key:1,"show-arrow":"",trigger:e(i).isMobile?"click":"hover",autoplay:"",interval:1e4},{default:o(()=>{var n;return[(d(!0),b(he,null,ge((n=e(h).forumData(a.forumId))==null?void 0:n.banners,re=>(d(),b("img",{src:re,class:"carousel-img"},null,8,qe))),256))]}),_:1},8,["trigger"]))])),r(e(m),{style:{"margin-top":"8px"},size:"small"},{default:o(()=>[r(e(A),{trigger:e(i).isMobile?"click":"hover",options:Q,placement:"bottom-start"},{default:o(()=>[r(e(c),null,{default:o(()=>[u("功能")]),_:1})]),_:1},8,["trigger"]),r(e(A),{trigger:e(i).isMobile?"click":"hover",options:X,placement:"bottom-start"},{default:o(()=>[r(e(c),null,{default:o(()=>[u("筛选")]),_:1})]),_:1},8,["trigger"]),r(e(ve),{size:e(i).isMobile?28:34},{default:o(()=>[r(e(ye),{style:{cursor:"pointer"},onClick:s[0]||(s[0]=n=>y.value=!y.value)})]),_:1},8,["size"]),r(e(c),{type:"primary",style:{"margin-left":"auto"},onClick:s[1]||(s[1]=n=>a.$router.push({name:"loudspeaker"}))},{default:o(()=>[u("大喇叭")]),_:1}),r(e(c),{type:"primary",onClick:s[2]||(s[2]=n=>a.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},{default:o(()=>[u("新主题")]),_:1})]),_:1}),y.value?(d(),_(e(m),{key:1,wrap:!1},{default:o(()=>[r(e(Le),{value:v.value,"onUpdate:value":s[3]||(s[3]=n=>v.value=n),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索标题","auto-size":"",onKeyup:_e(P,["enter"])},null,8,["value"]),r(e(c),{type:"primary",onClick:P},{default:o(()=>[u("搜索")]),_:1}),r(e(c),{type:"default",onClick:V},{default:o(()=>[u("清空")]),_:1})]),_:1})):k("",!0),r(Ne),r(Oe,{ref_key:"ThreadListCom",ref:U,"threads-list-data":te.value,"new-window-to-post":e(S),"show-this":!e(D),onWithdrawDelayThreadSuccess:j},null,8,["threads-list-data","new-window-to-post","show-this"]),r(e(m),{align:"center"},{default:o(()=>[r(e(c),{type:t.delay?"default":"primary",onClick:Y},{default:o(()=>[u(N(t.delay?"关闭延时主题":"查看延时主题"),1)]),_:1},8,["type"]),r(Fe,{page:T.value,"onUpdate:page":[s[4]||(s[4]=n=>T.value=n),Z],"last-page":e(D)?1:e(x).threads_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),je,(d(),_(be,{to:"#topbar-nav"},[r(L,{to:"/",class:"flex-item-center"},{default:o(()=>[r(e(ke),{tooltip:!1},{default:o(()=>{var n;return[u(N((n=e(h).forumData(a.forumId))==null?void 0:n.name),1)]}),_:1}),r(e(we),{round:"",class:"forum-tag",size:e(i).isMobile?"small":"medium"},{default:o(()=>[u(N(a.forumId),1)]),_:1},8,["size"])]),_:1})])),r(ze,{mode:"forum",ref_key:"SidebarCom",ref:W,onRefresh:s[5]||(s[5]=n=>j(!0)),onNewThread:s[6]||(s[6]=n=>a.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},null,512)]),_:1})}}}),Ze=$e(Be,[["__scopeId","data-v-6d75751d"]]);export{Ze as default};
