var ro=Object.defineProperty,io=Object.defineProperties;var uo=Object.getOwnPropertyDescriptors;var wt=Object.getOwnPropertySymbols;var mo=Object.prototype.hasOwnProperty,co=Object.prototype.propertyIsEnumerable;var Ye=(s,n,i)=>n in s?ro(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i,yt=(s,n)=>{for(var i in n||(n={}))mo.call(n,i)&&Ye(s,i,n[i]);if(wt)for(var i of wt(n))co.call(n,i)&&Ye(s,i,n[i]);return s},Ct=(s,n)=>io(s,uo(n));var kt=(s,n,i)=>Ye(s,typeof n!="symbol"?n+"":n,i);import{at as he,au as fo,n as re,t as y,p as b,j as r,x as t,E as o,q as e,F as ue,H as ce,I as k,J as q,S as P,L as l,P as T,D as Te,X as et,M as Je,av as Ve,O as ye,l as z,K as w,aw as po,ax as It,ay as Tt,g as ee,Y as Rt,am as De,az as Xe,aA as Le,aB as be,T as Ht,aC as go,aD as vo,U as At,W as Nt,b as W,aE as ke,N as _e,aF as ho,i as F,aG as tt,a4 as Fe,aH as qt,aI as Gt,aJ as bo,aK as _o,Q as le,w as ze,aL as wo,aM as yo,aN as Co,as as ko,C as Io,u as Z,an as So,ao as Po,a2 as St,ap as xo,aO as $o,R as Mo,aP as Lo,a3 as Pt,aq as xt,ar as Do,ak as zo,m as Ue,aQ as To,aR as Ro,aS as Ho,aT as Ao}from"./vendor-CSO85mTd.js";import{h as No,a as qo,g as Ot,_ as $t,b as Go,p as Oo,n as Eo}from"./emojiData-C4a2TBnO.js";import{t as jo,p as Mt}from"./showDialog-CO38MT1d.js";import{u as de,b as B,e as Ze,a as te,c as Ce,f as Uo,g as me,r as we,_ as Re,d as Lt}from"./app-IEeuuotq.js";import{_ as Dt}from"./loudspeaker-DlSKM8Uf.js";import{_ as Fo}from"./PostInput.vue_vue_type_script_setup_true_lang-BYNkRW5o.js";import{L as Qe,S as Vo}from"./LoudspeakerComponent-VtE5tG1-.js";import{u as Bo,t as Wo,a as Ko,d as Yo,r as Qo,b as Jo,c as Xo,e as Zo,f as ea}from"./admin-C1_1CaNB.js";import{i as ta,a as oa}from"./inputNumberFormat-BPxWRFt_.js";import{u as aa}from"./browseLogger-KpGxmd2K.js";import"./forums-Nq9wgwA_.js";window.Pusher=fo;class na{constructor(){kt(this,"_echoConnector");this._echoConnector=null}connect(){if(this._echoConnector===null){const n=window.location.hostname;this._echoConnector=new he({broadcaster:"reverb",key:"h1gdqae9h4rihjohv1vv",wsHost:n,wsPort:"8090",wssPort:"8090",forceTLS:!0,enabledTransports:["ws","wss"],namespace:""})}else throw new Error("Echo实例已经连接过了")}disconnect(){if(this._echoConnector instanceof he)this._echoConnector.disconnect(),this._echoConnector=null;else throw new Error("Echo实例已经删除过了")}channel(n){if(this._echoConnector instanceof he)return this._echoConnector.channel(n);throw new Error("Echo实例需要先连接.connect()")}leaveChannel(n){if(this._echoConnector instanceof he)this._echoConnector.leaveChannel(n);else throw new Error("Echo实例需要先连接.connect()")}leaveAllChannels(){if(this._echoConnector instanceof he)this._echoConnector.leaveAllChannels();else throw new Error("Echo实例需要先连接.connect()")}get isConnected(){return this._echoConnector instanceof he}get pusher(){return this._echoConnector instanceof he?this._echoConnector.connector.pusher:null}}function sa(){return new na}const la={0:{name:"空白占位",ImgSrc:""},23410:{name:"已日清",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97cf647.png"},23401:{name:"olo不足",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef9811f04.png"},234011:{name:"私密主题",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97ce810.png"},23404:{name:"板块or主题不存在",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef9818836.png"},21404:{name:"需要饼干",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97e42d8.png"}},ra=["src"],ia=re({__name:"ForbiddenModal",setup(s,{expose:n}){const i=y(0),R=y(""),v=de(),h=y(!1);function I(g){i.value=g.errorCode,R.value=g.message,h.value=!0}return n({show:I}),(g,u)=>(r(),b(e(Te),{show:h.value,"onUpdate:show":u[2]||(u[2]=p=>h.value=p),"display-directive":"if"},{default:t(()=>[o(e(ue),{style:ce({maxWidth:e(v).modalMaxWidth}),closable:"",onClose:u[1]||(u[1]=p=>h.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[o(e(B),{onClick:u[0]||(u[0]=p=>h.value=!1)},{default:t(()=>[...u[3]||(u[3]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[q("img",{style:{width:"100%"},src:e(la)[i.value].ImgSrc},null,8,ra),o(e(P),null,{default:t(()=>[l(T(R.value),1)]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),ua=re({__name:"JumpModal",props:{threadId:{},postsNum:{},page:{}},setup(s,{expose:n}){const i=de(),R=et(),v=s,h=y(),I=y(!1);function g(){I.value=!0}n({show:g});function u(){if(h.value!==void 0){const p=Math.ceil((h.value+1)/200),C="#f_"+h.value;if(R.push({name:"thread",params:{threadId:v.threadId,page:p},hash:C}),p===v.page){const S=document.querySelector(C);S==null||S.scrollIntoView({block:"center",behavior:"auto"}),S==null||S.classList.add("on-focus")}I.value=!1}}return(p,C)=>(r(),b(e(Te),{show:I.value,"onUpdate:show":C[3]||(C[3]=S=>I.value=S),"display-directive":"if"},{default:t(()=>[o(e(ue),{style:ce({maxWidth:e(i).modalMaxWidth}),title:"跳楼机",closable:"",onClose:C[2]||(C[2]=S=>I.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[o(e(B),{type:"primary",onClick:u,disabled:!h.value},{default:t(()=>[...C[5]||(C[5]=[l("Jump!",-1)])]),_:1},8,["disabled"]),o(e(B),{onClick:C[1]||(C[1]=S=>I.value=!1)},{default:t(()=>[...C[6]||(C[6]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[o(e(P),null,{default:t(()=>[l(" 最大高度："+T(s.postsNum)+"楼 ",1)]),_:1}),o(e(Je),null,{default:t(()=>[o(e(Ze),{style:{width:"3.2rem"},class:"round"},{default:t(()=>[...C[4]||(C[4]=[l("跳楼",-1)])]),_:1}),o(e(Ve),{placeholder:"请输入楼层号",max:s.postsNum,value:h.value,"onUpdate:value":C[0]||(C[0]=S=>h.value=S),onKeyup:ye(u,["enter"])},null,8,["max","value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),da=re({__name:"AdminActionModal",props:{threadId:{},forumId:{default:0}},emits:["refreshPostsList"],setup(s,{expose:n,emit:i}){const R=de(),v=te(),h=et(),I=y(null),g=s,u=y({contentInput:void 0,switchInput:!1}),p=y("hint"),C=y(!0),S=y();let _;const E=z(()=>({contentInput:{required:$.value.requireContent,message:"请填写理由"},switchInput:{required:!1}})),K={hint:{requireContent:!1,contentMessage:!1,requireSwitch:!1},ban:{requireContent:!0,contentMessage:"你要永久粉碎这个饼干吗？",requireSwitch:!1},lock:{requireContent:!0,contentMessage:`要封禁这个饼干吗？
第1次3天、2次6天、3次9天、4次碎饼`,requireSwitch:!1},deleteAll:{requireContent:!0,contentMessage:`要用管理员权限删除该饼干全部回复吗？
此功能请谨慎使用，仅在有恶意刷屏时。`,requireSwitch:!0},delete:{requireContent:!0,contentMessage:"要用管理员权限删除这个回复吗？",requireSwitch:!0},recovery:{requireContent:!0,contentMessage:"要用管理员权限恢复这个回复吗？",requireSwitch:!1},deleteThread:{requireContent:!0,contentMessage:"要用管理员权限删除这个主题吗？",requireSwitch:!1},setTop:{requireContent:!1,contentMessage:"要设为置顶吗？",requireSwitch:!1},cancelTop:{requireContent:!1,contentMessage:"要取消置顶吗？",requireSwitch:!1}},$=z(()=>K[p.value]),m=y(!1);function M(D){var c;p.value=D.action,_=(c=D.postId)!=null?c:0,S.value=void 0,m.value=!0,D.action==="hint"?(C.value=!1,N("hint")):C.value=!0}n({show:M});const x=i;function N(D){var c;if(D==="hint"){S.value="查询中……";const f={binggan:v.binggan,thread_id:g.threadId,post_id:_};Bo(f).then(H=>{S.value=`此饼干状态：${H.user_status}。已被锁定过${H.locked_count}次。`});return}(c=I.value)==null||c.validate(f=>{if(f){window.$message.error("请确认信息填写完整");return}else switch(D){case"ban":const H={binggan:v.binggan,thread_id:g.threadId,post_id:_,content:u.value.contentInput};ea(H).then(()=>{m.value=!1,x("refreshPostsList")});break;case"lock":const oe={binggan:v.binggan,thread_id:g.threadId,post_id:_,content:u.value.contentInput};Zo(oe).then(()=>{m.value=!1,x("refreshPostsList")});break;case"deleteAll":const j={binggan:v.binggan,thread_id:g.threadId,post_id:_,content:u.value.contentInput,reduce_olo:u.value.switchInput};Xo(j).then(()=>{m.value=!1,x("refreshPostsList")});break;case"delete":const G={binggan:v.binggan,thread_id:g.threadId,post_id:_,content:u.value.contentInput,reduce_olo:u.value.switchInput};Jo(G).then(()=>{m.value=!1,x("refreshPostsList")});break;case"recovery":const ae={binggan:v.binggan,thread_id:g.threadId,post_id:_,content:u.value.contentInput};Qo(ae).then(()=>{m.value=!1,x("refreshPostsList")});break;case"deleteThread":const O={binggan:v.binggan,thread_id:g.threadId,content:u.value.contentInput};Yo(O).then(()=>{m.value=!1,h.push({name:"forum",params:{forumId:g.forumId,page:1}})});break;case"setTop":const L={binggan:v.binggan,thread_id:g.threadId};Ko(L).then(()=>{m.value=!1,x("refreshPostsList")});break;case"cancelTop":const A={binggan:v.binggan,thread_id:g.threadId};Wo(A).then(()=>{m.value=!1,x("refreshPostsList")});break}})}return(D,c)=>(r(),b(e(Te),{show:m.value,"onUpdate:show":c[5]||(c[5]=f=>m.value=f),"display-directive":"if",size:"small"},{default:t(()=>[o(e(ue),{style:ce({maxWidth:e(R).modalMaxWidth}),title:"管理员操作",closable:"",onClose:c[4]||(c[4]=f=>m.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[C.value?(r(),b(e(B),{key:0,type:"warning",onClick:c[2]||(c[2]=f=>N(p.value))},{default:t(()=>[...c[7]||(c[7]=[l("提交",-1)])]),_:1})):w("",!0),o(e(B),{onClick:c[3]||(c[3]=f=>m.value=!1)},{default:t(()=>[...c[8]||(c[8]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[$.value.contentMessage?(r(),b(e(P),{key:0,style:{"white-space":"pre-wrap"}},{default:t(()=>[l(T($.value.contentMessage),1)]),_:1})):w("",!0),S.value?(r(),b(e(P),{key:1},{default:t(()=>[l(T(S.value),1)]),_:1})):w("",!0),o(e(po),{ref_key:"formRef",ref:I,model:u.value,"label-placement":"left","label-width":"auto",rules:E.value,size:e(R).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:t(()=>[$.value.requireContent?(r(),b(e(It),{key:0,label:"理由",path:"contentInput"},{default:t(()=>[o(e(Ce),{placeholder:"必填",value:u.value.contentInput,"onUpdate:value":c[0]||(c[0]=f=>u.value.contentInput=f)},null,8,["value"])]),_:1})):w("",!0),$.value.requireSwitch?(r(),b(e(It),{key:1,label:"罚款olo",path:"switchInput"},{default:t(()=>[o(e(Tt),{value:u.value.switchInput,"onUpdate:value":c[1]||(c[1]=f=>u.value.switchInput=f)},null,8,["value"]),o(e(P),{style:{"margin-left":"6px"}},{default:t(()=>[...c[6]||(c[6]=[l("每个帖子罚款500，封顶5000个olo",-1)])]),_:1})]),_:1})):w("",!0)]),_:1},8,["model","rules","size"])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),ma=re({__name:"RewardModal",emits:["refreshPostsList"],setup(s,{expose:n,emit:i}){const R=de(),v=te(),h=y(100),I=y(),g=y(!1),u=y();function p($){u.value=$,g.value=!0}n({show:p});const C=i;function S(){const $={binggan:v.binggan,post_floor_message:"@"+u.value.postFloorMessage,forum_id:u.value.forumId,thread_id:u.value.threadId,post_id:u.value.postId,coin:h.value,content:I.value};E($)}const{loading:_,send:E,onSuccess:K}=ee($=>Uo($),{immediate:!1});return K(()=>{g.value=!1,C("refreshPostsList")}),($,m)=>(r(),b(e(Te),{show:g.value,"onUpdate:show":m[4]||(m[4]=M=>g.value=M),"display-directive":"if"},{default:t(()=>{var M;return[o(e(ue),{style:ce({maxWidth:e(R).modalMaxWidth}),title:`打赏给№${(M=u.value)==null?void 0:M.floor}`,closable:"",onClose:m[3]||(m[3]=x=>g.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[o(e(B),{type:"primary",onClick:S,loading:e(_)},{default:t(()=>[...m[12]||(m[12]=[l("打赏",-1)])]),_:1},8,["loading"]),o(e(B),{onClick:m[2]||(m[2]=x=>g.value=!1)},{default:t(()=>[...m[13]||(m[13]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[q("div",null,[e(R).isDouble11?(r(),b(e(P),{key:1},{default:t(()=>[...m[6]||(m[6]=[q("del",null,"温馨提示：在打赏额以外，会追加扣除7%手续费。",-1),q("br",null,null,-1),l(" 活动期间限时手续费2%！ ",-1)])]),_:1})):(r(),b(e(P),{key:0},{default:t(()=>[...m[5]||(m[5]=[l(" 温馨提示：在打赏额以外，会追加扣除7%手续费。",-1)])]),_:1})),m[9]||(m[9]=q("br",null,null,-1)),o(e(P),null,{default:t(()=>[...m[7]||(m[7]=[l("总共扣除：",-1)])]),_:1}),o(e(P),{type:"error"},{default:t(()=>[l(T(Math.ceil(h.value*(e(R).isDouble11?1.02:1.07))),1)]),_:1}),o(e(P),null,{default:t(()=>[...m[8]||(m[8]=[l("块奥利奥。",-1)])]),_:1})]),o(e(Je),null,{default:t(()=>[o(e(Ze),{style:{width:"3.2rem"}},{default:t(()=>[...m[10]||(m[10]=[l("打赏",-1)])]),_:1}),o(e(Ve),{type:"password",placeholder:"olo数量","show-password-on":"mousedown",clearable:"",value:h.value,"onUpdate:value":m[0]||(m[0]=x=>h.value=x),onKeyup:ye(S,["enter"]),max:1e6,min:1,step:1e3,parse:e(oa),format:e(ta)},null,8,["value","parse","format"])]),_:1}),o(e(Je),null,{default:t(()=>[o(e(Ze),{style:{width:"3.2rem"},class:"round"},{default:t(()=>[...m[11]||(m[11]=[l("留言",-1)])]),_:1}),o(e(Ce),{value:I.value,"onUpdate:value":m[1]||(m[1]=x=>I.value=x),placeholder:"（可留空）",onKeyup:ye(S,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style","title"])]}),_:1},8,["show"]))}});let zt;function ca(s,n=500){return function(...i){clearTimeout(zt),zt=setTimeout(()=>{s(...i)},n)}}const fa=re({__name:"BrowseLogger",props:{postsListLoading:{type:Boolean},disableScroll:{type:Boolean,default:!1},isSearch:{type:Boolean},threadId:{},page:{}},setup(s){const n=s,i=y(!1),R=Rt(),v=aa();function h(){function g(){const p=window.innerWidth/2;return document.elementsFromPoint(p,100)}ca(()=>{const p=g(),C=v.get(n.threadId);p.forEach(S=>{const _=Number(S.getAttribute("floor"));_&&_>C.floor&&v.log(n.threadId,_)})},100)()}function I(){if(!R.hash&&v.get(n.threadId)){const g=v.get(n.threadId),u=Math.ceil((g.floor+1)/200);if(u===n.page&&g.floor!==0){const p=document.getElementById("f_"+g.floor);p!==null&&(p.scrollIntoView({behavior:"auto",block:"center"}),window.$message.success(`已自动滚到上次浏览进度${g.floor}楼`))}u>n.page&&(i.value=!0)}}return De(()=>n.postsListLoading,g=>{g===!1&&!n.disableScroll&&Xe(()=>I())}),Le(()=>{v.initThread(n.threadId),window.addEventListener("scroll",h)}),be(()=>{i.value=!1,window.removeEventListener("scroll",h)}),(g,u)=>{const p=Ht("router-link");return i.value&&!s.isSearch?(r(),b(e(go),{key:0,type:"success",closable:"",style:{"border-radius":"10px"}},{default:t(()=>[l(" 你上次已经浏览到"+T(e(v).get(s.threadId).floor)+"楼， ",1),o(p,{onClick:u[0]||(u[0]=C=>i.value=!1),to:{name:"thread",params:{threadId:s.threadId,page:Math.ceil((e(v).get(s.threadId).floor+1)/200)}}},{default:t(()=>[...u[1]||(u[1]=[l(" 点击这里 ",-1)])]),_:1},8,["to"]),u[2]||(u[2]=l(" 跳转 ",-1))]),_:1})):w("",!0)}}}),pa=re({__name:"ChangeColorModal",props:{threadId:{}},emits:["refreshPostsList"],setup(s,{expose:n,emit:i}){const R=de(),v=te(),h=s,I=y(),g=["#b65954","#c78878","#9b7e70","#de7562","#fca44b","#f1c727","#f6da79","#fbda97","#9fc778","#78c79f","#8ab185","#98c0d9","#8691db","#7878c7","#566b7c","#9678c7","#9f78c7","#ca95e9","#ecacc6","#a86fa2","#7e3749"],u=y(!1);function p(){u.value=!0}n({show:p});const{loading:C,send:S,onSuccess:_}=ee(K=>jo(K),{immediate:!1});function E(){if(!I.value){window.$message.error("颜色输入不能为空");return}const K={binggan:v.binggan,thread_id:h.threadId,color:I.value};S(K),_(()=>u.value=!1)}return(K,$)=>(r(),b(e(Te),{show:u.value,"onUpdate:show":$[3]||($[3]=m=>u.value=m),"display-directive":"if"},{default:t(()=>[o(e(ue),{style:ce({maxWidth:e(R).modalMaxWidth}),title:"标题改色",closable:"",onClose:$[2]||($[2]=m=>u.value=!1),size:"small"},{action:t(()=>[o(e(k),{justify:"end"},{default:t(()=>[o(e(B),{type:"primary",onClick:E,disabled:e(C),loading:e(C)},{default:t(()=>[...$[5]||($[5]=[l("提交",-1)])]),_:1},8,["disabled","loading"]),o(e(B),{onClick:$[1]||($[1]=m=>u.value=!1)},{default:t(()=>[...$[6]||($[6]=[l("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(k),{vertical:""},{default:t(()=>[o(e(P),null,{default:t(()=>[...$[4]||($[4]=[l(" 要更换标题颜色吗？每次收费500个olo喔 ",-1)])]),_:1}),o(e(vo),{value:I.value,"onUpdate:value":$[0]||($[0]=m=>I.value=m),modes:["hex"],"show-alpha":!1,style:{"max-width":"8.2rem"},swatches:g},null,8,["value"])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),ga=te(),va=s=>{const n=me.Get("api/crowds/"+s,{name:"crowdDataGetter-"+s,params:{binggan:ga.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},ha=s=>{const n=me.Post("api/crowds/",s,{name:"userCrowdPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},ba=s=>{const n=me.Post("api/crowds/repeal",s,{name:"adminCrowdRepealPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},_a={style:{"text-align":"center"}},wa={key:0},ya={key:1},Ca={key:2},ka={key:3},Ia=re({__name:"CrowdComponent",props:{crowdId:{},forumId:{}},setup(s){At(j=>({v02a8d6e9:e(v).dividerColor}));const n=s,i=te(),R=de(),v=Nt(),h=y(1e3),I=z(()=>{const j=W.tz(M.value.end_date),G=W(),ae=j.diff(G,"hour");return ae>=1?`${ae}小时后`:`${j.diff(G,"minute")}分钟后`}),g=z(()=>W.tz(M.value.end_date).format("YY年M月D日 HH:mm")),u=z(()=>W().isAfter(W.tz(M.value.end_date))),p=[{label:"中止",key:"repeal",icon:we(Gt,{size:"1.5rem"})}];function C(j){switch(j){case"repeal":oe();break}}const S=[{title:"我支持的olo",key:"olo",resizable:!0},{title:"参与时间",key:"created_at",resizable:!0}],{data:_,loading:E,send:K,onSuccess:$}=ee(va(n.crowdId),{immediate:!1});function m(){K({binggan:i.binggan})}i.binggan&&m();const M=z(()=>{var j;return(j=_.value)==null?void 0:j.crowd}),x=z(()=>{var j,G;return(G=(j=_.value)==null?void 0:j.crowd_record)!=null?G:[]}),N=z(()=>Math.round(M.value.olo_total/M.value.olo_target*100)),{loading:D,send:c,onSuccess:f}=ee(j=>ha(j),{immediate:!1});f(()=>{m()});function H(){if(!h.value){window.$message.error("请输入众筹金额喔");return}const j={binggan:i.binggan,crowd_olo:h.value,crowd_id:n.crowdId},G={title:"参加众筹",closable:!1,content:`确定要参加众筹吗？将消耗${h.value}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{c(j)}};window.$dialog.warning(G)}function oe(){const j={binggan:i.binggan,crowd_id:n.crowdId},G={title:"中止众筹",closable:!1,content:"确定要中止众筹吗？已投注的olo将会退回",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{ba(j).then(()=>{m()})}};window.$dialog.warning(G)}return(j,G)=>(r(),b(e(ue),{size:"small",bordered:!0},{default:t(()=>[o(e(ke),{show:e(E)},{default:t(()=>[M.value!==void 0?(r(),b(e(k),{key:0,vertical:""},{default:t(()=>[o(e(k),{size:"small",align:"center",class:"crowd-title"},{default:t(()=>[o(e(_e),{size:e(R).isMobile?24:32},{default:t(()=>[o(e(ho))]),_:1},8,["size"]),q("span",null,T(M.value.title),1)]),_:1}),o(e(k),{vertical:"",align:"center"},{default:t(()=>[o(e(tt),{type:"dashboard",status:"success",percentage:N.value},{default:t(()=>[q("span",_a,"进度"+T(N.value)+"% ",1)]),_:1},8,["percentage"]),u.value&&M.value.is_closed===0?(r(),F("span",wa,"众筹已经过期了")):w("",!0),M.value.is_closed===1?(r(),F("span",ya,"众筹已达成目标！谢谢各位参与~")):w("",!0),M.value.is_closed===2?(r(),F("span",Ca,"众筹已经被管理员中止，olo已退回")):w("",!0),!u.value&&M.value.is_closed===0?(r(),F("div",ka,[o(e(P),{depth:3},{default:t(()=>[...G[1]||(G[1]=[l("结束时间：",-1)])]),_:1}),q("span",null,T(g.value)+" ("+T(I.value)+")",1)])):w("",!0),q("div",null,[o(e(P),{depth:3},{default:t(()=>[...G[2]||(G[2]=[l("众筹目标：",-1)])]),_:1}),q("span",null,T(`${M.value.olo_target.toLocaleString("en-us")} 个olo`),1)]),q("div",null,[o(e(P),{depth:3},{default:t(()=>[...G[3]||(G[3]=[l("已众筹到：",-1)])]),_:1}),q("span",null,T(`${M.value.olo_total.toLocaleString("en-us")} 个olo`),1)]),o(e(k),{size:"small",align:"center"},{default:t(()=>[o(e(Ve),{max:1e6,min:1,step:1e3,placeholder:"投入额",disabled:u.value||M.value.is_closed!==0,value:h.value,"onUpdate:value":G[0]||(G[0]=ae=>h.value=ae)},null,8,["disabled","value"]),o(e(B),{type:"primary",onClick:H,loading:e(D),disabled:e(D)||u.value||M.value.is_closed!==0},{default:t(()=>[...G[4]||(G[4]=[l("投入",-1)])]),_:1},8,["loading","disabled"]),e(i).checkAdminForums(s.forumId)&&M.value.is_closed===0?(r(),b(e(Fe),{key:0,trigger:e(R).isMobile?"click":"hover",options:p,onSelect:C,placement:"bottom-start"},{default:t(()=>[o(e(B),{type:"warning"},{default:t(()=>[...G[5]||(G[5]=[l("管理",-1)])]),_:1})]),_:1},8,["trigger"])):w("",!0)]),_:1})]),_:1}),x.value.length>0?(r(),b(e(qt),{key:0,columns:S,data:x.value,bordered:!1},null,8,["data"])):w("",!0)]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),Sa=Re(Ia,[["__scopeId","data-v-c8ea6852"]]),Pa=te(),xa=s=>{const n=me.Get("api/gambles/"+s,{name:"gambleDataGetter-"+s,params:{binggan:Pa.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},$a=s=>{const n=me.Post("api/gambles/",s,{name:"userGamblePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Ma=s=>{const n=me.Post("api/gambles/close",s,{name:"adminGambleClosePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},La=s=>{const n=me.Post("api/gambles/repeal",s,{name:"adminGambleRepealPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Da={key:0},za={key:1},Ta={key:2},Ra={key:3},Ha={class:"gamble-item"},Aa={style:{"margin-left":"auto"}},Na=re({__name:"GambleComponent",props:{gambleId:{},forumId:{}},setup(s){At(O=>({v8196b06e:e(v).dividerColor}));const n=s,i=te(),R=de(),v=Nt(),h=y(),I=y(1e3),g=z(()=>{const O=W.tz(x.value.end_date),L=W(),A=O.diff(L,"hour");return A>=1?`${A}小时后`:`${O.diff(L,"minute")}分钟后`}),u=z(()=>W.tz(x.value.end_date).format("YY年M月D日 HH:mm")),p=z(()=>W().isAfter(W.tz(x.value.end_date))),C=[{label:"开奖",key:"close",icon:we(wo,{size:"1.5rem"})},{label:"中止",key:"repeal",icon:we(Gt,{size:"1.5rem"})}];function S(O){switch(O){case"close":G();break;case"repeal":ae();break}}const _=[{title:"我的投注",key:"option_text",resizable:!0},{title:"投注额",key:"betting_olo",resizable:!0},{title:"赔率",key:"odds",render:O=>{var L,A;return(A=(L=O.odds)==null?void 0:L.toFixed(2))!=null?A:"（开奖时确定）"},resizable:!0},{title:"奖金",key:"win_olo",resizable:!0}],{data:E,loading:K,send:$,onSuccess:m}=ee(xa(n.gambleId),{immediate:!1});function M(){$({binggan:i.binggan})}i.binggan&&M();const x=z(()=>E.value.gamble_question),N=z(()=>E.value.gamble_options),D=z(()=>{var O,L;return(L=(O=E.value.user_choices)==null?void 0:O.map(A=>{var ne;return Ct(yt({},A),{option_text:(ne=N.value.find(He=>He.id===A.option_id))==null?void 0:ne.option_text})}))!=null?L:[]}),c=z(()=>{var O;return(O=N.value.find(L=>L.id===x.value.result_option_id))==null?void 0:O.option_text}),{loading:f,send:H,onSuccess:oe}=ee(O=>$a(O),{immediate:!1});oe(()=>{M()});function j(){if(!h.value||!I.value){window.$message.error("请选择选项和输入投注额喔");return}const O={binggan:i.binggan,gamble_question_id:n.gambleId,bet_option:h.value,betting_olo:I.value},L={title:"参加菠菜",closable:!1,content:`确定要参加菠菜吗？将消耗${I.value}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{H(O)}};window.$dialog.warning(L)}function G(){var A;if(!h.value){window.$message.error("请选择选项喔");return}const O={binggan:i.binggan,gamble_question_id:n.gambleId,result_option:h.value},L={title:"开奖菠菜",closable:!1,content:`确定要开奖吗？开奖选项是：${(A=N.value.find(ne=>ne.id===h.value))==null?void 0:A.option_text}`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Ma(O).then(()=>{M()})}};window.$dialog.warning(L)}function ae(){const O={binggan:i.binggan,gamble_question_id:n.gambleId},L={title:"中止菠菜",closable:!1,content:"确定要中止菠菜吗？已投注的olo将会退回",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{La(O).then(()=>{M()})}};window.$dialog.warning(L)}return(O,L)=>(r(),b(e(ue),{size:"small",bordered:!0},{default:t(()=>[o(e(ke),{show:e(K)},{default:t(()=>[e(E)!==void 0?(r(),b(e(k),{key:0,vertical:""},{default:t(()=>[o(e(k),{size:"small",align:"center",class:"gamble-title"},{default:t(()=>[o(e(_e),{size:e(R).isMobile?24:32},{default:t(()=>[o(e(bo))]),_:1},8,["size"]),q("span",null,T(x.value.title),1)]),_:1}),o(e(_o),{value:h.value,"onUpdate:value":L[0]||(L[0]=A=>h.value=A)},{default:t(()=>[o(e(k),{vertical:"",size:"large"},{default:t(()=>[(r(!0),F(le,null,ze(N.value,(A,ne)=>(r(),F("div",{key:A.id},[o(e(yo),{value:A.id,label:`（当前赔率 ${A.odds.toFixed(2)}）： ${A.id==x.value.result_option_id?"⭐":""} ${A.option_text}`},null,8,["value","label"]),o(e(tt),{status:"success",type:"line",height:e(R).isMobile?20:24,percentage:Math.floor(A.olo_total/x.value.olo_total*100),"indicator-placement":"inside"},{default:t(()=>[l(T(A.olo_total),1)]),_:2},1032,["height","percentage"])]))),128))]),_:1})]),_:1},8,["value"]),p.value&&x.value.is_closed===0?(r(),F("span",Da,"菠菜已经关闭投注")):w("",!0),x.value.is_closed===1?(r(),F("span",za,T(`菠菜已开奖，奖金已发放。中奖项是：${c.value}`),1)):w("",!0),x.value.is_closed===2?(r(),F("span",Ta,"菠菜已经被管理员中止，投注olo已退回")):w("",!0),!p.value&&x.value.is_closed===0?(r(),F("div",Ra,[o(e(P),{depth:3},{default:t(()=>[...L[2]||(L[2]=[l("结束时间：",-1)])]),_:1}),q("span",null,T(u.value)+" ("+T(g.value)+")",1)])):w("",!0),o(e(k),{size:"small",align:"center"},{default:t(()=>[o(e(Ve),{max:1e6,min:1,step:1e3,placeholder:"投注额",disabled:p.value||x.value.is_closed!==0,value:I.value,"onUpdate:value":L[1]||(L[1]=A=>I.value=A)},null,8,["disabled","value"]),o(e(B),{type:"primary",onClick:j,loading:e(f),disabled:e(f)||p.value||x.value.is_closed!==0},{default:t(()=>[...L[3]||(L[3]=[l("投注",-1)])]),_:1},8,["loading","disabled"]),e(i).checkAdminForums(s.forumId)&&x.value.is_closed===0?(r(),b(e(Fe),{key:0,trigger:e(R).isMobile?"click":"hover",options:C,onSelect:S,placement:"bottom-start"},{default:t(()=>[o(e(B),{type:"warning"},{default:t(()=>[...L[4]||(L[4]=[l("管理",-1)])]),_:1})]),_:1},8,["trigger"])):w("",!0)]),_:1}),!e(R).isMobile&&D.value.length>0?(r(),b(e(qt),{key:4,columns:_,data:D.value,bordered:!1},null,8,["data"])):w("",!0),e(R).isMobile?(r(),F(le,{key:5},[D.value.length>0?(r(),b(e(k),{key:0,vertical:"",align:"start",size:"small"},{default:t(()=>[(r(!0),F(le,null,ze(D.value,A=>(r(),F("div",Ha,[o(e(k),{style:{"margin-bottom":"6px"}},{default:t(()=>[q("div",null,[o(e(P),{depth:3},{default:t(()=>[...L[5]||(L[5]=[l("我的投注：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[l(T(A.option_text),1)]),_:2},1024)])]),_:2},1024),o(e(k),{style:{"margin-bottom":"6px"}},{default:t(()=>[q("div",null,[o(e(P),{depth:3},{default:t(()=>[...L[6]||(L[6]=[l("投注额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[l(T(A.betting_olo),1)]),_:2},1024)])]),_:2},1024),A.win_olo?(r(),b(e(k),{key:0,style:{"margin-bottom":"6px"}},{default:t(()=>[q("div",null,[o(e(P),{depth:3},{default:t(()=>[...L[7]||(L[7]=[l("赔率：",-1)])]),_:1}),o(e(P),null,{default:t(()=>{var ne;return[l(T((ne=A.odds)==null?void 0:ne.toFixed(2)),1)]}),_:2},1024)]),q("div",Aa,[o(e(P),{depth:3},{default:t(()=>[...L[8]||(L[8]=[l("奖金：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[l(T(A.win_olo),1)]),_:2},1024)])]),_:2},1024)):w("",!0)]))),256))]),_:1})):w("",!0)],64)):w("",!0)]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),qa=Re(Na,[["__scopeId","data-v-d08fb987"]]),Ga={key:0},Oa=re({__name:"HongbaoComponent",props:{hongbaoId:{},threadId:{},forumId:{},noHongbaoPicMode:{type:Boolean}},emits:["refreshPostsList"],setup(s,{emit:n}){const i=te(),R=de(),v=s,h=z(()=>p.value.pic_url&&!v.noHongbaoPicMode),I=z(()=>h.value?{backgroundImage:`linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)), url(${p.value.pic_url})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{}),g=y(),u=z(()=>({1:"随机olo",2:"定额olo"})[p.value.type]),{data:p,loading:C,send:S,onSuccess:_}=ee(No(v.hongbaoId),{immediate:!1,initialData:{}});_(N=>{g.value=N.data.key_word});function E(){S({binggan:i.binggan})}i.binggan&&E();const{loading:K,send:$,onSuccess:m}=ee(N=>qo(N),{immediate:!1});m(()=>{x("refreshPostsList")});function M(N){if(!N.isTrusted){const H={title:"错误",closable:!1,content:"请不要用脚本抢红包喔",positiveText:"确定"};window.$dialog.warning(H);return}const{timestamp:D,newPostKey:c}=Ot(N.isTrusted,v.threadId,i.binggan),f={binggan:i.binggan,forum_id:v.forumId,thread_id:v.threadId,content:"--红包口令: "+g.value,nickname:"= =",post_with_admin:!1,new_post_key:c,timestamp:D,hongbao_id:v.hongbaoId,hongbao_key_word:g.value};$(f).then(()=>{E()})}const x=n;return(N,D)=>(r(),b(e(ue),{size:"small",bordered:!0,class:"hongbao-card",style:ce(I.value)},{default:t(()=>[o(e(ke),{show:e(C)},{default:t(()=>[o(e(k),{vertical:"",align:"center"},{default:t(()=>[o(e(k),{align:"center",size:"small"},{default:t(()=>[o(e(P),{style:{"font-size":"1rem"}},{default:t(()=>[...D[1]||(D[1]=[l("口令红包",-1)])]),_:1}),h.value?w("",!0):(r(),F("img",{key:0,src:"/hongbao.svg",style:ce({height:e(R).isMobile?"30px":"36px"})},null,4))]),_:1}),q("div",null,[e(p).key_word?(r(),b(e(P),{key:0,depth:3},{default:t(()=>[...D[2]||(D[2]=[l("口令：",-1)])]),_:1})):w("",!0),o(e(P),null,{default:t(()=>[l(T(e(p).key_word),1)]),_:1})]),q("div",null,[o(e(P),{depth:3},{default:t(()=>[...D[3]||(D[3]=[l("数量：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[l(T(e(p).num_remains)+" /"+T(e(p).num_total)+" （"+T(u.value)+"）",1)]),_:1})]),e(p).olo_hide?w("",!0):(r(),F("div",Ga,[o(e(P),{depth:3},{default:t(()=>[...D[4]||(D[4]=[l("总额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>{var c;return[l(T((c=e(p).olo_total)==null?void 0:c.toLocaleString("en-us"))+" olo ",1)]}),_:1})])),o(e(k),{size:"small",wrap:!1},{default:t(()=>{var c;return[e(p).hongbao_user===null?(r(),b(e(Ce),{key:0,value:g.value,"onUpdate:value":D[0]||(D[0]=f=>g.value=f),maxlength:255,onKeyup:ye(M,["enter"]),style:{"max-width":"328px"},placeholder:e(p).num_remains===0?"已经抢光啦":"请输入口令","auto-size":"",disabled:e(p).hongbao_user!==null||e(p).num_remains===0},null,8,["value","placeholder","disabled"])):(r(),b(e(Ce),{key:1,value:`你抢到了${(c=e(p).hongbao_user)==null?void 0:c.olo.toLocaleString("en-us")}个olo`,maxlength:255,style:{"max-width":"328px"},"auto-size":"",disabled:""},null,8,["value"])),o(e(B),{type:"primary",onClick:M,disabled:e(p).hongbao_user!==null||e(K)||e(p).num_remains===0},{default:t(()=>[...D[5]||(D[5]=[l("抢！",-1)])]),_:1},8,["disabled"])]}),_:1})]),_:1})]),_:1},8,["show"])]),_:1},8,["style"]))}}),Ea=Re(Oa,[["__scopeId","data-v-d0fedc06"]]),ja=te(),Ua=s=>{const n=me.Get("api/votes/"+s,{name:"voteDataGetter-"+s,params:{binggan:ja.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},Fa=s=>{const n=me.Post("api/votes/",s,{name:"userVotePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Va={key:0},Ba=re({__name:"VoteComponent",props:{voteId:{}},setup(s){const n=s,i=te(),R=de(),v=y([]);De(v,(c,f)=>{c.length>E.value.max_choices&&(window.$message.error(`最多只能选择${E.value.max_choices}个选项喔`),v.value=f)});const h=z(()=>{const c=W.tz(E.value.end_date),f=W(),H=c.diff(f,"hour");return H>=1?`${H}小时后`:`${c.diff(f,"minute")}分钟后`}),I=z(()=>W.tz(E.value.end_date).format("YY年M月D日 HH:mm")),g=z(()=>W().isAfter(W.tz(E.value.end_date))),{data:u,loading:p,send:C,onSuccess:S}=ee(Ua(n.voteId),{immediate:!1});S(c=>{c.data.user_choices&&(v.value=c.data.user_choices.options_id)});function _(){C({binggan:i.binggan})}i.binggan&&_();const E=z(()=>u.value.vote_question),K=z(()=>u.value.vote_options),$=z(()=>u.value.user_choices),m=z(()=>$.value!==null),{loading:M,send:x,onSuccess:N}=ee(c=>Fa(c),{immediate:!1});N(()=>{_()});function D(){const c={binggan:i.binggan,vote_question_id:n.voteId,vote_options:v.value};x(c)}return(c,f)=>(r(),b(e(ue),{size:"small",bordered:!0},{default:t(()=>[o(e(ke),{show:e(p)},{default:t(()=>[e(u)!==void 0?(r(),b(e(k),{key:0,vertical:""},{default:t(()=>[o(e(k),{size:"small",align:"center",class:"vote-title"},{default:t(()=>[o(e(_e),{size:e(R).isMobile?24:32},{default:t(()=>[o(e(Co))]),_:1},8,["size"]),q("span",null,T(e(u).vote_question.title),1)]),_:1}),o(e(ko),{value:v.value,"onUpdate:value":f[0]||(f[0]=H=>v.value=H),disabled:m.value},{default:t(()=>[o(e(k),{vertical:"",size:"large"},{default:t(()=>[(r(!0),F(le,null,ze(K.value,(H,oe)=>(r(),F("div",{key:H.id},[o(e(Io),{value:H.id,label:`${oe+1}. ${H.option_text}`},null,8,["value","label"]),o(e(tt),{status:"success",type:"line",height:e(R).isMobile?20:24,percentage:Math.floor(H.vote_total/E.value.vote_total*100),"indicator-placement":"inside"},{default:t(()=>[l(T(H.vote_total)+"票 ",1)]),_:2},1032,["height","percentage"])]))),128))]),_:1})]),_:1},8,["value","disabled"]),g.value?(r(),F("span",Va,"投票已经结束了")):(r(),F(le,{key:1},[q("div",null,[o(e(P),{depth:3},{default:t(()=>[...f[1]||(f[1]=[l("最多选择：",-1)])]),_:1}),q("span",null,T(E.value.max_choices)+"个选项",1)]),q("div",null,[o(e(P),{depth:3},{default:t(()=>[...f[2]||(f[2]=[l("结束时间：",-1)])]),_:1}),q("span",null,T(I.value)+" ("+T(h.value)+")",1)])],64)),o(e(k),{size:"small",align:"center"},{default:t(()=>[o(e(B),{type:"primary",onClick:D,loading:e(M),disabled:e(M)||m.value||g.value},{default:t(()=>[...f[3]||(f[3]=[l("投票",-1)])]),_:1},8,["loading","disabled"]),m.value?(r(),b(e(P),{key:0,depth:3},{default:t(()=>[...f[4]||(f[4]=[l("你已经投过票了，谢谢参与！",-1)])]),_:1})):w("",!0)]),_:1})]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),Wa=Re(Ba,[["__scopeId","data-v-467006fa"]]),Ka=te(),Ya=s=>{const n=me.Post("api/store_pool",s,{name:"poolStorePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Qa=()=>{const s=me.Get("api/get_pool",{name:"poolDataGetter",params:{binggan:Ka.binggan},localCache:null,hitSource:[]});return s.meta={shouldRemind:!1},s},Ja=re({__name:"PoolComponent",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(s,{emit:n}){const i=s,R=te(),v=de(),h=W.tz("2025-10-1 00:00"),I=W.tz("2025-10-4 00:00"),g=z(()=>{const c=W.tz();return c<h?0:c>I?2:1}),u=z(()=>({0:`活动将于 ${h.format("M月D日H点")} 开始`,1:`请投入你的祝福~~，活动将于${I.format("M月D日H点")}结束。（${p.value}）`,2:"祝福池已关闭，请等待开奖。"})[g.value]),p=z(()=>{const c=W.tz(),f=I.diff(c,"hour"),H=I.diff(c,"minute")-60*f;return`剩余${f}小时${H}分钟`}),C=y(),{data:S,loading:_,send:E,onSuccess:K}=ee(Qa(),{immediate:!1,initialData:{}});function $(){E()}R.binggan&&$();const{loading:m,send:M,onSuccess:x}=ee(c=>Ya(c),{immediate:!1});function N(c){if(C.value===void 0){const H={title:"错误",closable:!1,content:"请输入祝福语喔",positiveText:"确定"};window.$dialog.warning(H);return}const f={binggan:R.binggan,forum_id:i.forumId,thread_id:i.threadId,message:C.value,olo:c?3e5:1e3,admin:c};M(f).then(()=>{$(),D("refreshPostsList")})}const D=n;return(c,f)=>(r(),b(e(ue),{size:"small",bordered:!0},{default:t(()=>[o(e(ke),{show:e(_)},{default:t(()=>[o(e(k),{vertical:"",align:"center"},{default:t(()=>[o(e(k),{align:"center",size:"small"},{default:t(()=>[o(e(P),{style:{"font-size":"1rem"}},{default:t(()=>[...f[4]||(f[4]=[l("祝福池",-1)])]),_:1}),q("img",{src:"/hongbao.svg",style:ce({height:e(v).isMobile?"30px":"36px"})},null,4)]),_:1}),q("div",null,[o(e(P),{depth:3},{default:t(()=>[...f[5]||(f[5]=[l("祝福池总额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>{var H;return[l(T((H=e(S).olo_total)==null?void 0:H.toLocaleString("en-us"))+" olo ",1)]}),_:1})]),o(e(k),{size:"small",wrap:!1},{default:t(()=>[o(e(Ce),{value:C.value,"onUpdate:value":f[0]||(f[0]=H=>C.value=H),maxlength:255,onKeyup:f[1]||(f[1]=ye(H=>N(!1),["enter"])),style:{"max-width":"328px"},placeholder:e(S).user_pool===null?"请留下祝福语":"已经投过祝福啦","auto-size":"",disabled:e(S).user_pool!==null},null,8,["value","placeholder","disabled"]),o(e(B),{type:"primary",onClick:f[2]||(f[2]=H=>N(!1)),disabled:e(S).user_pool!==null||e(m)||g.value!==1},{default:t(()=>[...f[6]||(f[6]=[l("投入祝福",-1)])]),_:1},8,["disabled"]),e(R).admin.isSuperAdmin?(r(),b(e(B),{key:0,type:"warning",onClick:f[3]||(f[3]=H=>N(!0))},{default:t(()=>[...f[7]||(f[7]=[l("投入30w",-1)])]),_:1})):w("",!0)]),_:1}),o(e(k),{align:"center",size:"small"},{default:t(()=>[q("span",null,T(u.value),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1}))}}),Xa={bordered:!0,class:"post-item-skeleton"},Za=re({__name:"ThreadPage",props:{threadId:{},page:{},search:{}},setup(s){const n=te(),i=de(),R=Rt(),v=et(),h=y(null),I=y([]),g=y(null),u=y(null),p=y(null),C=y(null),S=y(null);Le(()=>{i.showTopbarNav=!1}),be(()=>{i.showTopbarNav=!0});const _=s,E=y(null),K=y(null),$=y(null),m=y(null),M=y(null),x=y(null),N=y(!0),D=y(!1);Le(()=>{D.value=!0}),be(()=>{D.value=!1});const c=z(()=>{const d=W.tz(V.value.nissin_date),a=W(),Y=d.diff(a,"hour"),J=d.diff(a,"minute")-60*Y;return`${Y}小时${J}分钟后`}),f=y(!1),H=y(!1),oe=Z("no_video_mode",!1),j=Z("no_image_mode",!1),G=Z("no_emoji_mode",!1),ae=Z("no_custom_emoji_mode",!1),O=Z("no_head_mode",!1),L=Z("no_battle_mode",!1),A=Z("no_roll_mode",!1),ne=Z("no_reward_mode",!1),He=Z("no_hongbao_mode",!1),Ae=Z("no_hongbao_pic_mode",!1),Ne=Z("no_mention_mode",!1),qe=Z("use_url_mode",!1),ot=Z("no_pailou_mode",!1),Et=z(()=>{const d=[{ref:oe,label:"音频视频"},{ref:j,label:"图片"},{ref:G,label:"一般表情包"},{ref:ae,label:"自定义表情包"},{ref:O,label:"头像"},{ref:L,label:"大乱斗"},{ref:A,label:"roll点"},{ref:ne,label:"打赏"},{ref:He,label:"红包结果"},{ref:Ae,label:"红包封面"},{ref:Ne,label:"关闭@标注"},{ref:ot,label:"无内容排楼"}];return n.admin.isSuperAdmin?d.unshift({ref:f,label:"超管模式启动！"}):n.admin.isNormalAdmin&&d.unshift({ref:H,label:"让代码失效"}),d});function jt(){return Ue(k,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(Et.value).map(d=>Ue(Lt,{checked:d.ref.value,"onUpdate:checked":a=>d.ref.value=a,label:d.label})),Ue(To,{keepAliveOnHover:!1,placement:"bottom",style:{width:"max-content"}},{trigger:()=>Ue(Lt,{checked:qe.value,"onUpdate:checked":d=>qe.value=d,label:"自动转换超链接"}),default:()=>"实验性功能，可能会导致回复显示出错"})])}const Ut=[{type:"group",key:"header",label:"屏蔽"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:jt}],Ft=z(()=>{const d=[{label:"删除主题",key:"deleteThread",icon:we(Ro,{size:"1.5rem"})}];return V.value.sub_id===0?d.push({label:"设为置顶",key:"setTop",icon:we(Ho,{size:"1.5rem"})}):d.push({label:"取消置顶",key:"cancelTop",icon:we(Ao,{size:"1.5rem"})}),d});function Vt(d){var a;(a=x.value)==null||a.show({action:d})}const Ie=y(_.page);function at(d){v.push({name:"thread",params:{threadId:_.threadId,page:d},query:{search:_.search}})}De(()=>_.page,d=>Ie.value=d);const nt=z(()=>({threadId:_.threadId,binggan:n.binggan,page:_.page,searchContent:_.search,noMentionMode:Ne.value})),{loading:fe,data:pe,onSuccess:Bt,onError:Wt,send:Kt}=So(()=>Mt(nt.value),[()=>_.threadId,()=>_.page,()=>_.search],{initialData:{},immediate:!0});Bt(d=>{document.title=d.data.thread_data.title,Xe(()=>{if(R.hash){const a=document.querySelector(R.hash);a==null||a.scrollIntoView({block:"center",behavior:"auto"}),a==null||a.classList.add("on-focus")}})}),Wt(d=>{var a;N.value=!1,d.error.cause!==void 0&&d.error.cause.code!==401&&((a=m.value)==null||a.show({errorCode:d.error.cause.code,message:d.error.message}))}),Le(()=>{Kt(),N.value=!0}),be(()=>{var d;fe.value=!0,(d=h.value)==null||d.resetInput()});const st=y(!1),{fetching:Be,onSuccess:Yt,onError:Qt,fetch:Jt}=Po();function se(d=!1){Be.value!==!0&&(st.value=d,Jt(Mt(nt.value)))}Yt(()=>{I.value.forEach(d=>{d.refreshBattleData()}),st.value&&!i.userCustom.lessToast&&window.$message.success("已刷新数据")}),Qt(d=>{var a;N.value=!1,d.error.cause!==void 0&&((a=m.value)==null||a.show({errorCode:d.error.cause.code,message:d.error.message}))});const Xt=z(()=>pe.value.posts_data.data),V=z(()=>pe.value.thread_data),Q=z(()=>pe.value.forum_data),Ge=z(()=>pe.value.your_post_floors),lt=z(()=>{let d;return d=Xt.value.filter(a=>{var Y;if(L.value===!0&&a.battle_id!==null||A.value===!0&&a.created_by_admin===2&&a.nickname==="Roll点系统")return!1;if(ne.value===!0&&a.created_by_admin===2&&a.nickname==="奥利奥打赏系统"&&!a.is_your_post){if(Ge.value.length>0){const J=a.content.match(/@№[0-9]+/g);if(J===null)return!1;const X=Number(J[0].slice(2));if(Ge.value.includes(X))return!0}return!1}if(He.value===!0){const J=a.created_by_admin==2&&a.nickname=="红包结果"&&!a.is_your_post,X=/^--红包口令: /.test(a.content)&&!a.is_your_post;if(J||X)return!1}if(ot.value===!0&&!a.is_your_post&&new RegExp("^<span(.*?)<\\/span>$","s").test(a.content))return!1;if((Y=n.userData)!=null&&Y.binggan.use_pingbici&&i.userCustom.hidePingbiciFloor){const J=i.userCustom.pingbiciIngnoreCase?"gi":"g";for(let X of n.userData.pingbici.content_pingbici)if(new RegExp(X,J).test(a.content))return!1;if(V.value.anti_jingfen){for(let X of n.userData.pingbici.fjf_pingbici)if(new RegExp(X,"g").test(a.created_binggan_hash.slice(0,5)))return!1}for(let X of n.userData.pingbici.fjf_pingbici)if(new RegExp(X,J).test(a.nickname))return!1}return!0}),d}),Oe=y(_.search),Ee=y(!!_.search);function rt(){v.push({name:"thread",params:{threadId:_.threadId,page:1},query:{search:Oe.value||void 0}})}function Zt(){Oe.value=void 0,Ee.value=!1,v.push({name:"thread",params:{threadId:_.threadId,page:1}})}const ge=y(!1),je=y(!1),it=z(()=>_.page===(fe.value?_.page:pe.value.posts_data.lastPage)),Se=sa();function eo(d){d.post_floor>=_.page*200?(ge.value=!1,je.value=!0):pe.value.posts_data.data.find(Y=>Y.id===d.post_id)||to(d.thread_id,d.post_id)}function to(d,a){const Y={binggan:n.binggan,post_id:a,thread_id:d};Oo(Y).then(J=>{pe.value.posts_data.data.push(J),i.userCustom.hongbaoThenStop&&J.hongbao_id!==null&&(window.$message.info("有红包！停止涮锅！（个人中心开启了红包自动停止涮锅）"),ge.value=!1);const X=document.body.clientHeight-document.documentElement.scrollTop;Xe(()=>{var ve;((ve=h.value)!=null&&ve.isTyping||i.userCustom.holdPageWhenListening)&&(document.documentElement.scrollTop=document.body.clientHeight-X)})})}De(ge,d=>{var a;if(d===!0)try{se(!1),Se.connect(),Se.channel("thread_"+_.threadId).listen("NewPost",Y=>eo(Y)),(a=Se.pusher)==null||a.connection.bind("state_change",Y=>{Y.current==="unavailable"&&(window.$message.error("嗷……服务器的自动涮锅服务好像出问题了，暂时不能使用"),ge.value=!1)})}catch(Y){window.$message.error("嗷……服务器的自动涮锅服务好像出问题了，暂时不能使用"),ge.value=!1}else Se.isConnected&&Se.disconnect()}),be(()=>{ge.value=!1}),De([()=>_.threadId,()=>_.page,()=>_.search],()=>{ge.value=!1,je.value=!1});let ut,We;function dt(d,a){const{timestamp:Y,newPostKey:J}=Ot(d.ist,V.value.id,n.binggan),X={binggan:n.binggan,forum_id:Q.value.id,thread_id:V.value.id,content:d.contentInput,nickname:d.nicknameInput,post_with_admin:d.postWithAdmin,new_post_key:J,timestamp:Y};We=a,ut=d,no(X)}function oo(){dt(ut,We)}const{loading:ao,send:no,onSuccess:so,onError:lo}=ee(d=>Eo(d),{immediate:!1});so(()=>{We("success"),se(!1)}),lo(d=>{var a;d.error.cause!==void 0&&d.error.cause.code===244291&&((a=K.value)==null||a.show())});function mt(d){d.ctrlKey&&d.key==="x"&&se(!0)}return Le(()=>{window.addEventListener("keyup",mt)}),be(()=>{window.removeEventListener("keyup",mt)}),(d,a)=>{var J,X;const Y=Ht("router-link");return r(),F(le,null,[o(e(k),{vertical:""},{default:t(()=>{var ve,ct,ft;return[N.value?(r(),F(le,{key:0},[o(e(k),{align:"center",style:{"margin-top":"8px"}},{default:t(()=>[o(e(_e),{size:e(i).isMobile?28:34},{default:t(()=>[o(e(xo),{style:{cursor:"pointer"},onClick:a[0]||(a[0]=U=>Ee.value=!Ee.value)})]),_:1},8,["size"]),o(Dt,{page:Ie.value,"onUpdate:page":[a[1]||(a[1]=U=>Ie.value=U),at],"last-page":e(fe)?1:e(pe).posts_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),Ee.value?(r(),b(e(k),{key:0,wrap:!1},{default:t(()=>[o(e(Ce),{value:Oe.value,"onUpdate:value":a[2]||(a[2]=U=>Oe.value=U),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索回复内容","auto-size":"",onKeyup:ye(rt,["enter"])},null,8,["value"]),o(e(B),{type:"primary",onClick:rt},{default:t(()=>[...a[15]||(a[15]=[l("搜索",-1)])]),_:1}),o(e(B),{type:"default",onClick:Zt},{default:t(()=>[...a[16]||(a[16]=[l("清空",-1)])]),_:1})]),_:1})):w("",!0),e(i).userCustom.loudspeakerPosition==="top"?(r(),b(Qe,{key:1})):w("",!0),o(fa,{page:s.page,"thread-id":s.threadId,"posts-list-loading":e(fe),"disable-scroll":!!s.search,"is-search":!!s.search},null,8,["page","thread-id","posts-list-loading","disable-scroll","is-search"])],64)):w("",!0),!e(fe)&&N.value?(r(),F(le,{key:1},[o(e(ue),{class:"thread-title-container",size:"small",key:"title-card"},{default:t(()=>{var U,ie,Pe,xe;return[q("span",{class:"thread-title",style:ce({fontSize:e(i).userCustom.fontSizeThreadList+"px"})},T((U=V.value)==null?void 0:U.title)+" ["+T((ie=V.value)==null?void 0:ie.posts_num)+"] ",5),e(n).checkAdminForums((Pe=Q.value)==null?void 0:Pe.id)?(r(),b(e(Fe),{key:0,trigger:"click",options:Ft.value,onSelect:Vt,size:e(i).isMobile?"medium":"large"},{default:t(()=>[o(e(_e),{size:e(i).isMobile?20:24,style:{cursor:"pointer",float:"right","margin-left":"0.5rem"}},{default:t(()=>[o(e($o))]),_:1},8,["size"])]),_:1},8,["options","size"])):w("",!0),(xe=V.value)!=null&&xe.is_your_thread?(r(),b(e(B),{key:1,size:"small",type:"primary",style:{float:"right","margin-left":"0.5rem"},onClick:a[3]||(a[3]=Ke=>{var $e;return($e=E.value)==null?void 0:$e.show()})},{default:t(()=>[...a[17]||(a[17]=[l(" 变色 ",-1)])]),_:1})):w("",!0)]}),_:1}),o(e(k),{vertical:"",size:2},{default:t(()=>{var U,ie,Pe,xe,Ke,$e,pt,gt;return[o($t,{"post-data":lt.value[0],"your-posts-list":Ge.value,"anti-jingfen":(U=V.value)==null?void 0:U.anti_jingfen,"forum-id":Q.value.id,"no-custom-emoji-mode":e(ae),"no-emoji-mode":e(G),"no-head-mode":e(O),"no-image-mode":e(j),"no-video-mode":e(oe),"use-url-mode":e(qe),"random-head-group-index":V.value.random_heads_group,"super-admin-mode":f.value,"no-mention-mode":e(Ne),onShowRewardModal:(ie=M.value)==null?void 0:ie.show,"no-hongbao-pic-mode":e(Ae),onQuoteClick:(Pe=h.value)==null?void 0:Pe.quoteHandle,onRefreshPostsList:a[4]||(a[4]=Me=>se(!1)),onAdminHandle:(xe=x.value)==null?void 0:xe.show},null,8,["post-data","your-posts-list","anti-jingfen","forum-id","no-custom-emoji-mode","no-emoji-mode","no-head-mode","no-image-mode","no-video-mode","use-url-mode","random-head-group-index","super-admin-mode","no-mention-mode","onShowRewardModal","no-hongbao-pic-mode","onQuoteClick","onAdminHandle"]),V.value.vote_question_id!==null?(r(),b(Wa,{key:0,ref_key:"VoteComponentCom",ref:g,"vote-id":V.value.vote_question_id},null,8,["vote-id"])):w("",!0),V.value.gamble_question_id!==null?(r(),b(qa,{key:1,ref_key:"GambleComponentCom",ref:u,"gamble-id":V.value.gamble_question_id,"forum-id":(Ke=Q.value)==null?void 0:Ke.id},null,8,["gamble-id","forum-id"])):w("",!0),V.value.crowd_id!==null?(r(),b(Sa,{key:2,ref_key:"CrowdComponentCom",ref:p,"crowd-id":V.value.crowd_id,"forum-id":($e=Q.value)==null?void 0:$e.id},null,8,["crowd-id","forum-id"])):w("",!0),V.value.hongbao_id!==null?(r(),b(Ea,{key:3,ref_key:"HongbaoComponentCom",ref:C,"hongbao-id":V.value.hongbao_id,"thread-id":s.threadId,"forum-id":(pt=Q.value)==null?void 0:pt.id,"no-hongbao-pic-mode":e(Ae),onRefreshPostsList:a[5]||(a[5]=Me=>se(!1))},null,8,["hongbao-id","thread-id","forum-id","no-hongbao-pic-mode"])):w("",!0),s.threadId===166424?(r(),b(Ja,{key:4,ref_key:"PoolComponentCom",ref:S,"thread-id":s.threadId,"forum-id":(gt=Q.value)==null?void 0:gt.id,onRefreshPostsList:a[6]||(a[6]=Me=>se(!1))},null,8,["thread-id","forum-id"])):w("",!0),(r(!0),F(le,null,ze(lt.value.slice(1),Me=>{var vt,ht,bt,_t;return r(),b($t,{key:Me.id,"post-data":Me,"your-posts-list":Ge.value,"anti-jingfen":(vt=V.value)==null?void 0:vt.anti_jingfen,"forum-id":Q.value.id,"no-custom-emoji-mode":e(ae),"no-emoji-mode":e(G),"no-head-mode":e(O),"no-image-mode":e(j),"no-video-mode":e(oe),"use-url-mode":e(qe),"random-head-group-index":V.value.random_heads_group,"super-admin-mode":f.value,"admin-mode":H.value,"no-mention-mode":e(Ne),onShowRewardModal:(ht=M.value)==null?void 0:ht.show,"no-hongbao-pic-mode":e(Ae),onQuoteClick:(bt=h.value)==null?void 0:bt.quoteHandle,onRefreshPostsList:a[7]||(a[7]=en=>se(!1)),onAdminHandle:(_t=x.value)==null?void 0:_t.show,ref_for:!0,ref_key:"PostItemComs",ref:I},null,8,["post-data","your-posts-list","anti-jingfen","forum-id","no-custom-emoji-mode","no-emoji-mode","no-head-mode","no-image-mode","no-video-mode","use-url-mode","random-head-group-index","super-admin-mode","admin-mode","no-mention-mode","onShowRewardModal","no-hongbao-pic-mode","onQuoteClick","onAdminHandle"])}),128))]}),_:1}),o(e(k),{align:"center",style:{"margin-top":"8px"}},{default:t(()=>[o(e(B),{type:"primary",loading:e(Be),disabled:e(Be),onClick:a[8]||(a[8]=U=>se(!0))},{default:t(()=>[...a[18]||(a[18]=[l("刷新",-1)])]),_:1},8,["loading","disabled"]),o(e(Tt),{value:ge.value,"onUpdate:value":a[9]||(a[9]=U=>ge.value=U),disabled:!it.value||je.value},{checked:t(()=>[...a[19]||(a[19]=[l(" 涮锅中 ",-1)])]),unchecked:t(()=>[...a[20]||(a[20]=[l(" 自动涮锅 ",-1)])]),_:1},8,["value","disabled"]),je.value?(r(),b(Y,{key:0,to:{name:"thread",params:{threadId:s.threadId,page:s.page+1}}},{default:t(()=>[...a[21]||(a[21]=[l("回帖已经翻页、点击前往 ",-1)])]),_:1},8,["to"])):w("",!0),it.value?w("",!0):(r(),b(e(P),{key:1},{default:t(()=>[...a[22]||(a[22]=[l("在最新一页才能自动涮锅",-1)])]),_:1}))]),_:1}),o(e(k),{align:"center",style:ce([{"margin-top":"8px"},{paddingRight:e(i).isMobile?"24px":"0px"}])},{default:t(()=>[o(e(Mo),{placement:"bottom-start",trigger:"hover"},{trigger:t(()=>[o(e(_e),{size:34},{default:t(()=>[o(e(Lo),{onClick:a[10]||(a[10]=U=>{var ie;return e(v).push({name:"forum",params:{forumId:(ie=Q.value)==null?void 0:ie.id}})}),style:{cursor:"pointer"}})]),_:1})]),default:t(()=>[o(e(P),null,{default:t(()=>[...a[23]||(a[23]=[l("返回小岛",-1)])]),_:1})]),_:1}),o(Dt,{page:Ie.value,"onUpdate:page":[a[11]||(a[11]=U=>Ie.value=U),at],"last-page":e(fe)?1:e(pe).posts_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1},8,["style"]),e(i).userCustom.loudspeakerPosition==="center"?(r(),b(Qe,{key:0})):w("",!0)],64)):(r(),b(e(k),{key:2,vertical:"",size:2},{default:t(()=>[(r(),F(le,null,ze(200,U=>q("div",Xa)),64))]),_:1})),St(o(Fo,{ref_key:"postInputCom",ref:h,mode:"post","forum-id":(ve=Q.value)==null?void 0:ve.id,"thread-id":s.threadId,disabled:!1,handling:e(ao),"random-heads-group":(ct=V.value)==null?void 0:ct.random_heads_group,onContentCommit:dt,onRefreshPostsList:se},null,8,["forum-id","thread-id","handling","random-heads-group"]),[[Pt,!e(fe)&&N.value]]),!e(fe)&&N.value?(r(),F(le,{key:3},[o(e(k),{justify:"end"},{default:t(()=>[Q.value.is_nissin===2&&V.value.sub_id===0?(r(),b(e(P),{key:0},{default:t(()=>[a[24]||(a[24]=l(" 本贴将于 ",-1)),o(e(P),{type:"error"},{default:t(()=>[l(T(c.value),1)]),_:1}),a[25]||(a[25]=l(" 日清，请及时更换帖子喔 ",-1))]),_:1})):w("",!0),Q.value.is_nissin===1&&V.value.sub_id===0?(r(),b(e(P),{key:1},{default:t(()=>[a[27]||(a[27]=l(" 本小岛 ",-1)),o(e(P),{type:"error"},{default:t(()=>[...a[26]||(a[26]=[l(" 每日早上8:00 ",-1)])]),_:1}),a[28]||(a[28]=l(" 日清，请及时更换帖子喔 ",-1))]),_:1})):w("",!0)]),_:1}),o(e(k),null,{default:t(()=>[o(e(B),{type:"primary",onClick:a[12]||(a[12]=U=>{var ie;return e(v).push({name:"forum",params:{forumId:(ie=Q.value)==null?void 0:ie.id}})})},{default:t(()=>[...a[29]||(a[29]=[l("返回小岛",-1)])]),_:1})]),_:1}),e(i).userCustom.loudspeakerPosition==="bottom"?(r(),b(Qe,{key:0})):w("",!0),a[31]||(a[31]=q("div",{style:{height:"50px"}},null,-1)),D.value?(r(),F(le,{key:1},[(r(),b(xt,{to:"#topbar-nav"},[o(Y,{to:{name:"forum",params:{forumId:(ft=Q.value)==null?void 0:ft.id}},class:"flex-item-center"},{default:t(()=>[o(e(Do),{tooltip:!1},{default:t(()=>{var U;return[l(T((U=Q.value)==null?void 0:U.name),1)]}),_:1}),o(e(zo),{round:"",class:"forum-tag",size:e(i).isMobile?"small":"medium"},{default:t(()=>{var U;return[l(T((U=Q.value)==null?void 0:U.id),1)]}),_:1},8,["size"])]),_:1},8,["to"])])),(r(),b(xt,{to:"#topbar-func"},[o(e(Fe),{trigger:e(i).isMobile?"click":"hover",options:Ut,placement:"bottom-start"},{default:t(()=>[o(e(B),null,{default:t(()=>[...a[30]||(a[30]=[l("屏蔽",-1)])]),_:1})]),_:1},8,["trigger"])]))],64)):w("",!0),o(pa,{ref_key:"ChangeColorModalCom",ref:E,"thread-id":s.threadId},null,8,["thread-id"]),o(Go,{ref_key:"CaptchaModalCom",ref:K,onWaterUnlockOnSuccess:oo,type:"new_post"},null,512),o(ua,{ref_key:"JumpModalCom",ref:$,"thread-id":s.threadId,"posts-num":V.value.posts_num,page:s.page},null,8,["thread-id","posts-num","page"]),o(ma,{ref_key:"RewardModalCom",ref:M,onRefreshPostsList:se},null,512)],64)):w("",!0),o(Vo,{mode:"thread",onRefresh:a[13]||(a[13]=U=>se(!0)),onShowJumpModal:a[14]||(a[14]=U=>$.value.show())})]}),_:1}),St(o(e(ke),{size:"large",class:"spin"},null,512),[[Pt,e(fe)]]),o(ia,{ref_key:"ForbiddenModalCom",ref:m},null,512),e(n).checkAdminForums((J=Q.value)==null?void 0:J.id)?(r(),b(da,{key:0,ref_key:"AdminActionModalCom",ref:x,onRefreshPostsList:se,"thread-id":s.threadId,"forum-id":(X=Q.value)==null?void 0:X.id},null,8,["thread-id","forum-id"])):w("",!0)],64)}}}),pn=Re(Za,[["__scopeId","data-v-45fe32c5"]]);export{pn as default};
