import{x as V,b as m,q as P,w as R,F as p,A as r,t as e,Q as K,K as l,R as t,V as D,X as d,au as Q,W as T,av as x,aN as j,at as X,a7 as B,aw as q,a8 as O,aA as Z,ag as F,T as z,_ as S,U as N,S as Y,a3 as ee,a4 as ae,z as te,b1 as le,a0 as se,a1 as _,$ as oe,J as ue,N as ne,aV as de}from"./vendor-DamaS_bj.js";import{n as ie}from"./admin-DHMiVug_.js";import{n as re}from"./globalSetting-BG9jSCJX.js";import{n as fe,l as ve,_ as pe,r as me}from"./loudspeaker-Dtgrv2yY.js";import{u as E,b as G,i as W,d as H,c as U,_ as ge}from"./app-CRZ7Digb.js";import{D as ye}from"./Delete-BfEHc_M2.js";const be=V({__name:"NewLoudspeakerModal",emits:["refreshLoudspeaker"],setup(J,{expose:b,emit:k}){const w=E(),M=G(),g=m(null),u=m({subId:"1",content:void 0,color:void 0,threadId:void 0,days:1,effectiveDate:W.tz().format("YYYY-MM-DD HH:mm:ss")}),f=m(!1),v=P(()=>({id:1,sub_id:1,content:u.value.content||"（这里是预览）",color:u.value.color||null,thread_id:null,effective_date:u.value.effectiveDate,expire_date:u.value.effectiveDate,created_at:u.value.effectiveDate,is_your_loudspeaker:!0})),C={effectiveDate:{required:!0,message:"请选择生效日期和时间"},days:{required:!0,message:"请填写生效天数",type:"number"},content:{required:!0,message:"请填写内容"},color:{required:!1},threadId:{required:!1},subId:{required:!1}},i=m(!1);function A(){i.value=!0}b({show:A});const h=k,{loading:y,send:L}=R(c=>fe(c),{immediate:!1});function I(){g.value?.validate(c=>{if(c)window.$message.error("请确认信息填写完整");else{const s={binggan:M.binggan,sub_id:u.value.subId,content:u.value.content,color:f?u.value.color:void 0,thread_id:u.value.threadId,effective_date:u.value.effectiveDate,days:u.value.days};L(s).then(()=>{h("refreshLoudspeaker"),i.value=!1})}})}return(c,s)=>(r(),p(e(K),{show:i.value,"onUpdate:show":s[9]||(s[9]=o=>i.value=o),"display-directive":"if"},{default:l(()=>[t(e(Y),{style:z({maxWidth:e(w).modalMaxWidth}),title:"发布大喇叭",closable:"",onClose:s[8]||(s[8]=o=>i.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(U),{type:"primary",disable:e(y),loading:e(y),onClick:I},{default:l(()=>[...s[10]||(s[10]=[d("发布",-1)])]),_:1},8,["disable","loading"]),t(e(U),{onClick:s[7]||(s[7]=o=>i.value=!1)},{default:l(()=>[...s[11]||(s[11]=[d("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[s[12]||(s[12]=D("div",null,[d(" 价格暂定为5000个olo（每天）"),D("br"),d(" 禁止发布辱骂、诅咒、黑锦鲤等方面情绪。 ")],-1)),t(e(Q),{ref_key:"formRef",ref:g,model:u.value,"label-placement":"left","label-width":"auto",rules:C,size:e(w).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:l(()=>[t(e(x),{label:"生效时间",path:"effectiveDate"},{default:l(()=>[t(e(j),{"formatted-value":u.value.effectiveDate,"onUpdate:formattedValue":s[0]||(s[0]=o=>u.value.effectiveDate=o),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",size:e(w).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),t(e(x),{label:"生效天数",path:"days"},{default:l(()=>[t(e(X),{value:u.value.days,"onUpdate:value":s[1]||(s[1]=o=>u.value.days=o),max:3,min:1,step:1,placeholder:"1-3天"},null,8,["value"])]),_:1}),t(e(x),{label:"内容",path:"content"},{default:l(()=>[t(e(H),{placeholder:"最多100字",type:"textarea",maxlength:"100","show-count":"",autosize:{minRows:3,maxRows:5},value:u.value.content,"onUpdate:value":s[2]||(s[2]=o=>u.value.content=o)},null,8,["value"])]),_:1}),t(e(x),{label:"设定颜色",path:"color"},{default:l(()=>[t(e(q),{value:f.value,"onUpdate:value":s[3]||(s[3]=o=>f.value=o)},null,8,["value"]),B(t(e(Z),{value:u.value.color,"onUpdate:value":s[4]||(s[4]=o=>u.value.color=o),modes:["hex"],"show-alpha":!1,style:{"max-width":"7rem","margin-left":"12px"}},null,8,["value"]),[[O,f.value]])]),_:1}),t(e(x),{label:"链接主题",path:"threadId"},{default:l(()=>[t(e(H),{value:u.value.threadId,"onUpdate:value":s[5]||(s[5]=o=>u.value.threadId=o),placeholder:"主题网址的ID（可留空）"},null,8,["value"])]),_:1}),e(M).admin.isSuperAdmin?(r(),p(e(x),{key:0,label:"设为置顶",path:"subId"},{default:l(()=>[t(e(q),{"onUpdate:value":s[6]||(s[6]=o=>u.value.subId=o),"checked-value":10,"unchecked-value":"1"})]),_:1})):T("",!0)]),_:1},8,["model","size"]),(r(),p(F(v.value.thread_id?"router-link":"span"),{style:z([{color:v.value.color},{"white-space":"pre-wrap"}]),to:v.value.thread_id!==null?`/thread/${v.value.thread_id}/1`:void 0},{default:l(()=>[d(S(v.value.content),1)]),_:1},8,["style","to"]))]),_:1},8,["style"])]),_:1},8,["show"]))}}),ke=V({__name:"LoudspeakerPage",setup(J){ee(o=>({"1386222b":e(M).textColor1}));const b=G(),k=E(),w=m(),M=ae();document.title="大喇叭";const g=m(),u=m(!1),f=m(1),v=m(30),C=P(()=>(f.value-1)*v.value),i={binggan:b.binggan,mode:"all"},{loading:A,data:h,send:y}=R(o=>ve(o),{immediate:!1,initialData:[]});y(i);const L=P(()=>h.value.filter(o=>!(u.value&&!o.is_your_loudspeaker||g.value&&!W.tz(g.value).isSame(o.effective_date,"day")))),{data:I}=R(re);function c(o){const a={title:"强制删除大喇叭",closable:!1,content:"要强制删除这个大喇叭吗？这是管理员功能。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{ie({binggan:b.binggan,loudspeaker_id:o}).then(()=>y(i))}};window.$dialog.warning(a)}function s(o,a=!1){const n={title:"撤回大喇叭",closable:!1,content:a?"由于已超过5分钟，olo将不会退回，是否接受？":"要撤回这个大喇叭吗？如果是5分钟内撤回将退回olo",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{me({binggan:b.binggan,loudspeaker_id:o,confirm_penalty:a}).then(()=>y(i)).catch($=>{$.cause!==void 0&&$.cause.code==21430&&s(o,!0)})}};a?window.$dialog.warning(n):window.$dialog.success(n)}return(o,a)=>(r(),p(e(N),{vertical:"",style:{"margin-top":"8px"}},{default:l(()=>[t(e(N),{size:"small",align:"center"},{default:l(()=>[D("img",{style:z({height:e(k).isMobile?"48px":"64px"}),src:"/ui/miku-loudspeaker.png"},null,4),t(e(le),{style:z({fontSize:e(k).isMobile?"16px":"20px"}),gradient:{from:"#7fcab9",to:"#99b1c5"}},{default:l(()=>[...a[6]||(a[6]=[d(" 爱乃是盲目～🎵 ",-1)])]),_:1},8,["style"]),t(e(se),{placement:"bottom",trigger:"hover",disabled:e(I)},{trigger:l(()=>[t(e(U),{type:"primary",disabled:!e(I),onClick:a[0]||(a[0]=n=>w.value?.show()),style:{"margin-left":"auto"}},{default:l(()=>[...a[7]||(a[7]=[d("发布大喇叭",-1)])]),_:1},8,["disabled"])]),default:l(()=>[t(e(_),null,{default:l(()=>[...a[8]||(a[8]=[d("嗷！目前暂停发布大喇叭…… ",-1)])]),_:1})]),_:1},8,["disabled"])]),_:1}),t(e(N),{size:"small",justify:"end",align:"center"},{default:l(()=>[t(e(_),null,{default:l(()=>[...a[9]||(a[9]=[d("只看自己",-1)])]),_:1}),t(e(q),{value:u.value,"onUpdate:value":a[1]||(a[1]=n=>u.value=n)},null,8,["value"]),t(e(j),{"formatted-value":g.value,"onUpdate:formattedValue":a[2]||(a[2]=n=>g.value=n),"value-format":"yyyy-MM-dd",type:"date",clearable:"",placeholder:"筛选生效日期",size:e(k).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),t(pe,{page:f.value,"onUpdate:page":[a[3]||(a[3]=n=>f.value=n),a[4]||(a[4]=n=>f.value=n)],"last-page":Math.ceil(L.value.length/v.value),style:{"margin-right":"auto"}},null,8,["page","last-page"]),L.value.length>0?(r(!0),te(oe,{key:0},ue(L.value.slice(C.value,C.value+v.value),n=>(r(),p(e(Y),{key:n.id,size:"small",bordered:!0,class:"loudspeaker-card"},{default:l(()=>[(r(),p(F(n.thread_id?"router-link":"span"),{style:z([{color:n.color},{"white-space":"pre-wrap"}]),to:n.thread_id!==null?`/thread/${n.thread_id}/1`:void 0},{default:l(()=>[d(S(n.content),1)]),_:2},1032,["style","to"])),t(e(N),{size:"small"},{default:l(()=>[D("span",null,[t(e(_),{depth:3},{default:l(()=>[...a[10]||(a[10]=[d("生效：",-1)])]),_:1}),t(e(_),null,{default:l(()=>[d(S(n.effective_date),1)]),_:2},1024)]),D("span",null,[t(e(_),{depth:3},{default:l(()=>[...a[11]||(a[11]=[d("到期：",-1)])]),_:1}),t(e(_),null,{default:l(()=>[d(S(n.expire_date),1)]),_:2},1024)]),a[13]||(a[13]=D("div",{style:{"margin-left":"auto"}},null,-1)),n.is_your_loudspeaker?(r(),p(e(ne),{key:0,size:e(k).isMobile?20:24,style:{cursor:"pointer"},onClick:$=>s(n.id,!1)},{default:l(()=>[t(e(ye))]),_:1},8,["size","onClick"])):T("",!0),e(b).admin.isNormalAdmin?(r(),p(e(U),{key:1,size:"tiny",type:"warning",onClick:$=>c(n.id)},{default:l(()=>[...a[12]||(a[12]=[d("强制删除",-1)])]),_:1},8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1024))),128)):(r(),p(e(de),{key:1})),t(be,{ref_key:"NewLoudspeakerModalCom",ref:w,onRefreshLoudspeaker:a[5]||(a[5]=n=>e(y)(i))},null,512)]),_:1}))}}),Ne=ge(ke,[["__scopeId","data-v-3027cefc"]]);export{Ne as default};
