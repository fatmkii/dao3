import{w as N,O as D,n as e,T as Q,$ as S,W as se,b as V,ao as X,h as j,A as m,M as k,p as a,K as L,H as t,t as x,z as i,F as w,I as F,Q as E,E as $,q as oe,y as T,v as h,a_ as ue,az as ae,X as te,_ as le,ay as B,ax as Z,aw as ie,e as q,ac as re,ad as de,b0 as me,aH as pe,bi as ne,bj as ge,S as H,at as R,bl as G,x as M,ak as fe,b4 as ce,b3 as ve,a9 as _e}from"./vendor-CYaCwXn6.js";import{a as A,u as O,b as C,_ as ee,c as Y}from"./app-Cof6PooY.js";import{s as be,g as ye,h as he,i as xe,j as ke,k as Se,l as ze}from"./admin-CLTc0NGA.js";import{u as J}from"./forums-DoWq6fkX.js";import{i as Ue,a as we}from"./inputNumberFormat-DaYmlx6U.js";const $e={class:"banner-box-sm"},Ie=["src"],Me=["src","onClick"],Te=N({__name:"TabBanners",setup(P){D(d=>({"6a1c8eac":e(_).textColor1}));const c=A();O();const b=J(),_=Q(),l=S(0);se(()=>{u.value.length>0&&(l.value=u.value[0].value)});const u=V(()=>c.binggan===null||c.userData.binggan.admin_forums===void 0?[]:b.forumsData.reduce((d,n)=>(c.checkAdminForums(n.id)&&d.push({value:n.id,label:n.name,forumId:n.id}),d),[])),r=S([]);X(l,d=>{var n,z;d===void 0?r.value=[]:r.value=[...(z=(n=b.forumData(d))==null?void 0:n.banners)!=null?z:[]]});const o=S(!1),g=S(),f=V(()=>{var d,n;return(n=(d=g.value)==null?void 0:d.split(/[\n,，]+/).filter(z=>z!=""))!=null?n:[]});function I(){o.value=!1,r.value=r.value.concat(f.value),g.value=void 0,s()}function y(d){var n;(n=r.value)==null||n.splice(d,1)}const{loading:p,send:v,onSuccess:U}=j(d=>be(d),{immediate:!1});U(()=>{b.getForumsData()});function s(){const d={binggan:c.binggan,forum_id:l.value,banners:r.value};v(d)}return(d,n)=>(m(),k(e(x),{vertical:""},{default:a(()=>[o.value?(m(),k(e(L),{key:0,title:"待追加的版头",size:"small",class:"dash-line"},{"header-extra":a(()=>[t(e(x),{size:"small"},{default:a(()=>[t(e(C),{type:"primary",onClick:I},{default:a(()=>[i("追加")]),_:1}),t(e(C),{type:"default",onClick:n[0]||(n[0]=z=>{o.value=!1,g.value=void 0})},{default:a(()=>[i("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(x),{size:"small"},{default:a(()=>[(m(!0),w(F,null,E(f.value,(z,K,W)=>(m(),w("div",$e,[$("img",{src:z,style:{width:"100%"}},null,8,Ie)]))),256))]),_:1}),t(e(oe),{type:"textarea",value:g.value,"onUpdate:value":n[1]||(n[1]=z=>g.value=z),placeholder:"在这里贴网址追加版头。可以一次多个，每行一个。",style:{"border-radius":"10px","margin-top":"6px"},autosize:{minRows:3,maxRows:5}},null,8,["value"])]),_:1})):T("",!0),t(e(L),{title:"版头设定",size:"small"},{"header-extra":a(()=>[t(e(x),{size:"small",align:"center",wrap:!0},{default:a(()=>[t(e(h),{depth:3},{default:a(()=>[i("选择小岛")]),_:1}),t(e(ue),{value:l.value,"onUpdate:value":n[2]||(n[2]=z=>l.value=z),options:u.value,"consistent-menu-width":!1,style:{width:"100px"}},null,8,["value","options"]),o.value?T("",!0):(m(),k(e(C),{key:0,type:"primary",onClick:n[3]||(n[3]=z=>o.value=!0)},{default:a(()=>[i("追加")]),_:1}))]),_:1})]),default:a(()=>[t(e(h),{depth:3},{default:a(()=>[i("点击图片移除")]),_:1}),t(e(x),{wrap:!0,size:[4,4]},{default:a(()=>[(m(!0),w(F,null,E(r.value,(z,K)=>{var W;return m(),w("div",{key:K+((W=l.value)!=null?W:0)*1e3,class:"banner-box"},[$("img",{src:z,class:"banner-img",onClick:Je=>y(K)},null,8,Me)])}),128))]),_:1})]),_:1}),t(e(x),{align:"center",justify:"end"},{default:a(()=>[t(e(h),{depth:3,style:{"font-size":"0.875rem"}},{default:a(()=>[i("各个小岛的变更要分别提交喔")]),_:1}),t(e(C),{type:"primary",loading:e(p),disable:e(p),onClick:s},{default:a(()=>[i("提交")]),_:1},8,["loading","disable"])]),_:1})]),_:1}))}}),Ce=ee(Te,[["__scopeId","data-v-35893c7d"]]),Ne=N({__name:"TabGlobal",setup(P){D(o=>({a7c75f86:e(b).textColor1}));const c=A();O(),J();const b=Q(),_=S(!1),l=S(!1),u=S(!1);c.admin.isSuperAdmin===!0&&ye().then(o=>{_.value=o.new_binggan,l.value=o.new_loudspeaker,u.value=!0});function r(o,g){const f={binggan:c.binggan,key:o,value:JSON.stringify(g)};he(f).then()}return(o,g)=>(m(),k(e(x),{vertical:"",size:[6,12]},{default:a(()=>[t(e(x),{size:"small"},{default:a(()=>[t(e(h),{style:{width:"6.2rem"}},{default:a(()=>[i("领取饼干开关")]),_:1}),t(e(ae),{value:_.value,"onUpdate:value":g[0]||(g[0]=f=>_.value=f),disabled:!u.value,onUpdateValue:g[1]||(g[1]=f=>r("new_binggan",f))},null,8,["value","disabled"]),te(t(e(h),{depth:3},{default:a(()=>[i("读取中")]),_:1},512),[[le,!u.value]])]),_:1}),t(e(x),{size:"small"},{default:a(()=>[t(e(h),{style:{width:"6.2rem"}},{default:a(()=>[i("大喇叭开关")]),_:1}),t(e(ae),{value:l.value,"onUpdate:value":g[2]||(g[2]=f=>l.value=f),disabled:!u.value,onUpdateValue:g[3]||(g[3]=f=>r("new_loudspeaker",f))},null,8,["value","disabled"]),te(t(e(h),{depth:3},{default:a(()=>[i("读取中")]),_:1},512),[[le,!u.value]])]),_:1})]),_:1}))}}),Ae=ee(Ne,[["__scopeId","data-v-44dcccc7"]]),Oe=N({__name:"TabMedal",setup(P){const c=A(),b=O();J(),Q();const _=S(null),l=S({binggan:"",medalId:181}),u={binggan:{required:!0,message:"请填写目标饼干",trigger:"blur"},medalId:{required:!0,message:"请选择要发放的成就",type:"number",trigger:"blur"}},r=[{value:181,label:"皇家御用画宗"},{value:182,label:"小火锅守护者"}],{loading:o,send:g,onSuccess:f,onError:I}=j(p=>xe(p),{immediate:!1});f(()=>{l.value.binggan=""}),I(()=>{l.value.binggan=""});function y(){var p;(p=_.value)==null||p.validate(v=>{if(v){window.$message.error("请确认信息填写完整");return}else{const U={binggan:c.binggan,binggan_target:l.value.binggan,medal_id:l.value.medalId},s=r.find(n=>n.value===l.value.medalId),d={title:"发放成就",closable:!1,content:`对象饼干：${l.value.binggan}  发放成就：${s==null?void 0:s.label}`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{g(U)}};window.$dialog.warning(d)}})}return(p,v)=>(m(),k(e(Z),{ref_key:"formRef",ref:_,model:l.value,"label-placement":"left","label-width":"auto",rules:u,size:e(b).isMobile?"small":"medium",style:{"max-width":"300px"}},{default:a(()=>[t(e(B),{label:"目标饼干",path:"binggan"},{default:a(()=>[t(e(Y),{value:l.value.binggan,"onUpdate:value":v[0]||(v[0]=U=>l.value.binggan=U)},null,8,["value"])]),_:1}),t(e(B),{label:"发放成就",path:"medalId"},{default:a(()=>[t(e(ue),{value:l.value.medalId,"onUpdate:value":v[1]||(v[1]=U=>l.value.medalId=U),options:r,"menu-props":{style:{borderRadius:"10px"}}},null,8,["value"])]),_:1}),t(e(C),{type:"primary",loading:e(o),disabled:e(o),onClick:y},{default:a(()=>[i("提交")]),_:1},8,["loading","disabled"])]),_:1},8,["model","size"]))}}),Pe=N({__name:"TabCoin",setup(P){const c=A(),b=O(),_=S(null),l=S({binggan:"",olo:void 0,message:""}),u={binggan:{required:!0,message:"请填写目标饼干",trigger:"blur"},message:{required:!1},olo:{required:!0,message:"请选择要奖罚的olo",type:"number",trigger:"blur"}},{loading:r,send:o,onSuccess:g,onError:f}=j(y=>ke(y),{immediate:!1});g(()=>{l.value.binggan=""}),f(()=>{l.value.binggan=""});function I(){var y;(y=_.value)==null||y.validate(p=>{if(p){window.$message.error("请确认信息填写完整");return}else{const v={binggan:c.binggan,binggan_target:l.value.binggan,olo_num:l.value.olo,olo_message:l.value.message},U=l.value.olo>0?"奖励":"罚款",s={title:"奖罚olo",closable:!1,content:`对象饼干：${l.value.binggan} ${U}${l.value.olo}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{o(v)}};window.$dialog.warning(s)}})}return(y,p)=>(m(),k(e(Z),{ref_key:"formRef",ref:_,model:l.value,"label-placement":"left","label-width":"auto",rules:u,size:e(b).isMobile?"small":"medium",style:{"max-width":"300px"}},{default:a(()=>[t(e(B),{label:"目标饼干",path:"binggan"},{default:a(()=>[t(e(Y),{value:l.value.binggan,"onUpdate:value":p[0]||(p[0]=v=>l.value.binggan=v)},null,8,["value"])]),_:1}),t(e(B),{label:"奖罚olo",path:"olo"},{default:a(()=>[t(e(ie),{value:l.value.olo,"onUpdate:value":p[1]||(p[1]=v=>l.value.olo=v),max:1e6,min:-1e6,step:1e3,parse:e(Ue),format:e(we),placeholder:"正数是奖励，负数是罚款"},null,8,["value","parse","format"])]),_:1}),t(e(B),{label:"附带留言",path:"message"},{default:a(()=>[t(e(Y),{value:l.value.message,"onUpdate:value":p[2]||(p[2]=v=>l.value.message=v),placeholder:"将显示在收支记录"},null,8,["value"])]),_:1}),t(e(C),{type:"primary",loading:e(r),disabled:e(r),onClick:I},{default:a(()=>[i("提交")]),_:1},8,["loading","disabled"])]),_:1},8,["model","size"]))}}),He={class:"actives-item"},Re={style:{"margin-left":"auto"}},Be={key:0,style:{"margin-top":"6px"}},Fe={style:{"margin-top":"6px"}},Ee={style:{"margin-top":"6px"}},je=N({__name:"TabActives",setup(P){D(s=>({a0198f68:e(_).dividerColor})),q.extend(re),q.extend(de);const c=A(),b=O(),_=Q(),l=S(q().tz("Asia/Shanghai").format("YYYY-MM-DD"));X(l,()=>y());const u=S(1);X(u,()=>y()),se(()=>y());function r(s){return q().add(1,"day").isBefore(s)}const o=[{title:"时间",key:"created_at",resizable:!0},{title:"管理员",key:"name",resizable:!0},{title:"罚款",key:"olo",resizable:!0},{title:"操作",key:"active",resizable:!0},{title:"原因",key:"content",resizable:!0},{title:"主题",key:"thread_title",render:v,resizable:!0},{title:"回复",key:"post_content",render:U,resizable:!0}],{loading:g,data:f,send:I}=j(s=>Se(s),{immediate:!1,initialData:{data:[],last_page:1}});function y(){const s={binggan:c.binggan,date:l.value,page:u.value};I(s)}function p(s){return{name:"thread",params:{threadId:s.thread_id,page:s.floor===null?1:Math.ceil((s.floor+1)/200)},hash:s.floor===null?void 0:"#f_"+s.floor}}function v(s,d){return s.thread_id!==null?H(G,{to:p(s),target:"_blank"},()=>H(R,{style:"max-width: 120px"},()=>s.thread_title)):H(R,{style:"max-width: 120px"},()=>s.thread_title)}function U(s,d){return s.thread_id!==null?H(G,{to:p(s),target:"_blank"},()=>H(R,{style:"max-width: 120px"},()=>s.post_content)):H(R,{style:"max-width: 120px"},()=>s.post_content)}return(s,d)=>(m(),k(e(x),{size:"small"},{default:a(()=>[t(e(me),{"formatted-value":l.value,"onUpdate:formattedValue":d[0]||(d[0]=n=>l.value=n),"value-format":"yyyy-MM-dd",type:"date",size:e(b).isMobile?"small":"medium","is-date-disabled":r},null,8,["formatted-value","size"]),t(e(C),{type:"primary",onClick:d[1]||(d[1]=n=>y())},{default:a(()=>[i(" 查询 ")]),_:1}),t(e(L),{title:"管理员操作记录",size:"small"},{default:a(()=>[e(b).isMobile?T("",!0):(m(),k(e(x),{key:0},{default:a(()=>[t(e(pe),{columns:o,data:e(f).data,bordered:!1,loading:e(g),style:{height:"100%"}},null,8,["data","loading"]),t(e(ne),{page:u.value,"onUpdate:page":d[2]||(d[2]=n=>u.value=n),"page-count":e(f).last_page,size:"medium",style:{"margin-left":"auto"}},null,8,["page","page-count"])]),_:1})),e(b).isMobile?(m(),w(F,{key:1},[e(f).data.length>0?(m(),k(e(x),{key:0,vertical:"",align:"start",size:"small"},{default:a(()=>[e(g)?T("",!0):(m(!0),w(F,{key:0},E(e(f).data,n=>(m(),w("div",He,[t(e(x),null,{default:a(()=>[$("div",null,[t(e(h),{depth:3},{default:a(()=>[i("时间：")]),_:1}),t(e(h),null,{default:a(()=>[i(M(n.created_at),1)]),_:2},1024)]),$("div",Re,[t(e(h),{depth:3},{default:a(()=>[i("管理员：")]),_:1}),t(e(h),null,{default:a(()=>[i(M(n.name),1)]),_:2},1024)])]),_:2},1024),n.olo?(m(),w("div",Be,[t(e(h),{depth:3},{default:a(()=>[i("罚款：")]),_:1}),t(e(h),null,{default:a(()=>[i(M(n.olo),1)]),_:2},1024)])):T("",!0),$("div",Fe,[t(e(h),{depth:3},{default:a(()=>[i("操作：")]),_:1}),t(e(h),null,{default:a(()=>[i(M(n.active),1)]),_:2},1024)]),$("div",Ee,[t(e(h),{depth:3},{default:a(()=>[i("原因：")]),_:1}),t(e(h),null,{default:a(()=>[i(M(n.content),1)]),_:2},1024)]),n.thread_title!==null?(m(),k(e(x),{key:1,style:{"margin-top":"6px"},wrap:!1},{default:a(()=>[t(e(h),{depth:3},{default:a(()=>[i("主题：")]),_:1}),t(e(G),{to:p(n),style:{"max-width":"80%"}},{default:a(()=>[t(e(R),null,{default:a(()=>[i(M(n.thread_title),1)]),_:2},1024)]),_:2},1032,["to"])]),_:2},1024)):T("",!0),n.post_content!==null?(m(),k(e(x),{key:2,style:{"margin-top":"6px"},wrap:!1},{default:a(()=>[t(e(h),{depth:3},{default:a(()=>[i("主题：")]),_:1}),t(e(G),{to:p(n),style:{"max-width":"80%"}},{default:a(()=>[t(e(R),null,{default:a(()=>[i(M(n.post_content),1)]),_:2},1024)]),_:2},1032,["to"])]),_:2},1024)):T("",!0)]))),256)),t(e(ne),{page:u.value,"onUpdate:page":d[3]||(d[3]=n=>u.value=n),"page-count":e(f).last_page,size:"small",style:{"margin-left":"auto"}},null,8,["page","page-count"])]),_:1})):(m(),k(e(ge),{key:1}))],64)):T("",!0)]),_:1})]),_:1}))}}),qe=ee(je,[["__scopeId","data-v-a35e3f42"]]),Ge=N({__name:"TabUUID",setup(P){const c=A(),b=O(),_=S(null),l=S({uuid:""}),u={uuid:{required:!0,message:"请填写目标UUID",trigger:"blur"}},{loading:r,send:o,onSuccess:g,onError:f}=j(y=>ze(y),{immediate:!1});g(()=>{l.value.uuid=""});function I(){var y;(y=_.value)==null||y.validate(p=>{if(p){window.$message.error("请确认信息填写完整");return}else{const v={binggan:c.binggan,uuid:l.value.uuid};o(v)}})}return(y,p)=>(m(),k(e(Z),{ref_key:"formRef",ref:_,model:l.value,"label-placement":"left","label-width":"auto",rules:u,size:e(b).isMobile?"small":"medium",style:{"max-width":"300px"}},{default:a(()=>[t(e(B),{label:"解锁UUID",path:"uuid"},{default:a(()=>[t(e(Y),{value:l.value.uuid,"onUpdate:value":p[0]||(p[0]=v=>l.value.uuid=v)},null,8,["value"])]),_:1}),t(e(C),{type:"primary",loading:e(r),disabled:e(r),onClick:I},{default:a(()=>[i("提交")]),_:1},8,["loading","disabled"])]),_:1},8,["model","size"]))}}),Ve=$("img",{src:"https://www.freeimg.cn/i/2024/05/15/6644aedee642d.png",style:{"max-width":"50px","max-height":"50px"}},null,-1),Le=$("span",null,"管理员中心",-1),Ye=N({__name:"AdminCard",setup(P){const c=A(),b=O(),_=J(),l=V(()=>c.binggan===null||c.userData.binggan.admin_forums===void 0?[]:_.forumsData.reduce((u,r)=>(c.checkAdminForums(r.id)&&u.push({value:r.id,label:r.name,forumId:r.id}),u),[]));return(u,r)=>(m(),k(e(L),{hoverable:"",size:"small"},{default:a(()=>[t(e(x),{vertical:e(b).isMobile},{default:a(()=>[t(e(x),{size:"small",align:"center"},{default:a(()=>[Ve,Le]),_:1}),$("div",null,[t(e(h),{depth:3},{default:a(()=>[i("我管理的板块")]),_:1}),t(e(x),null,{default:a(()=>[(m(!0),w(F,null,E(l.value,o=>(m(),k(e(fe),null,{default:a(()=>[i(M(o.forumId)+". "+M(o.label),1)]),_:2},1024))),256))]),_:1})])]),_:1},8,["vertical"])]),_:1}))}}),Qe=$("div",{style:{height:"50px"}},null,-1),ea=N({__name:"AdminCenter",setup(P){const c=A(),b=O(),_=S();document.title="管理员中心";const l=V(()=>{const u=[{name:"banners",tab:"版头设定",component:Ce}];return c.admin.isNormalAdmin&&u.unshift({name:"actives",tab:"管理状况",component:qe}),c.admin.isSuperAdmin?u.concat([{name:"global",tab:"全局设置",component:Ae},{name:"medals",tab:"发放成就",component:Oe},{name:"olo",tab:"奖罚olo",component:Pe},{name:"uuid",tab:"解锁uuid",component:Ge}]):u});return(u,r)=>(m(),k(e(x),{vertical:"",style:{"margin-top":"8px"}},{default:a(()=>[t(e(Ye)),t(e(ce),{type:"line","bar-width":e(b).isMobile?0:void 0,animated:"",size:e(b).isMobile?"small":"large",value:_.value,"onUpdate:value":r[0]||(r[0]=o=>_.value=o)},{default:a(()=>[(m(!0),w(F,null,E(l.value,o=>(m(),k(e(ve),{name:o.name,tab:o.tab,key:o.name},{default:a(()=>[(m(),k(_e(o.component)))]),_:2},1032,["name","tab"]))),128))]),_:1},8,["bar-width","size","value"]),Qe]),_:1}))}});export{ea as default};
