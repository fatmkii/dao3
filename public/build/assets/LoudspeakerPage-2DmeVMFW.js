import{ak as Q,ar as I,Y as K,w as W,L as J,d as _,b9 as X,a7 as A,al as F,a8 as Z,S as ee,bi as te,b as q,o as B,$ as k,c as U,bA as ae,A as x,M as C,f as o,H as a,a as e,k as D,n as R,z as m,ac as le,ad as oe,G as j,m as T,i as V,aG as ne,j as $,aW as re,bl as se,h as L,F as ie,Q as de,C as ue,aV as me,s as E,N as fe,bB as ce}from"./app-B4DzAUIj.js";import{n as pe}from"./globalSetting-ILPRVxST.js";import{_ as ve}from"./Pagination.vue_vue_type_script_setup_true_lang-CDMXc0em.js";import{d as O}from"./dayjs.min-BIwLhz4I.js";import{_ as G}from"./FInput.vue_vue_type_script_setup_true_lang-CxUjdTsS.js";import{N as Y}from"./DatePicker-CufqbsJZ.js";import{a as ge,N}from"./FormItem-9iP2kpeR.js";import{N as ye,a as H}from"./Switch-EVR9QKqy.js";import{N as be}from"./ColorPicker-COqjVpFD.js";import{u as he}from"./use-houdini-C3OycVbR.js";import{D as ke}from"./Delete-C2BM2MZE.js";import"./Pagination-CguQYKr6.js";import"./use-locale-B4ZjmQ99.js";import"./Input-D-cuxZic.js";import"./Select-DbLZIsfq.js";import"./Tag-BLrYgQ_6.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Add-loLTCSkp.js";import"./InputGroup-Cwysfm4x.js";const xe=d=>{const{primaryColor:i,successColor:f,warningColor:c,errorColor:p,infoColor:v,fontWeightStrong:y}=d;return{fontWeight:y,rotate:"252deg",colorStartPrimary:I(i,{alpha:.6}),colorEndPrimary:i,colorStartInfo:I(v,{alpha:.6}),colorEndInfo:v,colorStartWarning:I(c,{alpha:.6}),colorEndWarning:c,colorStartError:I(p,{alpha:.6}),colorEndError:p,colorStartSuccess:I(f,{alpha:.6}),colorEndSuccess:f}},_e={name:"GradientText",common:Q,self:xe},we=_e,Se=K("gradient-text",`
 display: inline-block;
 font-weight: var(--n-font-weight);
 -webkit-background-clip: text;
 background-clip: text;
 color: #0000;
 white-space: nowrap;
 background-image: linear-gradient(var(--n-rotate), var(--n-color-start) 0%, var(--n-color-end) 100%);
 transition:
 --n-color-start .3s var(--n-bezier),
 --n-color-end .3s var(--n-bezier);
`),Ce=Object.assign(Object.assign({},A.props),{size:[String,Number],fontSize:[String,Number],type:{type:String,default:"primary"},color:[Object,String],gradient:[Object,String]}),ze=W({name:"GradientText",props:Ce,setup(d){he();const{mergedClsPrefixRef:i,inlineThemeDisabled:f}=J(d),c=_(()=>{const{type:r}=d;return r==="danger"?"error":r}),p=_(()=>{let r=d.size||d.fontSize;return r&&(r=X(r)),r||void 0}),v=_(()=>{const r=d.color||d.gradient;if(typeof r=="string")return r;if(r){const g=r.deg||0,w=r.from,b=r.to;return`linear-gradient(${g}deg, ${w} 0%, ${b} 100%)`}}),y=A("GradientText","-gradient-text",Se,we,d,i),n=_(()=>{const{value:r}=c,{common:{cubicBezierEaseInOut:g},self:{rotate:w,[F("colorStart",r)]:b,[F("colorEnd",r)]:S,fontWeight:z}}=y.value;return{"--n-bezier":g,"--n-rotate":w,"--n-color-start":b,"--n-color-end":S,"--n-font-weight":z}}),u=f?Z("gradient-text",_(()=>c.value[0]),n,d):void 0;return{mergedClsPrefix:i,compatibleType:c,styleFontSize:p,styleBgImage:v,cssVars:f?void 0:n,themeClass:u==null?void 0:u.themeClass,onRender:u==null?void 0:u.onRender}},render(){const{mergedClsPrefix:d,onRender:i}=this;return i==null||i(),ee("span",{class:[`${d}-gradient-text`,`${d}-gradient-text--${this.compatibleType}-type`,this.themeClass],style:[{fontSize:this.styleFontSize,backgroundImage:this.styleBgImage},this.cssVars]},this.$slots)}}),Le=d=>{const i=te.Post("api/admin/del_loudspeaker",d,{name:"deleteLoudspeakerPoster",params:{},localCache:null,hitSource:[]});return i.meta={shouldRemind:!0},i},Ne=$("div",null,[m(" 价格暂定为5000个olo（每天）"),$("br"),m(" 禁止发布辱骂、诅咒、黑锦鲤等方面情绪。 ")],-1),$e=W({__name:"NewLoudspeakerModal",emits:["refreshLoudspeaker"],setup(d,{expose:i,emit:f}){const c=q(),p=B(),v=k(null),y=_(()=>{const h=window.innerWidth;return h>=532?"500px":h-32+"px"}),n=k({subId:"1",content:void 0,color:void 0,threadId:void 0,days:1,effectiveDate:O().format("YYYY-MM-DD 00:00:00")}),u=k(!1),r={effectiveDate:{required:!0,message:"请选择生效日期和时间"},days:{required:!0,message:"请填写生效天数",type:"number"},content:{required:!0,message:"请填写内容"},color:{required:!1},threadId:{required:!1},subId:{required:!1}},g=k(!1);function w(){g.value=!0}i({show:w});const b=f,{loading:S,send:z}=U(h=>ae(h),{immediate:!1});function P(){var h;(h=v.value)==null||h.validate(l=>{if(l)window.$message.error("请确认信息填写完整");else{const t={binggan:p.binggan,sub_id:n.value.subId,content:n.value.content,color:u?n.value.color:void 0,thread_id:n.value.threadId,effective_date:n.value.effectiveDate,days:n.value.days};z(t).then(()=>{b("refreshLoudspeaker"),g.value=!1})}})}return(h,l)=>(x(),C(e(ne),{show:g.value,"onUpdate:show":l[9]||(l[9]=t=>g.value=t),"display-directive":"if"},{default:o(()=>[a(e(V),{style:T({maxWidth:y.value}),title:"发布大喇叭",closable:"",onClose:l[8]||(l[8]=t=>g.value=!1),size:"small"},{action:o(()=>[a(e(D),{justify:"end"},{default:o(()=>[a(e(R),{type:"primary",disable:e(S),loading:e(S),onClick:P},{default:o(()=>[m("发布")]),_:1},8,["disable","loading"]),a(e(R),{onClick:l[7]||(l[7]=t=>g.value=!1)},{default:o(()=>[m("关闭")]),_:1})]),_:1})]),default:o(()=>[Ne,a(e(ge),{ref_key:"formRef",ref:v,model:n.value,"label-placement":"left","label-width":"auto",rules:r,size:e(c).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:o(()=>[a(e(N),{label:"生效日期",path:"effectiveDate"},{default:o(()=>[a(e(Y),{"formatted-value":n.value.effectiveDate,"onUpdate:formattedValue":l[0]||(l[0]=t=>n.value.effectiveDate=t),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",size:e(c).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),a(e(N),{label:"生效天数",path:"days"},{default:o(()=>[a(e(ye),{value:n.value.days,"onUpdate:value":l[1]||(l[1]=t=>n.value.days=t),max:3,min:1,step:1,placeholder:"1-3天"},null,8,["value"])]),_:1}),a(e(N),{label:"内容",path:"content"},{default:o(()=>[a(e(G),{placeholder:"最多100字",type:"textarea",maxlength:"100","show-count":"",autosize:{minRows:3,maxRows:5},value:n.value.content,"onUpdate:value":l[2]||(l[2]=t=>n.value.content=t)},null,8,["value"])]),_:1}),a(e(N),{label:"设定颜色",path:"color"},{default:o(()=>[a(e(H),{value:u.value,"onUpdate:value":l[3]||(l[3]=t=>u.value=t)},null,8,["value"]),le(a(e(be),{value:n.value.color,"onUpdate:value":l[4]||(l[4]=t=>n.value.color=t),modes:["hex"],"show-alpha":!1,style:{"max-width":"7rem","margin-left":"12px"}},null,8,["value"]),[[oe,u.value]])]),_:1}),a(e(N),{label:"链接主题",path:"threadId"},{default:o(()=>[a(e(G),{value:n.value.threadId,"onUpdate:value":l[5]||(l[5]=t=>n.value.threadId=t),placeholder:"主题网址的ID（可留空）"},null,8,["value"])]),_:1}),e(p).admin.isSuperAdmin?(x(),C(e(N),{key:0,label:"设为置顶",path:"subId"},{default:o(()=>[a(e(H),{"onUpdate:value":l[6]||(l[6]=t=>n.value.subId=t),"checked-value":10,"unchecked-value":"1"})]),_:1})):j("",!0)]),_:1},8,["model","size"])]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ie=$("div",{style:{"margin-left":"auto"}},null,-1),Ke=W({__name:"LoudspeakerPage",setup(d){const i=B(),f=q(),c=k(),p=k(),v=k(!1),y=k(1),n=k(30),u=_(()=>(y.value-1)*n.value),r={binggan:i.binggan,mode:"all"},{loading:g,data:w,send:b}=U(l=>re(l),{immediate:!1,initialData:[]});b(r);const S=_(()=>w.value.filter(l=>!(v.value&&!l.is_your_loudspeaker||p.value&&!O(p.value).isSame(l.effective_date,"day")))),{data:z}=U(pe);function P(l){const t={title:"强制删除大喇叭",closable:!1,content:"要强制删除这个大喇叭吗？这是管理员功能。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Le({binggan:i.binggan,loudspeaker_id:l}).then(()=>b(r))}};window.$dialog.warning(t)}function h(l){const t={title:"撤回大喇叭",closable:!1,content:"要撤回这个大喇叭吗？花费的奥利奥不会退回喔",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{ce({binggan:i.binggan,loudspeaker_id:l}).then(()=>b(r))}};window.$dialog.warning(t)}return(l,t)=>(x(),C(e(D),{vertical:"",style:{"margin-top":"8px"}},{default:o(()=>[a(e(D),{size:"small",align:"center"},{default:o(()=>[$("img",{style:T({height:e(f).isMobile?"48px":"64px"}),src:"https://oss.cpttmm.com/xhg_other/miku_loudspeaker.png"},null,4),a(e(ze),{style:T({fontSize:e(f).isMobile?"16px":"20px"}),gradient:{from:"#7fcab9",to:"#99b1c5"}},{default:o(()=>[m(" 爱乃是盲目～🎵 ")]),_:1},8,["style"]),a(e(se),{placement:"bottom",trigger:"hover",disabled:e(z)},{trigger:o(()=>[a(e(R),{type:"primary",disabled:!e(z),onClick:t[0]||(t[0]=s=>{var M;return(M=c.value)==null?void 0:M.show()}),style:{"margin-left":"auto"}},{default:o(()=>[m("发布大喇叭")]),_:1},8,["disabled"])]),default:o(()=>[a(e(L),null,{default:o(()=>[m("嗷！目前暂停发布大喇叭…… ")]),_:1})]),_:1},8,["disabled"])]),_:1}),a(e(D),{size:"small",justify:"end",align:"center"},{default:o(()=>[a(e(L),null,{default:o(()=>[m("只看自己")]),_:1}),a(e(H),{value:v.value,"onUpdate:value":t[1]||(t[1]=s=>v.value=s)},null,8,["value"]),a(e(Y),{"formatted-value":p.value,"onUpdate:formattedValue":t[2]||(t[2]=s=>p.value=s),"value-format":"yyyy-MM-dd",type:"date",clearable:"",placeholder:"筛选生效日期",size:e(f).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),a(ve,{page:y.value,"onUpdate:page":[t[3]||(t[3]=s=>y.value=s),t[4]||(t[4]=s=>y.value=s)],"last-page":Math.floor(S.value.length/n.value),style:{"margin-right":"auto"}},null,8,["page","last-page"]),(x(!0),ie(ue,null,de(S.value.slice(u.value,u.value+n.value),s=>(x(),C(e(V),{key:s.id,size:"small",bordered:!0,class:"loudspeaker-card"},{default:o(()=>[(x(),C(me(s.thread_id?"router-link":"span"),{style:T({color:s.color}),to:s.thread_id!==null?`/thread/${s.thread_id}/1`:void 0},{default:o(()=>[m(E(s.content),1)]),_:2},1032,["style","to"])),a(e(D),{size:"small"},{default:o(()=>[$("span",null,[a(e(L),{depth:3},{default:o(()=>[m("生效：")]),_:1}),a(e(L),null,{default:o(()=>[m(E(s.effective_date),1)]),_:2},1024)]),$("span",null,[a(e(L),{depth:3},{default:o(()=>[m("到期：")]),_:1}),a(e(L),null,{default:o(()=>[m(E(s.expire_date),1)]),_:2},1024)]),Ie,s.is_your_loudspeaker?(x(),C(e(fe),{key:0,size:e(f).isMobile?20:24,style:{cursor:"pointer"},onClick:M=>h(s.id)},{default:o(()=>[a(e(ke))]),_:2},1032,["size","onClick"])):j("",!0),e(i).admin.isNormalAdmin?(x(),C(e(R),{key:1,size:"tiny",type:"warning",onClick:M=>P(s.id)},{default:o(()=>[m("强制删除")]),_:2},1032,["onClick"])):j("",!0)]),_:2},1024)]),_:2},1024))),128)),a($e,{ref_key:"NewLoudspeakerModalCom",ref:c,onRefreshLoudspeaker:t[5]||(t[5]=s=>e(b)(r))},null,512)]),_:1}))}});export{Ke as default};
