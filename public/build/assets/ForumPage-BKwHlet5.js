import{R as le,ak as ne,w as ue,$ as p,u as $,b as F,al as ie,am as de,an as pe,A as d,M as _,o,m as e,K as ce,L as me,U as fe,F as b,H as s,af as he,x as k,ag as ge,_ as ve,Q as ye,X as W,z as u,N as _e,ao as be,s as m,B as ke,v as N,ap as we,aq as Ie,D as Se,ah as Ce,ai as xe,aj as De,J as G,S as f,ar as Te}from"./vendor-DQqxAeCv.js";import{u as Le,t as A}from"./forums-B1L0hElq.js";import{s as z}from"./subtitles-DW7M559j.js";import{u as H,a as $e,b as c,c as Fe,d as M,_ as Ne}from"./app-CvEUHSZB.js";import{_ as ze}from"./loudspeaker-C2pBNi3g.js";import{L as Me,S as Oe}from"./LoudspeakerComponent-FNAVZ8Dl.js";import{T as Ue}from"./ThreadList-Btt6sf0F.js";import"./showDialog-D6khvXZG.js";import"./browseLogger-DN4xlfaA.js";function Pe(){const i=H();le(()=>{i.showTopbarNav=!1}),ne(()=>{i.showTopbarNav=!0})}const K=i=>(xe("data-v-7de40444"),i=i(),De(),i),Re={key:0,class:"carousel-box"},je={key:0,class:"carousel-box"},qe=["src"],Be=K(()=>G("div",{style:{"margin-left":"auto"}},null,-1)),Ee=K(()=>G("div",{style:{height:"50px"}},null,-1)),We=ue({__name:"ForumPage",props:{forumId:{},page:{},search:{},delay:{type:Boolean}},setup(i){var B,E;ce(a=>({"08ba4a61":e(n).bannerHeight}));const w=$e(),n=H(),h=Le(),g=me(),Q=p(null);p();const O=p();Pe();const t=i;document.title=(E=(B=h.forumData(t.forumId))==null?void 0:B.name)!=null?E:"小火锅";const I=$("banner_hiden",!1),S=$("new_window_to_post",!1);function J(){return f(m,{style:"padding:6px 8px",vertical:!0},()=>[f(M,{checked:I.value,"onUpdate:checked":a=>I.value=a,label:"隐藏版头"}),f(M,{checked:S.value,"onUpdate:checked":a=>S.value=a,label:"新窗口打开"})])}const X=[{type:"group",key:"header",label:"功能"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:J}],C=$("subtitles_included",z),U=F(()=>z.filter(a=>!C.value.includes(a)));function V(){return f(Te,{value:C.value,"onUpdate:value":a=>C.value=a},()=>[f(m,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(z).map(a=>f(M,{value:a,label:a}))])])}const Y=[{type:"group",key:"header",label:"筛选"},{key:"header-divider",type:"divider"},{key:"filterOptions",type:"render",render:V}],v=p(t.search),y=p(!!t.search);function P(){g.push({name:"forum",params:{forumId:t.forumId,page:1},query:{search:v.value||void 0}})}function Z(){v.value=void 0,y.value=!1,g.push({name:"forum",params:{forumId:t.forumId,page:1}})}function ee(){g.push({name:"forum",params:{forumId:t.forumId,page:1},query:{delay:t.delay?void 0:"true"}})}const x=p(t.page);function ae(a){g.push({name:"forum",params:{forumId:t.forumId,page:a},query:{search:t.search,delay:t.delay?"true":void 0}})}ie(()=>t.page,a=>x.value=a);const R=F(()=>({forumId:t.forumId,binggan:w.binggan,page:t.page,threadsPerPage:50,subtitlesExcluded:U.value,searchTitle:t.search,delay:t.delay})),{loading:D,data:T,onSuccess:Ae}=de(()=>A(R.value),[()=>t.forumId,()=>t.page,()=>t.search,()=>t.delay,U],{initialData:[],immediate:!0}),j=p(!1),{fetching:Ge,onSuccess:te,fetch:se}=pe();function q(a=!1){var r;j.value=a,se(A(R.value)),(r=O.value)==null||r.reloadBrowseLogger()}te(()=>{j.value&&!n.userCustom.lessToast&&window.$message.success("已刷新数据")});const re=F(()=>{if(D.value)return[];if(w.userData.binggan.use_pingbici){const a=n.userCustom.pingbiciIngnoreCase?"gi":"g";return T.value.threads_data.data.filter(r=>{for(let L of w.userData.pingbici.title_pingbici)if(new RegExp(L,a).test(r.title))return!1;return!0})}else return T.value.threads_data.data});return(a,r)=>{const L=fe("router-link");return d(),_(e(m),{vertical:""},{default:o(()=>[e(I)?k("",!0):(d(),b("div",Re,[e(h).forumsDataLoading?(d(),b("div",je,[s(e(he),{class:"carousel-skeleton",sharp:""})])):k("",!0),e(h).forumsDataLoading?k("",!0):(d(),_(e(ge),{key:1,"show-arrow":"",trigger:e(n).isMobile?"click":"hover",autoplay:"",interval:1e4},{default:o(()=>{var l;return[(d(!0),b(ve,null,ye((l=e(h).forumData(a.forumId))==null?void 0:l.banners,oe=>(d(),b("img",{src:oe,class:"carousel-img"},null,8,qe))),256))]}),_:1},8,["trigger"]))])),s(e(m),{style:{"margin-top":"8px"},size:"small"},{default:o(()=>[s(e(W),{trigger:e(n).isMobile?"click":"hover",options:X,placement:"bottom-start"},{default:o(()=>[s(e(c),null,{default:o(()=>[u("功能")]),_:1})]),_:1},8,["trigger"]),s(e(W),{trigger:e(n).isMobile?"click":"hover",options:Y,placement:"bottom-start"},{default:o(()=>[s(e(c),null,{default:o(()=>[u("筛选")]),_:1})]),_:1},8,["trigger"]),s(e(_e),{size:e(n).isMobile?28:34},{default:o(()=>[s(e(be),{style:{cursor:"pointer"},onClick:r[0]||(r[0]=l=>y.value=!y.value)})]),_:1},8,["size"]),Be,s(e(c),{type:"primary",onClick:r[1]||(r[1]=l=>a.$router.push({name:"loudspeaker"}))},{default:o(()=>[u("大喇叭")]),_:1}),s(e(c),{type:"primary",onClick:r[2]||(r[2]=l=>a.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},{default:o(()=>[u("新主题")]),_:1})]),_:1}),y.value?(d(),_(e(m),{key:1,wrap:!1},{default:o(()=>[s(e(Fe),{value:v.value,"onUpdate:value":r[3]||(r[3]=l=>v.value=l),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索标题","auto-size":"",onKeyup:ke(P,["enter"])},null,8,["value"]),s(e(c),{type:"primary",onClick:P},{default:o(()=>[u("搜索")]),_:1}),s(e(c),{type:"default",onClick:Z},{default:o(()=>[u("清空")]),_:1})]),_:1})):k("",!0),s(Me),s(Ue,{ref_key:"ThreadListCom",ref:O,"threads-list-data":re.value,"new-window-to-post":e(S),"show-this":!e(D),onWithdrawDelayThreadSuccess:q},null,8,["threads-list-data","new-window-to-post","show-this"]),s(e(m),{align:"center"},{default:o(()=>[s(e(c),{type:t.delay?"default":"primary",onClick:ee},{default:o(()=>[u(N(t.delay?"关闭延时主题":"查看延时主题"),1)]),_:1},8,["type"]),s(ze,{page:x.value,"onUpdate:page":[r[4]||(r[4]=l=>x.value=l),ae],"last-page":e(D)?1:e(T).threads_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),Ee,(d(),_(we,{to:"#topbar-nav"},[s(L,{to:"/",class:"flex-item-center"},{default:o(()=>[s(e(Ie),{style:Se({maxWidth:e(n).isMobile?"120px":"900px"}),tooltip:!1},{default:o(()=>{var l;return[u(N((l=e(h).forumData(a.forumId))==null?void 0:l.name),1)]}),_:1},8,["style"]),s(e(Ce),{round:"",class:"forum-tag",size:e(n).isMobile?"small":"medium"},{default:o(()=>[u(N(a.forumId),1)]),_:1},8,["size"])]),_:1})])),s(Oe,{mode:"forum",ref_key:"SidebarCom",ref:Q,onRefresh:r[5]||(r[5]=l=>q(!0)),onNewThread:r[6]||(r[6]=l=>a.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},null,512)]),_:1})}}}),aa=Ne(We,[["__scopeId","data-v-7de40444"]]);export{aa as default};
