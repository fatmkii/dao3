import{a1 as se,al as oe,n as le,U as ue,X as ne,t as d,l as b,u as $,am as ie,an as de,ao as pe,T as me,p as k,j as i,x as o,i as w,K as I,E as s,J as fe,q as e,ai as ce,aj as ge,Q as ve,w as he,I as m,a4 as B,L as u,N as ye,ap as be,O as ke,P as F,aq as we,ar as Ie,ak as _e,m as f,as as Se}from"./vendor-TKhEiLHF.js";import{u as Ce,t as W}from"./forums-g7lMW6w-.js";import{s as O}from"./subtitles-DW7M559j.js";import{s as Te}from"./shuffle-Bl2z5mvo.js";import{u as G,a as xe,b as p,c as De,d as U,_ as Le}from"./app-DyjO_oyN.js";import{_ as Ne}from"./loudspeaker-CdG28IO6.js";import{L as $e,S as Fe}from"./LoudspeakerComponent-ZQh2wrCs.js";import{T as Oe}from"./ThreadList-CFWlYtoH.js";import"./showDialog-DAOem-pu.js";import"./browseLogger-CL0k0N9N.js";function Ue(){const g=G();se(()=>{g.showTopbarNav=!1}),oe(()=>{g.showTopbarNav=!0})}const Pe={key:0,class:"carousel-box"},Me={key:0,class:"carousel-box"},qe=["src"],ze=le({__name:"ForumPage",props:{forumId:{},page:{},search:{},delay:{type:Boolean}},setup(g){var A,R;ue(t=>({"366ac772":e(n).bannerHeight}));const _=xe(),n=G(),c=Ce(),v=ne(),K=d(null);d();const P=d();Ue();const r=g,H=b(()=>{var t;return Te((t=c.forumData(r.forumId))==null?void 0:t.banners).slice(0,5)});document.title=(R=(A=c.forumData(r.forumId))==null?void 0:A.name)!=null?R:"小火锅";const S=$("banner_hiden",!1),C=$("new_window_to_post",!1);function J(){return f(m,{style:"padding:6px 8px",vertical:!0},()=>[f(U,{checked:S.value,"onUpdate:checked":t=>S.value=t,label:"隐藏版头"}),f(U,{checked:C.value,"onUpdate:checked":t=>C.value=t,label:"新窗口打开"})])}const Q=[{type:"group",key:"header",label:"功能"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:J}],T=$("subtitles_included",O),M=b(()=>O.filter(t=>!T.value.includes(t)));function X(){return f(Se,{value:T.value,"onUpdate:value":t=>T.value=t},()=>[f(m,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(O).map(t=>f(U,{value:t,label:t}))])])}const V=[{type:"group",key:"header",label:"筛选"},{key:"header-divider",type:"divider"},{key:"filterOptions",type:"render",render:X}],h=d(r.search),y=d(!!r.search);function q(){v.push({name:"forum",params:{forumId:r.forumId,page:1},query:{search:h.value||void 0}})}function Y(){h.value=void 0,y.value=!1,v.push({name:"forum",params:{forumId:r.forumId,page:1}})}function Z(){v.push({name:"forum",params:{forumId:r.forumId,page:1},query:{delay:r.delay?void 0:"true"}})}const x=d(r.page);function ee(t){v.push({name:"forum",params:{forumId:r.forumId,page:t},query:{search:r.search,delay:r.delay?"true":void 0}})}ie(()=>r.page,t=>x.value=t);const z=b(()=>({forumId:r.forumId,binggan:_.binggan,page:r.page,threadsPerPage:50,subtitlesExcluded:M.value,searchTitle:r.search,delay:r.delay})),{loading:D,data:L,onSuccess:Ee}=de(()=>W(z.value),[()=>r.forumId,()=>r.page,()=>r.search,()=>r.delay,M],{initialData:[],immediate:!0}),E=d(!1),{onSuccess:ae,fetch:te}=pe();function j(t=!1){var a;E.value=t,te(W(z.value)),(a=P.value)==null||a.reloadBrowseLogger()}ae(()=>{E.value&&!n.userCustom.lessToast&&window.$message.success("已刷新数据")});const re=b(()=>{if(D.value)return[];if(_.userData.binggan.use_pingbici){const t=n.userCustom.pingbiciIngnoreCase?"gi":"g";return L.value.threads_data.data.filter(a=>{for(let N of _.userData.pingbici.title_pingbici)if(new RegExp(N,t).test(a.title))return!1;return!0})}else return L.value.threads_data.data});return(t,a)=>{const N=me("router-link");return i(),k(e(m),{vertical:""},{default:o(()=>[e(S)?I("",!0):(i(),w("div",Pe,[e(c).forumsDataLoading?(i(),w("div",Me,[s(e(ce),{class:"carousel-skeleton",sharp:""})])):I("",!0),e(c).forumsDataLoading?I("",!0):(i(),k(e(ge),{key:1,"show-arrow":"",trigger:e(n).isMobile?"click":"hover",autoplay:"",interval:1e4},{default:o(()=>[(i(!0),w(ve,null,he(H.value,l=>(i(),w("img",{src:l,class:"carousel-img"},null,8,qe))),256))]),_:1},8,["trigger"]))])),s(e(m),{style:{"margin-top":"8px"},size:"small"},{default:o(()=>[s(e(B),{trigger:e(n).isMobile?"click":"hover",options:Q,placement:"bottom-start"},{default:o(()=>[s(e(p),null,{default:o(()=>[...a[7]||(a[7]=[u("功能",-1)])]),_:1})]),_:1},8,["trigger"]),s(e(B),{trigger:e(n).isMobile?"click":"hover",options:V,placement:"bottom-start"},{default:o(()=>[s(e(p),null,{default:o(()=>[...a[8]||(a[8]=[u("筛选",-1)])]),_:1})]),_:1},8,["trigger"]),s(e(ye),{size:e(n).isMobile?28:34},{default:o(()=>[s(e(be),{style:{cursor:"pointer"},onClick:a[0]||(a[0]=l=>y.value=!y.value)})]),_:1},8,["size"]),s(e(p),{type:"primary",style:{"margin-left":"auto"},onClick:a[1]||(a[1]=l=>t.$router.push({name:"loudspeaker"}))},{default:o(()=>[...a[9]||(a[9]=[u("大喇叭",-1)])]),_:1}),s(e(p),{type:"primary",onClick:a[2]||(a[2]=l=>t.$router.push({name:"new-thread",params:{forumId:r.forumId}}))},{default:o(()=>[...a[10]||(a[10]=[u("新主题",-1)])]),_:1})]),_:1}),y.value?(i(),k(e(m),{key:1,wrap:!1},{default:o(()=>[s(e(De),{value:h.value,"onUpdate:value":a[3]||(a[3]=l=>h.value=l),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索标题","auto-size":"",onKeyup:ke(q,["enter"])},null,8,["value"]),s(e(p),{type:"primary",onClick:q},{default:o(()=>[...a[11]||(a[11]=[u("搜索",-1)])]),_:1}),s(e(p),{type:"default",onClick:Y},{default:o(()=>[...a[12]||(a[12]=[u("清空",-1)])]),_:1})]),_:1})):I("",!0),s($e),s(Oe,{ref_key:"ThreadListCom",ref:P,"threads-list-data":re.value,"new-window-to-post":e(C),"show-this":!e(D),onWithdrawDelayThreadSuccess:j},null,8,["threads-list-data","new-window-to-post","show-this"]),s(e(m),{align:"center"},{default:o(()=>[s(e(p),{type:r.delay?"default":"primary",onClick:Z},{default:o(()=>[u(F(r.delay?"关闭延时主题":"查看延时主题"),1)]),_:1},8,["type"]),s(Ne,{page:x.value,"onUpdate:page":[a[4]||(a[4]=l=>x.value=l),ee],"last-page":e(D)?1:e(L).threads_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),a[13]||(a[13]=fe("div",{style:{height:"50px"}},null,-1)),(i(),k(we,{to:"#topbar-nav"},[s(N,{to:"/",class:"flex-item-center"},{default:o(()=>[s(e(Ie),{tooltip:!1},{default:o(()=>{var l;return[u(F((l=e(c).forumData(t.forumId))==null?void 0:l.name),1)]}),_:1}),s(e(_e),{round:"",class:"forum-tag",size:e(n).isMobile?"small":"medium"},{default:o(()=>[u(F(t.forumId),1)]),_:1},8,["size"])]),_:1})])),s(Fe,{mode:"forum",ref_key:"SidebarCom",ref:K,onRefresh:a[5]||(a[5]=l=>j(!0)),onNewThread:a[6]||(a[6]=l=>t.$router.push({name:"new-thread",params:{forumId:r.forumId}}))},null,512)]),_:1})}}}),Xe=Le(ze,[["__scopeId","data-v-e58df8a9"]]);export{Xe as default};
