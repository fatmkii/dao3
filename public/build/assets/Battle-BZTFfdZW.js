import{w as E,n as P,b as U,g as q,u as V,d as f,$ as W,c as w,bQ as D,r as J,A as o,M as n,f as s,H as u,a as t,k as d,F as K,C as M,Q as X,B as N,j as Y,h as Z,z as c,s as g,G as m,v as tt,i as et,_ as at}from"./app-Da7oLsYJ.js";import{c as R,d as $,e as st}from"./PostInput.vue_vue_type_script_setup_true_lang-JxMNEBUG.js";import{u as lt}from"./forums-DsNq_JUg.js";import{_ as rt}from"./FInputGroupLabel.vue_vue_type_script_setup_true_lang-BxnBQYdF.js";import{N as ot}from"./Spin-BUKmjrh7.js";import{N as h}from"./Tag-BnrtdMBU.js";import{N as nt}from"./InputGroup-C0EEYLl8.js";import{N as it}from"./Select-u4gn01MJ.js";import"./showDialog-O5Oh67OX.js";import"./randomHeads-BQiS7tyh.js";import"./FInput.vue_vue_type_script_setup_true_lang-Bv4PsbcU.js";import"./Input-BcRzcrax.js";import"./use-locale-D1qzf9M6.js";import"./InputNumber-BbKoRU-Z.js";import"./Add-B7duuN3l.js";import"./index-Crq6HWd9.js";import"./_commonjsHelpers-BosuxZz1.js";import"./inputNumberFormat-DaYmlx6U.js";import"./Grid-C79_jOOC.js";import"./ColorPicker-C_NassY-.js";import"./_createCompounder-BkiSbKIq.js";import"./Ellipsis-DDTNcUuY.js";import"./download-sglA049O.js";import"./emojiData-nGA-8XBz.js";import"./Tabs-BX_nhzuh.js";import"./Divider-BK0016qm.js";const ut=["src"],ct=E({__name:"Battle",props:{battleId:{}},setup(j,{expose:k}){const y=P(),C=U();lt(),q(),V();const p=j,v=[{"flex-direction":"row","justify-content":"center"},{"flex-direction":"row","justify-content":"start"},{"flex-direction":"row-reverse","justify-content":"end"}],F=f(()=>{const e=R[l.value.battle.chara_group];if(l.value.battle.chara_group===0){const r=y.userData.my_battle_chara.filter(a=>!a.not_use).map((a,b)=>({value:b+240,label:a.name}));return e.concat(r)}else return e}),x=f(()=>l.value.battle.is_your_battle||l.value.battle.you_are_challenger),I=f(()=>{const e=l.value.battle;if(!x.value)return"";const r=e.result===1&&e.is_your_battle===!0||e.result===2&&e.you_are_challenger===!0||e.result===3,a=C.isDouble11?1.98:1.96,b=Math.floor(r?e.battle_olo*a:e.battle_olo).toLocaleString("en-us");return`你${r?"赢得":"输掉"}了${b}个奥利奥`}),i=W(8),{data:l,loading:G,onSuccess:z}=w($(p.battleId));z(e=>{e.data.battle.progress===0&&D(`battleDataGetter-${e.data.battle.id}`),e.data.battle.chara_group>0&&(i.value=R[e.data.battle.chara_group][0].value)});const{fetch:B,fetching:T,onSuccess:H}=J();function _(){B($(p.battleId))}H(e=>{e.data.battle.progress===0&&D(`battleDataGetter-${e.data.battle.id}`)}),k({refreshBattleDataHandle:_});const{loading:S,onSuccess:L,onError:O,send:A}=w(e=>st(e),{immediate:!1});L(()=>{_()}),O(()=>{_()});function Q(){const e={title:"加入战斗！",closable:!1,content:`将押注：${l.value.battle.battle_olo.toLocaleString("en-us")}个奥利奥`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{const r={binggan:y.binggan,battle_id:p.battleId,chara_id:i.value>=240?i.value-240:i.value,is_custom_chara:i.value>=240};A(r)}};window.$dialog.warning(e)}return(e,r)=>(o(),n(t(et),{size:"small",bordered:!0,embedded:"",class:"battle-card"},{default:s(()=>[u(t(ot),{show:t(G)||t(T)},{default:s(()=>[t(l)!==void 0?(o(),n(t(d),{key:0,vertical:"",size:"small"},{default:s(()=>[(o(!0),K(M,null,X(t(l).battle_messages,a=>(o(),n(t(d),{align:"center",wrap:!1,style:N(v[a.message_type])},{default:s(()=>[Y("img",{class:"emoji-img",src:a.chara_url},null,8,ut),a.message_type!==0?(o(),n(t(Z),{key:0},{default:s(()=>[c(g(a.message),1)]),_:2},1024)):(o(),n(t(h),{key:1,round:""},{default:s(()=>[c(g(a.message),1)]),_:2},1024))]),_:2},1032,["style"]))),256)),u(t(d),{style:N(v[0])},{default:s(()=>[t(l).battle.progress===0?(o(),n(t(h),{key:0,round:""},{default:s(()=>[c("正在等待挑战者")]),_:1})):m("",!0),t(l).battle.progress===2&&x.value?(o(),n(t(h),{key:1,round:""},{default:s(()=>[c(g(I.value),1)]),_:1})):m("",!0)]),_:1},8,["style"]),t(l).battle.progress===0&&t(l).battle.is_your_battle===!1?(o(),n(t(d),{key:0,size:"small",wrap:!1,align:"center",justify:"center",style:{"margin-top":"6px"}},{default:s(()=>[u(t(nt),{style:{"max-width":"15.2rem"}},{default:s(()=>[u(t(rt),{style:{width:"3.2rem"}},{default:s(()=>[c("角色")]),_:1}),u(t(it),{value:i.value,"onUpdate:value":r[0]||(r[0]=a=>i.value=a),options:F.value},null,8,["value","options"])]),_:1}),u(t(tt),{type:"primary",onClick:Q,disabled:t(S),loading:t(S)},{default:s(()=>[c("挑战")]),_:1},8,["disabled","loading"])]),_:1})):m("",!0)]),_:1})):m("",!0)]),_:1},8,["show"])]),_:1}))}}),Lt=at(ct,[["__scopeId","data-v-a4b1df18"]]);export{Lt as default};
