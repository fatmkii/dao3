import{ak as K,bq as D,Y as J,w as F,L as X,d as N,aS as Z,a7 as O,al as G,a8 as ee,S as te,b as V,o as W,$ as _,c as j,A as k,M as C,f as a,H as t,a as e,k as T,n as E,z as m,ac as ae,ad as oe,G as H,m as P,i as B,aq as le,j as M,u as re,l as se,av as ne,h as I,F as ie,Q as de,C as ue,aA as me,s as U,N as fe,R as ce,O as pe,_ as ve}from"./app-CFOHxrPW.js";import{g as ge}from"./admin-BwFUjGfP.js";import{n as ye}from"./globalSetting-EEbD7f46.js";import{n as be,l as he,_ as ke,r as _e}from"./loudspeaker-BDTaErux.js";import{d as Y}from"./dayjs.min-BIwLhz4I.js";import{_ as A}from"./FInput.vue_vue_type_script_setup_true_lang-Dqu80n8T.js";import{N as xe,a as $}from"./FormItem-B3CJvQ0Z.js";import{N as Q}from"./DatePicker-D9r5X-z5.js";import{N as we}from"./InputNumber-BSnx7S7w.js";import{N as q}from"./Switch-LudVpBA1.js";import{N as Se}from"./ColorPicker-C2YgypnU.js";import{u as Ce}from"./use-houdini-bqF2_DTG.js";import{a as ze}from"./Select-B_fx2u36.js";import{D as Ne}from"./Delete-Cn6BPI5W.js";import"./Pagination-B01r0OVT.js";import"./use-locale-s9WFjRt5.js";import"./prop-DfVitj0l.js";import"./Input-UucsUpb9.js";import"./Forward-BzudI9WJ.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Add-287cP3mI.js";import"./InputGroup-DLhoRCKT.js";import"./Tag-DxmmApj7.js";const Le=i=>{const{primaryColor:d,successColor:c,warningColor:f,errorColor:h,infoColor:p,fontWeightStrong:l}=i;return{fontWeight:l,rotate:"252deg",colorStartPrimary:D(d,{alpha:.6}),colorEndPrimary:d,colorStartInfo:D(p,{alpha:.6}),colorEndInfo:p,colorStartWarning:D(f,{alpha:.6}),colorEndWarning:f,colorStartError:D(h,{alpha:.6}),colorEndError:h,colorStartSuccess:D(c,{alpha:.6}),colorEndSuccess:c}},Ie={name:"GradientText",common:K,self:Le},$e=Ie,Me=J("gradient-text",`
 display: inline-block;
 font-weight: var(--n-font-weight);
 -webkit-background-clip: text;
 background-clip: text;
 color: #0000;
 white-space: nowrap;
 background-image: linear-gradient(var(--n-rotate), var(--n-color-start) 0%, var(--n-color-end) 100%);
 transition:
 --n-color-start .3s var(--n-bezier),
 --n-color-end .3s var(--n-bezier);
`),De=Object.assign(Object.assign({},O.props),{size:[String,Number],fontSize:[String,Number],type:{type:String,default:"primary"},color:[Object,String],gradient:[Object,String]}),Te=F({name:"GradientText",props:De,setup(i){Ce();const{mergedClsPrefixRef:d,inlineThemeDisabled:c}=X(i),f=N(()=>{const{type:o}=i;return o==="danger"?"error":o}),h=N(()=>{let o=i.size||i.fontSize;return o&&(o=Z(o)),o||void 0}),p=N(()=>{const o=i.color||i.gradient;if(typeof o=="string")return o;if(o){const y=o.deg||0,L=o.from,x=o.to;return`linear-gradient(${y}deg, ${L} 0%, ${x} 100%)`}}),l=O("GradientText","-gradient-text",Me,$e,i,d),v=N(()=>{const{value:o}=f,{common:{cubicBezierEaseInOut:y},self:{rotate:L,[G("colorStart",o)]:x,[G("colorEnd",o)]:w,fontWeight:z}}=l.value;return{"--n-bezier":y,"--n-rotate":L,"--n-color-start":x,"--n-color-end":w,"--n-font-weight":z}}),g=c?ee("gradient-text",N(()=>f.value[0]),v,i):void 0;return{mergedClsPrefix:d,compatibleType:f,styleFontSize:h,styleBgImage:p,cssVars:c?void 0:v,themeClass:g==null?void 0:g.themeClass,onRender:g==null?void 0:g.onRender}},render(){const{mergedClsPrefix:i,onRender:d}=this;return d==null||d(),te("span",{class:[`${i}-gradient-text`,`${i}-gradient-text--${this.compatibleType}-type`,this.themeClass],style:[{fontSize:this.styleFontSize,backgroundImage:this.styleBgImage},this.cssVars]},this.$slots)}}),Re=M("div",null,[m(" 价格暂定为5000个olo（每天）"),M("br"),m(" 禁止发布辱骂、诅咒、黑锦鲤等方面情绪。 ")],-1),Pe=F({__name:"NewLoudspeakerModal",emits:["refreshLoudspeaker"],setup(i,{expose:d,emit:c}){const f=V(),h=W(),p=_(null),l=_({subId:"1",content:void 0,color:void 0,threadId:void 0,days:1,effectiveDate:Y().format("YYYY-MM-DD 00:00:00")}),v=_(!1),g={effectiveDate:{required:!0,message:"请选择生效日期和时间"},days:{required:!0,message:"请填写生效天数",type:"number"},content:{required:!0,message:"请填写内容"},color:{required:!1},threadId:{required:!1},subId:{required:!1}},o=_(!1);function y(){o.value=!0}d({show:y});const L=c,{loading:x,send:w}=j(S=>be(S),{immediate:!1});function z(){var S;(S=p.value)==null||S.validate(r=>{if(r)window.$message.error("请确认信息填写完整");else{const s={binggan:h.binggan,sub_id:l.value.subId,content:l.value.content,color:v?l.value.color:void 0,thread_id:l.value.threadId,effective_date:l.value.effectiveDate,days:l.value.days};w(s).then(()=>{L("refreshLoudspeaker"),o.value=!1})}})}return(S,r)=>(k(),C(e(le),{show:o.value,"onUpdate:show":r[9]||(r[9]=s=>o.value=s),"display-directive":"if"},{default:a(()=>[t(e(B),{style:P({maxWidth:e(f).modalMaxWidth}),title:"发布大喇叭",closable:"",onClose:r[8]||(r[8]=s=>o.value=!1),size:"small"},{action:a(()=>[t(e(T),{justify:"end"},{default:a(()=>[t(e(E),{type:"primary",disable:e(x),loading:e(x),onClick:z},{default:a(()=>[m("发布")]),_:1},8,["disable","loading"]),t(e(E),{onClick:r[7]||(r[7]=s=>o.value=!1)},{default:a(()=>[m("关闭")]),_:1})]),_:1})]),default:a(()=>[Re,t(e(xe),{ref_key:"formRef",ref:p,model:l.value,"label-placement":"left","label-width":"auto",rules:g,size:e(f).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:a(()=>[t(e($),{label:"生效日期",path:"effectiveDate"},{default:a(()=>[t(e(Q),{"formatted-value":l.value.effectiveDate,"onUpdate:formattedValue":r[0]||(r[0]=s=>l.value.effectiveDate=s),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",size:e(f).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),t(e($),{label:"生效天数",path:"days"},{default:a(()=>[t(e(we),{value:l.value.days,"onUpdate:value":r[1]||(r[1]=s=>l.value.days=s),max:3,min:1,step:1,placeholder:"1-3天"},null,8,["value"])]),_:1}),t(e($),{label:"内容",path:"content"},{default:a(()=>[t(e(A),{placeholder:"最多100字",type:"textarea",maxlength:"100","show-count":"",autosize:{minRows:3,maxRows:5},value:l.value.content,"onUpdate:value":r[2]||(r[2]=s=>l.value.content=s)},null,8,["value"])]),_:1}),t(e($),{label:"设定颜色",path:"color"},{default:a(()=>[t(e(q),{value:v.value,"onUpdate:value":r[3]||(r[3]=s=>v.value=s)},null,8,["value"]),ae(t(e(Se),{value:l.value.color,"onUpdate:value":r[4]||(r[4]=s=>l.value.color=s),modes:["hex"],"show-alpha":!1,style:{"max-width":"7rem","margin-left":"12px"}},null,8,["value"]),[[oe,v.value]])]),_:1}),t(e($),{label:"链接主题",path:"threadId"},{default:a(()=>[t(e(A),{value:l.value.threadId,"onUpdate:value":r[5]||(r[5]=s=>l.value.threadId=s),placeholder:"主题网址的ID（可留空）"},null,8,["value"])]),_:1}),e(h).admin.isSuperAdmin?(k(),C(e($),{key:0,label:"设为置顶",path:"subId"},{default:a(()=>[t(e(q),{"onUpdate:value":r[6]||(r[6]=s=>l.value.subId=s),"checked-value":10,"unchecked-value":"1"})]),_:1})):H("",!0)]),_:1},8,["model","size"])]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ee=i=>(ce("data-v-cb8cecc1"),i=i(),pe(),i),Ue=Ee(()=>M("div",{style:{"margin-left":"auto"}},null,-1)),je=F({__name:"LoudspeakerPage",setup(i){se(b=>({ebbe7e80:e(h).textColor1}));const d=W(),c=V(),f=_(),h=re();document.title="大喇叭";const p=_(),l=_(!1),v=_(1),g=_(30),o=N(()=>(v.value-1)*g.value),y={binggan:d.binggan,mode:"all"},{loading:L,data:x,send:w}=j(b=>he(b),{immediate:!1,initialData:[]});w(y);const z=N(()=>x.value.filter(b=>!(l.value&&!b.is_your_loudspeaker||p.value&&!Y(p.value).isSame(b.effective_date,"day")))),{data:S}=j(ye);function r(b){const u={title:"强制删除大喇叭",closable:!1,content:"要强制删除这个大喇叭吗？这是管理员功能。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{ge({binggan:d.binggan,loudspeaker_id:b}).then(()=>w(y))}};window.$dialog.warning(u)}function s(b){const u={title:"撤回大喇叭",closable:!1,content:"要撤回这个大喇叭吗？花费的奥利奥不会退回喔",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{_e({binggan:d.binggan,loudspeaker_id:b}).then(()=>w(y))}};window.$dialog.warning(u)}return(b,u)=>(k(),C(e(T),{vertical:"",style:{"margin-top":"8px"}},{default:a(()=>[t(e(T),{size:"small",align:"center"},{default:a(()=>[M("img",{style:P({height:e(c).isMobile?"48px":"64px"}),src:"https://ll4484.bvimg.com/21501/47292a78bd68f016.png"},null,4),t(e(Te),{style:P({fontSize:e(c).isMobile?"16px":"20px"}),gradient:{from:"#7fcab9",to:"#99b1c5"}},{default:a(()=>[m(" 爱乃是盲目～🎵 ")]),_:1},8,["style"]),t(e(ne),{placement:"bottom",trigger:"hover",disabled:e(S)},{trigger:a(()=>[t(e(E),{type:"primary",disabled:!e(S),onClick:u[0]||(u[0]=n=>{var R;return(R=f.value)==null?void 0:R.show()}),style:{"margin-left":"auto"}},{default:a(()=>[m("发布大喇叭")]),_:1},8,["disabled"])]),default:a(()=>[t(e(I),null,{default:a(()=>[m("嗷！目前暂停发布大喇叭…… ")]),_:1})]),_:1},8,["disabled"])]),_:1}),t(e(T),{size:"small",justify:"end",align:"center"},{default:a(()=>[t(e(I),null,{default:a(()=>[m("只看自己")]),_:1}),t(e(q),{value:l.value,"onUpdate:value":u[1]||(u[1]=n=>l.value=n)},null,8,["value"]),t(e(Q),{"formatted-value":p.value,"onUpdate:formattedValue":u[2]||(u[2]=n=>p.value=n),"value-format":"yyyy-MM-dd",type:"date",clearable:"",placeholder:"筛选生效日期",size:e(c).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),t(ke,{page:v.value,"onUpdate:page":[u[3]||(u[3]=n=>v.value=n),u[4]||(u[4]=n=>v.value=n)],"last-page":Math.floor(z.value.length/g.value),style:{"margin-right":"auto"}},null,8,["page","last-page"]),z.value.length>0?(k(!0),ie(ue,{key:0},de(z.value.slice(o.value,o.value+g.value),n=>(k(),C(e(B),{key:n.id,size:"small",bordered:!0,class:"loudspeaker-card"},{default:a(()=>[(k(),C(me(n.thread_id?"router-link":"span"),{style:P({color:n.color}),to:n.thread_id!==null?`/thread/${n.thread_id}/1`:void 0},{default:a(()=>[m(U(n.content),1)]),_:2},1032,["style","to"])),t(e(T),{size:"small"},{default:a(()=>[M("span",null,[t(e(I),{depth:3},{default:a(()=>[m("生效：")]),_:1}),t(e(I),null,{default:a(()=>[m(U(n.effective_date),1)]),_:2},1024)]),M("span",null,[t(e(I),{depth:3},{default:a(()=>[m("到期：")]),_:1}),t(e(I),null,{default:a(()=>[m(U(n.expire_date),1)]),_:2},1024)]),Ue,n.is_your_loudspeaker?(k(),C(e(fe),{key:0,size:e(c).isMobile?20:24,style:{cursor:"pointer"},onClick:R=>s(n.id)},{default:a(()=>[t(e(Ne))]),_:2},1032,["size","onClick"])):H("",!0),e(d).admin.isNormalAdmin?(k(),C(e(E),{key:1,size:"tiny",type:"warning",onClick:R=>r(n.id)},{default:a(()=>[m("强制删除")]),_:2},1032,["onClick"])):H("",!0)]),_:2},1024)]),_:2},1024))),128)):(k(),C(e(ze),{key:1})),t(Pe,{ref_key:"NewLoudspeakerModalCom",ref:f,onRefreshLoudspeaker:u[5]||(u[5]=n=>e(w)(y))},null,512)]),_:1}))}}),it=ve(je,[["__scopeId","data-v-cb8cecc1"]]);export{it as default};
