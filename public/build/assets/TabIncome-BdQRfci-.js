import{w as q,l as A,a as e,o as P,b as Q,aO as B,g as E,u as Z,$ as h,q as J,e as K,d as b,c as x,c9 as W,ca as X,A as o,M as p,f as a,H as l,n as T,z as n,i as w,bz as ee,G as k,F as _,C as I,k as m,Q as te,j as z,h as r,s as f,cb as C,v as ae,S as le,_ as se}from"./app-Wa4snSXg.js";import{u as ie}from"./forums-pPOgYbJt.js";import{d as D}from"./dayjs.min-BIwLhz4I.js";import{a as ne}from"./Select-BmXC1wuX.js";import{N as oe}from"./DatePicker-B3_Ieh3m.js";import{N as re}from"./DataTable-C1BgONCp.js";import{N as ue}from"./Pagination-BkC3lwj0.js";import"./_commonjsHelpers-BosuxZz1.js";import"./use-locale-B56d6MS2.js";import"./Tag-BnIb2J0i.js";import"./Input-B0c9eymO.js";import"./Ellipsis-COTKgZw2.js";import"./download-sglA049O.js";import"./prop-DfVitj0l.js";const de={class:"income-item"},me={style:{"margin-left":"auto"}},fe={key:0,style:{"margin-top":"6px"}},g=30,ce=q({__name:"TabIncome",setup(pe){A(t=>({20183840:e($).dividerColor})),P();const y=Q();ie(),B(),E();const $=Z(),d=h(D().format("YYYY-MM-DD"));J(d,()=>c("day")),K(()=>c("day"));const j=h({pageSize:g}),F=[{title:"时间",key:"created_at",resizable:!0},{title:"收支",key:"olo",resizable:!0},{title:"内容",key:"content",resizable:!0},{title:"主题",key:"thread",render:V,ellipsis:!0,resizable:!0}],L=b(()=>Y.value?[{label:"加载中...",key:"loading"}]:[{label:"当月统计："+M.value.sum_month,key:"monthSum"},{label:"全年统计："+M.value.sum_year,key:"yearSum"}]);function G(t){return D().isBefore(t)}const v=h(1),S=b(()=>(v.value-1)*g),{loading:H,data:u,send:R}=x(t=>W(t),{immediate:!1,initialData:[]}),{loading:Y,data:M,send:O}=x(t=>X(t),{immediate:!1,initialData:{sum_year:0,sum_month:0}}),U=b(()=>u.value.map(t=>t.olo).reduce((t,s)=>t+s,0));function c(t){if(d.value===null)window.$message.error("需要选择日期");else{const s={income_date:d.value};t==="day"&&R(s),t==="sum"&&O(s)}}function N(t){return{name:"thread",params:{threadId:t.thread_id,page:t.floor===null?1:Math.ceil((t.floor+1)/200)},hash:t.floor===null?void 0:"#f_"+t.floor}}function V(t,s){return t.thread_id!==null?le(C,{to:N(t),target:"_blank",innerHTML:t.thread_title}):""}return(t,s)=>(o(),p(e(m),{size:"small"},{default:a(()=>[l(e(oe),{"formatted-value":d.value,"onUpdate:formattedValue":s[0]||(s[0]=i=>d.value=i),"value-format":"yyyy-MM-dd",type:"date",size:e(y).isMobile?"small":"medium","is-date-disabled":G},null,8,["formatted-value","size"]),l(e(T),{type:"primary",onClick:s[1]||(s[1]=i=>c("day"))},{default:a(()=>[n(" 查询 ")]),_:1}),l(e(w),{title:"收支记录",size:"small"},ee({default:a(()=>[e(y).isMobile?k("",!0):(o(),p(e(re),{key:0,columns:F,data:e(u),pagination:j.value,bordered:!1,loading:e(H)},null,8,["data","pagination","loading"])),e(y).isMobile?(o(),_(I,{key:1},[e(u).length>0?(o(),p(e(m),{key:0,vertical:"",align:"start",size:"small"},{default:a(()=>[(o(!0),_(I,null,te(e(u).slice(S.value,S.value+g),i=>(o(),_("div",de,[l(e(m),null,{default:a(()=>[z("div",null,[l(e(r),{depth:3},{default:a(()=>[n("时间：")]),_:1}),l(e(r),null,{default:a(()=>[n(f(i.created_at),1)]),_:2},1024)]),z("div",me,[l(e(r),{depth:3},{default:a(()=>[n("收支：")]),_:1}),l(e(r),null,{default:a(()=>[n(f(i.olo),1)]),_:2},1024)])]),_:2},1024),l(e(m),{style:{"margin-top":"6px"}},{default:a(()=>[z("div",null,[l(e(r),{depth:3},{default:a(()=>[n("内容：")]),_:1}),l(e(r),null,{default:a(()=>[n(f(i.content),1)]),_:2},1024)])]),_:2},1024),i.thread_id!==null?(o(),_("div",fe,[l(e(r),{depth:3},{default:a(()=>[n("主题：")]),_:1}),l(e(C),{to:N(i)},{default:a(()=>[n(f(i.thread_title),1)]),_:2},1032,["to"])])):k("",!0)]))),256)),l(e(ue),{page:v.value,"onUpdate:page":s[3]||(s[3]=i=>v.value=i),"item-count":e(u).length,"page-size":g,size:"small",style:{"margin-left":"auto"}},null,8,["page","item-count"])]),_:1})):(o(),p(e(ne),{key:1}))],64)):k("",!0)]),_:2},[e(u).length>0?{name:"header-extra",fn:a(()=>[l(e(m),{size:"small",align:"center"},{default:a(()=>[n(" 当日小计："+f(U.value)+" ",1),l(e(ae),{trigger:"click",placement:"bottom-end",options:L.value},{default:a(()=>[l(e(T),{size:"small",onClick:s[2]||(s[2]=i=>c("sum"))},{default:a(()=>[n("月年总计")]),_:1})]),_:1},8,["options"])]),_:1})]),key:"0"}:void 0]),1024)]),_:1}))}}),Ce=se(ce,[["__scopeId","data-v-3edf97d9"]]);export{Ce as default};
