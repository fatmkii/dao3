import{w as P,A as i,F as m,j as p,o as H,b6 as I,l as ee,a as e,b as te,u as ae,$ as D,d as w,au as T,c as L,M as x,f as a,H as o,k as f,N as le,s as _,C as M,Q as A,z as d,G as c,h as g,n as F,v as oe,i as se,_ as ne}from"./app-D3KRLCX5.js";import{d as z}from"./dayjs.min-BIwLhz4I.js";import{R as ie}from"./CloseCircleOutline-BdFgeVxL.js";import{N as re,a as ue,b as de}from"./DataTable-C-apa2u4.js";import{N as me}from"./Spin-vVqxMhX3.js";import{N as ce}from"./randomHeads-BMKfwlWl.js";import{N as pe}from"./InputNumber-6ilP31aU.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Input-BjjOkiuC.js";import"./use-locale-Dw65RudZ.js";import"./Ellipsis-C5FdZerz.js";import"./Select-bMolnIVN.js";import"./Tag-B9uplHib.js";import"./Pagination-Cbnf7tZK.js";import"./prop-DfVitj0l.js";import"./Forward-CBif0EGx.js";import"./download-sglA049O.js";import"./showDialog-Cp-JDqzM.js";import"./FInput.vue_vue_type_script_setup_true_lang-C_4Y_-rN.js";import"./FInputGroupLabel.vue_vue_type_script_setup_true_lang-BRd1kDFJ.js";import"./InputGroup-1qQquVyw.js";import"./index-Crq6HWd9.js";import"./inputNumberFormat-DaYmlx6U.js";import"./Grid-DPUYPpg-.js";import"./ColorPicker-4Oph4eMj.js";import"./Add-Clu1FtrT.js";import"./_createCompounder-CQAZBpau.js";import"./emojiData-nGA-8XBz.js";import"./Tabs-tBrMkQkY.js";const _e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},ge=p("path",{d:"M528.1 171.5L382 150.2L316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2L47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103l-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5l105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3l23.7-138.4l-100.6-98l139-20.2l62.2-126l62.2 126l139 20.2l-100.6 98z",fill:"currentColor"},null,-1),be=[ge],ve=P({name:"StarRegular",render:function(n,b){return i(),m("svg",_e,be)}}),fe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},he=p("path",{d:"M48 366.92L240 480V284L48 170zM192 288c8.84 0 16 10.75 16 24s-7.16 24-16 24s-16-10.75-16-24s7.16-24 16-24zm-96 32c8.84 0 16 10.75 16 24s-7.16 24-16 24s-16-10.75-16-24s7.16-24 16-24z",fill:"currentColor"},null,-1),we=p("path",{d:"M272 284v196l192-113.08V170zm48 140c-8.84 0-16-10.75-16-24s7.16-24 16-24s16 10.75 16 24s-7.16 24-16 24zm0-88c-8.84 0-16-10.75-16-24s7.16-24 16-24s16 10.75 16 24s-7.16 24-16 24zm96 32c-8.84 0-16-10.75-16-24s7.16-24 16-24s16 10.75 16 24s-7.16 24-16 24zm0-88c-8.84 0-16-10.75-16-24s7.16-24 16-24s16 10.75 16 24s-7.16 24-16 24zm32 77.64z",fill:"currentColor"},null,-1),xe=p("path",{d:"M256 32L64 144l192 112l192-112zm0 120c-13.25 0-24-7.16-24-16s10.75-16 24-16s24 7.16 24 16s-10.75 16-24 16z",fill:"currentColor"},null,-1),ke=[he,we,xe],ze=P({name:"DiceSharp",render:function(n,b){return i(),m("svg",fe,ke)}}),ye=H(),$e=u=>{const n=I.Get("api/gambles/"+u,{name:"gambleDataGetter-"+u,params:{binggan:ye.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},Ce=u=>{const n=I.Post("api/gambles/",u,{name:"userGamblePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Ge=u=>{const n=I.Post("api/gambles/close",u,{name:"adminGambleClosePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Se=u=>{const n=I.Post("api/gambles/repeal",u,{name:"adminGambleRepealPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Ne={key:0},Ie={key:1},Me={key:2},Pe={key:3},Re={class:"gamble-item"},De={style:{"margin-left":"auto"}},Te=P({__name:"GambleComponent",props:{gambleId:{},forumId:{}},setup(u){ee(l=>({"4c31a718":e(O).dividerColor}));const n=u,b=H(),y=te(),O=ae(),h=D(),k=D(1e3),q=w(()=>{const l=z(r.value.end_date),s=z(),t=l.diff(s,"hour");return t>=1?`${t}小时后`:`${l.diff(s,"minute")}分钟后`}),j=w(()=>z(r.value.end_date).format("YY年M月D日 HH:mm")),$=w(()=>z().isAfter(z(r.value.end_date))),U=[{label:"开奖",key:"close",icon:T(ve,{size:"1.5rem"})},{label:"中止",key:"repeal",icon:T(ie,{size:"1.5rem"})}];function V(l){switch(l){case"close":X();break;case"repeal":Z();break}}const B=[{title:"我的投注",key:"option_text",resizable:!0},{title:"投注额",key:"betting_olo",resizable:!0},{title:"赔率",key:"odds",render:l=>{var s;return((s=l.odds)==null?void 0:s.toFixed(2))??"（开奖时确定）"},resizable:!0},{title:"奖金",key:"win_olo",resizable:!0}],{data:C,loading:Q,send:Y,onSuccess:Le}=L($e(n.gambleId),{immediate:!1});function G(){Y({binggan:b.binggan})}b.binggan&&G();const r=w(()=>C.value.gamble_question),S=w(()=>C.value.gamble_options),N=w(()=>{var l;return((l=C.value.user_choices)==null?void 0:l.map(s=>{var t;return{...s,option_text:(t=S.value.find(v=>v.id===s.option_id))==null?void 0:t.option_text}}))??[]}),E=w(()=>{var l;return(l=S.value.find(s=>s.id===r.value.result_option_id))==null?void 0:l.option_text}),{loading:R,send:J,onSuccess:K}=L(l=>Ce(l),{immediate:!1});K(()=>{G()});function W(){if(!h.value||!k.value){window.$message.error("请选择选项和输入投注额喔");return}const l={binggan:b.binggan,gamble_question_id:n.gambleId,bet_option:h.value,betting_olo:k.value},s={title:"参加菠菜",closable:!1,content:`确定要参加菠菜吗？将消耗${k.value}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{J(l)}};window.$dialog.warning(s)}function X(){var t;if(!h.value){window.$message.error("请选择选项喔");return}const l={binggan:b.binggan,gamble_question_id:n.gambleId,result_option:h.value},s={title:"开奖菠菜",closable:!1,content:`确定要开奖吗？开奖选项是：${(t=S.value.find(v=>v.id===h.value))==null?void 0:t.option_text}`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Ge(l).then(()=>{G()})}};window.$dialog.warning(s)}function Z(){const l={binggan:b.binggan,gamble_question_id:n.gambleId},s={title:"中止菠菜",closable:!1,content:"确定要中止菠菜吗？已投注的olo将会退回",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Se(l).then(()=>{G()})}};window.$dialog.warning(s)}return(l,s)=>(i(),x(e(se),{size:"small",bordered:!0},{default:a(()=>[o(e(me),{show:e(Q)},{default:a(()=>[e(C)!==void 0?(i(),x(e(f),{key:0,vertical:""},{default:a(()=>[o(e(f),{size:"small",align:"center",class:"gamble-title"},{default:a(()=>[o(e(le),{size:e(y).isMobile?24:32},{default:a(()=>[o(e(ze))]),_:1},8,["size"]),p("span",null,_(r.value.title),1)]),_:1}),o(e(re),{value:h.value,"onUpdate:value":s[0]||(s[0]=t=>h.value=t)},{default:a(()=>[o(e(f),{vertical:"",size:"large"},{default:a(()=>[(i(!0),m(M,null,A(S.value,(t,v)=>(i(),m("div",{key:t.id},[o(e(ue),{value:t.id,label:`（当前赔率 ${t.odds.toFixed(2)}）： ${t.id==r.value.result_option_id?"⭐":""} ${t.option_text}`},null,8,["value","label"]),o(e(ce),{status:"success",type:"line",height:e(y).isMobile?20:24,percentage:Math.floor(t.olo_total/r.value.olo_total*100),"indicator-placement":"inside"},{default:a(()=>[d(_(t.olo_total),1)]),_:2},1032,["height","percentage"])]))),128))]),_:1})]),_:1},8,["value"]),$.value&&r.value.is_closed===0?(i(),m("span",Ne,"菠菜已经关闭投注")):c("",!0),r.value.is_closed===1?(i(),m("span",Ie,_(`菠菜已开奖，奖金已发放。中奖项是：${E.value}`),1)):c("",!0),r.value.is_closed===2?(i(),m("span",Me,"菠菜已经被管理员中止，投注olo已退回")):c("",!0),!$.value&&r.value.is_closed===0?(i(),m("div",Pe,[o(e(g),{depth:3},{default:a(()=>[d("结束时间：")]),_:1}),p("span",null,_(j.value)+" ("+_(q.value)+")",1)])):c("",!0),o(e(f),{size:"small",align:"center"},{default:a(()=>[o(e(pe),{max:1e6,min:1,step:1e3,placeholder:"投注额",disabled:$.value||r.value.is_closed!==0,value:k.value,"onUpdate:value":s[1]||(s[1]=t=>k.value=t)},null,8,["disabled","value"]),o(e(F),{type:"primary",onClick:W,loading:e(R),disabled:e(R)||$.value||r.value.is_closed!==0},{default:a(()=>[d("投注")]),_:1},8,["loading","disabled"]),e(b).checkAdminForums(l.forumId)&&r.value.is_closed===0?(i(),x(e(oe),{key:0,trigger:"hover",options:U,onSelect:V,placement:"bottom-start"},{default:a(()=>[o(e(F),{type:"warning"},{default:a(()=>[d("管理")]),_:1})]),_:1})):c("",!0)]),_:1}),!e(y).isMobile&&N.value.length>0?(i(),x(e(de),{key:4,columns:B,data:N.value,bordered:!1},null,8,["data"])):c("",!0),e(y).isMobile?(i(),m(M,{key:5},[N.value.length>0?(i(),x(e(f),{key:0,vertical:"",align:"start",size:"small"},{default:a(()=>[(i(!0),m(M,null,A(N.value,t=>(i(),m("div",Re,[o(e(f),{style:{"margin-bottom":"6px"}},{default:a(()=>[p("div",null,[o(e(g),{depth:3},{default:a(()=>[d("我的投注：")]),_:1}),o(e(g),null,{default:a(()=>[d(_(t.option_text),1)]),_:2},1024)])]),_:2},1024),o(e(f),{style:{"margin-bottom":"6px"}},{default:a(()=>[p("div",null,[o(e(g),{depth:3},{default:a(()=>[d("投注额：")]),_:1}),o(e(g),null,{default:a(()=>[d(_(t.betting_olo),1)]),_:2},1024)])]),_:2},1024),t.win_olo?(i(),x(e(f),{key:0,style:{"margin-bottom":"6px"}},{default:a(()=>[p("div",null,[o(e(g),{depth:3},{default:a(()=>[d("赔率：")]),_:1}),o(e(g),null,{default:a(()=>{var v;return[d(_((v=t.odds)==null?void 0:v.toFixed(2)),1)]}),_:2},1024)]),p("div",De,[o(e(g),{depth:3},{default:a(()=>[d("奖金：")]),_:1}),o(e(g),null,{default:a(()=>[d(_(t.win_olo),1)]),_:2},1024)])]),_:2},1024)):c("",!0)]))),256))]),_:1})):c("",!0)],64)):c("",!0)]),_:1})):c("",!0)]),_:1},8,["show"])]),_:1}))}}),ct=ne(Te,[["__scopeId","data-v-f027c483"]]);export{ct as default};
