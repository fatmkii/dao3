import{r as se,u as oe,x as le,a4 as ue,a6 as ne,b as d,q as b,i as ie,an as de,ao as pe,a2 as me,F as k,A as i,K as o,z as w,W as _,R as s,V as fe,t as e,ak as ce,al as ge,$ as ve,J as he,U as m,aa as B,X as u,N as ye,Z as be,_ as N,ap as ke,aq as we,am as _e,C as f,ar as Ie}from"./vendor-DKSliaeX.js";import{u as Se,t as j}from"./forums-BKK4zFtC.js";import{s as F}from"./subtitles-DW7M559j.js";import{s as Ce}from"./shuffle-Bl2z5mvo.js";import{u as G,c as Te,b as U,d as p,S as xe,e as De,f as O,_ as Le}from"./app-BS5C2Xv4.js";import{_ as $e}from"./loudspeaker-BZnNu3IF.js";import{L as Ne,S as Fe}from"./LoudspeakerComponent-HY2Oj6HI.js";import{T as Ue}from"./ThreadList-XojFjp9c.js";import"./showDialog-CR-FesH4.js";import"./browseLogger-Dw9qxaZF.js";function Oe(){const g=G();se(()=>{g.showTopbarNav=!1}),oe(()=>{g.showTopbarNav=!0})}const ze={key:0,class:"carousel-box"},Me={key:0,class:"carousel-box"},Pe=["src"],qe=le({__name:"ForumPage",props:{forumId:{},page:{},search:{},delay:{type:Boolean}},setup(g){var E,W;ue(t=>({"366ac772":e(n).bannerHeight}));const I=Te(),n=G(),c=Se(),v=ne(),K=d(null);d();const z=d();Oe();const r=g,H=b(()=>{var t;return Ce((t=c.forumData(r.forumId))==null?void 0:t.banners).slice(0,5)});document.title=(W=(E=c.forumData(r.forumId))==null?void 0:E.name)!=null?W:"小火锅";const S=U("banner_hiden",!1),C=U("new_window_to_post",!1);function J(){return f(m,{style:"padding:6px 8px",vertical:!0},()=>[f(O,{checked:S.value,"onUpdate:checked":t=>S.value=t,label:"隐藏版头"}),f(O,{checked:C.value,"onUpdate:checked":t=>C.value=t,label:"新窗口打开"})])}const V=[{type:"group",key:"header",label:"功能"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:J}],T=U("subtitles_included",F),M=b(()=>F.filter(t=>!T.value.includes(t)));function X(){return f(Ie,{value:T.value,"onUpdate:value":t=>T.value=t},()=>[f(m,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(F).map(t=>f(O,{value:t,label:t}))])])}const Z=[{type:"group",key:"header",label:"筛选"},{key:"header-divider",type:"divider"},{key:"filterOptions",type:"render",render:X}],h=d(r.search),y=d(!!r.search);function P(){v.push({name:"forum",params:{forumId:r.forumId,page:1},query:{search:h.value||void 0}})}function Q(){h.value=void 0,y.value=!1,v.push({name:"forum",params:{forumId:r.forumId,page:1}})}function Y(){v.push({name:"forum",params:{forumId:r.forumId,page:1},query:{delay:r.delay?void 0:"true"}})}const x=d(r.page);function ee(t){v.push({name:"forum",params:{forumId:r.forumId,page:t},query:{search:r.search,delay:r.delay?"true":void 0}})}ie(()=>r.page,t=>x.value=t);const q=b(()=>({forumId:r.forumId,binggan:I.binggan,page:r.page,threadsPerPage:50,subtitlesExcluded:M.value,searchTitle:r.search,delay:r.delay})),{loading:D,data:L,onSuccess:Ae}=de(()=>j(q.value),[()=>r.forumId,()=>r.page,()=>r.search,()=>r.delay,M],{initialData:[],immediate:!0}),A=d(!1),{onSuccess:ae,fetch:te}=pe();function R(t=!1){var a;A.value=t,te(j(q.value)),(a=z.value)==null||a.reloadBrowseLogger()}ae(()=>{A.value&&!n.userCustom.lessToast&&window.$message.success("已刷新数据")});const re=b(()=>{if(D.value)return[];if(I.userData.binggan.use_pingbici){const t=n.userCustom.pingbiciIngnoreCase?"gi":"g";return L.value.threads_data.data.filter(a=>{for(let $ of I.userData.pingbici.title_pingbici)if(new RegExp($,t).test(a.title))return!1;return!0})}else return L.value.threads_data.data});return(t,a)=>{const $=me("router-link");return i(),k(e(m),{vertical:""},{default:o(()=>[e(S)?_("",!0):(i(),w("div",ze,[e(c).forumsDataLoading?(i(),w("div",Me,[s(e(ce),{class:"carousel-skeleton",sharp:""})])):_("",!0),e(c).forumsDataLoading?_("",!0):(i(),k(e(ge),{key:1,"show-arrow":"",trigger:e(n).isMobile?"click":"hover",autoplay:"",interval:1e4},{default:o(()=>[(i(!0),w(ve,null,he(H.value,l=>(i(),w("img",{src:l,class:"carousel-img"},null,8,Pe))),256))]),_:1},8,["trigger"]))])),s(e(m),{style:{"margin-top":"8px"},size:"small"},{default:o(()=>[s(e(B),{trigger:e(n).isMobile?"click":"hover",options:V,placement:"bottom-start"},{default:o(()=>[s(e(p),null,{default:o(()=>[...a[7]||(a[7]=[u("功能",-1)])]),_:1})]),_:1},8,["trigger"]),s(e(B),{trigger:e(n).isMobile?"click":"hover",options:Z,placement:"bottom-start"},{default:o(()=>[s(e(p),null,{default:o(()=>[...a[8]||(a[8]=[u("筛选",-1)])]),_:1})]),_:1},8,["trigger"]),s(e(ye),{size:e(n).isMobile?28:34},{default:o(()=>[s(e(xe),{style:{cursor:"pointer"},onClick:a[0]||(a[0]=l=>y.value=!y.value)})]),_:1},8,["size"]),s(e(p),{type:"primary",style:{"margin-left":"auto"},onClick:a[1]||(a[1]=l=>t.$router.push({name:"loudspeaker"}))},{default:o(()=>[...a[9]||(a[9]=[u("大喇叭",-1)])]),_:1}),s(e(p),{type:"primary",onClick:a[2]||(a[2]=l=>t.$router.push({name:"new-thread",params:{forumId:r.forumId}}))},{default:o(()=>[...a[10]||(a[10]=[u("新主题",-1)])]),_:1})]),_:1}),y.value?(i(),k(e(m),{key:1,wrap:!1},{default:o(()=>[s(e(De),{value:h.value,"onUpdate:value":a[3]||(a[3]=l=>h.value=l),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索标题","auto-size":"",onKeyup:be(P,["enter"])},null,8,["value"]),s(e(p),{type:"primary",onClick:P},{default:o(()=>[...a[11]||(a[11]=[u("搜索",-1)])]),_:1}),s(e(p),{type:"default",onClick:Q},{default:o(()=>[...a[12]||(a[12]=[u("清空",-1)])]),_:1})]),_:1})):_("",!0),s(Ne),s(Ue,{ref_key:"ThreadListCom",ref:z,"threads-list-data":re.value,"new-window-to-post":e(C),"show-this":!e(D),onWithdrawDelayThreadSuccess:R},null,8,["threads-list-data","new-window-to-post","show-this"]),s(e(m),{align:"center"},{default:o(()=>[s(e(p),{type:r.delay?"default":"primary",onClick:Y},{default:o(()=>[u(N(r.delay?"关闭延时主题":"查看延时主题"),1)]),_:1},8,["type"]),s($e,{page:x.value,"onUpdate:page":[a[4]||(a[4]=l=>x.value=l),ee],"last-page":e(D)?1:e(L).threads_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),a[13]||(a[13]=fe("div",{style:{height:"50px"}},null,-1)),(i(),k(ke,{to:"#topbar-nav"},[s($,{to:"/",class:"flex-item-center"},{default:o(()=>[s(e(we),{tooltip:!1},{default:o(()=>{var l;return[u(N((l=e(c).forumData(t.forumId))==null?void 0:l.name),1)]}),_:1}),s(e(_e),{round:"",class:"forum-tag",size:e(n).isMobile?"small":"medium"},{default:o(()=>[u(N(t.forumId),1)]),_:1},8,["size"])]),_:1})])),s(Fe,{mode:"forum",ref_key:"SidebarCom",ref:K,onRefresh:a[5]||(a[5]=l=>R(!0)),onNewThread:a[6]||(a[6]=l=>t.$router.push({name:"new-thread",params:{forumId:r.forumId}}))},null,512)]),_:1})}}}),Xe=Le(qe,[["__scopeId","data-v-e58df8a9"]]);export{Xe as default};
