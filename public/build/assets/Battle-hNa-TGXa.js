import{w as P,o as Q,b as U,g as W,u as q,d as f,$ as V,c as w,bW as D,t as J,A as o,M as n,f as a,H as u,a as t,i as K,k as d,F as M,C as X,Q as Y,m as R,j as Z,h as tt,z as c,s as g,G as m,aH as et,n as at,_ as st}from"./app-BYB32yAm.js";import{f as j,h as $,j as lt}from"./randomHeads-DL3TN-el.js";import{u as rt}from"./forums-DK5zcUOZ.js";import{_ as ot}from"./index-u4XndDaU.js";import{N as nt}from"./ThreadPage-C8vYMAte.js";import{N as h}from"./Tag-BnmF-oYL.js";import{b as it}from"./Ellipsis-wYYb2U2o.js";import"./showDialog-DZhBB07B.js";import"./Checkbox-Idy5uEl7.js";import"./FInput.vue_vue_type_script_setup_true_lang-CsJqv-RY.js";import"./Tabs-D1dnVlrx.js";import"./emojiData-a0Hcov0e.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Sidebar-DwkY6PwE.js";import"./Pagination-w6_7Wy46.js";import"./dayjs.min-BIwLhz4I.js";const ut=["src"],ct=P({__name:"Battle",props:{battleId:{}},setup(k,{expose:C}){const y=Q(),F=U();rt(),W(),q();const _=k,v=[{"flex-direction":"row","justify-content":"center"},{"flex-direction":"row","justify-content":"start"},{"flex-direction":"row-reverse","justify-content":"end"}],N=f(()=>{const e=j[l.value.battle.chara_group];if(l.value.battle.chara_group===0){const r=y.userData.my_battle_chara.filter(s=>!s.not_use).map((s,b)=>({value:b+240,label:s.name}));return e.concat(r)}else return e}),x=f(()=>l.value.battle.is_your_battle||l.value.battle.you_are_challenger),I=f(()=>{const e=l.value.battle;if(!x)return"";const r=e.progress===1&&e.is_your_battle===!0||e.progress===2&&e.you_are_challenger===!0||e.progress===3,s=F.isDouble11?1.98:1.96,b=Math.floor(r?e.battle_olo*s:e.battle_olo).toLocaleString("en-us");return`你${r?"赢得":"输掉"}了${b}个奥利奥`}),i=V(8),{data:l,loading:z,onSuccess:G}=w($(_.battleId));G(e=>{e.data.battle.progress===0&&D(`battleDataGetter-${e.data.battle.id}`),e.data.battle.chara_group>0&&(i.value=j[e.data.battle.chara_group-1][0].value)});const{fetch:H,fetching:T,onSuccess:B}=J();function p(){H($(_.battleId))}B(e=>{e.data.battle.progress===0&&D(`battleDataGetter-${e.data.battle.id}`)}),C({refreshBattleDataHandle:p});const{loading:S,onSuccess:L,onError:O,send:A}=w(e=>lt(e),{immediate:!1});L(()=>{p()}),O(()=>{p()});function E(){const e={title:"加入战斗！",closable:!1,content:`将押注：${l.value.battle.battle_olo.toLocaleString("en-us")}个奥利奥`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{const r={binggan:y.binggan,battle_id:_.battleId,chara_id:i.value>=240?i.value-240:i.value,is_custom_chara:i.value>=240};A(r)}};window.$dialog.warning(e)}return(e,r)=>(o(),n(t(d),{size:"small",vertical:""},{default:a(()=>[u(t(K),{size:"small",bordered:!0,embedded:"",class:"battle-card"},{default:a(()=>[u(t(nt),{show:t(z)||t(T)},{default:a(()=>[t(l)!==void 0?(o(),n(t(d),{key:0,vertical:"",size:"small"},{default:a(()=>[(o(!0),M(X,null,Y(t(l).battle_messages,s=>(o(),n(t(d),{align:"center",wrap:!1,style:R(v[s.message_type])},{default:a(()=>[Z("img",{class:"emoji-img",src:s.chara_url},null,8,ut),s.message_type!==0?(o(),n(t(tt),{key:0},{default:a(()=>[c(g(s.message),1)]),_:2},1024)):(o(),n(t(h),{key:1,round:""},{default:a(()=>[c(g(s.message),1)]),_:2},1024))]),_:2},1032,["style"]))),256)),u(t(d),{style:R(v[0])},{default:a(()=>[t(l).battle.progress===0?(o(),n(t(h),{key:0,round:""},{default:a(()=>[c("正在等待挑战者")]),_:1})):m("",!0),t(l).battle.progress===2&&x.value?(o(),n(t(h),{key:1,round:""},{default:a(()=>[c(g(I.value),1)]),_:1})):m("",!0)]),_:1},8,["style"]),t(l).battle.progress===0&&t(l).battle.is_your_battle===!1?(o(),n(t(d),{key:0,size:"small",wrap:!1,align:"center",justify:"center",style:{"margin-top":"6px"}},{default:a(()=>[u(t(et),{style:{"max-width":"15.2rem"}},{default:a(()=>[u(t(ot),{style:{width:"3.2rem"}},{default:a(()=>[c("角色")]),_:1}),u(t(it),{value:i.value,"onUpdate:value":r[0]||(r[0]=s=>i.value=s),options:N.value},null,8,["value","options"])]),_:1}),u(t(at),{type:"primary",onClick:E,disabled:t(S),loading:t(S)},{default:a(()=>[c("挑战")]),_:1},8,["disabled","loading"])]),_:1})):m("",!0)]),_:1})):m("",!0)]),_:1},8,["show"])]),_:1})]),_:1}))}}),kt=st(ct,[["__scopeId","data-v-f19f9337"]]);export{kt as default};
