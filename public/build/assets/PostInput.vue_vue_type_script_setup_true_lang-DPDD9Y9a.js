import{n as le,l as O,t as f,g as fe,p as W,j as H,q as e,D as ve,x as l,E as t,F as re,H as V,I as N,S as J,L as r,P as se,M as R,av as ye,ao as Ke,i as te,K as Z,O as ge,am as Ae,a_ as we,a2 as Le,a3 as Pe,a1 as We,b5 as He,J as ee,b6 as Ue,aU as Se,a$ as qe,aY as De,aD as Ve,Q as de,w as Ce,b3 as Je,b4 as Be,m as be,B as Re,N as oe,b1 as Qe,b2 as Ze,C as et,al as tt,u as lt,a4 as je,aO as at,R as ie,b7 as nt,b8 as ot,b9 as st,ba as ut,aZ as it,bb as rt,bc as dt,z as vt,bd as mt,be as pt}from"./vendor-TKhEiLHF.js";import{u as ae,a as ue,e as j,c as Q,b as Y,i as Ne,w as ft,j as Oe,k as gt,p as ct,r as Ee,d as xe}from"./app-DyjO_oyN.js";import{s as ht}from"./showDialog-DAOem-pu.js";import{b as bt,c as yt,d as ze,e as wt,g as Ct,f as kt,i as It,_ as Mt}from"./emojiData-Dg30ZW5G.js";import{i as Ye,a as Xe}from"./inputNumberFormat-BPxWRFt_.js";const xt=le({__name:"RollModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(G,{expose:X,emit:S}){const U=ae(),i=ue(),I=G,$=O(()=>{let c=[];if(v.value>0&&b.value>0){for(var n=0;n<v.value;n++)c[n]=Math.floor(Math.random()*b.value)+1;return c.join()}else return null}),z=f(),C=f(),v=f(1),b=f(100),_=f(!1);function M(){_.value=!0}X({show:M});const A=S,{loading:d,send:y,onSuccess:m}=fe(c=>bt(c),{immediate:!1});function w(){if(!v.value){window.$message.error("请填写骰子数量");return}if(!b.value){window.$message.error("请填写骰子数量");return}const c={binggan:i.binggan,thread_id:I.threadId,forum_id:I.forumId,roll_name:z.value,roll_event:C.value,roll_num:v.value,roll_range:b.value};y(c)}return m(()=>{A("refreshPostsList"),_.value=!1}),(c,n)=>(H(),W(e(ve),{show:_.value,"onUpdate:show":n[6]||(n[6]=g=>_.value=g),"display-directive":"if"},{default:l(()=>[t(e(re),{style:V({maxWidth:e(U).modalMaxWidth}),title:"Roll点",closable:"",onClose:n[5]||(n[5]=g=>_.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:w,disabled:e(d)},{default:l(()=>[...n[12]||(n[12]=[r("Roll it!",-1)])]),_:1},8,["disabled"]),t(e(Y),{onClick:n[4]||(n[4]=g=>_.value=!1)},{default:l(()=>[...n[13]||(n[13]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...n[7]||(n[7]=[r(" 输出参考： ",-1)])]),_:1}),t(e(J),null,{default:l(()=>[r(se(z.value?`「${z.value}」，`:"")+" "+se(C.value?`「${C.value}」的结果：`:"")+" "+se(`${v.value} d ${b.value} = 「${$.value}」`),1)]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[8]||(n[8]=[r("Roll点昵称",-1)])]),_:1}),t(e(Q),{placeholder:"可留空",maxlength:100,value:z.value,"onUpdate:value":n[0]||(n[0]=g=>z.value=g)},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[9]||(n[9]=[r("Roll点事件",-1)])]),_:1}),t(e(Q),{placeholder:"可留空",maxlength:100,value:C.value,"onUpdate:value":n[1]||(n[1]=g=>C.value=g)},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[10]||(n[10]=[r("骰子数量",-1)])]),_:1}),t(e(ye),{max:100,min:1,placeholder:"必须填写",value:v.value,"onUpdate:value":n[2]||(n[2]=g=>v.value=g)},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[11]||(n[11]=[r("骰子大小",-1)])]),_:1}),t(e(ye),{max:1e4,min:1,placeholder:"必须填写",value:b.value,"onUpdate:value":n[3]||(n[3]=g=>b.value=g)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Tt=["src"],$t=le({__name:"CaptchaModal",emits:["waterUnlockOnSuccess"],setup(G,{expose:X,emit:S}){const U=ae(),i=ue(),I=f(),$=O(()=>b.value.captcha_key),z=f(!1);function C(){z.value=!0,M()}X({show:C});const v=S,{data:b,loading:_,send:M}=fe(Ne,{immediate:!1}),{fetch:A}=Ke();function d(){A(Ne())}const{loading:y,send:m,onSuccess:w,onError:c}=fe(g=>ft(g),{immediate:!1});function n(){if(!I.value){window.$message.error("验证码不能为空");return}const g={binggan:i.binggan,captcha_code:I.value,captcha_key:$.value};m(g),w(()=>{I.value="",z.value=!1,v("waterUnlockOnSuccess")}),c(()=>{I.value="",d()})}return(g,o)=>(H(),W(e(ve),{show:z.value,"onUpdate:show":o[3]||(o[3]=T=>z.value=T),"display-directive":"if"},{default:l(()=>[t(e(re),{style:V({maxWidth:e(U).modalMaxWidth}),title:"验证码",closable:"",onClose:o[2]||(o[2]=T=>z.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:n,loading:e(y),disabled:e(y)},{default:l(()=>[...o[7]||(o[7]=[r("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(Y),{onClick:o[1]||(o[1]=T=>z.value=!1)},{default:l(()=>[...o[8]||(o[8]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...o[4]||(o[4]=[r(" 嗷……你可能刷太多了，休息一下吧。 ",-1)])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"3.2rem"},class:"round"},{default:l(()=>[...o[5]||(o[5]=[r("输入",-1)])]),_:1}),t(e(Q),{placeholder:"请输入验证码",maxlength:"4","show-count":"",value:I.value,"onUpdate:value":o[0]||(o[0]=T=>I.value=T),onKeyup:ge(n,["enter"])},null,8,["value"])]),_:1}),e(_)?Z("",!0):(H(),te("img",{key:0,src:"data:image/png;base64,"+e(b).captcha_img,style:{"max-width":"200px"},onClick:d},null,8,Tt)),t(e(J),null,{default:l(()=>[...o[6]||(o[6]=[r(" 点击可更换验证码。不区分大小写。 ",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),_t=le({__name:"BattleModal",props:{threadId:{},forumId:{},randomHeadsGroup:{}},emits:["refreshPostsList"],setup(G,{expose:X,emit:S}){const U=ae(),i=ue(),I=f(null),$=G,z=O(()=>{const g=[{value:1,label:"共通",available:!0}];return yt.forEach(o=>{o.value===$.randomHeadsGroup&&g.push(o)}),g}),C=O(()=>{const g=ze[b.value-1];if(b.value===1){const o=i.userData.my_battle_chara.filter(T=>!T.not_use).map((T,E)=>({value:E+240,label:T.name}));return g.concat(o)}else return g}),v=f(1),b=f($.randomHeadsGroup),_=f(100);Ae(b,g=>{g===1?v.value=ze[g-1][8].value:v.value=ze[g-1][0].value},{immediate:!0});const{loading:M,send:A,onSuccess:d,onError:y}=fe(g=>wt(g),{immediate:!1});function m(g){var K;const{timestamp:o,newPostKey:T}=Ct((K=g==null?void 0:g.isTrusted)!=null?K:!0,$.threadId,i.binggan),E={binggan:i.binggan,forum_id:$.forumId,thread_id:$.threadId,battle_olo:_.value,chara_id:v.value>=240?v.value-240:v.value,is_custom_chara:v.value>=240,chara_group:b.value-1,new_post_key:T,timestamp:o};A(E)}d(()=>{n("refreshPostsList"),w.value=!1}),y(g=>{var o;g.error.cause!==void 0&&g.error.cause.code===244291&&((o=I.value)==null||o.show())});const w=f(!1);function c(){w.value=!0}X({show:c});const n=S;return(g,o)=>(H(),W(e(ve),{show:w.value,"onUpdate:show":o[5]||(o[5]=T=>w.value=T),"display-directive":"if"},{default:l(()=>[t(e(re),{style:V({maxWidth:e(U).modalMaxWidth}),title:"表情包大乱斗！",closable:"",onClose:o[4]||(o[4]=T=>w.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:m,loading:e(M)},{default:l(()=>[...o[10]||(o[10]=[r("提交",-1)])]),_:1},8,["loading"]),t(e(Y),{onClick:o[3]||(o[3]=T=>w.value=!1)},{default:l(()=>[...o[11]||(o[11]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...o[6]||(o[6]=[r("小斗怡情，大斗伤身，强斗奥飞湮灭",-1)])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...o[7]||(o[7]=[r("主题",-1)])]),_:1}),t(e(we),{value:b.value,"onUpdate:value":o[0]||(o[0]=T=>b.value=T),options:z.value},null,8,["value","options"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...o[8]||(o[8]=[r("角色",-1)])]),_:1}),t(e(we),{value:v.value,"onUpdate:value":o[1]||(o[1]=T=>v.value=T),options:C.value},null,8,["value","options"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...o[9]||(o[9]=[r("下注",-1)])]),_:1}),t(e(ye),{value:_.value,"onUpdate:value":o[2]||(o[2]=T=>_.value=T),max:1e6,min:1,step:100,parse:e(Xe),format:e(Ye),onKeyup:ge(m,["enter"])},null,8,["value","parse","format"])]),_:1})]),_:1}),t($t,{ref_key:"CaptchaModalCom",ref:I,onWaterUnlockOnSuccess:m},null,512)]),_:1},8,["style"])]),_:1},8,["show"]))}}),Dt=le({__name:"CodeModal",emits:["insertCode"],setup(G,{expose:X,emit:S}){const U=ae(),i=f(0),I=f(),$=f(),z=[{value:0,label:"折叠内容"},{value:1,label:"超链接"},{value:2,label:"图片"},{value:3,label:"删除线"}],C=O(()=>[{prepend_1:"显示内容",prepend_2:"隐藏内容",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"显示内容",inputDefault_2:"隐藏内容",insertText:`<details><summary>${I.value}</summary>${$.value}</details>`},{prepend_1:"显示文字",prepend_2:"链接网址",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"点我跳转",inputDefault_2:"",insertText:`<a href="${$.value}">${I.value}</a>`},{prepend_1:"图片链接",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<img src="${I.value}">`},{prepend_1:"删除文字",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<del>${I.value}</del>`}]);Ae(i,()=>{I.value=C.value[i.value].inputDefault_1,$.value=C.value[i.value].inputDefault_2},{immediate:!0});function v(){M("insertCode",C.value[i.value].insertText),I.value=C.value[i.value].inputDefault_1,$.value=C.value[i.value].inputDefault_2,b.value=!1}const b=f(!1);function _(){b.value=!0}X({show:_});const M=S;return(A,d)=>(H(),W(e(ve),{show:b.value,"onUpdate:show":d[5]||(d[5]=y=>b.value=y),"display-directive":"if"},{default:l(()=>[t(e(re),{style:V({maxWidth:e(U).modalMaxWidth}),title:"快捷代码",closable:"",onClose:d[4]||(d[4]=y=>b.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:v},{default:l(()=>[...d[8]||(d[8]=[r("插入",-1)])]),_:1}),t(e(Y),{onClick:d[3]||(d[3]=y=>b.value=!1)},{default:l(()=>[...d[9]||(d[9]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...d[6]||(d[6]=[r("代码预览：",-1)])]),_:1}),t(e(J),null,{default:l(()=>[r(se(C.value[i.value].insertText),1)]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...d[7]||(d[7]=[r("代码内容",-1)])]),_:1}),t(e(we),{value:i.value,"onUpdate:value":d[0]||(d[0]=y=>i.value=y),options:z},null,8,["value"])]),_:1}),Le(t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[r(se(C.value[i.value].prepend_1),1)]),_:1}),t(e(Q),{value:I.value,"onUpdate:value":d[1]||(d[1]=y=>I.value=y),onKeyup:ge(v,["enter"])},null,8,["value"])]),_:1},512),[[Pe,C.value[i.value].inputEnable_1]]),Le(t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[r(se(C.value[i.value].prepend_2),1)]),_:1}),t(e(Q),{value:$.value,"onUpdate:value":d[2]||(d[2]=y=>$.value=y),onKeyup:ge(v,["enter"])},null,8,["value"])]),_:1},512),[[Pe,C.value[i.value].inputEnable_2]])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),zt=["width","height"],Ht=["width","height"],Ut=["onClick"],At=["title","innerHTML","onClick"],Lt=le({__name:"DrawerModal",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(G,{expose:X,emit:S}){const U=ue();ae();const i=G,I=f(!1);function $(){I.value=!0}X({show:$});const z=S,C=f(),v=O(()=>{var p;return(p=C.value)==null?void 0:p.getContext("2d")}),b=f(),_=O(()=>{var p;return(p=b.value)==null?void 0:p.getContext("2d")}),M=new Image;let A=!1;const d={x:0,y:0,width:0,height:0},y=f([]),m=f([]),w=f([]),c=f({lineWidth:3,lineColor:"#111111",shadowBlur:1}),n=f(!1),g=f(!1);let o=0,T=0;const E=O(()=>window.innerWidth>836?796:window.innerWidth-36),K=O(()=>window.innerHeight>580?400:window.innerHeight-212),F=O(()=>[{title:"上一步",action:"prev",className:y.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>'},{title:"下一步",action:"next",className:m.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/></svg>'},{title:"橡皮擦",action:"eraser",className:y.value.length||m.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"/></svg>'},{title:"清除",action:"clear",className:y.value.length||m.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/><path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/></svg>'},{title:"拖动背景",action:"drag",className:g.value?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor"  viewBox="0 0 16 16"> <path d="M6.75 1a.75.75 0 0 1 .75.75V8a.5.5 0 0 0 1 0V5.467l.086-.004c.317-.012.637-.008.816.027.134.027.294.096.448.182.077.042.15.147.15.314V8a.5.5 0 1 0 1 0V6.435a4.9 4.9 0 0 1 .106-.01c.316-.024.584-.01.708.04.118.046.3.207.486.43.081.096.15.19.2.259V8.5a.5.5 0 0 0 1 0v-1h.342a1 1 0 0 1 .995 1.1l-.271 2.715a2.5 2.5 0 0 1-.317.991l-1.395 2.442a.5.5 0 0 1-.434.252H6.035a.5.5 0 0 1-.416-.223l-1.433-2.15a1.5 1.5 0 0 1-.243-.666l-.345-3.105a.5.5 0 0 1 .399-.546L5 8.11V9a.5.5 0 0 0 1 0V1.75A.75.75 0 0 1 6.75 1zM8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v5.34l-1.2.24a1.5 1.5 0 0 0-1.196 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.271-2.715a2 2 0 0 0-1.99-2.199h-.581a5.114 5.114 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.632 2.632 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002zm2.094 2.025z"/></svg>'}]),B=[{lineWidth:3,innerHTML:"🖌️",font_size:12},{lineWidth:6,innerHTML:"🖌️",font_size:16},{lineWidth:12,innerHTML:"🖌️",font_size:20}];function u(){const p=new ImageData(E.value,K.value);w.value.push(p)}We(()=>{u()});function L(){v.value.lineWidth=c.value.lineWidth,v.value.shadowBlur=c.value.shadowBlur,v.value.shadowColor=c.value.lineColor,v.value.strokeStyle=c.value.lineColor,v.value.lineCap="round",v.value.lineJoin="round"}function me(p){if(A)if(g.value){const s=p.target;let k,x;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,x=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,x=p.changedTouches[0].clientY-s.getBoundingClientRect().y),b.value.height=b.value.height;let P={x:d.x+(k-o),y:d.y+(x-T),width:d.width,height:d.height};ne(M,P)}else{v.value.beginPath(),v.value.moveTo(o,T);const s=p.target;let k,x;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,x=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,x=p.changedTouches[0].clientY-s.getBoundingClientRect().y),v.value.globalCompositeOperation=n.value?"destination-out":"source-over",v.value.lineTo(k,x),[o,T]=[k,x],v.value.stroke()}}function ke(p){if(g.value){const s=p.target;let k,x;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,x=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,x=p.changedTouches[0].clientY-s.getBoundingClientRect().y),d.x+=k-o,d.y+=x-T,A=!1}else{const s=v.value.getImageData(0,0,C.value.width,C.value.height);m.value.length?(w.value=[],w.value=w.value.concat(y.value),w.value.push(s),m.value=[]):w.value.push(s),A=!1}}function Ie(p){if(g.value){const s=p.target;let k,x;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,x=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,x=p.changedTouches[0].clientY-s.getBoundingClientRect().y),o=k,T=x,A=!0}else{A=!0;const s=p.target;let k,x;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,x=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,x=p.changedTouches[0].clientY-s.getBoundingClientRect().y),L(),o=k,T=x;const P=v.value.getImageData(0,0,C.value.width,C.value.height);y.value.push(P)}}function Te(p){c.value.lineWidth=p,n.value=!1,g.value=!1}function ce(p){switch(p){case"prev":if(y.value.length){const s=y.value.pop(),k=w.value[y.value.length+1];m.value.push(k),v.value.putImageData(s,0,0)}break;case"next":if(m.value.length){const s=m.value.pop(),k=w.value[w.value.length-m.value.length-2];y.value.push(k),v.value.putImageData(s,0,0)}break;case"clear":v.value.clearRect(0,0,C.value.width,C.value.height),y.value=[],m.value=[],w.value=[w.value[0]];break;case"eraser":n.value=!0;break;case"drag":g.value=!0;break}}function $e(p){if(p.file.file){var s=new FileReader;s.readAsDataURL(p.file.file),s.onload=k=>{M.src=k.target.result,M.onload=function(){var x=b,P=M;d.width=P.width,d.height=P.height,P.width/P.height>=x.value.width/x.value.height?P.width>x.value.width&&(d.width=x.value.width,d.height=P.height*x.value.width/P.width):P.height>x.value.height&&(d.width=P.width*x.value.height/P.height,d.height=x.value.height),ne(P,d)}}}}function ne(p,s){_.value.drawImage(p,s.x,s.y,s.width,s.height)}const pe=f(!1);function he(){let p=new Image;p.src=C.value.toDataURL("image/png"),p.onload=()=>{_.value.drawImage(p,0,0),s(b.value)};function s(x){x.toBlob(P=>{P&&k(P)},"image/png")}function k(x){const P={binggan:U.binggan,file:x,mode:"draw",thread_id:i.threadId,forum_id:i.forumId};pe.value=!0,Oe(P).then(Me=>{z("insertImage",Me.file_url),pe.value=!1,I.value=!1}).catch(()=>{pe.value=!1})}}return(p,s)=>(H(),W(e(ve),{show:I.value,"onUpdate:show":s[5]||(s[5]=k=>I.value=k),"display-directive":"show"},{default:l(()=>[t(e(re),{style:V({maxWidth:E.value+4+"px"}),title:"涂鸦板",closable:"",onClose:s[4]||(s[4]=k=>I.value=!1),size:"small","content-style":{padding:"0px"}},{default:l(()=>[ee("div",{id:"canvas-container",style:V({width:E.value+"px",height:K.value+"px"})},[ee("canvas",{id:"drawer-canvas-background",ref_key:"canvasBackground",ref:b,width:E.value,height:K.value,onTouchmove:s[0]||(s[0]=Ue(()=>{},["prevent"]))},null,40,zt),ee("canvas",{id:"drawer-canvas",ref_key:"canvas",ref:C,class:Se({painting:!g.value,dragging:g.value}),width:E.value,height:K.value,onTouchmove:[s[1]||(s[1]=Ue(()=>{},["prevent"])),me],onMousedown:Ie,onMouseup:ke,onMousemove:me,onTouchstart:Ie,onTouchend:ke},null,42,Ht)],4),t(e(qe),{"x-gap":"6",cols:4},{default:l(()=>[t(e(De),{span:"1"},{default:l(()=>[s[6]||(s[6]=ee("div",null,"颜色",-1)),t(e(Ve),{value:c.value.lineColor,"onUpdate:value":s[2]||(s[2]=k=>c.value.lineColor=k),modes:["hex"],"show-alpha":!1},null,8,["value"])]),_:1}),t(e(De),{span:"1"},{default:l(()=>[s[7]||(s[7]=ee("div",null,"画笔",-1)),t(e(N),{id:"canvas-brush",size:"small",align:"center"},{default:l(()=>[(H(),te(de,null,Ce(B,(k,x)=>ee("span",{key:x,style:V({fontSize:k.font_size+"px"}),onClick:P=>Te(k.lineWidth)},se(k.innerHTML),13,Ut)),64))]),_:1})]),_:1}),t(e(De),{span:"2"},{default:l(()=>[s[8]||(s[8]=ee("div",null,"操作",-1)),t(e(N),{id:"canvas-control",size:"small"},{default:l(()=>[(H(!0),te(de,null,Ce(F.value,(k,x)=>(H(),te("span",{key:x,title:k.title,class:Se([k.className]),innerHTML:k.innerHTML,onClick:P=>ce(k.action)},null,10,At))),128))]),_:1})]),_:1})]),_:1})]),action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(He),{"default-upload":!1,onChange:$e,"show-file-list":!1},{default:l(()=>[t(e(Y),null,{default:l(()=>[...s[9]||(s[9]=[r("加载图片",-1)])]),_:1})]),_:1}),t(e(Y),{type:"primary",onClick:he,disabled:p.userIsLocked,loading:pe.value},{default:l(()=>[...s[10]||(s[10]=[r("上传",-1)])]),_:1},8,["disabled","loading"]),t(e(Y),{onClick:s[3]||(s[3]=k=>I.value=!1)},{default:l(()=>[...s[11]||(s[11]=[r("关闭",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Pt=["onClick"],St=["src"],Bt=le({__name:"EmojiTab",props:{randomHeadsGroup:{default:1},autoHide:{type:Boolean,default:!0}},emits:["appendEmoji"],setup(G,{emit:X}){const S=ue(),U=ae(),i=G,I=O(()=>{let d=0,y=0;return U.isMobile&&(U.userCustom.sidebarLeft?d=20:y=20),{paddingLeft:d+"px",paddingRight:y+"px"}}),$=f(),z=O(()=>{const d=kt.filter(y=>!S.userData.emoji_excluded.includes(y.id)&&(y.headsId===0||y.headsId===i.randomHeadsGroup));return S.userData.my_emoji&&d.unshift({id:0,headsId:0,name:"自定义",emojis:S.userData.my_emoji}),d}),C=X;function v(d,y){C("appendEmoji",d,y==="自定义"),i.autoHide&&($.value=-1)}let b=!1;function _(d,y){return be("span",{onClick:()=>M(y),innerHTML:d})}function M(d){d===$.value&&(b=!0,$.value=-1)}function A(d,y){return b?(b=!1,!1):!0}return(d,y)=>(H(),W(e(Je),{type:"line","bar-width":0,animated:"",onBeforeLeave:A,size:e(U).isMobile?"small":"medium","default-value":-1,value:$.value,"onUpdate:value":y[0]||(y[0]=m=>$.value=m)},{default:l(()=>[(H(!0),te(de,null,Ce(z.value,(m,w,c)=>(H(),W(e(Be),{name:m.id,tab:_(m.name,m.id)},{default:l(()=>[t(e(N),{size:"small",class:"emoji-container",style:V(I.value)},{default:l(()=>[(H(!0),te(de,null,Ce(m.emojis,(n,g,o)=>(H(),te("div",{class:"emoji-box",onClick:T=>v(n,m.name)},[ee("img",{src:n,class:"emoji-in-box"},null,8,St)],8,Pt))),256))]),_:2},1032,["style"])]),_:2},1032,["name","tab"]))),256)),t(e(Be),{name:-1,tab:"隐藏"})]),_:1},8,["size","value"]))}}),Rt=le({__name:"HongbaoModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(G,{expose:X,emit:S}){const U=ae(),i=ue(),I=G,$=[{value:1,label:"口令红包 直接公开口令"},{value:2,label:"抢答红包 回复答对才公开口令"},{value:3,label:"暗号红包 抢完红包才公开口令"}],z=[{value:1,label:"随机olo"},{value:2,label:"定额olo"}],C=f(3e3),v=f(10),b=f(1),_=f(1),M=f(),A=f(),d=f([]),y=f(!1),m=f(),w=f(1);function c(B){B===1&&w.value<5&&(w.value+=1),B===-1&&w.value>1&&(d.value.splice(w.value-1,1),w.value-=1)}const{loading:n,send:g,onSuccess:o}=fe(B=>It(B),{immediate:!1});function T(){function B(){const u={binggan:i.binggan,forum_id:I.forumId,thread_id:I.threadId,hongbao_olo:C.value,hongbao_num:v.value,type:b.value,key_word_type:_.value,hongbao_key_word:M.value,hongbao_question:A.value,hongbao_message_json:d.value,hongbao_olo_hide:y.value,pic_url:m.value};g(u)}if(M.value===void 0){window.$message.error("必须填写“红包口令”喔");return}if(A.value===void 0&&[2,3].includes(_.value)){window.$message.error("抢答红包或者暗号红包时，必须填写“口令提示”喔");return}if(b.value===2&&C.value%v.value!==0){const u={title:"提醒",closable:!1,content:"olo总额不是红包个数的整倍数，多出的余数olo将在最后一个红包发出。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{B()}};window.$dialog.warning(u);return}B()}o(()=>{F("refreshPostsList"),E.value=!1});const E=f(!1);function K(){E.value=!0}X({show:K});const F=S;return(B,u)=>(H(),W(e(ve),{show:E.value,"onUpdate:show":u[12]||(u[12]=L=>E.value=L),"display-directive":"if"},{default:l(()=>[t(e(re),{style:V({maxWidth:e(U).modalMaxWidth}),title:"发起红包",closable:"",onClose:u[11]||(u[11]=L=>E.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:T,disabled:e(n),loading:e(n)},{default:l(()=>[...u[26]||(u[26]=[r("提交",-1)])]),_:1},8,["disabled","loading"]),t(e(Y),{onClick:u[10]||(u[10]=L=>E.value=!1)},{default:l(()=>[...u[27]||(u[27]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[ee("div",null,[t(e(J),{depth:3},{default:l(()=>[...u[13]||(u[13]=[r("温馨提示：",-1)])]),_:1}),u[14]||(u[14]=r("在红包总额以外，会追加扣除7%手续费。 ",-1))]),ee("div",null,[t(e(J),{depth:3},{default:l(()=>[...u[15]||(u[15]=[r("总共扣除：",-1)])]),_:1}),t(e(J),{type:"warning"},{default:l(()=>[r(se(Math.ceil(C.value*(e(U).isDouble11?1.02:1.07))),1)]),_:1}),u[16]||(u[16]=r("个奥利奥 ",-1))]),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[17]||(u[17]=[r("红包类型",-1)])]),_:1}),t(e(we),{value:_.value,"onUpdate:value":u[0]||(u[0]=L=>_.value=L),options:$},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[18]||(u[18]=[r("olo类型",-1)])]),_:1}),t(e(we),{value:b.value,"onUpdate:value":u[1]||(u[1]=L=>b.value=L),options:z},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[19]||(u[19]=[r("红包个数",-1)])]),_:1}),t(e(ye),{value:v.value,"onUpdate:value":u[2]||(u[2]=L=>v.value=L),max:50,min:5,step:5},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[20]||(u[20]=[r("olo总额",-1)])]),_:1}),t(e(ye),{value:C.value,"onUpdate:value":u[3]||(u[3]=L=>C.value=L),max:1e6,min:3e3,step:1e3,parse:e(Xe),format:e(Ye)},null,8,["value","parse","format"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[21]||(u[21]=[r("红包口令",-1)])]),_:1}),t(e(Q),{value:M.value,"onUpdate:value":u[4]||(u[4]=L=>M.value=L),placeholder:"必填"},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[22]||(u[22]=[r("红包封面",-1)])]),_:1}),t(e(Q),{value:m.value,"onUpdate:value":u[5]||(u[5]=L=>m.value=L),placeholder:"（可选）填写图片的完整网址"},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[23]||(u[23]=[r("口令提示",-1)])]),_:1}),t(e(Q),{value:A.value,"onUpdate:value":u[6]||(u[6]=L=>A.value=L),placeholder:"抢答红包或者暗号红包时，必填"},null,8,["value"])]),_:1}),(H(!0),te(de,null,Ce(w.value,L=>(H(),W(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[24]||(u[24]=[r("回复留言",-1)])]),_:1}),t(e(Q),{value:d.value[L-1],"onUpdate:value":me=>d.value[L-1]=me,placeholder:`#${L}（可选） 多个留言时随机抽取一个`,maxlength:255},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024))),256)),t(e(N),{size:"small",align:"center"},{default:l(()=>[t(e(J),{depth:3},{default:l(()=>[...u[25]||(u[25]=[r("留言数量",-1)])]),_:1}),t(e(Re),{size:"tiny",circle:"",disabled:w.value===5,onClick:u[7]||(u[7]=L=>c(1))},{icon:l(()=>[t(e(oe),null,{default:l(()=>[t(e(Qe))]),_:1})]),_:1},8,["disabled"]),t(e(Re),{size:"tiny",circle:"",disabled:w.value===1,onClick:u[8]||(u[8]=L=>{c(-1)})},{icon:l(()=>[t(e(oe),null,{default:l(()=>[t(e(Ze))]),_:1})]),_:1},8,["disabled"]),t(e(et),{checked:y.value,"onUpdate:checked":u[9]||(u[9]=L=>y.value=L),label:"隐藏olo总额",style:{"margin-left":"auto"}},null,8,["checked"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),jt=le({__name:"ImageUpload",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(G,{emit:X}){const S=ae(),U=ue(),i=f(null),I=G,$=X,z=["mjj","imgbb","freeimage","picgo","tutu"],C=["imge","imgtbl","imgimg","helloimg","picui","imgwang"],v=O(()=>I.forumId===419?0:z.includes(S.userCustom.imgHost)?1:C.includes(S.userCustom.imgHost)?2:1),b=f(!1),_=({file:m,data:w,headers:c,withCredentials:n,action:g,onFinish:o,onError:T,onProgress:E})=>{var K;if(m.file!==null){if(m.file.size>1024e3){window.$message.error("图片大小不能超过10M喔"),(K=i.value)==null||K.clear();return}const F={binggan:U.binggan,file:m.file,mode:"img",thread_id:I.threadId,forum_id:I.forumId};b.value=!0,Oe(F).then(B=>{var u;$("insertImage",B.file_url),(u=i.value)==null||u.clear(),b.value=!1}).catch(()=>{var B;(B=i.value)==null||B.clear(),b.value=!1})}};function M(m){var w=document.getElementsByTagName("body")[0],c=document.createElement("script");c.setAttribute("id","image-upload-js");var n=document.getElementById("upload-button");m=="mjj"&&(c.setAttribute("async","true"),c.setAttribute("data-mode","manual"),c.setAttribute("src","https://mjj.today/sdk/pup.js"),c.setAttribute("data-url","https://mjj.today/upload"),c.setAttribute("data-auto-insert","html-embed"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),m=="imgbb"&&(c.setAttribute("async","true"),c.setAttribute("data-mode","manual"),c.setAttribute("src","https://imgbb.com/upload.js"),c.setAttribute("data-url","https://imgbb.com/upload"),c.setAttribute("data-auto-insert","html-embed-medium"),n==null||n.setAttribute("data-imgbb-trigger","")),m=="freeimage"&&(c.setAttribute("async","true"),c.setAttribute("data-mode","manual"),c.setAttribute("src","https://freeimage.host/sdk/pup.js"),c.setAttribute("data-url","https://freeimage.host/upload"),c.setAttribute("data-auto-insert","html-embed-medium"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),m=="picgo"&&(c.setAttribute("async","true"),c.setAttribute("data-mode","manual"),c.setAttribute("src","https://www.picgo.net/sdk/pup.js"),c.setAttribute("data-url","https://www.picgo.net/upload"),c.setAttribute("data-auto-insert","html-embed"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),w.appendChild(c)}const A=O(()=>({imge:"https://imge.cc/api/v1/upload",imgtbl:"https://imgtbl.com/api/v1/upload",imgimg:"https://imgimg.cc/api/v1/upload",helloimg:"https://www.helloimg.com/api/v1/upload",picui:"https://picui.cn/api/v1/upload",imgwang:"https://img.wang/api/v1/upload"})[S.userCustom.imgHost]||""),d=({file:m,data:w,headers:c,withCredentials:n,action:g,onFinish:o,onError:T,onProgress:E})=>{if(m.file!==null){const K={file:m.file,url:A.value};b.value=!0,gt(K).then(F=>{var B;console.log(F.data),F.status===!0?$("insertImage",F.data.links.url):window.$message.error(F.message),(B=i.value)==null||B.clear(),b.value=!1}).catch(()=>{var F;(F=i.value)==null||F.clear(),b.value=!1})}};function y(){const m=document.getElementById("image-upload-js");m==null||m.remove()}return We(()=>{z.includes(S.userCustom.imgHost)&&M(S.userCustom.imgHost)}),tt(()=>{y()}),(m,w)=>(H(),te(de,null,[v.value===0?(H(),W(e(He),{key:0,accept:"image/*","custom-request":_,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:i},{default:l(()=>[t(e(Y),{style:{"margin-right":"auto"},disabled:m.userIsLocked,loading:b.value},{default:l(()=>[...w[0]||(w[0]=[r("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):Z("",!0),v.value===1?(H(),W(e(Y),{key:1,style:{"margin-right":"auto"},disabled:m.userIsLocked,"data-target":"#content-input",id:"upload-button"},{default:l(()=>[...w[1]||(w[1]=[r("上传图片",-1)])]),_:1},8,["disabled"])):Z("",!0),v.value===2?(H(),W(e(He),{key:2,accept:"image/*","custom-request":d,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:i},{default:l(()=>[t(e(Y),{style:{"margin-right":"auto"},disabled:m.userIsLocked,loading:b.value},{default:l(()=>[...w[2]||(w[2]=[r("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):Z("",!0)],64))}}),Nt=le({__name:"PingbiciModal",setup(G,{expose:X}){const S=ae(),U=ue(),i=f(),{loading:I,send:$,onSuccess:z}=fe(_=>ct(_),{immediate:!1});function C(){if(!i.value){window.$message.error("请填写屏蔽词");return}const _={binggan:U.binggan,content_pingbici:i.value};$(_)}z(()=>{U.refreshUserData(),v.value=!1});const v=f(!1);function b(){v.value=!0}return X({show:b}),(_,M)=>(H(),W(e(ve),{show:v.value,"onUpdate:show":M[3]||(M[3]=A=>v.value=A),"display-directive":"if"},{default:l(()=>[t(e(re),{style:V({maxWidth:e(S).modalMaxWidth}),title:"追加屏蔽词",closable:"",onClose:M[2]||(M[2]=A=>v.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:C,loading:e(I),disabled:!i.value||e(I)},{default:l(()=>[...M[6]||(M[6]=[r("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(Y),{onClick:M[1]||(M[1]=A=>v.value=!1)},{default:l(()=>[...M[7]||(M[7]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...M[4]||(M[4]=[r("暂时只做了“内容屏蔽词”的追加",-1)])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"4.2rem"}},{default:l(()=>[...M[5]||(M[5]=[r("屏蔽词",-1)])]),_:1}),t(e(Q),{value:i.value,"onUpdate:value":M[0]||(M[0]=A=>i.value=A),maxlength:20,"show-count":"",onKeyup:ge(C,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ft=le({__name:"PostInput",props:{mode:{},disabled:{type:Boolean},handling:{type:Boolean},forumId:{default:0},threadId:{default:0},randomHeadsGroup:{default:1}},emits:["contentCommit","refreshPostsList"],setup(G,{expose:X,emit:S}){const U=ue(),i=ae(),I=f(null),$=f(null),z=f(null),C=f(null),v=f(null),b=f(null),_=f(null),M=G,A=O(()=>({fontSize:i.userCustom.fontSizeInput+"px",borderRadius:"10px"})),d=O(()=>{const h=(n.value.match(/\r?\n|\r/g)||[]).length+2;return h<5?5:h>10?10:h}),y=O(()=>U.userData.binggan.locked_ttl>0?`你的饼干封禁中，将于${Math.floor(U.userData.binggan.locked_ttl/3600)+1}小时后解封`:"正文内容"),m=O(()=>U.userData.binggan.locked_ttl>0),w=f(U.userData.binggan.nickname||"= ="),c=f(""),n=f(""),g=f(!1),o=f(!1);function T(){w.value=U.userData.binggan.nickname||"= =",c.value="",n.value="",g.value=!1,o.value=!1}const E=O(()=>({id:0,created_at:"预览模式",is_deleted:0,thread_id:0,battle_id:null,hongbao_id:null,floor:0,random_head:1,created_by_admin:0,content:n.value,nickname:w.value,is_your_post:!0,hongbao_data:null})),K=O(()=>({class:{"nickname-input":!0,admin:o.value}})),F=f(!1),B=lt("emoji_auto_hide",!1);function u(){let h=[be(xe,{checked:F.value,"onUpdate:checked":a=>F.value=a,label:"实时预览"}),be(xe,{checked:B.value,"onUpdate:checked":a=>B.value=a,label:"表情包自动收起"})];return U.userData.binggan.admin!==0&&U.checkAdminForums(M.forumId)&&h.push(be(xe,{checked:o.value,"onUpdate:checked":a=>o.value=a,label:"管理员"})),be(N,{style:"padding:6px 8px",vertical:!0},()=>h)}const L=[{key:"funcOption",type:"render",render:u}],me=[{label:"涂鸦板",key:"draw",icon:Ee(mt,{size:"1.5rem"})},{label:"屏蔽词",key:"mute",icon:Ee(pt,{size:"1.5rem"})}];function ke(h){var a,D;switch(h){case"mute":(a=v.value)==null||a.show();break;case"draw":(D=_.value)==null||D.show();break}}Ae(o,h=>w.value=h?"管理员":"= =");function Ie(h){return h.selectionStart!=null?h.selectionStart:0}function Te(h,a){const D=Ie(h),q=h.value,Ge=q.substring(0,D)+a+q.substring(D);n.value=Ge,setTimeout(()=>{h.selectionStart=D+a.length,h.selectionEnd=D+a.length},0)}function ce(h){const a=document.getElementById("content-input");Te(a,h),he(),a.focus()}function $e(){ht({title:"要清空内容吗？",onPositiveClick:()=>n.value=""})}const ne=f([""]);function pe(){ne.value.length>1&&(ne.value.pop(),n.value=ne.value.slice(-1)[0])}function he(){var h;ne.value.push((h=n.value)!=null?h:""),ne.value.length>20&&ne.value.shift()}function p(h,a){ce(`<img src='${h}' class='${a?"custom-emoji-img":"emoji-img"}'>`)}function s(h){ce(h)}function k(h){ce(`<img src='${h}' />`)}function x(h){var a;n.value=h,he(),(a=I.value)==null||a.focus()}const P=S;function Me(h){if(!h.isTrusted){const D={title:"错误",closable:!1,content:"请不要用脚本回复喔，可能会被系统判断为脚本并碎饼干。",positiveText:"确定"};window.$dialog.warning(D);return}new Promise(function(D,q){P("contentCommit",{contentInput:n.value,nicknameInput:w.value,postWithAdmin:o.value,titleInput:c.value,isDelay:g.value,ist:h.isTrusted},D)}).then(Fe)}function Fe(){c.value="",n.value="",g.value=!1}const _e=f(!1);return X({quoteHandle:x,isTyping:_e,resetInput:T}),(h,a)=>(H(),W(e(N),{vertical:""},{default:l(()=>[F.value?(H(),te(de,{key:0},[h.mode==="thread"?(H(),W(e(re),{class:"thread-title-container",size:"small",key:"title-card"},{default:l(()=>[ee("span",{class:"thread-title",style:V({fontSize:e(i).userCustom.fontSizeThreadList+"px"})},se(c.value||"标题预览")+" [0] ",5)]),_:1})):Z("",!0),t(Mt,{"post-data":E.value,"forum-id":0,"preview-mode":!0},null,8,["post-data"])],64)):Z("",!0),t(e(N),{size:"small",wrap:!1,align:"center",style:V({paddingRight:e(i).isMobile?"24px":"0px"})},{default:l(()=>[t(e(R),{style:{"max-width":"300px"}},{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...a[15]||(a[15]=[r("昵称",-1)])]),_:1}),t(e(Q),{maxlength:30,value:w.value,"onUpdate:value":a[0]||(a[0]=D=>w.value=D),"show-count":"","input-props":K.value},null,8,["value","input-props"])]),_:1}),t(e(je),{trigger:e(i).isMobile?"click":"hover",options:L,placement:"bottom-start"},{default:l(()=>[t(e(Y),{size:"medium",style:{"flex-shrink":"0"},secondary:!1},{default:l(()=>[...a[16]||(a[16]=[r("功能",-1)])]),_:1})]),_:1},8,["trigger"])]),_:1},8,["style"]),h.mode==="thread"?(H(),W(e(R),{key:1},{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...a[17]||(a[17]=[r("标题",-1)])]),_:1}),t(e(Q),{maxlength:100,value:c.value,"onUpdate:value":a[1]||(a[1]=D=>c.value=D),"show-count":"",placeholder:"标题内容"},null,8,["value"])]),_:1})):Z("",!0),t(Bt,{"auto-hide":e(B),"random-heads-group":h.randomHeadsGroup,onAppendEmoji:p},null,8,["auto-hide","random-heads-group"]),t(e(N),{size:e(i).isMobile?"small":"medium",justify:"end",align:"center",style:V({paddingRight:e(i).isMobile?"24px":"0px"})},{default:l(()=>[t(e(je),{trigger:"click",options:me,onSelect:ke,size:e(i).isMobile?"medium":"large"},{default:l(()=>[t(e(oe),{size:e(i).isMobile?20:24,style:{cursor:"pointer"}},{default:l(()=>[t(e(at))]),_:1},8,["size"])]),_:1},8,["size"]),h.mode==="post"?(H(),W(e(ie),{key:0,placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(nt),{style:{cursor:"pointer"},onClick:a[2]||(a[2]=D=>{var q;return(q=$.value)==null?void 0:q.show()})})]),_:1},8,["size"])]),default:l(()=>[a[18]||(a[18]=r(" 发红包 ",-1))]),_:1},8,["trigger"])):Z("",!0),h.mode==="post"?(H(),W(e(ie),{key:1,placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(ot),{style:{cursor:"pointer"},onClick:a[3]||(a[3]=D=>{var q;return(q=z.value)==null?void 0:q.show()})})]),_:1},8,["size"])]),default:l(()=>[a[19]||(a[19]=r(" 大乱斗 ",-1))]),_:1},8,["trigger"])):Z("",!0),h.mode==="post"?(H(),W(e(ie),{key:2,placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(st),{style:{cursor:"pointer"},onClick:a[4]||(a[4]=D=>{var q;return(q=C.value)==null?void 0:q.show()})})]),_:1},8,["size"])]),default:l(()=>[a[20]||(a[20]=r(" Roll点 ",-1))]),_:1},8,["trigger"])):Z("",!0),t(e(ie),{placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(ut),{style:{cursor:"pointer"},onClick:a[5]||(a[5]=D=>{var q;return(q=b.value)==null?void 0:q.show()})})]),_:1},8,["size"])]),default:l(()=>[a[21]||(a[21]=r(" 快捷代码 ",-1))]),_:1},8,["trigger"]),t(e(it),{vertical:""}),t(e(ie),{placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(rt),{style:{cursor:"pointer"},onClick:pe})]),_:1},8,["size"])]),default:l(()=>[a[22]||(a[22]=r(" 撤销 ",-1))]),_:1},8,["trigger"]),t(e(ie),{placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(dt),{style:{cursor:"pointer"},onClick:$e})]),_:1},8,["size"])]),default:l(()=>[a[23]||(a[23]=r(" 清空 ",-1))]),_:1},8,["trigger"])]),_:1},8,["size","style"]),t(e(vt),{value:n.value,"onUpdate:value":a[6]||(a[6]=D=>n.value=D),type:"textarea",placeholder:y.value,rows:d.value,ref_key:"contentInputDom",ref:I,style:V(A.value),"input-props":{id:"content-input"},disabled:m.value,onChange:he,onKeyup:a[7]||(a[7]=ge(Ue(D=>Me(D),["ctrl"]),["enter"])),onBlur:a[8]||(a[8]=D=>_e.value=!1),onFocus:a[9]||(a[9]=D=>_e.value=!0)},null,8,["value","placeholder","rows","style","disabled"]),t(e(N),{justify:"end",align:"center"},{default:l(()=>[t(jt,{"user-is-locked":m.value,"forum-id":h.forumId,"thread-id":h.threadId,onInsertImage:k},null,8,["user-is-locked","forum-id","thread-id"]),h.mode==="thread"?(H(),W(e(ie),{key:0,placement:"bottom-start",trigger:"hover",disabled:e(i).isMobile},{trigger:l(()=>[t(e(xe),{checked:g.value,"onUpdate:checked":a[10]||(a[10]=D=>g.value=D)},{default:l(()=>[...a[24]||(a[24]=[r("延时发送",-1)])]),_:1},8,["checked"])]),default:l(()=>[a[25]||(a[25]=r(" 第二天8点自动发出 ",-1))]),_:1},8,["disabled"])):Z("",!0),t(e(ie),{placement:"bottom-start",trigger:"hover",disabled:e(i).isMobile},{trigger:l(()=>[t(e(Y),{type:"primary",onClick:a[11]||(a[11]=D=>Me(D)),loading:h.handling,disabled:h.handling||m.value},{default:l(()=>[...a[26]||(a[26]=[r("提交",-1)])]),_:1},8,["loading","disabled"])]),default:l(()=>[a[27]||(a[27]=r(" 可以Ctrl+Enter ",-1))]),_:1},8,["disabled"])]),_:1}),t(Rt,{ref_key:"HongbaoModalCom",ref:$,"thread-id":h.threadId,"forum-id":h.forumId,onRefreshPostsList:a[12]||(a[12]=D=>P("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(_t,{ref_key:"BattleModalCom",ref:z,"thread-id":h.threadId,"forum-id":h.forumId,"random-heads-group":h.randomHeadsGroup,onRefreshPostsList:a[13]||(a[13]=D=>P("refreshPostsList"))},null,8,["thread-id","forum-id","random-heads-group"]),t(xt,{ref_key:"RollModalCom",ref:C,"thread-id":h.threadId,"forum-id":h.forumId,onRefreshPostsList:a[14]||(a[14]=D=>P("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(Nt,{ref_key:"PingbiciModalCom",ref:v},null,512),t(Dt,{ref_key:"CodeModalCom",ref:b,onInsertCode:s},null,512),t(Lt,{ref_key:"DrawerModalCom",ref:_,onInsertImage:k,"user-is-locked":m.value,"forum-id":h.forumId,"thread-id":h.threadId},null,8,["user-is-locked","forum-id","thread-id"])]),_:1}))}});export{Ft as _,$t as a};
