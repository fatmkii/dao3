import{l as Mt,w as X,A as r,F as H,O as y,R as Ht,W as Lt,b as z,$ as A,i as ct,bp as ft,aq as Rt,M as m,q as s,H as u,o as e,x as M,Q as Tt,a2 as V,J as T,ak as st,z as x,C as b,B as v,D as $t,a_ as Et,aI as Nt,K as pt,y as j,E as Ft,X as nt,aX as it,p as Bt,N as R,bq as bt,br as xt,aP as wt,a1 as Gt,ab as Ot,bs as Jt,bt as Ut,bu as Kt,S as lt,aC as Qt}from"./vendor-CGtf6mcl.js";import{g as I,a as K,u as gt,e as Wt,b as Z,_ as St,c as vt,i as Vt,r as F,C as Zt}from"./app-DbEY_lp0.js";import{s as rt}from"./showDialog-DthhaySo.js";import{u as Xt}from"./forums-BjBxPwYJ.js";import{D as ut}from"./Delete-DetGFr7J.js";const Ae=n=>{const o=I.Post("api/posts/create",n,{name:"newPostPoster",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o},Ie=n=>{const o=I.Get("api/posts/"+n.post_id,{name:"postGetter",params:{binggan:n.binggan,thread_id:n.thread_id},localCache:null,hitSource:[]});return o.meta={shouldRemind:!1},o},Yt=n=>{const o=I.Delete("api/posts/"+n.post_id,{binggan:n.binggan,thread_id:n.thread_id},{name:"deletePostDeleter",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o},te=n=>{const o=I.Put("api/posts/recover/"+n.post_id,{binggan:n.binggan,thread_id:n.thread_id},{name:"recoverPostPutter",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o},qe=n=>{const o=I.Post("api/posts/create_roll",n,{name:"rollPostPoster",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o};function ee(n,o,q){const C=new Date().getTime(),g=Mt.MD5(o+q+C+n).toString();return{timestamp:C,newPostKey:g}}const ae=[{id:1,name:"默认",random_heads:["https://z3.ax1x.com/2021/08/01/fSAAIg.png","https://z3.ax1x.com/2021/08/01/fSAeRs.png","https://z3.ax1x.com/2021/08/01/fSAViQ.png","https://z3.ax1x.com/2021/08/01/fSAZGj.png","https://z3.ax1x.com/2021/08/01/fSAkdS.png","https://z3.ax1x.com/2021/08/01/fSAmzn.png","https://z3.ax1x.com/2021/08/01/fSAuMq.png","https://z3.ax1x.com/2021/08/01/fSAKs0.png","https://z3.ax1x.com/2021/08/01/fSAMLV.png","https://z3.ax1x.com/2021/08/01/fSAlZT.png","https://z3.ax1x.com/2021/08/01/fSA1dU.png","https://z3.ax1x.com/2021/08/01/fSA3oF.png","https://z3.ax1x.com/2021/08/01/fSAGi4.png","https://z3.ax1x.com/2021/08/01/fSAYW9.png","https://z3.ax1x.com/2021/08/01/fSAJJJ.png","https://z3.ax1x.com/2021/08/01/fSAtzR.png","https://z3.ax1x.com/2021/08/01/fSAUQ1.png","https://z3.ax1x.com/2021/08/01/fSAsFe.png","https://z3.ax1x.com/2021/08/01/fSABdO.png","https://z3.ax1x.com/2021/08/01/fSADoD.png","https://z3.ax1x.com/2021/08/01/fSA0eK.png","https://z3.ax1x.com/2021/08/01/fSAyJH.png","https://z3.ax1x.com/2021/08/01/fSA6Wd.png","https://z3.ax1x.com/2021/08/01/fSAgSA.png","https://z3.ax1x.com/2021/08/01/fSA2QI.png","https://z3.ax1x.com/2021/08/01/fSARyt.png","https://z3.ax1x.com/2021/08/01/fSAWOP.png","https://z3.ax1x.com/2021/08/01/fSAhef.png","https://z3.ax1x.com/2021/08/01/fSA4w8.png","https://z3.ax1x.com/2021/08/01/fSA5TS.png","https://z3.ax1x.com/2021/08/01/fSAoFg.png","https://z3.ax1x.com/2021/08/01/fSATYQ.png","https://z3.ax1x.com/2021/08/01/fSA7Wj.png","https://z3.ax1x.com/2021/08/01/fSAbSs.png","https://z3.ax1x.com/2021/08/01/fSAqln.png","https://z3.ax1x.com/2021/08/01/fSALyq.png","https://z3.ax1x.com/2021/08/01/fSAOO0.png","https://z3.ax1x.com/2021/08/01/fSAjmV.png","https://z3.ax1x.com/2021/08/01/fSAvwT.png","https://z3.ax1x.com/2021/08/01/fSAxTU.png"]},{id:2,name:"咒岛",random_heads:["https://www.z4a.net/images/2021/04/28/1ec2f3b016cc3993d.png","https://www.z4a.net/images/2021/04/28/2c9d9c4cfced955f1.png","https://www.z4a.net/images/2021/04/28/3a72868d2ed97544e.png","https://www.z4a.net/images/2021/04/28/4a530a7008124f895.png","https://www.z4a.net/images/2021/04/28/16.png","https://www.z4a.net/images/2021/04/28/5c3d0f8f7e94c0f87.png","https://www.z4a.net/images/2021/04/28/6.png","https://www.z4a.net/images/2021/04/28/7.png","https://www.z4a.net/images/2021/04/28/8.png","https://www.z4a.net/images/2021/04/28/9.png","https://www.z4a.net/images/2021/04/28/17.png","https://www.z4a.net/images/2021/04/28/10a78173cca4d2b9e4.png","https://www.z4a.net/images/2021/04/28/116817e6f9946a883b.png","https://www.z4a.net/images/2021/04/28/12d6faaf27dd411273.png","https://www.z4a.net/images/2021/04/28/13cd6b9af2dee496c2.png","https://www.z4a.net/images/2021/04/28/158cb6d1c543151992.png","https://www.z4a.net/images/2021/04/28/191dbde0611454f9c4.png","https://www.z4a.net/images/2021/04/28/149dd44da8e8badd09.png","https://www.z4a.net/images/2021/04/28/189f30c4bbf3eb9015.png","https://www.z4a.net/images/2021/04/28/201161035e7d5b8c56.png","https://www.z4a.net/images/2021/04/28/21.png","https://www.z4a.net/images/2021/04/28/222dc14b16d6f5e3ad.png","https://www.z4a.net/images/2021/04/28/23.png","https://www.z4a.net/images/2021/04/28/24.png","https://www.z4a.net/images/2021/04/28/25.png","https://www.z4a.net/images/2021/04/28/26.png","https://www.z4a.net/images/2021/04/28/27.png","https://www.z4a.net/images/2021/04/28/28.png","https://www.z4a.net/images/2021/04/28/29.png","https://www.z4a.net/images/2021/04/28/30.png","https://www.z4a.net/images/2021/04/28/31.png","https://www.z4a.net/images/2021/04/28/32.png","https://www.z4a.net/images/2021/04/28/333753a209916c1bac.png","https://www.z4a.net/images/2021/04/28/34.png","https://www.z4a.net/images/2021/04/28/35.png","https://www.z4a.net/images/2021/04/28/36.png","https://www.z4a.net/images/2021/04/28/37.png","https://www.z4a.net/images/2021/04/28/38.png","https://www.z4a.net/images/2021/04/28/39.png","https://www.z4a.net/images/2021/04/28/40.png"]},{id:3,name:"国配",random_heads:["https://s2.ax1x.com/2020/03/04/3oNmCT.jpg","https://s2.ax1x.com/2020/03/04/3oNZ5V.jpg","https://s2.ax1x.com/2020/03/04/3oNVU0.jpg","https://s2.ax1x.com/2020/03/04/3oNEEq.jpg","https://s2.ax1x.com/2020/03/04/3oNkbn.jpg","https://s2.ax1x.com/2020/03/04/3oNFDs.jpg","https://s2.ax1x.com/2020/03/04/3oNiuj.jpg","https://s2.ax1x.com/2020/03/04/3oNCvQ.jpg","https://s2.ax1x.com/2020/03/04/3oN9gg.jpg","https://s2.ax1x.com/2020/03/04/3otx4f.jpg","https://s2.ax1x.com/2020/03/04/3otvUP.jpg","https://s2.ax1x.com/2020/03/04/3otjEt.jpg","https://s2.ax1x.com/2020/03/04/3otOHI.jpg","https://s2.ax1x.com/2020/03/04/3otLDA.jpg","https://s2.ax1x.com/2020/03/04/3otqud.jpg","https://s2.ax1x.com/2020/03/04/3otHjH.jpg","https://s2.ax1x.com/2020/03/04/3ot54K.jpg","https://s2.ax1x.com/2020/03/04/3ot4N6.jpg","https://s2.ax1x.com/2020/03/04/3ot6c4.jpg","https://s2.ax1x.com/2020/03/04/3otcjJ.jpg","https://i.loli.net/2020/05/12/fjzJG2tOKS9x75i.png","https://s2.ax1x.com/2020/03/04/3othAx.jpg","https://s2.ax1x.com/2020/03/04/3otWH1.jpg","https://i.loli.net/2020/05/12/RJkuylMqTDbhFYK.png","https://s2.ax1x.com/2020/03/04/3oaHvF.jpg","https://i.loli.net/2020/05/12/JniT3y5EjlHveCa.png","https://i.loli.net/2020/05/12/uLf37Dh4moSNWHl.png","https://i.loli.net/2020/05/12/4PDlehfWOJZoEcj.png","https://i.loli.net/2020/05/12/UznI9POMuTN5CdF.png","https://i.loli.net/2020/05/12/Ku24JNkQp6sedEb.png","https://i.loli.net/2020/05/12/zPiTZRcU2WxC65D.png","https://i.loli.net/2020/05/12/6JeYhNKMLsBQlFO.png","https://i.loli.net/2020/05/12/gIqU1VEXHAQ2ShG.png","https://i.loli.net/2020/05/12/RJOoTxZKvQtLNrA.png","https://i.loli.net/2020/05/12/WHtM9RFxsaCXUYp.png","https://i.loli.net/2020/05/12/KtVvfRUPzA4CDFi.png","https://i.loli.net/2020/05/12/XQWotbfrYi7dBp6.png","https://i.loli.net/2020/05/12/f4h65rGU7cRYwZ8.png","https://i.loli.net/2020/05/12/1HWeg4xdsX85kZT.png","https://i.loli.net/2020/05/12/J8uH6ClX4EGLifc.png"]},{id:4,name:"兵兵球",random_heads:["https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-01.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-02.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-03.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-04.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-05.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-06.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-07.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-08.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-09.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-10.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-11.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-12.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-13.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-14.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-15.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-16.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-17.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-18.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-19.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-20.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-21.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-22.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-23.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-24.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-25.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-26.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-27.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-28.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-29.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-30.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-31.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-32.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-33.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-34.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-35.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-36.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-37.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-38.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-39.gif","https://hcfgt.com/unicorn/i/1890/touxiang/zhuqiu-40.gif"]}],oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},se=y("path",{d:"M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67l-.5-.68C10.96 2.54 10.05 2 9 2C7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1s-1-.45-1-1s.45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1s-1-.45-1-1s.45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83L8.62 12L11 8.76l1-1.36l1 1.36L15.38 12L17 10.83L14.92 8H20v6z",fill:"currentColor"},null,-1),ne=[se],_t=X({name:"CardGiftcardFilled",render:function(o,q){return r(),H("svg",oe,ne)}}),ie=K(),zt=n=>{const o=I.Get("api/battles/"+n,{name:"battleDataGetter-"+n,params:{binggan:ie.binggan},localCache:{mode:"restore",expire:6e5},hitSource:[]});return o.meta={shouldRemind:!1},o},je=n=>{const o=I.Post("api/battles/",n,{name:"battleCreatePoster",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o},le=n=>{const o=I.Post("api/battles/c_roll/",n,{name:"battleChanllengerRollPoster",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o},yt=[[{value:0,label:"AC娘"},{value:1,label:"鹦鹉鸡"},{value:2,label:"咪子鱼"},{value:3,label:"小黑猫"},{value:4,label:"小白猫"},{value:5,label:"麻将脸"},{value:6,label:"小恐龙"},{value:7,label:"TD猫"},{value:8,label:"小豆泥"},{value:9,label:"小企鹅"},{value:10,label:"元元"},{value:11,label:"fufu"}],[{value:100,label:"虎杖悠仁"},{value:101,label:"伏黑惠"},{value:102,label:"钉崎野蔷薇"},{value:103,label:"五条悟"},{value:104,label:"七海建人"},{value:105,label:"夏油杰"},{value:106,label:"乙骨忧太"},{value:107,label:"狗卷棘"},{value:108,label:"两面宿傩"},{value:109,label:"伏黑甚尔"},{value:110,label:"禅院直哉"},{value:111,label:"屁元"},{value:199,label:"芥见下下"}],[],[{value:201,label:"zumi"},{value:202,label:"奶瓶雕"},{value:203,label:"什么夫"},{value:204,label:"盘盘兔"},{value:205,label:"龙小可"},{value:206,label:"皱海蒯"},{value:207,label:"肥肥鲨"},{value:208,label:"保龄鸭"},{value:209,label:"小emo"},{value:210,label:"彩虹马"}]],Me=[{value:0,label:"共通",available:!0},{value:2,label:"咒术回战",available:!0},{available:!1},{value:4,label:"兵兵球",available:!0}],re=["src"],ue=X({__name:"Battle",props:{battleId:{}},setup(n,{expose:o}){const q=K(),C=gt();Xt(),Ht(),Lt();const g=n,l=[{"flex-direction":"row","justify-content":"center"},{"flex-direction":"row","justify-content":"start"},{"flex-direction":"row-reverse","justify-content":"end"}],B=z(()=>{const h=yt[a.value.battle.chara_group];if(a.value.battle.chara_group===0){const w=q.userData.my_battle_chara.filter(f=>!f.not_use).map((f,U)=>({value:U+240,label:f.name}));return h.concat(w)}else return h}),_=z(()=>a.value.battle.is_your_battle||a.value.battle.you_are_challenger),$=z(()=>{const h=a.value.battle;if(!_.value)return"";const w=h.result===1&&h.is_your_battle===!0||h.result===2&&h.you_are_challenger===!0||h.result===3,f=C.isDouble11?1.98:1.96,U=Math.floor(w?h.battle_olo*f:h.battle_olo).toLocaleString("en-us");return`你${w?"赢得":"输掉"}了${U}个奥利奥`}),k=A(8),{data:a,loading:G,onSuccess:O}=ct(zt(g.battleId));O(h=>{h.data.battle.progress===0&&ft(`battleDataGetter-${h.data.battle.id}`),h.data.battle.chara_group>0&&(k.value=yt[h.data.battle.chara_group][0].value)});const{fetch:N,fetching:d,onSuccess:L}=Rt();function S(){N(zt(g.battleId))}L(h=>{h.data.battle.progress===0&&ft(`battleDataGetter-${h.data.battle.id}`)}),o({refreshBattleDataHandle:S});const{loading:D,onSuccess:J,onError:Y,send:tt}=ct(h=>le(h),{immediate:!1});J(()=>{S()}),Y(()=>{S()});function et(){const h={title:"加入战斗！",closable:!1,content:`将押注：${a.value.battle.battle_olo.toLocaleString("en-us")}个奥利奥`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{const w={binggan:q.binggan,battle_id:g.battleId,chara_id:k.value>=240?k.value-240:k.value,is_custom_chara:k.value>=240};tt(w)}};window.$dialog.warning(h)}return(h,w)=>(r(),m(e(pt),{size:"small",bordered:!0,embedded:"",class:"battle-card"},{default:s(()=>[u(e(Nt),{show:e(G)||e(d)},{default:s(()=>[e(a)!==void 0?(r(),m(e(M),{key:0,vertical:"",size:"small"},{default:s(()=>[(r(!0),H(V,null,Tt(e(a).battle_messages,f=>(r(),m(e(M),{align:"center",wrap:!1,style:T(l[f.message_type])},{default:s(()=>[y("img",{class:"emoji-img",src:f.chara_url},null,8,re),f.message_type!==0?(r(),m(e(j),{key:0},{default:s(()=>[x(v(f.message),1)]),_:2},1024)):(r(),m(e(st),{key:1,round:""},{default:s(()=>[x(v(f.message),1)]),_:2},1024))]),_:2},1032,["style"]))),256)),u(e(M),{style:T(l[0])},{default:s(()=>[e(a).battle.progress===0?(r(),m(e(st),{key:0,round:""},{default:s(()=>[x("正在等待挑战者")]),_:1})):b("",!0),e(a).battle.progress===2&&_.value?(r(),m(e(st),{key:1,round:""},{default:s(()=>[x(v($.value),1)]),_:1})):b("",!0)]),_:1},8,["style"]),e(a).battle.progress===0&&e(a).battle.is_your_battle===!1?(r(),m(e(M),{key:0,size:"small",wrap:!1,align:"center",justify:"center",style:{"margin-top":"6px"}},{default:s(()=>[u(e($t),{style:{"max-width":"15.2rem"}},{default:s(()=>[u(e(Wt),{style:{width:"3.2rem"}},{default:s(()=>[x("角色")]),_:1}),u(e(Et),{value:k.value,"onUpdate:value":w[0]||(w[0]=f=>k.value=f),options:B.value},null,8,["value","options"])]),_:1}),u(e(Z),{type:"primary",onClick:et,disabled:e(D),loading:e(D)},{default:s(()=>[x("挑战")]),_:1},8,["disabled","loading"])]),_:1})):b("",!0)]),_:1})):b("",!0)]),_:1},8,["show"])]),_:1}))}}),ce=St(ue,[["__scopeId","data-v-a4b1df18"]]),pe=K(),He=n=>{const o=I.Post("api/hongbao_post/create",n,{name:"hongbaoPostCreatePoster",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o},ge=n=>{const o=I.Post("api/hongbao_post/store",n,{name:"hongbaoPostStorePoster",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o},Le=n=>{const o=I.Get("api/hongbao/"+n,{name:"hongbaoDataGetter-"+n,params:{binggan:pe.binggan},localCache:null,hitSource:[]});return o.meta={shouldRemind:!1},o},Re=n=>{const o=I.Post("api/hongbao/store",n,{name:"hongbaoStorePoster",params:{},localCache:null,hitSource:[]});return o.meta={shouldRemind:!0},o},de={key:0},he=X({__name:"HongbaoPost",props:{hongbaoData:{},threadId:{},forumId:{}},emits:["refreshPostsList"],setup(n,{emit:o}){const q=K(),C=gt(),g=n,l=z(()=>({1:"随机olo",2:"定额olo"})[g.hongbaoData.type]),B=z(()=>({1:"口令红包",2:"抢答红包",3:"暗号红包"})[g.hongbaoData.key_word_type]),_=A(g.hongbaoData.key_word_type===1?g.hongbaoData.key_word:""),$=o,{loading:k,send:a,onSuccess:G,onError:O}=ct(d=>ge(d),{immediate:!1});function N(d){if(!d.isTrusted){const J={title:"错误",closable:!1,content:"请不要用脚本抢红包喔",positiveText:"确定"};window.$dialog.warning(J);return}const{timestamp:L,newPostKey:S}=ee(d.isTrusted,g.threadId,q.binggan),D={binggan:q.binggan,forum_id:g.forumId,thread_id:g.threadId,content:"--红包口令: "+_.value,nickname:"= =",post_with_admin:!1,new_post_key:S,timestamp:L,hongbao_post_id:g.hongbaoData.id,hongbao_key_word:_.value};a(D)}return G(()=>{_.value="",$("refreshPostsList")}),O(()=>{_.value="",$("refreshPostsList")}),(d,L)=>(r(),m(e(M),{size:"small",vertical:""},{default:s(()=>[u(e(pt),{size:"small",bordered:!0,embedded:"",class:"hongbao-post-card"},{default:s(()=>[u(e(M),{vertical:"",align:"center"},{default:s(()=>[u(e(M),{align:"center",size:"small"},{default:s(()=>[u(e(j),{style:{"font-size":"1rem"}},{default:s(()=>[x(v(B.value),1)]),_:1}),y("img",{src:"/hongbao.svg",style:T({height:e(C).isMobile?"30px":"36px"})},null,4)]),_:1}),y("div",null,[d.hongbaoData.question?(r(),m(e(j),{key:0,depth:3},{default:s(()=>[x("提示：")]),_:1})):b("",!0),u(e(j),null,{default:s(()=>[x(v(d.hongbaoData.question),1)]),_:1})]),y("div",null,[d.hongbaoData.key_word?(r(),m(e(j),{key:0,depth:3},{default:s(()=>[x("口令：")]),_:1})):b("",!0),u(e(j),null,{default:s(()=>[x(v(d.hongbaoData.key_word),1)]),_:1})]),y("div",null,[u(e(j),{depth:3},{default:s(()=>[x("数量：")]),_:1}),u(e(j),null,{default:s(()=>[x(v(d.hongbaoData.num_remains)+" /"+v(d.hongbaoData.num_total)+" （"+v(l.value)+"）",1)]),_:1})]),d.hongbaoData.olo_hide?b("",!0):(r(),H("div",de,[u(e(j),{depth:3},{default:s(()=>[x("总额：")]),_:1}),u(e(j),null,{default:s(()=>{var S;return[x(v((S=d.hongbaoData.olo_total)==null?void 0:S.toLocaleString("en-us"))+" olo ",1)]}),_:1})]))]),_:1})]),_:1}),u(e(M),{size:"small",wrap:!1},{default:s(()=>{var S;return[d.hongbaoData.hongbao_user===null?(r(),m(e(vt),{key:0,value:_.value,"onUpdate:value":L[0]||(L[0]=D=>_.value=D),maxlength:255,onKeyup:Ft(N,["enter"]),style:{"max-width":"328px"},placeholder:d.hongbaoData.num_remains===0?"已经抢光啦":"请输入口令","auto-size":"",disabled:d.hongbaoData.hongbao_user!==null||d.hongbaoData.num_remains===0},null,8,["value","placeholder","disabled"])):(r(),m(e(vt),{key:1,value:`你抢到了${(S=d.hongbaoData.hongbao_user)==null?void 0:S.olo.toLocaleString("en-us")}个olo`,maxlength:255,style:{"max-width":"328px"},"auto-size":"",disabled:""},null,8,["value"])),u(e(Z),{type:"primary",onClick:N,disabled:d.hongbaoData.hongbao_user!==null||e(k)||d.hongbaoData.num_remains===0},{default:s(()=>[x("抢！")]),_:1},8,["disabled"])]}),_:1})]),_:1}))}}),me=St(he,[["__scopeId","data-v-bb51ac79"]]),fe={key:0,class:"random-head-container"},be=["src"],xe=y("div",{style:{"margin-left":"auto"}},null,-1),we=y("div",{style:{"margin-left":"auto"}},null,-1),ve=["innerHTML"],_e={class:"post-created-at"},ze={key:0,class:"post-anti-jingfen"},ye={key:1},Te=X({__name:"PostItem",props:{forumId:{},postData:{},yourPostsList:{default:()=>[]},randomHeadGroupIndex:{default:1},antiJingfen:{type:Boolean,default:!1},noImageMode:{type:Boolean,default:!1},noEmojiMode:{type:Boolean,default:!1},noCustomEmojiMode:{type:Boolean,default:!1},noHeadMode:{type:Boolean,default:!1},noVideoMode:{type:Boolean,default:!1},noMentionMode:{type:Boolean,default:!1},useUrlMode:{type:Boolean,default:!1},previewMode:{type:Boolean,default:!1},superAdminMode:{type:Boolean,default:!1}},emits:["showRewardModal","quoteClick","refreshPostsList","adminHandle"],setup(n,{expose:o,emit:q}){const C=A(!1),g=K(),l=gt(),B=Vt(),_=A(null),$=A(null),k=A(null),a=n,G=z(()=>l.userCustom.postLegacyMode?{paddingTop:"6px",paddingBottom:"6px",borderBottom:"1px solid",borderColor:B.themeColor.postItemBorderColor}:void 0),O=z(()=>l.userCustom.postLegacyMode?void 0:{padding:l.userCustom.postCardPadding+"px"}),N=z(()=>{let t=0;return l.isMobile&&!l.userCustom.sidebarLeft&&(t=l.userCustom.postLegacyMode?20:20-l.userCustom.postCardPadding),{paddingRight:t+"px"}}),d=z(()=>{let t=0,i=0;return l.isMobile&&(l.userCustom.sidebarLeft?t=l.userCustom.postLegacyMode?20:20-l.userCustom.postCardPadding:i=l.userCustom.postLegacyMode?20:20-l.userCustom.postCardPadding),{maxHeight:Q.value===void 0?void 0:Q.value+"px",marginTop:l.userCustom.postInnerMargin+"px",lineHeight:l.userCustom.lineHeightPost+"px",paddingLeft:t+"px",paddingRight:i+"px"}}),L=z(()=>({top:W.value===void 0?void 0:W.value+"px",fontSize:l.userCustom.fontSizePost+"px"})),S=z(()=>({marginTop:l.userCustom.postInnerMargin+"px",fontSize:l.userCustom.fontSizeFooter+"px",lineHeight:l.userCustom.fontSizeFooter+"px"})),D=q,J=z(()=>{const t=[{label:"提示",key:"hint",icon:F(Jt,{size:"1.5rem"})},{label:"碎饼",key:"ban",icon:F(Ut,{size:"1.5rem"})},{label:"封禁",key:"lock",icon:F(Kt,{size:"1.5rem"})},{label:"删全",key:"deleteAll",icon:F(ut,{size:"1.5rem"})}];return a.postData.is_deleted===0?t.push({label:"删帖",key:"delete",icon:F(ut,{size:"1.5rem"})}):t.push({label:"恢复",key:"recovery",icon:F(bt,{size:"1.5rem"})}),t});function Y(){D("showRewardModal",{floor:a.postData.floor,forumId:a.forumId,threadId:a.postData.thread_id,postId:a.postData.id,postFloorMessage:ht.value})}function tt(){function t(){const i={binggan:g.binggan,thread_id:a.postData.thread_id,post_id:a.postData.id};Yt(i).then(()=>D("refreshPostsList"))}rt({title:"要删除这个回复吗？",content:"会消费300olo喔",onPositiveClick:()=>{a.postData.hongbao_id!==null?rt({title:"注意",content:"这个回帖有红包。删除后红包将消失，并且olo不退回。是否确认？",onPositiveClick:()=>{t()}}):t()}})}function et(){function t(){const i={binggan:g.binggan,thread_id:a.postData.thread_id,post_id:a.postData.id};te(i).then(()=>D("refreshPostsList"))}rt({title:"要恢复这个已删除的回复吗？",content:"会消费300olo喔",onPositiveClick:()=>{t()}})}function h(t){D("adminHandle",{action:t,postId:a.postData.id})}const w=A(!1),f=A();function U(t){return t.search(/class='emoji[-_]img'/g)!=-1?a.noEmojiMode?"":t:t.search(/class='custom[-_]emoji[-_]img'/g)!=-1?a.noCustomEmojiMode?"":t:a.noImageMode?t.replace(/src/,"origin-src").replace("<img ",'<img src="/img_svg.svg" class="img-svg"'):t}const dt=z(()=>{var i;let t;if(t=a.postData.content.replace(/<img[^>]*>/g,U).replace(/<script/g,"<**禁止使用script**").replace(/\n/g,"<br>"),(i=g.userData)!=null&&i.binggan.use_pingbici){const c=l.userCustom.pingbiciIngnoreCase?"gi":"g";if(!l.userCustom.hidePingbiciFloor){const p=g.userData.pingbici.content_pingbici;p==null||p.forEach(P=>{new RegExp(P,c).test(t)&&(w.value=!0,f.value="屏蔽词折叠（点击展开）")})}if(a.antiJingfen&&!l.userCustom.hidePingbiciFloor){const p=g.userData.pingbici.fjf_pingbici;p==null||p.forEach(P=>{new RegExp(P,"g").test(a.postData.created_binggan_hash.slice(0,5))&&(w.value=!0,f.value="小尾巴黑名单（点击展开）")})}if(!l.userCustom.hidePingbiciFloor){const p=g.userData.pingbici.fjf_pingbici;p==null||p.forEach(P=>{new RegExp(P,c).test(a.postData.nickname)&&(w.value=!0,f.value="固马黑名单（点击展开）")})}}if(a.noVideoMode&&new RegExp(/<video|<audio|<embed|<iframe/,"g").test(t)&&(w.value=!0,f.value="音视频折叠（点击展开）"),a.yourPostsList.length>0&&!a.noMentionMode&&(t=t.replace(/@№[0-9]+/g,c=>{const p=Number(c.slice(2));return a.yourPostsList.includes(p)?`<span class="highlight">${c}</span>`:c})),a.useUrlMode){let c=function(P){return new RegExp(/.*(png|jpe?g|webp|gif)$/,"i").test(P)?P:`<a href="${P}" target="_blank">${P}</a>`};const p=new RegExp(/(https?:\/\/|www\.)[a-zA-Z_0-9\-@]+(\.\w[a-zA-Z_0-9\-:]+)+(\/[\(\)~#&\-=?\+\%/\.\w]+)?/,"gi");t=t.replace(p,c)}return t}),ht=z(()=>{var t;return a.antiJingfen?`№${a.postData.floor} ${a.postData.nickname} ${a.postData.created_at} →${(t=a.postData.created_binggan_hash)==null?void 0:t.slice(0,5)}`:`№${a.postData.floor} ${a.postData.nickname} ${a.postData.created_at}`});function at(){const t=l.userCustom.quoteMax;let i=_.value.getElementsByTagName("details");for(let E of i)E.open=!1;let c=_.value.innerText.split(`
`),p=[];c.forEach((E,jt)=>{E.indexOf("@№")>-1&&p.push(jt)}),p.length>=t&&(c=c.slice(p[p.length-t]+1,c.length));const P="<span class='quote-content'>"+c.join(`
`)+`
@`+ht.value+`</span>
`;D("quoteClick",P)}const mt=A();function Dt(){_.value.querySelectorAll("img").forEach(i=>{i.getAttribute("class")!=="img-svg"&&i.addEventListener("click",c=>{mt.value=i,window.$message.success("要添加至自定义表情包吗？",{render:Ct,closable:!0})})})}const Ct=t=>{const{type:i}=t;return lt(Qt,{closable:!1,type:i==="loading"?"default":i,showIcon:!1,style:{boxShadow:"var(--n-box-shadow)",maxWidth:"calc(100vw - 64px)",width:"250px"}},()=>[lt("span",{innerText:t.content}),lt(Z,{size:"tiny",type:"success",onClick:kt},{default:()=>"确定"})])};function kt(){var c;const t=g.userData.my_emoji,i=(c=mt.value)==null?void 0:c.getAttribute("src");if(t!==null&&t.includes(i))window.$message.error("已经添加过该表情包了");else{const p={binggan:g.binggan,my_emoji:i};Zt(p).then(()=>g.refreshUserData())}}nt(()=>{Dt()});function Pt(){_.value.querySelectorAll(".img-svg").forEach(i=>{i.addEventListener("click",c=>{const p=i.getAttribute("src");i.setAttribute("src",""),i.setAttribute("src",i.getAttribute("origin-src")),i.setAttribute("origin-src",p)})})}nt(()=>{Pt()});const ot=A(!1),Q=A(),W=A();function At(){const t=window.getComputedStyle($.value),i=parseInt(t.lineHeight),c=parseInt(t.height),p=i*16;c>p&&(ot.value=!0,W.value=p-c,Q.value=p)}function It(){ot.value=!1,W.value=void 0,Q.value=void 0}nt(()=>{a.postData.floor!==0&&At()});function qt(){var t;(t=k.value)==null||t.refreshBattleDataHandle()}return o({refreshBattleData:qt}),(t,i)=>(r(),m(Ot(e(l).userCustom.postLegacyMode?"div":e(pt)),{class:it([{card:!e(l).userCustom.postLegacyMode},"post-item"]),id:"f_"+t.postData.floor,floor:t.postData.floor,style:T(G.value),"content-style":O.value},{default:s(()=>[u(e(M),{size:"small",style:T(N.value)},{default:s(()=>[t.noHeadMode?b("",!0):(r(),H("div",fe,[y("img",{src:e(ae)[t.randomHeadGroupIndex-1].random_heads[t.postData.random_head],class:it("head_"+t.postData.random_head)},null,10,be)])),f.value!==void 0?(r(),m(e(Bt),{key:1,text:"",onClick:i[0]||(i[0]=c=>w.value=!w.value)},{default:s(()=>[x(v(f.value),1)]),_:1})):b("",!0),t.previewMode?(r(),H(V,{key:3},[we,u(e(R),{size:24,style:{cursor:"pointer"}},{default:s(()=>[u(e(_t))]),_:1}),u(e(R),{size:24,style:{cursor:"pointer"}},{default:s(()=>[u(e(xt))]),_:1})],64)):(r(),H(V,{key:2},[xe,t.postData.is_your_post&&t.postData.is_deleted===0?(r(),m(e(R),{key:0,size:24,style:{cursor:"pointer"},onClick:tt},{default:s(()=>[u(e(ut))]),_:1})):b("",!0),t.postData.is_your_post&&t.postData.is_deleted===1?(r(),m(e(R),{key:1,size:24,style:{cursor:"pointer"},onClick:et},{default:s(()=>[u(e(bt))]),_:1})):b("",!0),t.postData.is_your_post?b("",!0):(r(),m(e(R),{key:2,size:24,style:{cursor:"pointer"},onClick:Y},{default:s(()=>[u(e(_t))]),_:1})),u(e(R),{size:24,style:{cursor:"pointer"},onClick:at},{default:s(()=>[u(e(xt))]),_:1}),!C.value&&e(g).checkAdminForums(a.forumId)?(r(),m(e(R),{key:3,size:24,style:{cursor:"pointer"},onClick:i[1]||(i[1]=c=>C.value=!0)},{default:s(()=>[u(e(wt))]),_:1})):b("",!0),C.value&&e(g).checkAdminForums(a.forumId)?(r(),m(e(Gt),{key:4,trigger:"click",options:J.value,onSelect:h,show:C.value,size:e(l).isMobile?"medium":"large",onClickoutside:i[2]||(i[2]=c=>C.value=!1)},{default:s(()=>[u(e(R),{size:24,style:{cursor:"pointer"}},{default:s(()=>[u(e(wt))]),_:1})]),_:1},8,["options","show","size"])):b("",!0)],64))]),_:1},8,["style"]),w.value?b("",!0):(r(),H(V,{key:0},[y("div",{class:"post-content",ref_key:"postContentContainerDom",ref:$,style:T(d.value)},[y("span",{innerHTML:dt.value,class:"post-span",ref_key:"postContentDom",ref:_,style:T(L.value)},null,12,ve)],4),t.postData.hongbao_data!==null?(r(),m(me,{key:0,"hongbao-data":t.postData.hongbao_data,"forum-id":t.forumId,"thread-id":t.postData.thread_id,onRefreshPostsList:i[3]||(i[3]=c=>D("refreshPostsList"))},null,8,["hongbao-data","forum-id","thread-id"])):b("",!0),t.postData.battle_id!==null?(r(),m(ce,{key:1,"battle-id":t.postData.battle_id,ref_key:"BattleCom",ref:k},null,8,["battle-id"])):b("",!0),u(e(M),{size:[4,0],class:it(["post-footer",{"system-post":t.postData.created_by_admin===2,"admin-post":t.postData.created_by_admin===1}]),style:T(S.value)},{default:s(()=>{var c;return[y("span",{depth:3,class:"post-footer-text",onClick:at,style:{cursor:"pointer"}},v("№"+t.postData.floor),1),y("span",{class:"post-nick-name",onClick:at,style:{cursor:"pointer"}},v(t.postData.nickname),1),y("span",_e,v(t.postData.created_at),1),t.antiJingfen?(r(),H("span",ze," →"+v((c=t.postData.created_binggan_hash)==null?void 0:c.slice(0,5)),1)):b("",!0),t.superAdminMode?(r(),H("span",ye,v(t.postData.created_binggan),1)):b("",!0),ot.value?(r(),m(e(Z),{key:2,size:"tiny",onClick:It},{default:s(()=>[x("展开限高")]),_:1})):b("",!0)]}),_:1},8,["style","class"])],64))]),_:1},8,["class","id","floor","style","content-style"]))}});export{Te as _,Re as a,qe as b,Me as c,yt as d,je as e,He as f,ee as g,Le as h,Ae as n,Ie as p,ae as r};
