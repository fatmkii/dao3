import{n as j,t as m,b as E,l as P,g as R,p,j as r,q as e,D as K,x as t,E as l,J as D,L as d,aw as Q,K as q,ax as x,b0 as F,av as B,a2 as O,ay as H,a3 as X,aD as Z,ab as V,H as M,P as S,I as z,F as Y,U as ee,W as ae,i as le,bz as te,R as se,S as _,Q as oe,w as ue,N as ne,aR as de,bg as ie}from"./vendor-C-2co6ae.js";import{n as re}from"./admin-ejhZ9tk1.js";import{n as fe}from"./globalSetting-l-WeQ9XX.js";import{n as ve,l as pe,_ as me,r as ge}from"./loudspeaker-B409tdOb.js";import{u as G,a as W,c as A,b as U,_ as ye}from"./app-CsEnLcBD.js";const be=j({__name:"NewLoudspeakerModal",emits:["refreshLoudspeaker"],setup(J,{expose:b,emit:k}){const w=G(),N=W(),g=m(null),u=m({subId:"1",content:void 0,color:void 0,threadId:void 0,days:1,effectiveDate:E.tz().format("YYYY-MM-DD HH:mm:ss")}),f=m(!1),v=P(()=>({id:1,sub_id:1,content:u.value.content||"（这里是预览）",color:u.value.color||null,thread_id:null,effective_date:u.value.effectiveDate,expire_date:u.value.effectiveDate,created_at:u.value.effectiveDate,is_your_loudspeaker:!0})),I={effectiveDate:{required:!0,message:"请选择生效日期和时间"},days:{required:!0,message:"请填写生效天数",type:"number"},content:{required:!0,message:"请填写内容"},color:{required:!1},threadId:{required:!1},subId:{required:!1}},i=m(!1);function T(){i.value=!0}b({show:T});const h=k,{loading:y,send:L}=R(c=>ve(c),{immediate:!1});function C(){g.value?.validate(c=>{if(c)window.$message.error("请确认信息填写完整");else{const s={binggan:N.binggan,sub_id:u.value.subId,content:u.value.content,color:f?u.value.color:void 0,thread_id:u.value.threadId,effective_date:u.value.effectiveDate,days:u.value.days};L(s).then(()=>{h("refreshLoudspeaker"),i.value=!1})}})}return(c,s)=>(r(),p(e(K),{show:i.value,"onUpdate:show":s[9]||(s[9]=o=>i.value=o),"display-directive":"if"},{default:t(()=>[l(e(Y),{style:M({maxWidth:e(w).modalMaxWidth}),title:"发布大喇叭",closable:"",onClose:s[8]||(s[8]=o=>i.value=!1),size:"small"},{action:t(()=>[l(e(z),{justify:"end"},{default:t(()=>[l(e(U),{type:"primary",disable:e(y),loading:e(y),onClick:C},{default:t(()=>[...s[10]||(s[10]=[d("发布",-1)])]),_:1},8,["disable","loading"]),l(e(U),{onClick:s[7]||(s[7]=o=>i.value=!1)},{default:t(()=>[...s[11]||(s[11]=[d("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[s[12]||(s[12]=D("div",null,[d(" 价格暂定为5000个olo（每天）"),D("br"),d(" 禁止发布辱骂、诅咒、黑锦鲤等方面情绪。 ")],-1)),l(e(Q),{ref_key:"formRef",ref:g,model:u.value,"label-placement":"left","label-width":"auto",rules:I,size:e(w).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:t(()=>[l(e(x),{label:"生效时间",path:"effectiveDate"},{default:t(()=>[l(e(F),{"formatted-value":u.value.effectiveDate,"onUpdate:formattedValue":s[0]||(s[0]=o=>u.value.effectiveDate=o),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",size:e(w).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),l(e(x),{label:"生效天数",path:"days"},{default:t(()=>[l(e(B),{value:u.value.days,"onUpdate:value":s[1]||(s[1]=o=>u.value.days=o),max:3,min:1,step:1,placeholder:"1-3天"},null,8,["value"])]),_:1}),l(e(x),{label:"内容",path:"content"},{default:t(()=>[l(e(A),{placeholder:"最多100字",type:"textarea",maxlength:"100","show-count":"",autosize:{minRows:3,maxRows:5},value:u.value.content,"onUpdate:value":s[2]||(s[2]=o=>u.value.content=o)},null,8,["value"])]),_:1}),l(e(x),{label:"设定颜色",path:"color"},{default:t(()=>[l(e(H),{value:f.value,"onUpdate:value":s[3]||(s[3]=o=>f.value=o)},null,8,["value"]),O(l(e(Z),{value:u.value.color,"onUpdate:value":s[4]||(s[4]=o=>u.value.color=o),modes:["hex"],"show-alpha":!1,style:{"max-width":"7rem","margin-left":"12px"}},null,8,["value"]),[[X,f.value]])]),_:1}),l(e(x),{label:"链接主题",path:"threadId"},{default:t(()=>[l(e(A),{value:u.value.threadId,"onUpdate:value":s[5]||(s[5]=o=>u.value.threadId=o),placeholder:"主题网址的ID（可留空）"},null,8,["value"])]),_:1}),e(N).admin.isSuperAdmin?(r(),p(e(x),{key:0,label:"设为置顶",path:"subId"},{default:t(()=>[l(e(H),{"onUpdate:value":s[6]||(s[6]=o=>u.value.subId=o),"checked-value":10,"unchecked-value":"1"})]),_:1})):q("",!0)]),_:1},8,["model","size"]),(r(),p(V(v.value.thread_id?"router-link":"span"),{style:M([{color:v.value.color},{"white-space":"pre-wrap"}]),to:v.value.thread_id!==null?`/thread/${v.value.thread_id}/1`:void 0},{default:t(()=>[d(S(v.value.content),1)]),_:1},8,["style","to"]))]),_:1},8,["style"])]),_:1},8,["show"]))}}),ke=j({__name:"LoudspeakerPage",setup(J){ee(o=>({"1386222b":e(N).textColor1}));const b=W(),k=G(),w=m(),N=ae();document.title="大喇叭";const g=m(),u=m(!1),f=m(1),v=m(30),I=P(()=>(f.value-1)*v.value),i={binggan:b.binggan,mode:"all"},{loading:T,data:h,send:y}=R(o=>pe(o),{immediate:!1,initialData:[]});y(i);const L=P(()=>h.value.filter(o=>!(u.value&&!o.is_your_loudspeaker||g.value&&!E.tz(g.value).isSame(o.effective_date,"day")))),{data:C}=R(fe);function c(o){const a={title:"强制删除大喇叭",closable:!1,content:"要强制删除这个大喇叭吗？这是管理员功能。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{re({binggan:b.binggan,loudspeaker_id:o}).then(()=>y(i))}};window.$dialog.warning(a)}function s(o,a=!1){const n={title:"撤回大喇叭",closable:!1,content:a?"由于已超过5分钟，olo将不会退回，是否接受？":"要撤回这个大喇叭吗？如果是5分钟内撤回将退回olo",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{ge({binggan:b.binggan,loudspeaker_id:o,confirm_penalty:a}).then(()=>y(i)).catch($=>{$.cause!==void 0&&$.cause.code==21430&&s(o,!0)})}};a?window.$dialog.warning(n):window.$dialog.success(n)}return(o,a)=>(r(),p(e(z),{vertical:"",style:{"margin-top":"8px"}},{default:t(()=>[l(e(z),{size:"small",align:"center"},{default:t(()=>[D("img",{style:M({height:e(k).isMobile?"48px":"64px"}),src:"/ui/miku-loudspeaker.png"},null,4),l(e(te),{style:M({fontSize:e(k).isMobile?"16px":"20px"}),gradient:{from:"#7fcab9",to:"#99b1c5"}},{default:t(()=>[...a[6]||(a[6]=[d(" 爱乃是盲目～🎵 ",-1)])]),_:1},8,["style"]),l(e(se),{placement:"bottom",trigger:"hover",disabled:e(C)},{trigger:t(()=>[l(e(U),{type:"primary",disabled:!e(C),onClick:a[0]||(a[0]=n=>w.value?.show()),style:{"margin-left":"auto"}},{default:t(()=>[...a[7]||(a[7]=[d("发布大喇叭",-1)])]),_:1},8,["disabled"])]),default:t(()=>[l(e(_),null,{default:t(()=>[...a[8]||(a[8]=[d("嗷！目前暂停发布大喇叭…… ",-1)])]),_:1})]),_:1},8,["disabled"])]),_:1}),l(e(z),{size:"small",justify:"end",align:"center"},{default:t(()=>[l(e(_),null,{default:t(()=>[...a[9]||(a[9]=[d("只看自己",-1)])]),_:1}),l(e(H),{value:u.value,"onUpdate:value":a[1]||(a[1]=n=>u.value=n)},null,8,["value"]),l(e(F),{"formatted-value":g.value,"onUpdate:formattedValue":a[2]||(a[2]=n=>g.value=n),"value-format":"yyyy-MM-dd",type:"date",clearable:"",placeholder:"筛选生效日期",size:e(k).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),l(me,{page:f.value,"onUpdate:page":[a[3]||(a[3]=n=>f.value=n),a[4]||(a[4]=n=>f.value=n)],"last-page":Math.ceil(L.value.length/v.value),style:{"margin-right":"auto"}},null,8,["page","last-page"]),L.value.length>0?(r(!0),le(oe,{key:0},ue(L.value.slice(I.value,I.value+v.value),n=>(r(),p(e(Y),{key:n.id,size:"small",bordered:!0,class:"loudspeaker-card"},{default:t(()=>[(r(),p(V(n.thread_id?"router-link":"span"),{style:M([{color:n.color},{"white-space":"pre-wrap"}]),to:n.thread_id!==null?`/thread/${n.thread_id}/1`:void 0},{default:t(()=>[d(S(n.content),1)]),_:2},1032,["style","to"])),l(e(z),{size:"small"},{default:t(()=>[D("span",null,[l(e(_),{depth:3},{default:t(()=>[...a[10]||(a[10]=[d("生效：",-1)])]),_:1}),l(e(_),null,{default:t(()=>[d(S(n.effective_date),1)]),_:2},1024)]),D("span",null,[l(e(_),{depth:3},{default:t(()=>[...a[11]||(a[11]=[d("到期：",-1)])]),_:1}),l(e(_),null,{default:t(()=>[d(S(n.expire_date),1)]),_:2},1024)]),a[13]||(a[13]=D("div",{style:{"margin-left":"auto"}},null,-1)),n.is_your_loudspeaker?(r(),p(e(ne),{key:0,size:e(k).isMobile?20:24,style:{cursor:"pointer"},onClick:$=>s(n.id,!1)},{default:t(()=>[l(e(de))]),_:1},8,["size","onClick"])):q("",!0),e(b).admin.isNormalAdmin?(r(),p(e(U),{key:1,size:"tiny",type:"warning",onClick:$=>c(n.id)},{default:t(()=>[...a[12]||(a[12]=[d("强制删除",-1)])]),_:1},8,["onClick"])):q("",!0)]),_:2},1024)]),_:2},1024))),128)):(r(),p(e(ie),{key:1})),l(be,{ref_key:"NewLoudspeakerModalCom",ref:w,onRefreshLoudspeaker:a[5]||(a[5]=n=>e(y)(i))},null,512)]),_:1}))}}),Le=ye(ke,[["__scopeId","data-v-3027cefc"]]);export{Le as default};
