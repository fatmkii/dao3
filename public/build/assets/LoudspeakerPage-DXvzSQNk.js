import{x as V,b as m,q as P,w as R,F as p,A as i,t as e,Q as J,K as l,R as t,V as L,X as d,av as K,W as T,aw as _,aO as j,au as O,a8 as Q,ax as q,a9 as X,aB as Z,ah as F,T as N,_ as S,U as M,S as Y,a4 as ee,a5 as ae,z as te,b1 as le,a0 as se,a1 as D,$ as oe,J as ue,N as ne,aV as de}from"./vendor-DKSliaeX.js";import{n as re}from"./admin-Di1jog18.js";import{n as ie}from"./globalSetting-WymbpgkT.js";import{n as fe,l as ve,_ as pe,r as me}from"./loudspeaker-BZnNu3IF.js";import{u as E,c as G,j as W,e as H,d as U,_ as ge}from"./app-BS5C2Xv4.js";import{D as ye}from"./Delete-D3xRQ076.js";const be=V({__name:"NewLoudspeakerModal",emits:["refreshLoudspeaker"],setup(B,{expose:w,emit:c}){const x=E(),C=G(),g=m(null),u=m({subId:"1",content:void 0,color:void 0,threadId:void 0,days:1,effectiveDate:W.tz().format("YYYY-MM-DD HH:mm:ss")}),f=m(!1),v=P(()=>({id:1,sub_id:1,content:u.value.content||"（这里是预览）",color:u.value.color||null,thread_id:null,effective_date:u.value.effectiveDate,expire_date:u.value.effectiveDate,created_at:u.value.effectiveDate,is_your_loudspeaker:!0})),I={effectiveDate:{required:!0,message:"请选择生效日期和时间"},days:{required:!0,message:"请填写生效天数",type:"number"},content:{required:!0,message:"请填写内容"},color:{required:!1},threadId:{required:!1},subId:{required:!1}},r=m(!1);function A(){r.value=!0}w({show:A});const h=c,{loading:y,send:z}=R(b=>fe(b),{immediate:!1});function $(){var b;(b=g.value)==null||b.validate(s=>{if(s)window.$message.error("请确认信息填写完整");else{const o={binggan:C.binggan,sub_id:u.value.subId,content:u.value.content,color:f?u.value.color:void 0,thread_id:u.value.threadId,effective_date:u.value.effectiveDate,days:u.value.days};z(o).then(()=>{h("refreshLoudspeaker"),r.value=!1})}})}return(b,s)=>(i(),p(e(J),{show:r.value,"onUpdate:show":s[9]||(s[9]=o=>r.value=o),"display-directive":"if"},{default:l(()=>[t(e(Y),{style:N({maxWidth:e(x).modalMaxWidth}),title:"发布大喇叭",closable:"",onClose:s[8]||(s[8]=o=>r.value=!1),size:"small"},{action:l(()=>[t(e(M),{justify:"end"},{default:l(()=>[t(e(U),{type:"primary",disable:e(y),loading:e(y),onClick:$},{default:l(()=>[...s[10]||(s[10]=[d("发布",-1)])]),_:1},8,["disable","loading"]),t(e(U),{onClick:s[7]||(s[7]=o=>r.value=!1)},{default:l(()=>[...s[11]||(s[11]=[d("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[s[12]||(s[12]=L("div",null,[d(" 价格暂定为5000个olo（每天）"),L("br"),d(" 禁止发布辱骂、诅咒、黑锦鲤等方面情绪。 ")],-1)),t(e(K),{ref_key:"formRef",ref:g,model:u.value,"label-placement":"left","label-width":"auto",rules:I,size:e(x).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:l(()=>[t(e(_),{label:"生效时间",path:"effectiveDate"},{default:l(()=>[t(e(j),{"formatted-value":u.value.effectiveDate,"onUpdate:formattedValue":s[0]||(s[0]=o=>u.value.effectiveDate=o),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",size:e(x).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),t(e(_),{label:"生效天数",path:"days"},{default:l(()=>[t(e(O),{value:u.value.days,"onUpdate:value":s[1]||(s[1]=o=>u.value.days=o),max:3,min:1,step:1,placeholder:"1-3天"},null,8,["value"])]),_:1}),t(e(_),{label:"内容",path:"content"},{default:l(()=>[t(e(H),{placeholder:"最多100字",type:"textarea",maxlength:"100","show-count":"",autosize:{minRows:3,maxRows:5},value:u.value.content,"onUpdate:value":s[2]||(s[2]=o=>u.value.content=o)},null,8,["value"])]),_:1}),t(e(_),{label:"设定颜色",path:"color"},{default:l(()=>[t(e(q),{value:f.value,"onUpdate:value":s[3]||(s[3]=o=>f.value=o)},null,8,["value"]),Q(t(e(Z),{value:u.value.color,"onUpdate:value":s[4]||(s[4]=o=>u.value.color=o),modes:["hex"],"show-alpha":!1,style:{"max-width":"7rem","margin-left":"12px"}},null,8,["value"]),[[X,f.value]])]),_:1}),t(e(_),{label:"链接主题",path:"threadId"},{default:l(()=>[t(e(H),{value:u.value.threadId,"onUpdate:value":s[5]||(s[5]=o=>u.value.threadId=o),placeholder:"主题网址的ID（可留空）"},null,8,["value"])]),_:1}),e(C).admin.isSuperAdmin?(i(),p(e(_),{key:0,label:"设为置顶",path:"subId"},{default:l(()=>[t(e(q),{"onUpdate:value":s[6]||(s[6]=o=>u.value.subId=o),"checked-value":10,"unchecked-value":"1"})]),_:1})):T("",!0)]),_:1},8,["model","size"]),(i(),p(F(v.value.thread_id?"router-link":"span"),{style:N([{color:v.value.color},{"white-space":"pre-wrap"}]),to:v.value.thread_id!==null?`/thread/${v.value.thread_id}/1`:void 0},{default:l(()=>[d(S(v.value.content),1)]),_:1},8,["style","to"]))]),_:1},8,["style"])]),_:1},8,["show"]))}}),ke=V({__name:"LoudspeakerPage",setup(B){ee(o=>({"1386222b":e(C).textColor1}));const w=G(),c=E(),x=m(),C=ae();document.title="大喇叭";const g=m(),u=m(!1),f=m(1),v=m(30),I=P(()=>(f.value-1)*v.value),r={binggan:w.binggan,mode:"all"},{loading:A,data:h,send:y}=R(o=>ve(o),{immediate:!1,initialData:[]});y(r);const z=P(()=>h.value.filter(o=>!(u.value&&!o.is_your_loudspeaker||g.value&&!W.tz(g.value).isSame(o.effective_date,"day")))),{data:$}=R(ie);function b(o){const a={title:"强制删除大喇叭",closable:!1,content:"要强制删除这个大喇叭吗？这是管理员功能。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{re({binggan:w.binggan,loudspeaker_id:o}).then(()=>y(r))}};window.$dialog.warning(a)}function s(o,a=!1){const n={title:"撤回大喇叭",closable:!1,content:a?"由于已超过5分钟，olo将不会退回，是否接受？":"要撤回这个大喇叭吗？如果是5分钟内撤回将退回olo",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{me({binggan:w.binggan,loudspeaker_id:o,confirm_penalty:a}).then(()=>y(r)).catch(k=>{k.cause!==void 0&&k.cause.code==21430&&s(o,!0)})}};a?window.$dialog.warning(n):window.$dialog.success(n)}return(o,a)=>(i(),p(e(M),{vertical:"",style:{"margin-top":"8px"}},{default:l(()=>[t(e(M),{size:"small",align:"center"},{default:l(()=>[L("img",{style:N({height:e(c).isMobile?"48px":"64px"}),src:"/ui/miku-loudspeaker.png"},null,4),t(e(le),{style:N({fontSize:e(c).isMobile?"16px":"20px"}),gradient:{from:"#7fcab9",to:"#99b1c5"}},{default:l(()=>[...a[6]||(a[6]=[d(" 爱乃是盲目～🎵 ",-1)])]),_:1},8,["style"]),t(e(se),{placement:"bottom",trigger:"hover",disabled:e($)},{trigger:l(()=>[t(e(U),{type:"primary",disabled:!e($),onClick:a[0]||(a[0]=n=>{var k;return(k=x.value)==null?void 0:k.show()}),style:{"margin-left":"auto"}},{default:l(()=>[...a[7]||(a[7]=[d("发布大喇叭",-1)])]),_:1},8,["disabled"])]),default:l(()=>[t(e(D),null,{default:l(()=>[...a[8]||(a[8]=[d("嗷！目前暂停发布大喇叭…… ",-1)])]),_:1})]),_:1},8,["disabled"])]),_:1}),t(e(M),{size:"small",justify:"end",align:"center"},{default:l(()=>[t(e(D),null,{default:l(()=>[...a[9]||(a[9]=[d("只看自己",-1)])]),_:1}),t(e(q),{value:u.value,"onUpdate:value":a[1]||(a[1]=n=>u.value=n)},null,8,["value"]),t(e(j),{"formatted-value":g.value,"onUpdate:formattedValue":a[2]||(a[2]=n=>g.value=n),"value-format":"yyyy-MM-dd",type:"date",clearable:"",placeholder:"筛选生效日期",size:e(c).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),t(pe,{page:f.value,"onUpdate:page":[a[3]||(a[3]=n=>f.value=n),a[4]||(a[4]=n=>f.value=n)],"last-page":Math.ceil(z.value.length/v.value),style:{"margin-right":"auto"}},null,8,["page","last-page"]),z.value.length>0?(i(!0),te(oe,{key:0},ue(z.value.slice(I.value,I.value+v.value),n=>(i(),p(e(Y),{key:n.id,size:"small",bordered:!0,class:"loudspeaker-card"},{default:l(()=>[(i(),p(F(n.thread_id?"router-link":"span"),{style:N([{color:n.color},{"white-space":"pre-wrap"}]),to:n.thread_id!==null?`/thread/${n.thread_id}/1`:void 0},{default:l(()=>[d(S(n.content),1)]),_:2},1032,["style","to"])),t(e(M),{size:"small"},{default:l(()=>[L("span",null,[t(e(D),{depth:3},{default:l(()=>[...a[10]||(a[10]=[d("生效：",-1)])]),_:1}),t(e(D),null,{default:l(()=>[d(S(n.effective_date),1)]),_:2},1024)]),L("span",null,[t(e(D),{depth:3},{default:l(()=>[...a[11]||(a[11]=[d("到期：",-1)])]),_:1}),t(e(D),null,{default:l(()=>[d(S(n.expire_date),1)]),_:2},1024)]),a[13]||(a[13]=L("div",{style:{"margin-left":"auto"}},null,-1)),n.is_your_loudspeaker?(i(),p(e(ne),{key:0,size:e(c).isMobile?20:24,style:{cursor:"pointer"},onClick:k=>s(n.id,!1)},{default:l(()=>[t(e(ye))]),_:1},8,["size","onClick"])):T("",!0),e(w).admin.isNormalAdmin?(i(),p(e(U),{key:1,size:"tiny",type:"warning",onClick:k=>b(n.id)},{default:l(()=>[...a[12]||(a[12]=[d("强制删除",-1)])]),_:1},8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1024))),128)):(i(),p(e(de),{key:1})),t(be,{ref_key:"NewLoudspeakerModalCom",ref:x,onRefreshLoudspeaker:a[5]||(a[5]=n=>e(y)(r))},null,512)]),_:1}))}}),ze=ge(ke,[["__scopeId","data-v-3027cefc"]]);export{ze as default};
