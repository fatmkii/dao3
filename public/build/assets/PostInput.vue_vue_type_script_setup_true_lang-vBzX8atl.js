import{n as ae,l as W,t as c,g as ge,p as j,j as z,q as e,D as me,x as l,E as t,F as de,H as Q,I as N,S as J,L as i,P as se,M as B,av as we,ao as Ke,i as le,K as te,O as ce,am as Ae,a_ as Ce,a2 as Le,a3 as Pe,a1 as We,b5 as He,J as Z,b6 as Ue,aU as Se,a$ as qe,aY as De,aD as Ve,Q as ve,w as ke,b3 as Je,b4 as Be,m as ye,B as Re,N as ue,b1 as Qe,b2 as Ze,C as et,al as tt,u as lt,a4 as je,aO as at,R as re,b7 as nt,b8 as ot,b9 as ut,ba as st,aZ as it,bb as rt,bc as dt,z as vt,bd as mt,be as ft}from"./vendor-TKhEiLHF.js";import{u as ne,a as ie,e as R,c as ee,b as O,i as Ne,w as pt,j as Oe,k as gt,p as ct,r as Ee,d as xe}from"./app-DAtwFFf0.js";import{s as ht}from"./showDialog-Da8JjK79.js";import{b as bt,c as yt,d as ze,e as wt,g as Ct,f as kt,i as It,_ as Mt}from"./emojiData-Csse3usw.js";import{i as Ye,a as Xe}from"./inputNumberFormat-BPxWRFt_.js";const xt=ae({__name:"RollModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(F,{expose:Y,emit:S}){const H=ne(),r=ie(),k=F,T=W(()=>{let v=[];if(m.value>0&&b.value>0){for(var n=0;n<m.value;n++)v[n]=Math.floor(Math.random()*b.value)+1;return v.join()}else return null}),U=c(),w=c(),m=c(1),b=c(100),$=c(!1);function M(){$.value=!0}Y({show:M});const L=S,{loading:d,send:y,onSuccess:f}=ge(v=>bt(v),{immediate:!1});function I(){if(!m.value){window.$message.error("请填写骰子数量");return}if(!b.value){window.$message.error("请填写骰子数量");return}const v={binggan:r.binggan,thread_id:k.threadId,forum_id:k.forumId,roll_name:U.value,roll_event:w.value,roll_num:m.value,roll_range:b.value};y(v)}return f(()=>{L("refreshPostsList"),$.value=!1}),(v,n)=>(z(),j(e(me),{show:$.value,"onUpdate:show":n[6]||(n[6]=p=>$.value=p),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(H).modalMaxWidth}),title:"Roll点",closable:"",onClose:n[5]||(n[5]=p=>$.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(O),{type:"primary",onClick:I,disabled:e(d)},{default:l(()=>[...n[12]||(n[12]=[i("Roll it!",-1)])]),_:1},8,["disabled"]),t(e(O),{onClick:n[4]||(n[4]=p=>$.value=!1)},{default:l(()=>[...n[13]||(n[13]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...n[7]||(n[7]=[i(" 输出参考： ",-1)])]),_:1}),t(e(J),null,{default:l(()=>[i(se(U.value?`「${U.value}」，`:"")+" "+se(w.value?`「${w.value}」的结果：`:"")+" "+se(`${m.value} d ${b.value} = 「${T.value}」`),1)]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[8]||(n[8]=[i("Roll点昵称",-1)])]),_:1}),t(e(ee),{placeholder:"可留空",maxlength:100,value:U.value,"onUpdate:value":n[0]||(n[0]=p=>U.value=p)},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[9]||(n[9]=[i("Roll点事件",-1)])]),_:1}),t(e(ee),{placeholder:"可留空",maxlength:100,value:w.value,"onUpdate:value":n[1]||(n[1]=p=>w.value=p)},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[10]||(n[10]=[i("骰子数量",-1)])]),_:1}),t(e(we),{max:100,min:1,placeholder:"必须填写",value:m.value,"onUpdate:value":n[2]||(n[2]=p=>m.value=p)},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[11]||(n[11]=[i("骰子大小",-1)])]),_:1}),t(e(we),{max:1e4,min:1,placeholder:"必须填写",value:b.value,"onUpdate:value":n[3]||(n[3]=p=>b.value=p)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Tt=["src"],$t=ae({__name:"CaptchaModal",emits:["waterUnlockOnSuccess"],setup(F,{expose:Y,emit:S}){const H=ne(),r=ie(),k=c(),T=W(()=>b.value.captcha_key),U=c(!1);function w(){U.value=!0,M()}Y({show:w});const m=S,{data:b,loading:$,send:M}=ge(Ne,{immediate:!1}),{fetch:L}=Ke();function d(){L(Ne())}const{loading:y,send:f,onSuccess:I,onError:v}=ge(p=>pt(p),{immediate:!1});function n(){if(!k.value){window.$message.error("验证码不能为空");return}const p={binggan:r.binggan,captcha_code:k.value,captcha_key:T.value};f(p),I(()=>{k.value="",U.value=!1,m("waterUnlockOnSuccess")}),v(()=>{k.value="",d()})}return(p,u)=>(z(),j(e(me),{show:U.value,"onUpdate:show":u[3]||(u[3]=_=>U.value=_),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(H).modalMaxWidth}),title:"验证码",closable:"",onClose:u[2]||(u[2]=_=>U.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(O),{type:"primary",onClick:n,loading:e(y),disabled:e(y)},{default:l(()=>[...u[7]||(u[7]=[i("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(O),{onClick:u[1]||(u[1]=_=>U.value=!1)},{default:l(()=>[...u[8]||(u[8]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...u[4]||(u[4]=[i(" 嗷……你可能刷太多了，休息一下吧。 ",-1)])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"3.2rem"},class:"round"},{default:l(()=>[...u[5]||(u[5]=[i("输入",-1)])]),_:1}),t(e(ee),{placeholder:"请输入验证码",maxlength:"4","show-count":"",value:k.value,"onUpdate:value":u[0]||(u[0]=_=>k.value=_),onKeyup:ce(n,["enter"])},null,8,["value"])]),_:1}),e($)?te("",!0):(z(),le("img",{key:0,src:"data:image/png;base64,"+e(b).captcha_img,style:{"max-width":"200px"},onClick:d},null,8,Tt)),t(e(J),null,{default:l(()=>[...u[6]||(u[6]=[i(" 点击可更换验证码。不区分大小写。 ",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),_t=ae({__name:"BattleModal",props:{threadId:{},forumId:{},randomHeadsGroup:{}},emits:["refreshPostsList"],setup(F,{expose:Y,emit:S}){const H=ne(),r=ie(),k=c(null),T=F,U=W(()=>{const p=[{value:1,label:"共通",available:!0}];return yt.forEach(u=>{u.value===T.randomHeadsGroup&&p.push(u)}),p}),w=W(()=>{const p=ze[b.value-1];if(b.value===1){const u=r.userData.my_battle_chara.filter(_=>!_.not_use).map((_,G)=>({value:G+240,label:_.name}));return p.concat(u)}else return p}),m=c(1),b=c(T.randomHeadsGroup),$=c(100);Ae(b,p=>{p===1?m.value=ze[p-1][8].value:m.value=ze[p-1][0].value},{immediate:!0});const{loading:M,send:L,onSuccess:d,onError:y}=ge(p=>wt(p),{immediate:!1});function f(p){var E;const{timestamp:u,newPostKey:_}=Ct((E=p==null?void 0:p.isTrusted)!=null?E:!0,T.threadId,r.binggan),G={binggan:r.binggan,forum_id:T.forumId,thread_id:T.threadId,battle_olo:$.value,chara_id:m.value>=240?m.value-240:m.value,is_custom_chara:m.value>=240,chara_group:b.value-1,new_post_key:_,timestamp:u};L(G)}d(()=>{n("refreshPostsList"),I.value=!1}),y(p=>{var u;p.error.cause!==void 0&&p.error.cause.code===244291&&((u=k.value)==null||u.show())});const I=c(!1);function v(){I.value=!0}Y({show:v});const n=S;return(p,u)=>(z(),j(e(me),{show:I.value,"onUpdate:show":u[5]||(u[5]=_=>I.value=_),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(H).modalMaxWidth}),title:"表情包大乱斗！",closable:"",onClose:u[4]||(u[4]=_=>I.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(O),{type:"primary",onClick:f,loading:e(M)},{default:l(()=>[...u[10]||(u[10]=[i("提交",-1)])]),_:1},8,["loading"]),t(e(O),{onClick:u[3]||(u[3]=_=>I.value=!1)},{default:l(()=>[...u[11]||(u[11]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...u[6]||(u[6]=[i("小斗怡情，大斗伤身，强斗奥飞湮灭",-1)])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...u[7]||(u[7]=[i("主题",-1)])]),_:1}),t(e(Ce),{value:b.value,"onUpdate:value":u[0]||(u[0]=_=>b.value=_),options:U.value},null,8,["value","options"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...u[8]||(u[8]=[i("角色",-1)])]),_:1}),t(e(Ce),{value:m.value,"onUpdate:value":u[1]||(u[1]=_=>m.value=_),options:w.value},null,8,["value","options"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...u[9]||(u[9]=[i("下注",-1)])]),_:1}),t(e(we),{value:$.value,"onUpdate:value":u[2]||(u[2]=_=>$.value=_),max:1e6,min:1,step:100,parse:e(Xe),format:e(Ye),onKeyup:ce(f,["enter"])},null,8,["value","parse","format"])]),_:1})]),_:1}),t($t,{ref_key:"CaptchaModalCom",ref:k,onWaterUnlockOnSuccess:f},null,512)]),_:1},8,["style"])]),_:1},8,["show"]))}}),Dt=ae({__name:"CodeModal",emits:["insertCode"],setup(F,{expose:Y,emit:S}){const H=ne(),r=c(0),k=c(),T=c(),U=[{value:0,label:"折叠内容"},{value:1,label:"超链接"},{value:2,label:"图片"},{value:3,label:"删除线"}],w=W(()=>[{prepend_1:"显示内容",prepend_2:"隐藏内容",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"显示内容",inputDefault_2:"隐藏内容",insertText:`<details><summary>${k.value}</summary>${T.value}</details>`},{prepend_1:"显示文字",prepend_2:"链接网址",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"点我跳转",inputDefault_2:"",insertText:`<a href="${T.value}">${k.value}</a>`},{prepend_1:"图片链接",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<img src="${k.value}">`},{prepend_1:"删除文字",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<del>${k.value}</del>`}]);Ae(r,()=>{k.value=w.value[r.value].inputDefault_1,T.value=w.value[r.value].inputDefault_2},{immediate:!0});function m(){M("insertCode",w.value[r.value].insertText),k.value=w.value[r.value].inputDefault_1,T.value=w.value[r.value].inputDefault_2,b.value=!1}const b=c(!1);function $(){b.value=!0}Y({show:$});const M=S;return(L,d)=>(z(),j(e(me),{show:b.value,"onUpdate:show":d[5]||(d[5]=y=>b.value=y),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(H).modalMaxWidth}),title:"快捷代码",closable:"",onClose:d[4]||(d[4]=y=>b.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(O),{type:"primary",onClick:m},{default:l(()=>[...d[8]||(d[8]=[i("插入",-1)])]),_:1}),t(e(O),{onClick:d[3]||(d[3]=y=>b.value=!1)},{default:l(()=>[...d[9]||(d[9]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...d[6]||(d[6]=[i("代码预览：",-1)])]),_:1}),t(e(J),null,{default:l(()=>[i(se(w.value[r.value].insertText),1)]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[7]||(d[7]=[i("代码内容",-1)])]),_:1}),t(e(Ce),{value:r.value,"onUpdate:value":d[0]||(d[0]=y=>r.value=y),options:U},null,8,["value"])]),_:1}),Le(t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[i(se(w.value[r.value].prepend_1),1)]),_:1}),t(e(ee),{value:k.value,"onUpdate:value":d[1]||(d[1]=y=>k.value=y),onKeyup:ce(m,["enter"])},null,8,["value"])]),_:1},512),[[Pe,w.value[r.value].inputEnable_1]]),Le(t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[i(se(w.value[r.value].prepend_2),1)]),_:1}),t(e(ee),{value:T.value,"onUpdate:value":d[2]||(d[2]=y=>T.value=y),onKeyup:ce(m,["enter"])},null,8,["value"])]),_:1},512),[[Pe,w.value[r.value].inputEnable_2]])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),zt=["width","height"],Ht=["width","height"],Ut=["onClick"],At=["title","innerHTML","onClick"],Lt=ae({__name:"DrawerModal",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(F,{expose:Y,emit:S}){const H=ie();ne();const r=F,k=c(!1);function T(){k.value=!0}Y({show:T});const U=S,w=c(),m=W(()=>{var g;return(g=w.value)==null?void 0:g.getContext("2d")}),b=c(),$=W(()=>{var g;return(g=b.value)==null?void 0:g.getContext("2d")}),M=new Image;let L=!1;const d={x:0,y:0,width:0,height:0},y=c([]),f=c([]),I=c([]),v=c({lineWidth:3,lineColor:"#111111",shadowBlur:1}),n=c(!1),p=c(!1);let u=0,_=0;const G=W(()=>window.innerWidth>836?796:window.innerWidth-36),E=W(()=>window.innerHeight>580?400:window.innerHeight-212),X=W(()=>[{title:"上一步",action:"prev",className:y.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>'},{title:"下一步",action:"next",className:f.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/></svg>'},{title:"橡皮擦",action:"eraser",className:y.value.length||f.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"/></svg>'},{title:"清除",action:"clear",className:y.value.length||f.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/><path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/></svg>'},{title:"拖动背景",action:"drag",className:p.value?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor"  viewBox="0 0 16 16"> <path d="M6.75 1a.75.75 0 0 1 .75.75V8a.5.5 0 0 0 1 0V5.467l.086-.004c.317-.012.637-.008.816.027.134.027.294.096.448.182.077.042.15.147.15.314V8a.5.5 0 1 0 1 0V6.435a4.9 4.9 0 0 1 .106-.01c.316-.024.584-.01.708.04.118.046.3.207.486.43.081.096.15.19.2.259V8.5a.5.5 0 0 0 1 0v-1h.342a1 1 0 0 1 .995 1.1l-.271 2.715a2.5 2.5 0 0 1-.317.991l-1.395 2.442a.5.5 0 0 1-.434.252H6.035a.5.5 0 0 1-.416-.223l-1.433-2.15a1.5 1.5 0 0 1-.243-.666l-.345-3.105a.5.5 0 0 1 .399-.546L5 8.11V9a.5.5 0 0 0 1 0V1.75A.75.75 0 0 1 6.75 1zM8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v5.34l-1.2.24a1.5 1.5 0 0 0-1.196 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.271-2.715a2 2 0 0 0-1.99-2.199h-.581a5.114 5.114 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.632 2.632 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002zm2.094 2.025z"/></svg>'}]),K=[{lineWidth:3,innerHTML:"🖌️",font_size:12},{lineWidth:6,innerHTML:"🖌️",font_size:16},{lineWidth:12,innerHTML:"🖌️",font_size:20}];function q(){const g=new ImageData(G.value,E.value);I.value.push(g)}We(()=>{q()});function o(){m.value.lineWidth=v.value.lineWidth,m.value.shadowBlur=v.value.shadowBlur,m.value.shadowColor=v.value.lineColor,m.value.strokeStyle=v.value.lineColor,m.value.lineCap="round",m.value.lineJoin="round"}function A(g){if(L)if(p.value){const s=g.target;let C,x;g instanceof MouseEvent?(C=g.clientX-s.getBoundingClientRect().x,x=g.clientY-s.getBoundingClientRect().y):(C=g.changedTouches[0].clientX-s.getBoundingClientRect().x,x=g.changedTouches[0].clientY-s.getBoundingClientRect().y),b.value.height=b.value.height;let P={x:d.x+(C-u),y:d.y+(x-_),width:d.width,height:d.height};oe(M,P)}else{m.value.beginPath(),m.value.moveTo(u,_);const s=g.target;let C,x;g instanceof MouseEvent?(C=g.clientX-s.getBoundingClientRect().x,x=g.clientY-s.getBoundingClientRect().y):(C=g.changedTouches[0].clientX-s.getBoundingClientRect().x,x=g.changedTouches[0].clientY-s.getBoundingClientRect().y),m.value.globalCompositeOperation=n.value?"destination-out":"source-over",m.value.lineTo(C,x),[u,_]=[C,x],m.value.stroke()}}function fe(g){if(p.value){const s=g.target;let C,x;g instanceof MouseEvent?(C=g.clientX-s.getBoundingClientRect().x,x=g.clientY-s.getBoundingClientRect().y):(C=g.changedTouches[0].clientX-s.getBoundingClientRect().x,x=g.changedTouches[0].clientY-s.getBoundingClientRect().y),d.x+=C-u,d.y+=x-_,L=!1}else{const s=m.value.getImageData(0,0,w.value.width,w.value.height);f.value.length?(I.value=[],I.value=I.value.concat(y.value),I.value.push(s),f.value=[]):I.value.push(s),L=!1}}function Ie(g){if(p.value){const s=g.target;let C,x;g instanceof MouseEvent?(C=g.clientX-s.getBoundingClientRect().x,x=g.clientY-s.getBoundingClientRect().y):(C=g.changedTouches[0].clientX-s.getBoundingClientRect().x,x=g.changedTouches[0].clientY-s.getBoundingClientRect().y),u=C,_=x,L=!0}else{L=!0;const s=g.target;let C,x;g instanceof MouseEvent?(C=g.clientX-s.getBoundingClientRect().x,x=g.clientY-s.getBoundingClientRect().y):(C=g.changedTouches[0].clientX-s.getBoundingClientRect().x,x=g.changedTouches[0].clientY-s.getBoundingClientRect().y),o(),u=C,_=x;const P=m.value.getImageData(0,0,w.value.width,w.value.height);y.value.push(P)}}function Te(g){v.value.lineWidth=g,n.value=!1,p.value=!1}function he(g){switch(g){case"prev":if(y.value.length){const s=y.value.pop(),C=I.value[y.value.length+1];f.value.push(C),m.value.putImageData(s,0,0)}break;case"next":if(f.value.length){const s=f.value.pop(),C=I.value[I.value.length-f.value.length-2];y.value.push(C),m.value.putImageData(s,0,0)}break;case"clear":m.value.clearRect(0,0,w.value.width,w.value.height),y.value=[],f.value=[],I.value=[I.value[0]];break;case"eraser":n.value=!0;break;case"drag":p.value=!0;break}}function $e(g){if(g.file.file){var s=new FileReader;s.readAsDataURL(g.file.file),s.onload=C=>{M.src=C.target.result,M.onload=function(){var x=b,P=M;d.width=P.width,d.height=P.height,P.width/P.height>=x.value.width/x.value.height?P.width>x.value.width&&(d.width=x.value.width,d.height=P.height*x.value.width/P.width):P.height>x.value.height&&(d.width=P.width*x.value.height/P.height,d.height=x.value.height),oe(P,d)}}}}function oe(g,s){$.value.drawImage(g,s.x,s.y,s.width,s.height)}const pe=c(!1);function be(){let g=new Image;g.src=w.value.toDataURL("image/png"),g.onload=()=>{$.value.drawImage(g,0,0),s(b.value)};function s(x){x.toBlob(P=>{P&&C(P)},"image/png")}function C(x){const P={binggan:H.binggan,file:x,mode:"draw",thread_id:r.threadId,forum_id:r.forumId};pe.value=!0,Oe(P).then(Me=>{U("insertImage",Me.file_url),pe.value=!1,k.value=!1}).catch(()=>{pe.value=!1})}}return(g,s)=>(z(),j(e(me),{show:k.value,"onUpdate:show":s[5]||(s[5]=C=>k.value=C),"display-directive":"show"},{default:l(()=>[t(e(de),{style:Q({maxWidth:G.value+4+"px"}),title:"涂鸦板",closable:"",onClose:s[4]||(s[4]=C=>k.value=!1),size:"small","content-style":{padding:"0px"}},{default:l(()=>[Z("div",{id:"canvas-container",style:Q({width:G.value+"px",height:E.value+"px"})},[Z("canvas",{id:"drawer-canvas-background",ref_key:"canvasBackground",ref:b,width:G.value,height:E.value,onTouchmove:s[0]||(s[0]=Ue(()=>{},["prevent"]))},null,40,zt),Z("canvas",{id:"drawer-canvas",ref_key:"canvas",ref:w,class:Se({painting:!p.value,dragging:p.value}),width:G.value,height:E.value,onTouchmove:[s[1]||(s[1]=Ue(()=>{},["prevent"])),A],onMousedown:Ie,onMouseup:fe,onMousemove:A,onTouchstart:Ie,onTouchend:fe},null,42,Ht)],4),t(e(qe),{"x-gap":"6",cols:4},{default:l(()=>[t(e(De),{span:"1"},{default:l(()=>[s[6]||(s[6]=Z("div",null,"颜色",-1)),t(e(Ve),{value:v.value.lineColor,"onUpdate:value":s[2]||(s[2]=C=>v.value.lineColor=C),modes:["hex"],"show-alpha":!1},null,8,["value"])]),_:1}),t(e(De),{span:"1"},{default:l(()=>[s[7]||(s[7]=Z("div",null,"画笔",-1)),t(e(N),{id:"canvas-brush",size:"small",align:"center"},{default:l(()=>[(z(),le(ve,null,ke(K,(C,x)=>Z("span",{key:x,style:Q({fontSize:C.font_size+"px"}),onClick:P=>Te(C.lineWidth)},se(C.innerHTML),13,Ut)),64))]),_:1})]),_:1}),t(e(De),{span:"2"},{default:l(()=>[s[8]||(s[8]=Z("div",null,"操作",-1)),t(e(N),{id:"canvas-control",size:"small"},{default:l(()=>[(z(!0),le(ve,null,ke(X.value,(C,x)=>(z(),le("span",{key:x,title:C.title,class:Se([C.className]),innerHTML:C.innerHTML,onClick:P=>he(C.action)},null,10,At))),128))]),_:1})]),_:1})]),_:1})]),action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(He),{"default-upload":!1,onChange:$e,"show-file-list":!1},{default:l(()=>[t(e(O),null,{default:l(()=>[...s[9]||(s[9]=[i("加载图片",-1)])]),_:1})]),_:1}),t(e(O),{type:"primary",onClick:be,disabled:g.userIsLocked,loading:pe.value},{default:l(()=>[...s[10]||(s[10]=[i("上传",-1)])]),_:1},8,["disabled","loading"]),t(e(O),{onClick:s[3]||(s[3]=C=>k.value=!1)},{default:l(()=>[...s[11]||(s[11]=[i("关闭",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Pt=["onClick"],St=["src"],Bt=ae({__name:"EmojiTab",props:{randomHeadsGroup:{default:1},autoHide:{type:Boolean,default:!0}},emits:["appendEmoji"],setup(F,{emit:Y}){const S=ie(),H=ne(),r=F,k=W(()=>{let d=0,y=0;return H.isMobile&&(H.userCustom.sidebarLeft?d=20:y=20),{paddingLeft:d+"px",paddingRight:y+"px"}}),T=c(),U=W(()=>{const d=kt.filter(y=>!S.userData.emoji_excluded.includes(y.id)&&(y.headsId===0||y.headsId===r.randomHeadsGroup));return S.userData.my_emoji&&d.unshift({id:0,headsId:0,name:"自定义",emojis:S.userData.my_emoji}),d}),w=Y;function m(d,y){w("appendEmoji",d,y==="自定义"),r.autoHide&&(T.value=-1)}let b=!1;function $(d,y){return ye("span",{onClick:()=>M(y),innerHTML:d})}function M(d){d===T.value&&(b=!0,T.value=-1)}function L(d,y){return b?(b=!1,!1):!0}return(d,y)=>(z(),j(e(Je),{type:"line","bar-width":0,animated:"",onBeforeLeave:L,size:e(H).isMobile?"small":"medium","default-value":-1,value:T.value,"onUpdate:value":y[0]||(y[0]=f=>T.value=f)},{default:l(()=>[(z(!0),le(ve,null,ke(U.value,(f,I)=>(z(),j(e(Be),{name:f.id,tab:$(f.name,f.id)},{default:l(()=>[t(e(N),{size:"small",class:"emoji-container",style:Q(k.value)},{default:l(()=>[(z(!0),le(ve,null,ke(f.emojis,(v,n)=>(z(),le("div",{class:"emoji-box",onClick:p=>m(v,f.name)},[Z("img",{src:v,class:"emoji-in-box"},null,8,St)],8,Pt))),256))]),_:2},1032,["style"])]),_:2},1032,["name","tab"]))),256)),t(e(Be),{name:-1,tab:"隐藏"})]),_:1},8,["size","value"]))}}),Rt=ae({__name:"HongbaoModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(F,{expose:Y,emit:S}){const H=ne(),r=ie(),k=F,T=[{value:1,label:"口令红包 直接公开口令"},{value:2,label:"抢答红包 回复答对才公开口令"},{value:3,label:"暗号红包 抢完红包才公开口令"}],U=[{value:1,label:"随机olo"},{value:2,label:"定额olo"}],w=c(3e3),m=c(10),b=c(1),$=c(1),M=c(),L=c(),d=c([]),y=c(!1),f=c(),I=W(()=>H.isDouble11?Math.ceil(w.value*1.02):H.isOctober1st&&m.value>=20?w.value:Math.ceil(w.value*1.07)),v=c(1);function n(q){q===1&&v.value<5&&(v.value+=1),q===-1&&v.value>1&&(d.value.splice(v.value-1,1),v.value-=1)}const{loading:p,send:u,onSuccess:_}=ge(q=>It(q),{immediate:!1});function G(){function q(){const o={binggan:r.binggan,forum_id:k.forumId,thread_id:k.threadId,hongbao_olo:w.value,hongbao_num:m.value,type:b.value,key_word_type:$.value,hongbao_key_word:M.value,hongbao_question:L.value,hongbao_message_json:d.value,hongbao_olo_hide:y.value,pic_url:f.value};u(o)}if(M.value===void 0){window.$message.error("必须填写“红包口令”喔");return}if(L.value===void 0&&[2,3].includes($.value)){window.$message.error("抢答红包或者暗号红包时，必须填写“口令提示”喔");return}if(b.value===2&&w.value%m.value!==0){const o={title:"提醒",closable:!1,content:"olo总额不是红包个数的整倍数，多出的余数olo将在最后一个红包发出。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{q()}};window.$dialog.warning(o);return}q()}_(()=>{K("refreshPostsList"),E.value=!1});const E=c(!1);function X(){E.value=!0}Y({show:X});const K=S;return(q,o)=>(z(),j(e(me),{show:E.value,"onUpdate:show":o[12]||(o[12]=A=>E.value=A),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(H).modalMaxWidth}),title:"发起红包",closable:"",onClose:o[11]||(o[11]=A=>E.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(O),{type:"primary",onClick:G,disabled:e(p),loading:e(p)},{default:l(()=>[...o[30]||(o[30]=[i("提交",-1)])]),_:1},8,["disabled","loading"]),t(e(O),{onClick:o[10]||(o[10]=A=>E.value=!1)},{default:l(()=>[...o[31]||(o[31]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[Z("div",null,[t(e(J),{depth:3},{default:l(()=>[...o[13]||(o[13]=[i("温馨提示：",-1)])]),_:1}),e(H).isOctober1st?(z(),j(e(J),{key:1},{default:l(()=>[o[16]||(o[16]=Z("del",null,"在红包总额以外，会追加扣除7%手续费。",-1)),o[17]||(o[17]=Z("br",null,null,-1)),o[18]||(o[18]=i(" 10月1日“红包个数”在20个及以上时，手续费",-1)),t(e(J),{type:"error"},{default:l(()=>[...o[15]||(o[15]=[i("0%!!",-1)])]),_:1})]),_:1})):(z(),j(e(J),{key:0},{default:l(()=>[...o[14]||(o[14]=[i(" 在红包总额以外，会追加扣除7%手续费。",-1)])]),_:1}))]),Z("div",null,[t(e(J),{depth:3},{default:l(()=>[...o[19]||(o[19]=[i("总共扣除：",-1)])]),_:1}),t(e(J),{type:"warning"},{default:l(()=>[i(se(I.value),1)]),_:1}),o[20]||(o[20]=i("个奥利奥 ",-1))]),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...o[21]||(o[21]=[i("红包类型",-1)])]),_:1}),t(e(Ce),{value:$.value,"onUpdate:value":o[0]||(o[0]=A=>$.value=A),options:T},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...o[22]||(o[22]=[i("olo类型",-1)])]),_:1}),t(e(Ce),{value:b.value,"onUpdate:value":o[1]||(o[1]=A=>b.value=A),options:U},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...o[23]||(o[23]=[i("红包个数",-1)])]),_:1}),t(e(we),{value:m.value,"onUpdate:value":o[2]||(o[2]=A=>m.value=A),max:50,min:5,step:5},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...o[24]||(o[24]=[i("olo总额",-1)])]),_:1}),t(e(we),{value:w.value,"onUpdate:value":o[3]||(o[3]=A=>w.value=A),max:1e6,min:3e3,step:1e3,parse:e(Xe),format:e(Ye)},null,8,["value","parse","format"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...o[25]||(o[25]=[i("红包口令",-1)])]),_:1}),t(e(ee),{value:M.value,"onUpdate:value":o[4]||(o[4]=A=>M.value=A),placeholder:"必填"},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...o[26]||(o[26]=[i("红包封面",-1)])]),_:1}),t(e(ee),{value:f.value,"onUpdate:value":o[5]||(o[5]=A=>f.value=A),placeholder:"（可选）填写图片的完整网址"},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...o[27]||(o[27]=[i("口令提示",-1)])]),_:1}),t(e(ee),{value:L.value,"onUpdate:value":o[6]||(o[6]=A=>L.value=A),placeholder:"抢答红包或者暗号红包时，必填"},null,8,["value"])]),_:1}),(z(!0),le(ve,null,ke(v.value,A=>(z(),j(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...o[28]||(o[28]=[i("回复留言",-1)])]),_:1}),t(e(ee),{value:d.value[A-1],"onUpdate:value":fe=>d.value[A-1]=fe,placeholder:`#${A}（可选） 多个留言时随机抽取一个`,maxlength:255},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024))),256)),t(e(N),{size:"small",align:"center"},{default:l(()=>[t(e(J),{depth:3},{default:l(()=>[...o[29]||(o[29]=[i("留言数量",-1)])]),_:1}),t(e(Re),{size:"tiny",circle:"",disabled:v.value===5,onClick:o[7]||(o[7]=A=>n(1))},{icon:l(()=>[t(e(ue),null,{default:l(()=>[t(e(Qe))]),_:1})]),_:1},8,["disabled"]),t(e(Re),{size:"tiny",circle:"",disabled:v.value===1,onClick:o[8]||(o[8]=A=>{n(-1)})},{icon:l(()=>[t(e(ue),null,{default:l(()=>[t(e(Ze))]),_:1})]),_:1},8,["disabled"]),t(e(et),{checked:y.value,"onUpdate:checked":o[9]||(o[9]=A=>y.value=A),label:"隐藏olo总额",style:{"margin-left":"auto"}},null,8,["checked"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),jt=ae({__name:"ImageUpload",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(F,{emit:Y}){const S=ne(),H=ie(),r=c(null),k=F,T=Y,U=["mjj","imgbb","freeimage","picgo","tutu"],w=["imge","imgtbl","imgimg","helloimg","picui","imgwang"],m=W(()=>k.forumId===419?0:U.includes(S.userCustom.imgHost)?1:w.includes(S.userCustom.imgHost)?2:1),b=c(!1),$=({file:f,data:I,headers:v,withCredentials:n,action:p,onFinish:u,onError:_,onProgress:G})=>{var E;if(f.file!==null){if(f.file.size>1024e3){window.$message.error("图片大小不能超过10M喔"),(E=r.value)==null||E.clear();return}const X={binggan:H.binggan,file:f.file,mode:"img",thread_id:k.threadId,forum_id:k.forumId};b.value=!0,Oe(X).then(K=>{var q;T("insertImage",K.file_url),(q=r.value)==null||q.clear(),b.value=!1}).catch(()=>{var K;(K=r.value)==null||K.clear(),b.value=!1})}};function M(f){var I=document.getElementsByTagName("body")[0],v=document.createElement("script");v.setAttribute("id","image-upload-js");var n=document.getElementById("upload-button");f=="mjj"&&(v.setAttribute("async","true"),v.setAttribute("data-mode","manual"),v.setAttribute("src","https://mjj.today/sdk/pup.js"),v.setAttribute("data-url","https://mjj.today/upload"),v.setAttribute("data-auto-insert","html-embed"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),f=="imgbb"&&(v.setAttribute("async","true"),v.setAttribute("data-mode","manual"),v.setAttribute("src","https://imgbb.com/upload.js"),v.setAttribute("data-url","https://imgbb.com/upload"),v.setAttribute("data-auto-insert","html-embed-medium"),n==null||n.setAttribute("data-imgbb-trigger","")),f=="freeimage"&&(v.setAttribute("async","true"),v.setAttribute("data-mode","manual"),v.setAttribute("src","https://freeimage.host/sdk/pup.js"),v.setAttribute("data-url","https://freeimage.host/upload"),v.setAttribute("data-auto-insert","html-embed-medium"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),f=="picgo"&&(v.setAttribute("async","true"),v.setAttribute("data-mode","manual"),v.setAttribute("src","https://www.picgo.net/sdk/pup.js"),v.setAttribute("data-url","https://www.picgo.net/upload"),v.setAttribute("data-auto-insert","html-embed"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),I.appendChild(v)}const L=W(()=>({imge:"https://imge.cc/api/v1/upload",imgtbl:"https://imgtbl.com/api/v1/upload",imgimg:"https://imgimg.cc/api/v1/upload",helloimg:"https://www.helloimg.com/api/v1/upload",picui:"https://picui.cn/api/v1/upload",imgwang:"https://img.wang/api/v1/upload"})[S.userCustom.imgHost]||""),d=({file:f,data:I,headers:v,withCredentials:n,action:p,onFinish:u,onError:_,onProgress:G})=>{if(f.file!==null){const E={file:f.file,url:L.value};b.value=!0,gt(E).then(X=>{var K;console.log(X.data),X.status===!0?T("insertImage",X.data.links.url):window.$message.error(X.message),(K=r.value)==null||K.clear(),b.value=!1}).catch(()=>{var X;(X=r.value)==null||X.clear(),b.value=!1})}};function y(){const f=document.getElementById("image-upload-js");f==null||f.remove()}return We(()=>{U.includes(S.userCustom.imgHost)&&M(S.userCustom.imgHost)}),tt(()=>{y()}),(f,I)=>(z(),le(ve,null,[m.value===0?(z(),j(e(He),{key:0,accept:"image/*","custom-request":$,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:r},{default:l(()=>[t(e(O),{style:{"margin-right":"auto"},disabled:f.userIsLocked,loading:b.value},{default:l(()=>[...I[0]||(I[0]=[i("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):te("",!0),m.value===1?(z(),j(e(O),{key:1,style:{"margin-right":"auto"},disabled:f.userIsLocked,"data-target":"#content-input",id:"upload-button"},{default:l(()=>[...I[1]||(I[1]=[i("上传图片",-1)])]),_:1},8,["disabled"])):te("",!0),m.value===2?(z(),j(e(He),{key:2,accept:"image/*","custom-request":d,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:r},{default:l(()=>[t(e(O),{style:{"margin-right":"auto"},disabled:f.userIsLocked,loading:b.value},{default:l(()=>[...I[2]||(I[2]=[i("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):te("",!0)],64))}}),Nt=ae({__name:"PingbiciModal",setup(F,{expose:Y}){const S=ne(),H=ie(),r=c(),{loading:k,send:T,onSuccess:U}=ge($=>ct($),{immediate:!1});function w(){if(!r.value){window.$message.error("请填写屏蔽词");return}const $={binggan:H.binggan,content_pingbici:r.value};T($)}U(()=>{H.refreshUserData(),m.value=!1});const m=c(!1);function b(){m.value=!0}return Y({show:b}),($,M)=>(z(),j(e(me),{show:m.value,"onUpdate:show":M[3]||(M[3]=L=>m.value=L),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(S).modalMaxWidth}),title:"追加屏蔽词",closable:"",onClose:M[2]||(M[2]=L=>m.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(O),{type:"primary",onClick:w,loading:e(k),disabled:!r.value||e(k)},{default:l(()=>[...M[6]||(M[6]=[i("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(O),{onClick:M[1]||(M[1]=L=>m.value=!1)},{default:l(()=>[...M[7]||(M[7]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...M[4]||(M[4]=[i("暂时只做了“内容屏蔽词”的追加",-1)])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"4.2rem"}},{default:l(()=>[...M[5]||(M[5]=[i("屏蔽词",-1)])]),_:1}),t(e(ee),{value:r.value,"onUpdate:value":M[0]||(M[0]=L=>r.value=L),maxlength:20,"show-count":"",onKeyup:ce(w,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ft=ae({__name:"PostInput",props:{mode:{},disabled:{type:Boolean},handling:{type:Boolean},forumId:{default:0},threadId:{default:0},randomHeadsGroup:{default:1}},emits:["contentCommit","refreshPostsList"],setup(F,{expose:Y,emit:S}){const H=ie(),r=ne(),k=c(null),T=c(null),U=c(null),w=c(null),m=c(null),b=c(null),$=c(null),M=F,L=W(()=>({fontSize:r.userCustom.fontSizeInput+"px",borderRadius:"10px"})),d=W(()=>{const h=(n.value.match(/\r?\n|\r/g)||[]).length+2;return h<5?5:h>10?10:h}),y=W(()=>H.userData.binggan.locked_ttl>0?`你的饼干封禁中，将于${Math.floor(H.userData.binggan.locked_ttl/3600)+1}小时后解封`:"正文内容"),f=W(()=>H.userData.binggan.locked_ttl>0),I=c(H.userData.binggan.nickname||"= ="),v=c(""),n=c(""),p=c(!1),u=c(!1);function _(){I.value=H.userData.binggan.nickname||"= =",v.value="",n.value="",p.value=!1,u.value=!1}const G=W(()=>({id:0,created_at:"预览模式",is_deleted:0,thread_id:0,battle_id:null,hongbao_id:null,floor:0,random_head:1,created_by_admin:0,content:n.value,nickname:I.value,is_your_post:!0,hongbao_data:null})),E=W(()=>({class:{"nickname-input":!0,admin:u.value}})),X=c(!1),K=lt("emoji_auto_hide",!1);function q(){let h=[ye(xe,{checked:X.value,"onUpdate:checked":a=>X.value=a,label:"实时预览"}),ye(xe,{checked:K.value,"onUpdate:checked":a=>K.value=a,label:"表情包自动收起"})];return H.userData.binggan.admin!==0&&H.checkAdminForums(M.forumId)&&h.push(ye(xe,{checked:u.value,"onUpdate:checked":a=>u.value=a,label:"管理员"})),ye(N,{style:"padding:6px 8px",vertical:!0},()=>h)}const o=[{key:"funcOption",type:"render",render:q}],A=[{label:"涂鸦板",key:"draw",icon:Ee(mt,{size:"1.5rem"})},{label:"屏蔽词",key:"mute",icon:Ee(ft,{size:"1.5rem"})}];function fe(h){var a,D;switch(h){case"mute":(a=m.value)==null||a.show();break;case"draw":(D=$.value)==null||D.show();break}}Ae(u,h=>I.value=h?"管理员":"= =");function Ie(h){return h.selectionStart!=null?h.selectionStart:0}function Te(h,a){const D=Ie(h),V=h.value,Ge=V.substring(0,D)+a+V.substring(D);n.value=Ge,setTimeout(()=>{h.selectionStart=D+a.length,h.selectionEnd=D+a.length},0)}function he(h){const a=document.getElementById("content-input");Te(a,h),be(),a.focus()}function $e(){ht({title:"要清空内容吗？",onPositiveClick:()=>n.value=""})}const oe=c([""]);function pe(){oe.value.length>1&&(oe.value.pop(),n.value=oe.value.slice(-1)[0])}function be(){var h;oe.value.push((h=n.value)!=null?h:""),oe.value.length>20&&oe.value.shift()}function g(h,a){he(`<img src='${h}' class='${a?"custom-emoji-img":"emoji-img"}'>`)}function s(h){he(h)}function C(h){he(`<img src='${h}' />`)}function x(h){var a;n.value=h,be(),(a=k.value)==null||a.focus()}const P=S;function Me(h){if(!h.isTrusted){const D={title:"错误",closable:!1,content:"请不要用脚本回复喔，可能会被系统判断为脚本并碎饼干。",positiveText:"确定"};window.$dialog.warning(D);return}new Promise(function(D,V){P("contentCommit",{contentInput:n.value,nicknameInput:I.value,postWithAdmin:u.value,titleInput:v.value,isDelay:p.value,ist:h.isTrusted},D)}).then(Fe)}function Fe(){v.value="",n.value="",p.value=!1}const _e=c(!1);return Y({quoteHandle:x,isTyping:_e,resetInput:_}),(h,a)=>(z(),j(e(N),{vertical:""},{default:l(()=>[X.value?(z(),le(ve,{key:0},[h.mode==="thread"?(z(),j(e(de),{class:"thread-title-container",size:"small",key:"title-card"},{default:l(()=>[Z("span",{class:"thread-title",style:Q({fontSize:e(r).userCustom.fontSizeThreadList+"px"})},se(v.value||"标题预览")+" [0] ",5)]),_:1})):te("",!0),t(Mt,{"post-data":G.value,"forum-id":0,"preview-mode":!0},null,8,["post-data"])],64)):te("",!0),t(e(N),{size:"small",wrap:!1,align:"center",style:Q({paddingRight:e(r).isMobile?"24px":"0px"})},{default:l(()=>[t(e(B),{style:{"max-width":"300px"}},{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...a[15]||(a[15]=[i("昵称",-1)])]),_:1}),t(e(ee),{maxlength:30,value:I.value,"onUpdate:value":a[0]||(a[0]=D=>I.value=D),"show-count":"","input-props":E.value},null,8,["value","input-props"])]),_:1}),t(e(je),{trigger:e(r).isMobile?"click":"hover",options:o,placement:"bottom-start"},{default:l(()=>[t(e(O),{size:"medium",style:{"flex-shrink":"0"},secondary:!1},{default:l(()=>[...a[16]||(a[16]=[i("功能",-1)])]),_:1})]),_:1},8,["trigger"])]),_:1},8,["style"]),h.mode==="thread"?(z(),j(e(B),{key:1},{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...a[17]||(a[17]=[i("标题",-1)])]),_:1}),t(e(ee),{maxlength:100,value:v.value,"onUpdate:value":a[1]||(a[1]=D=>v.value=D),"show-count":"",placeholder:"标题内容"},null,8,["value"])]),_:1})):te("",!0),t(Bt,{"auto-hide":e(K),"random-heads-group":h.randomHeadsGroup,onAppendEmoji:g},null,8,["auto-hide","random-heads-group"]),t(e(N),{size:e(r).isMobile?"small":"medium",justify:"end",align:"center",style:Q({paddingRight:e(r).isMobile?"24px":"0px"})},{default:l(()=>[t(e(je),{trigger:"click",options:A,onSelect:fe,size:e(r).isMobile?"medium":"large"},{default:l(()=>[t(e(ue),{size:e(r).isMobile?20:24,style:{cursor:"pointer"}},{default:l(()=>[t(e(at))]),_:1},8,["size"])]),_:1},8,["size"]),h.mode==="post"?(z(),j(e(re),{key:0,placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ue),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(nt),{style:{cursor:"pointer"},onClick:a[2]||(a[2]=D=>{var V;return(V=T.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:l(()=>[a[18]||(a[18]=i(" 发红包 ",-1))]),_:1},8,["trigger"])):te("",!0),h.mode==="post"?(z(),j(e(re),{key:1,placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ue),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(ot),{style:{cursor:"pointer"},onClick:a[3]||(a[3]=D=>{var V;return(V=U.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:l(()=>[a[19]||(a[19]=i(" 大乱斗 ",-1))]),_:1},8,["trigger"])):te("",!0),h.mode==="post"?(z(),j(e(re),{key:2,placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ue),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(ut),{style:{cursor:"pointer"},onClick:a[4]||(a[4]=D=>{var V;return(V=w.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:l(()=>[a[20]||(a[20]=i(" Roll点 ",-1))]),_:1},8,["trigger"])):te("",!0),t(e(re),{placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ue),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(st),{style:{cursor:"pointer"},onClick:a[5]||(a[5]=D=>{var V;return(V=b.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:l(()=>[a[21]||(a[21]=i(" 快捷代码 ",-1))]),_:1},8,["trigger"]),t(e(it),{vertical:""}),t(e(re),{placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ue),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(rt),{style:{cursor:"pointer"},onClick:pe})]),_:1},8,["size"])]),default:l(()=>[a[22]||(a[22]=i(" 撤销 ",-1))]),_:1},8,["trigger"]),t(e(re),{placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ue),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(dt),{style:{cursor:"pointer"},onClick:$e})]),_:1},8,["size"])]),default:l(()=>[a[23]||(a[23]=i(" 清空 ",-1))]),_:1},8,["trigger"])]),_:1},8,["size","style"]),t(e(vt),{value:n.value,"onUpdate:value":a[6]||(a[6]=D=>n.value=D),type:"textarea",placeholder:y.value,rows:d.value,ref_key:"contentInputDom",ref:k,style:Q(L.value),"input-props":{id:"content-input"},disabled:f.value,onChange:be,onKeyup:a[7]||(a[7]=ce(Ue(D=>Me(D),["ctrl"]),["enter"])),onBlur:a[8]||(a[8]=D=>_e.value=!1),onFocus:a[9]||(a[9]=D=>_e.value=!0)},null,8,["value","placeholder","rows","style","disabled"]),t(e(N),{justify:"end",align:"center"},{default:l(()=>[t(jt,{"user-is-locked":f.value,"forum-id":h.forumId,"thread-id":h.threadId,onInsertImage:C},null,8,["user-is-locked","forum-id","thread-id"]),h.mode==="thread"?(z(),j(e(re),{key:0,placement:"bottom-start",trigger:"hover",disabled:e(r).isMobile},{trigger:l(()=>[t(e(xe),{checked:p.value,"onUpdate:checked":a[10]||(a[10]=D=>p.value=D)},{default:l(()=>[...a[24]||(a[24]=[i("延时发送",-1)])]),_:1},8,["checked"])]),default:l(()=>[a[25]||(a[25]=i(" 第二天8点自动发出 ",-1))]),_:1},8,["disabled"])):te("",!0),t(e(re),{placement:"bottom-start",trigger:"hover",disabled:e(r).isMobile},{trigger:l(()=>[t(e(O),{type:"primary",onClick:a[11]||(a[11]=D=>Me(D)),loading:h.handling,disabled:h.handling||f.value},{default:l(()=>[...a[26]||(a[26]=[i("提交",-1)])]),_:1},8,["loading","disabled"])]),default:l(()=>[a[27]||(a[27]=i(" 可以Ctrl+Enter ",-1))]),_:1},8,["disabled"])]),_:1}),t(Rt,{ref_key:"HongbaoModalCom",ref:T,"thread-id":h.threadId,"forum-id":h.forumId,onRefreshPostsList:a[12]||(a[12]=D=>P("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(_t,{ref_key:"BattleModalCom",ref:U,"thread-id":h.threadId,"forum-id":h.forumId,"random-heads-group":h.randomHeadsGroup,onRefreshPostsList:a[13]||(a[13]=D=>P("refreshPostsList"))},null,8,["thread-id","forum-id","random-heads-group"]),t(xt,{ref_key:"RollModalCom",ref:w,"thread-id":h.threadId,"forum-id":h.forumId,onRefreshPostsList:a[14]||(a[14]=D=>P("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(Nt,{ref_key:"PingbiciModalCom",ref:m},null,512),t(Dt,{ref_key:"CodeModalCom",ref:b,onInsertCode:s},null,512),t(Lt,{ref_key:"DrawerModalCom",ref:$,onInsertImage:C,"user-is-locked":f.value,"forum-id":h.forumId,"thread-id":h.threadId},null,8,["user-is-locked","forum-id","thread-id"])]),_:1}))}});export{Ft as _,$t as a};
