import{n as ae,l as O,t as g,g as pe,p as N,j as U,q as e,D as me,x as l,E as t,F as de,H as Q,I as E,S as J,L as i,P as se,M as j,av as we,ao as Ke,i as le,K as te,O as ce,am as Le,a_ as Ce,a2 as Pe,a3 as Se,a1 as We,b5 as Ue,J as Z,b6 as Ae,aU as Be,a$ as qe,aY as ze,aD as Ve,Q as ve,w as ke,b3 as Je,b4 as Re,m as ye,B as je,N as oe,b1 as Qe,b2 as Ze,C as et,al as tt,u as lt,a4 as _e,aO as at,R as re,b7 as nt,b8 as ut,b9 as ot,ba as st,aZ as it,bb as rt,bc as dt,z as vt,bd as mt,be as ft}from"./vendor-CSO85mTd.js";import{u as ne,a as ie,e as _,c as ee,b as Y,i as Ne,w as gt,j as Oe,k as pt,p as ct,r as Ee,d as Me}from"./app-wVYcDB9I.js";import{s as ht}from"./showDialog-BvWCiN3E.js";import{b as bt,c as yt,d as He,e as wt,g as Ct,f as kt,i as xt,_ as It}from"./emojiData-D2riSHOo.js";import{i as Ye,a as Xe}from"./inputNumberFormat-BPxWRFt_.js";const Mt=ae({__name:"RollModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(x,{expose:X,emit:R}){const A=ne(),r=ie(),C=x,$=O(()=>{let v=[];if(m.value>0&&c.value>0){for(var n=0;n<m.value;n++)v[n]=Math.floor(Math.random()*c.value)+1;return v.join()}else return null}),L=g(),y=g(),m=g(1),c=g(100),D=g(!1);function I(){D.value=!0}X({show:I});const S=R,{loading:d,send:b,onSuccess:h}=pe(v=>bt(v),{immediate:!1});function k(){if(!m.value){window.$message.error("请填写骰子数量");return}if(!c.value){window.$message.error("请填写骰子数量");return}const v={binggan:r.binggan,thread_id:C.threadId,forum_id:C.forumId,roll_name:L.value,roll_event:y.value,roll_num:m.value,roll_range:c.value};b(v)}return h(()=>{S("refreshPostsList"),D.value=!1}),(v,n)=>(U(),N(e(me),{show:D.value,"onUpdate:show":n[6]||(n[6]=f=>D.value=f),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(A).modalMaxWidth}),title:"Roll点",closable:"",onClose:n[5]||(n[5]=f=>D.value=!1),size:"small"},{action:l(()=>[t(e(E),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:k,disabled:e(d)},{default:l(()=>[...n[12]||(n[12]=[i("Roll it!",-1)])]),_:1},8,["disabled"]),t(e(Y),{onClick:n[4]||(n[4]=f=>D.value=!1)},{default:l(()=>[...n[13]||(n[13]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(E),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...n[7]||(n[7]=[i(" 输出参考： ",-1)])]),_:1}),t(e(J),null,{default:l(()=>[i(se(L.value?`「${L.value}」，`:"")+" "+se(y.value?`「${y.value}」的结果：`:"")+" "+se(`${m.value} d ${c.value} = 「${$.value}」`),1)]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[8]||(n[8]=[i("Roll点昵称",-1)])]),_:1}),t(e(ee),{placeholder:"可留空",maxlength:100,value:L.value,"onUpdate:value":n[0]||(n[0]=f=>L.value=f)},null,8,["value"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[9]||(n[9]=[i("Roll点事件",-1)])]),_:1}),t(e(ee),{placeholder:"可留空",maxlength:100,value:y.value,"onUpdate:value":n[1]||(n[1]=f=>y.value=f)},null,8,["value"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[10]||(n[10]=[i("骰子数量",-1)])]),_:1}),t(e(we),{max:100,min:1,placeholder:"必须填写",value:m.value,"onUpdate:value":n[2]||(n[2]=f=>m.value=f)},null,8,["value"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[11]||(n[11]=[i("骰子大小",-1)])]),_:1}),t(e(we),{max:1e4,min:1,placeholder:"必须填写",value:c.value,"onUpdate:value":n[3]||(n[3]=f=>c.value=f)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Tt=["src"],$t=ae({__name:"CaptchaModal",emits:["waterUnlockOnSuccess"],setup(x,{expose:X,emit:R}){const A=ne(),r=ie(),C=g(),$=O(()=>c.value.captcha_key),L=g(!1);function y(){L.value=!0,I()}X({show:y});const m=R,{data:c,loading:D,send:I}=pe(Ne,{immediate:!1}),{fetch:S}=Ke();function d(){S(Ne())}const{loading:b,send:h,onSuccess:k,onError:v}=pe(f=>gt(f),{immediate:!1});function n(){if(!C.value){window.$message.error("验证码不能为空");return}const f={binggan:r.binggan,captcha_code:C.value,captcha_key:$.value};h(f),k(()=>{C.value="",L.value=!1,m("waterUnlockOnSuccess")}),v(()=>{C.value="",d()})}return(f,o)=>(U(),N(e(me),{show:L.value,"onUpdate:show":o[3]||(o[3]=z=>L.value=z),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(A).modalMaxWidth}),title:"验证码",closable:"",onClose:o[2]||(o[2]=z=>L.value=!1),size:"small"},{action:l(()=>[t(e(E),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:n,loading:e(b),disabled:e(b)},{default:l(()=>[...o[7]||(o[7]=[i("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(Y),{onClick:o[1]||(o[1]=z=>L.value=!1)},{default:l(()=>[...o[8]||(o[8]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(E),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...o[4]||(o[4]=[i(" 嗷……你可能刷太多了，休息一下吧。 ",-1)])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"3.2rem"},class:"round"},{default:l(()=>[...o[5]||(o[5]=[i("输入",-1)])]),_:1}),t(e(ee),{placeholder:"请输入验证码",maxlength:"4","show-count":"",value:C.value,"onUpdate:value":o[0]||(o[0]=z=>C.value=z),onKeyup:ce(n,["enter"])},null,8,["value"])]),_:1}),e(D)?te("",!0):(U(),le("img",{key:0,src:"data:image/png;base64,"+e(c).captcha_img,style:{"max-width":"200px"},onClick:d},null,8,Tt)),t(e(J),null,{default:l(()=>[...o[6]||(o[6]=[i(" 点击可更换验证码。不区分大小写。 ",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Dt=ae({__name:"BattleModal",props:{threadId:{},forumId:{},randomHeadsGroup:{}},emits:["refreshPostsList"],setup(x,{expose:X,emit:R}){const A=ne(),r=ie(),C=g(null),$=x,L=O(()=>{const f=[{value:1,label:"共通",available:!0}];return yt.forEach(o=>{o.value===$.randomHeadsGroup&&f.push(o)}),f}),y=O(()=>{const f=He[c.value-1];if(c.value===1){const o=r.userData.my_battle_chara.filter(z=>!z.not_use).map((z,G)=>({value:G+240,label:z.name}));return f.concat(o)}else return f}),m=g(1),c=g($.randomHeadsGroup),D=g(100);Le(c,f=>{f===1?m.value=He[f-1][8].value:m.value=He[f-1][0].value},{immediate:!0});const{loading:I,send:S,onSuccess:d,onError:b}=pe(f=>wt(f),{immediate:!1});function h(f){var W;const{timestamp:o,newPostKey:z}=Ct((W=f==null?void 0:f.isTrusted)!=null?W:!0,$.threadId,r.binggan),G={binggan:r.binggan,forum_id:$.forumId,thread_id:$.threadId,battle_olo:D.value,chara_id:m.value>=240?m.value-240:m.value,is_custom_chara:m.value>=240,chara_group:c.value-1,new_post_key:z,timestamp:o};S(G)}d(()=>{n("refreshPostsList"),k.value=!1}),b(f=>{var o;f.error.cause!==void 0&&f.error.cause.code===244291&&((o=C.value)==null||o.show())});const k=g(!1);function v(){k.value=!0}X({show:v});const n=R;return(f,o)=>(U(),N(e(me),{show:k.value,"onUpdate:show":o[5]||(o[5]=z=>k.value=z),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(A).modalMaxWidth}),title:"表情包大乱斗！",closable:"",onClose:o[4]||(o[4]=z=>k.value=!1),size:"small"},{action:l(()=>[t(e(E),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:h,loading:e(I)},{default:l(()=>[...o[10]||(o[10]=[i("提交",-1)])]),_:1},8,["loading"]),t(e(Y),{onClick:o[3]||(o[3]=z=>k.value=!1)},{default:l(()=>[...o[11]||(o[11]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(E),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...o[6]||(o[6]=[i("小斗怡情，大斗伤身，强斗奥飞湮灭",-1)])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"3.2rem"}},{default:l(()=>[...o[7]||(o[7]=[i("主题",-1)])]),_:1}),t(e(Ce),{value:c.value,"onUpdate:value":o[0]||(o[0]=z=>c.value=z),options:L.value},null,8,["value","options"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"3.2rem"}},{default:l(()=>[...o[8]||(o[8]=[i("角色",-1)])]),_:1}),t(e(Ce),{value:m.value,"onUpdate:value":o[1]||(o[1]=z=>m.value=z),options:y.value},null,8,["value","options"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"3.2rem"}},{default:l(()=>[...o[9]||(o[9]=[i("下注",-1)])]),_:1}),t(e(we),{value:D.value,"onUpdate:value":o[2]||(o[2]=z=>D.value=z),max:1e6,min:1,step:100,parse:e(Xe),format:e(Ye),onKeyup:ce(h,["enter"])},null,8,["value","parse","format"])]),_:1})]),_:1}),t($t,{ref_key:"CaptchaModalCom",ref:C,onWaterUnlockOnSuccess:h},null,512)]),_:1},8,["style"])]),_:1},8,["show"]))}}),zt=ae({__name:"CodeModal",emits:["insertCode"],setup(x,{expose:X,emit:R}){const A=ne(),r=g(0),C=g(),$=g(),L=[{value:0,label:"折叠内容"},{value:1,label:"超链接"},{value:2,label:"图片"},{value:3,label:"删除线"}],y=O(()=>[{prepend_1:"显示内容",prepend_2:"隐藏内容",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"显示内容",inputDefault_2:"隐藏内容",insertText:`<details><summary>${C.value}</summary>${$.value}</details>`},{prepend_1:"显示文字",prepend_2:"链接网址",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"点我跳转",inputDefault_2:"",insertText:`<a href="${$.value}">${C.value}</a>`},{prepend_1:"图片链接",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<img src="${C.value}">`},{prepend_1:"删除文字",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<del>${C.value}</del>`}]);Le(r,()=>{C.value=y.value[r.value].inputDefault_1,$.value=y.value[r.value].inputDefault_2},{immediate:!0});function m(){I("insertCode",y.value[r.value].insertText),C.value=y.value[r.value].inputDefault_1,$.value=y.value[r.value].inputDefault_2,c.value=!1}const c=g(!1);function D(){c.value=!0}X({show:D});const I=R;return(S,d)=>(U(),N(e(me),{show:c.value,"onUpdate:show":d[5]||(d[5]=b=>c.value=b),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(A).modalMaxWidth}),title:"快捷代码",closable:"",onClose:d[4]||(d[4]=b=>c.value=!1),size:"small"},{action:l(()=>[t(e(E),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:m},{default:l(()=>[...d[8]||(d[8]=[i("插入",-1)])]),_:1}),t(e(Y),{onClick:d[3]||(d[3]=b=>c.value=!1)},{default:l(()=>[...d[9]||(d[9]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(E),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...d[6]||(d[6]=[i("代码预览：",-1)])]),_:1}),t(e(J),null,{default:l(()=>[i(se(y.value[r.value].insertText),1)]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...d[7]||(d[7]=[i("代码内容",-1)])]),_:1}),t(e(Ce),{value:r.value,"onUpdate:value":d[0]||(d[0]=b=>r.value=b),options:L},null,8,["value"])]),_:1}),Pe(t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[i(se(y.value[r.value].prepend_1),1)]),_:1}),t(e(ee),{value:C.value,"onUpdate:value":d[1]||(d[1]=b=>C.value=b),onKeyup:ce(m,["enter"])},null,8,["value"])]),_:1},512),[[Se,y.value[r.value].inputEnable_1]]),Pe(t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[i(se(y.value[r.value].prepend_2),1)]),_:1}),t(e(ee),{value:$.value,"onUpdate:value":d[2]||(d[2]=b=>$.value=b),onKeyup:ce(m,["enter"])},null,8,["value"])]),_:1},512),[[Se,y.value[r.value].inputEnable_2]])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ht=["width","height"],Ut=["width","height"],At=["onClick"],Lt=["title","innerHTML","onClick"],Pt=ae({__name:"DrawerModal",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(x,{expose:X,emit:R}){const A=ie();ne();const r=x,C=g(!1);function $(){C.value=!0}X({show:$});const L=R,y=g(),m=O(()=>{var p;return(p=y.value)==null?void 0:p.getContext("2d")}),c=g(),D=O(()=>{var p;return(p=c.value)==null?void 0:p.getContext("2d")}),I=new Image;let S=!1;const d={x:0,y:0,width:0,height:0},b=g([]),h=g([]),k=g([]),v=g({lineWidth:3,lineColor:"#111111",shadowBlur:1}),n=g(!1),f=g(!1);let o=0,z=0;const G=O(()=>window.innerWidth>836?796:window.innerWidth-36),W=O(()=>window.innerHeight>580?400:window.innerHeight-212),F=O(()=>[{title:"上一步",action:"prev",className:b.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>'},{title:"下一步",action:"next",className:h.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/></svg>'},{title:"橡皮擦",action:"eraser",className:b.value.length||h.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"/></svg>'},{title:"清除",action:"clear",className:b.value.length||h.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/><path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/></svg>'},{title:"拖动背景",action:"drag",className:f.value?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor"  viewBox="0 0 16 16"> <path d="M6.75 1a.75.75 0 0 1 .75.75V8a.5.5 0 0 0 1 0V5.467l.086-.004c.317-.012.637-.008.816.027.134.027.294.096.448.182.077.042.15.147.15.314V8a.5.5 0 1 0 1 0V6.435a4.9 4.9 0 0 1 .106-.01c.316-.024.584-.01.708.04.118.046.3.207.486.43.081.096.15.19.2.259V8.5a.5.5 0 0 0 1 0v-1h.342a1 1 0 0 1 .995 1.1l-.271 2.715a2.5 2.5 0 0 1-.317.991l-1.395 2.442a.5.5 0 0 1-.434.252H6.035a.5.5 0 0 1-.416-.223l-1.433-2.15a1.5 1.5 0 0 1-.243-.666l-.345-3.105a.5.5 0 0 1 .399-.546L5 8.11V9a.5.5 0 0 0 1 0V1.75A.75.75 0 0 1 6.75 1zM8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v5.34l-1.2.24a1.5 1.5 0 0 0-1.196 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.271-2.715a2 2 0 0 0-1.99-2.199h-.581a5.114 5.114 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.632 2.632 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002zm2.094 2.025z"/></svg>'}]),K=[{lineWidth:3,innerHTML:"🖌️",font_size:12},{lineWidth:6,innerHTML:"🖌️",font_size:16},{lineWidth:12,innerHTML:"🖌️",font_size:20}];function q(){const p=new ImageData(G.value,W.value);k.value.push(p)}We(()=>{q()});function u(){m.value.lineWidth=v.value.lineWidth,m.value.shadowBlur=v.value.shadowBlur,m.value.shadowColor=v.value.lineColor,m.value.strokeStyle=v.value.lineColor,m.value.lineCap="round",m.value.lineJoin="round"}function P(p){if(S)if(f.value){const s=p.target;let w,M;p instanceof MouseEvent?(w=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(w=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),c.value.height=c.value.height;let B={x:d.x+(w-o),y:d.y+(M-z),width:d.width,height:d.height};ue(I,B)}else{m.value.beginPath(),m.value.moveTo(o,z);const s=p.target;let w,M;p instanceof MouseEvent?(w=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(w=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),m.value.globalCompositeOperation=n.value?"destination-out":"source-over",m.value.lineTo(w,M),[o,z]=[w,M],m.value.stroke()}}function fe(p){if(f.value){const s=p.target;let w,M;p instanceof MouseEvent?(w=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(w=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),d.x+=w-o,d.y+=M-z,S=!1}else{const s=m.value.getImageData(0,0,y.value.width,y.value.height);h.value.length?(k.value=[],k.value=k.value.concat(b.value),k.value.push(s),h.value=[]):k.value.push(s),S=!1}}function xe(p){if(f.value){const s=p.target;let w,M;p instanceof MouseEvent?(w=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(w=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),o=w,z=M,S=!0}else{S=!0;const s=p.target;let w,M;p instanceof MouseEvent?(w=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(w=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),u(),o=w,z=M;const B=m.value.getImageData(0,0,y.value.width,y.value.height);b.value.push(B)}}function Te(p){v.value.lineWidth=p,n.value=!1,f.value=!1}function he(p){switch(p){case"prev":if(b.value.length){const s=b.value.pop(),w=k.value[b.value.length+1];h.value.push(w),m.value.putImageData(s,0,0)}break;case"next":if(h.value.length){const s=h.value.pop(),w=k.value[k.value.length-h.value.length-2];b.value.push(w),m.value.putImageData(s,0,0)}break;case"clear":m.value.clearRect(0,0,y.value.width,y.value.height),b.value=[],h.value=[],k.value=[k.value[0]];break;case"eraser":n.value=!0;break;case"drag":f.value=!0;break}}function $e(p){if(p.file.file){var s=new FileReader;s.readAsDataURL(p.file.file),s.onload=w=>{I.src=w.target.result,I.onload=function(){var M=c,B=I;d.width=B.width,d.height=B.height,B.width/B.height>=M.value.width/M.value.height?B.width>M.value.width&&(d.width=M.value.width,d.height=B.height*M.value.width/B.width):B.height>M.value.height&&(d.width=B.width*M.value.height/B.height,d.height=M.value.height),ue(B,d)}}}}function ue(p,s){D.value.drawImage(p,s.x,s.y,s.width,s.height)}const ge=g(!1);function be(){let p=new Image;p.src=y.value.toDataURL("image/png"),p.onload=()=>{D.value.drawImage(p,0,0),s(c.value)};function s(M){M.toBlob(B=>{B&&w(B)},"image/png")}function w(M){const B={binggan:A.binggan,file:M,mode:"draw",thread_id:r.threadId,forum_id:r.forumId};ge.value=!0,Oe(B).then(Ie=>{L("insertImage",Ie.file_url),ge.value=!1,C.value=!1}).catch(()=>{ge.value=!1})}}return(p,s)=>(U(),N(e(me),{show:C.value,"onUpdate:show":s[5]||(s[5]=w=>C.value=w),"display-directive":"show"},{default:l(()=>[t(e(de),{style:Q({maxWidth:G.value+4+"px"}),title:"涂鸦板",closable:"",onClose:s[4]||(s[4]=w=>C.value=!1),size:"small","content-style":{padding:"0px"}},{default:l(()=>[Z("div",{id:"canvas-container",style:Q({width:G.value+"px",height:W.value+"px"})},[Z("canvas",{id:"drawer-canvas-background",ref_key:"canvasBackground",ref:c,width:G.value,height:W.value,onTouchmove:s[0]||(s[0]=Ae(()=>{},["prevent"]))},null,40,Ht),Z("canvas",{id:"drawer-canvas",ref_key:"canvas",ref:y,class:Be({painting:!f.value,dragging:f.value}),width:G.value,height:W.value,onTouchmove:[s[1]||(s[1]=Ae(()=>{},["prevent"])),P],onMousedown:xe,onMouseup:fe,onMousemove:P,onTouchstart:xe,onTouchend:fe},null,42,Ut)],4),t(e(qe),{"x-gap":"6",cols:4},{default:l(()=>[t(e(ze),{span:"1"},{default:l(()=>[s[6]||(s[6]=Z("div",null,"颜色",-1)),t(e(Ve),{value:v.value.lineColor,"onUpdate:value":s[2]||(s[2]=w=>v.value.lineColor=w),modes:["hex"],"show-alpha":!1},null,8,["value"])]),_:1}),t(e(ze),{span:"1"},{default:l(()=>[s[7]||(s[7]=Z("div",null,"画笔",-1)),t(e(E),{id:"canvas-brush",size:"small",align:"center"},{default:l(()=>[(U(),le(ve,null,ke(K,(w,M)=>Z("span",{key:M,style:Q({fontSize:w.font_size+"px"}),onClick:B=>Te(w.lineWidth)},se(w.innerHTML),13,At)),64))]),_:1})]),_:1}),t(e(ze),{span:"2"},{default:l(()=>[s[8]||(s[8]=Z("div",null,"操作",-1)),t(e(E),{id:"canvas-control",size:"small"},{default:l(()=>[(U(!0),le(ve,null,ke(F.value,(w,M)=>(U(),le("span",{key:M,title:w.title,class:Be([w.className]),innerHTML:w.innerHTML,onClick:B=>he(w.action)},null,10,Lt))),128))]),_:1})]),_:1})]),_:1})]),action:l(()=>[t(e(E),{justify:"end"},{default:l(()=>[t(e(Ue),{"default-upload":!1,onChange:$e,"show-file-list":!1},{default:l(()=>[t(e(Y),null,{default:l(()=>[...s[9]||(s[9]=[i("加载图片",-1)])]),_:1})]),_:1}),t(e(Y),{type:"primary",onClick:be,disabled:x.userIsLocked,loading:ge.value},{default:l(()=>[...s[10]||(s[10]=[i("上传",-1)])]),_:1},8,["disabled","loading"]),t(e(Y),{onClick:s[3]||(s[3]=w=>C.value=!1)},{default:l(()=>[...s[11]||(s[11]=[i("关闭",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),St=["onClick"],Bt=["src"],Rt=ae({__name:"EmojiTab",props:{randomHeadsGroup:{default:1},autoHide:{type:Boolean,default:!0}},emits:["appendEmoji"],setup(x,{emit:X}){const R=ie(),A=ne(),r=x,C=O(()=>{let d=0,b=0;return A.isMobile&&(A.userCustom.sidebarLeft?d=20:b=20),{paddingLeft:d+"px",paddingRight:b+"px"}}),$=g(),L=O(()=>{const d=kt.filter(b=>!R.userData.emoji_excluded.includes(b.id)&&(b.headsId===0||b.headsId===r.randomHeadsGroup));return R.userData.my_emoji&&d.unshift({id:0,headsId:0,name:"自定义",emojis:R.userData.my_emoji}),d}),y=X;function m(d,b){y("appendEmoji",d,b==="自定义"),r.autoHide&&($.value=-1)}let c=!1;function D(d,b){return ye("span",{onClick:()=>I(b),innerHTML:d})}function I(d){d===$.value&&(c=!0,$.value=-1)}function S(d,b){return c?(c=!1,!1):!0}return(d,b)=>(U(),N(e(Je),{type:"line","bar-width":0,animated:"",onBeforeLeave:S,size:e(A).isMobile?"small":"medium","default-value":-1,value:$.value,"onUpdate:value":b[0]||(b[0]=h=>$.value=h)},{default:l(()=>[(U(!0),le(ve,null,ke(L.value,(h,k)=>(U(),N(e(Re),{name:h.id,tab:D(h.name,h.id)},{default:l(()=>[t(e(E),{size:"small",class:"emoji-container",style:Q(C.value)},{default:l(()=>[(U(!0),le(ve,null,ke(h.emojis,(v,n)=>(U(),le("div",{class:"emoji-box",onClick:f=>m(v,h.name)},[Z("img",{src:v,class:"emoji-in-box"},null,8,Bt)],8,St))),256))]),_:2},1032,["style"])]),_:2},1032,["name","tab"]))),256)),t(e(Re),{name:-1,tab:"隐藏"})]),_:1},8,["size","value"]))}}),jt=ae({__name:"HongbaoModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(x,{expose:X,emit:R}){const A=ne(),r=ie(),C=x,$=[{value:1,label:"口令红包 直接公开口令"},{value:2,label:"抢答红包 回复答对才公开口令"},{value:3,label:"暗号红包 抢完红包才公开口令"}],L=[{value:1,label:"随机olo"},{value:2,label:"定额olo"}],y=g(3e3),m=g(10),c=g(1),D=g(1),I=g(),S=g(),d=g([]),b=g(!1),h=g(),k=O(()=>A.isDouble11?Math.ceil(y.value*1.02):A.isOctober1st&&m.value>=20?y.value:Math.ceil(y.value*1.07)),v=g(1);function n(q){q===1&&v.value<5&&(v.value+=1),q===-1&&v.value>1&&(d.value.splice(v.value-1,1),v.value-=1)}const{loading:f,send:o,onSuccess:z}=pe(q=>xt(q),{immediate:!1});function G(){function q(){const u={binggan:r.binggan,forum_id:C.forumId,thread_id:C.threadId,hongbao_olo:y.value,hongbao_num:m.value,type:c.value,key_word_type:D.value,hongbao_key_word:I.value,hongbao_question:S.value,hongbao_message_json:d.value,hongbao_olo_hide:b.value,pic_url:h.value};o(u)}if(I.value===void 0){window.$message.error("必须填写“红包口令”喔");return}if(S.value===void 0&&[2,3].includes(D.value)){window.$message.error("抢答红包或者暗号红包时，必须填写“口令提示”喔");return}if(c.value===2&&y.value%m.value!==0){const u={title:"提醒",closable:!1,content:"olo总额不是红包个数的整倍数，多出的余数olo将在最后一个红包发出。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{q()}};window.$dialog.warning(u);return}q()}z(()=>{K("refreshPostsList"),W.value=!1});const W=g(!1);function F(){W.value=!0}X({show:F});const K=R;return(q,u)=>(U(),N(e(me),{show:W.value,"onUpdate:show":u[12]||(u[12]=P=>W.value=P),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(A).modalMaxWidth}),title:"发起红包",closable:"",onClose:u[11]||(u[11]=P=>W.value=!1),size:"small"},{action:l(()=>[t(e(E),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:G,disabled:e(f),loading:e(f)},{default:l(()=>[...u[30]||(u[30]=[i("提交",-1)])]),_:1},8,["disabled","loading"]),t(e(Y),{onClick:u[10]||(u[10]=P=>W.value=!1)},{default:l(()=>[...u[31]||(u[31]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(E),{vertical:""},{default:l(()=>[Z("div",null,[t(e(J),{depth:3},{default:l(()=>[...u[13]||(u[13]=[i("温馨提示：",-1)])]),_:1}),e(A).isOctober1st?(U(),N(e(J),{key:1},{default:l(()=>[u[16]||(u[16]=Z("del",null,"在红包总额以外，会追加扣除7%手续费。",-1)),u[17]||(u[17]=Z("br",null,null,-1)),u[18]||(u[18]=i(" 10月1日“红包个数”在20个及以上时，手续费",-1)),t(e(J),{type:"error"},{default:l(()=>[...u[15]||(u[15]=[i("0%!!",-1)])]),_:1})]),_:1})):(U(),N(e(J),{key:0},{default:l(()=>[...u[14]||(u[14]=[i(" 在红包总额以外，会追加扣除7%手续费。",-1)])]),_:1}))]),Z("div",null,[t(e(J),{depth:3},{default:l(()=>[...u[19]||(u[19]=[i("总共扣除：",-1)])]),_:1}),t(e(J),{type:"warning"},{default:l(()=>[i(se(k.value),1)]),_:1}),u[20]||(u[20]=i("个奥利奥 ",-1))]),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...u[21]||(u[21]=[i("红包类型",-1)])]),_:1}),t(e(Ce),{value:D.value,"onUpdate:value":u[0]||(u[0]=P=>D.value=P),options:$},null,8,["value"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...u[22]||(u[22]=[i("olo类型",-1)])]),_:1}),t(e(Ce),{value:c.value,"onUpdate:value":u[1]||(u[1]=P=>c.value=P),options:L},null,8,["value"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...u[23]||(u[23]=[i("红包个数",-1)])]),_:1}),t(e(we),{value:m.value,"onUpdate:value":u[2]||(u[2]=P=>m.value=P),max:50,min:5,step:5},null,8,["value"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...u[24]||(u[24]=[i("olo总额",-1)])]),_:1}),t(e(we),{value:y.value,"onUpdate:value":u[3]||(u[3]=P=>y.value=P),max:1e6,min:3e3,step:1e3,parse:e(Xe),format:e(Ye)},null,8,["value","parse","format"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...u[25]||(u[25]=[i("红包口令",-1)])]),_:1}),t(e(ee),{value:I.value,"onUpdate:value":u[4]||(u[4]=P=>I.value=P),placeholder:"必填"},null,8,["value"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...u[26]||(u[26]=[i("红包封面",-1)])]),_:1}),t(e(ee),{value:h.value,"onUpdate:value":u[5]||(u[5]=P=>h.value=P),placeholder:"（可选）填写图片的完整网址"},null,8,["value"])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...u[27]||(u[27]=[i("口令提示",-1)])]),_:1}),t(e(ee),{value:S.value,"onUpdate:value":u[6]||(u[6]=P=>S.value=P),placeholder:"抢答红包或者暗号红包时，必填"},null,8,["value"])]),_:1}),(U(!0),le(ve,null,ke(v.value,P=>(U(),N(e(j),null,{default:l(()=>[t(e(_),{style:{width:"5.2rem"}},{default:l(()=>[...u[28]||(u[28]=[i("回复留言",-1)])]),_:1}),t(e(ee),{value:d.value[P-1],"onUpdate:value":fe=>d.value[P-1]=fe,placeholder:`#${P}（可选） 多个留言时随机抽取一个`,maxlength:255},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024))),256)),t(e(E),{size:"small",align:"center"},{default:l(()=>[t(e(J),{depth:3},{default:l(()=>[...u[29]||(u[29]=[i("留言数量",-1)])]),_:1}),t(e(je),{size:"tiny",circle:"",disabled:v.value===5,onClick:u[7]||(u[7]=P=>n(1))},{icon:l(()=>[t(e(oe),null,{default:l(()=>[t(e(Qe))]),_:1})]),_:1},8,["disabled"]),t(e(je),{size:"tiny",circle:"",disabled:v.value===1,onClick:u[8]||(u[8]=P=>{n(-1)})},{icon:l(()=>[t(e(oe),null,{default:l(()=>[t(e(Ze))]),_:1})]),_:1},8,["disabled"]),t(e(et),{checked:b.value,"onUpdate:checked":u[9]||(u[9]=P=>b.value=P),label:"隐藏olo总额",style:{"margin-left":"auto"}},null,8,["checked"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),_t=ae({__name:"ImageUpload",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(x,{emit:X}){const R=ne(),A=ie(),r=g(null),C=x,$=X,L=["mjj","imgbb","freeimage","picgo","tutu"],y=["imge","imgtbl","imgimg","helloimg","picui","imgwang"],m=O(()=>C.forumId===419?0:L.includes(R.userCustom.imgHost)?1:y.includes(R.userCustom.imgHost)?2:1),c=g(!1),D=({file:h,data:k,headers:v,withCredentials:n,action:f,onFinish:o,onError:z,onProgress:G})=>{var W;if(h.file!==null){if(h.file.size>1024e3){window.$message.error("图片大小不能超过10M喔"),(W=r.value)==null||W.clear();return}const F={binggan:A.binggan,file:h.file,mode:"img",thread_id:C.threadId,forum_id:C.forumId};c.value=!0,Oe(F).then(K=>{var q;$("insertImage",K.file_url),(q=r.value)==null||q.clear(),c.value=!1}).catch(()=>{var K;(K=r.value)==null||K.clear(),c.value=!1})}};function I(h){var k=document.getElementsByTagName("body")[0],v=document.createElement("script");v.setAttribute("id","image-upload-js");var n=document.getElementById("upload-button");h=="mjj"&&(v.setAttribute("async","true"),v.setAttribute("data-mode","manual"),v.setAttribute("src","https://mjj.today/sdk/pup.js"),v.setAttribute("data-url","https://mjj.today/upload"),v.setAttribute("data-auto-insert","html-embed"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),h=="imgbb"&&(v.setAttribute("async","true"),v.setAttribute("data-mode","manual"),v.setAttribute("src","https://imgbb.com/upload.js"),v.setAttribute("data-url","https://imgbb.com/upload"),v.setAttribute("data-auto-insert","html-embed-medium"),n==null||n.setAttribute("data-imgbb-trigger","")),h=="freeimage"&&(v.setAttribute("async","true"),v.setAttribute("data-mode","manual"),v.setAttribute("src","https://freeimage.host/sdk/pup.js"),v.setAttribute("data-url","https://freeimage.host/upload"),v.setAttribute("data-auto-insert","html-embed-medium"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),h=="picgo"&&(v.setAttribute("async","true"),v.setAttribute("data-mode","manual"),v.setAttribute("src","https://www.picgo.net/sdk/pup.js"),v.setAttribute("data-url","https://www.picgo.net/upload"),v.setAttribute("data-auto-insert","html-embed"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),k.appendChild(v)}const S=O(()=>({imge:"https://imge.cc/api/v1/upload",imgtbl:"https://imgtbl.com/api/v1/upload",imgimg:"https://imgimg.cc/api/v1/upload",helloimg:"https://www.helloimg.com/api/v1/upload",picui:"https://picui.cn/api/v1/upload",imgwang:"https://img.wang/api/v1/upload"})[R.userCustom.imgHost]||""),d=({file:h,data:k,headers:v,withCredentials:n,action:f,onFinish:o,onError:z,onProgress:G})=>{if(h.file!==null){const W={file:h.file,url:S.value};c.value=!0,pt(W).then(F=>{var K;console.log(F.data),F.status===!0?$("insertImage",F.data.links.url):window.$message.error(F.message),(K=r.value)==null||K.clear(),c.value=!1}).catch(()=>{var F;(F=r.value)==null||F.clear(),c.value=!1})}};function b(){const h=document.getElementById("image-upload-js");h==null||h.remove()}return We(()=>{L.includes(R.userCustom.imgHost)&&I(R.userCustom.imgHost)}),tt(()=>{b()}),(h,k)=>(U(),le(ve,null,[m.value===0?(U(),N(e(Ue),{key:0,accept:"image/*","custom-request":D,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:r},{default:l(()=>[t(e(Y),{style:{"margin-right":"auto"},disabled:x.userIsLocked,loading:c.value},{default:l(()=>[...k[0]||(k[0]=[i("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):te("",!0),m.value===1?(U(),N(e(Y),{key:1,style:{"margin-right":"auto"},disabled:x.userIsLocked,"data-target":"#content-input",id:"upload-button"},{default:l(()=>[...k[1]||(k[1]=[i("上传图片",-1)])]),_:1},8,["disabled"])):te("",!0),m.value===2?(U(),N(e(Ue),{key:2,accept:"image/*","custom-request":d,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:r},{default:l(()=>[t(e(Y),{style:{"margin-right":"auto"},disabled:x.userIsLocked,loading:c.value},{default:l(()=>[...k[2]||(k[2]=[i("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):te("",!0)],64))}}),Nt=ae({__name:"PingbiciModal",setup(x,{expose:X}){const R=ne(),A=ie(),r=g(),{loading:C,send:$,onSuccess:L}=pe(D=>ct(D),{immediate:!1});function y(){if(!r.value){window.$message.error("请填写屏蔽词");return}const D={binggan:A.binggan,content_pingbici:r.value};$(D)}L(()=>{A.refreshUserData(),m.value=!1});const m=g(!1);function c(){m.value=!0}return X({show:c}),(D,I)=>(U(),N(e(me),{show:m.value,"onUpdate:show":I[3]||(I[3]=S=>m.value=S),"display-directive":"if"},{default:l(()=>[t(e(de),{style:Q({maxWidth:e(R).modalMaxWidth}),title:"追加屏蔽词",closable:"",onClose:I[2]||(I[2]=S=>m.value=!1),size:"small"},{action:l(()=>[t(e(E),{justify:"end"},{default:l(()=>[t(e(Y),{type:"primary",onClick:y,loading:e(C),disabled:!r.value||e(C)},{default:l(()=>[...I[6]||(I[6]=[i("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(Y),{onClick:I[1]||(I[1]=S=>m.value=!1)},{default:l(()=>[...I[7]||(I[7]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(E),{vertical:""},{default:l(()=>[t(e(J),null,{default:l(()=>[...I[4]||(I[4]=[i("暂时只做了“内容屏蔽词”的追加",-1)])]),_:1}),t(e(j),null,{default:l(()=>[t(e(_),{style:{width:"4.2rem"}},{default:l(()=>[...I[5]||(I[5]=[i("屏蔽词",-1)])]),_:1}),t(e(ee),{value:r.value,"onUpdate:value":I[0]||(I[0]=S=>r.value=S),maxlength:20,"show-count":"",onKeyup:ce(y,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ft=ae({__name:"PostInput",props:{mode:{},disabled:{type:Boolean},handling:{type:Boolean},forumId:{default:0},threadId:{default:0},randomHeadsGroup:{default:1}},emits:["contentCommit","refreshPostsList"],setup(x,{expose:X,emit:R}){const A=ie(),r=ne(),C=g(null),$=g(null),L=g(null),y=g(null),m=g(null),c=g(null),D=g(null),I=x,S=O(()=>({fontSize:r.userCustom.fontSizeInput+"px",borderRadius:"10px"})),d=O(()=>{const T=(n.value.match(/\r?\n|\r/g)||[]).length+2;return T<5?5:T>10?10:T}),b=O(()=>A.userData.binggan.locked_ttl>0?`你的饼干封禁中，将于${Math.floor(A.userData.binggan.locked_ttl/3600)+1}小时后解封`:"正文内容"),h=O(()=>A.userData.binggan.locked_ttl>0),k=g(A.userData.binggan.nickname||"= ="),v=g(""),n=g(""),f=g(!1),o=g(!1);function z(){k.value=A.userData.binggan.nickname||"= =",v.value="",n.value="",f.value=!1,o.value=!1}const G=O(()=>({id:0,created_at:"预览模式",is_deleted:0,thread_id:0,battle_id:null,hongbao_id:null,floor:0,random_head:1,created_by_admin:0,content:n.value,nickname:k.value,is_your_post:!0,hongbao_data:null})),W=O(()=>({class:{"nickname-input":!0,admin:o.value}})),F=g(!1),K=lt("emoji_auto_hide",!1);function q(){let T=[ye(Me,{checked:F.value,"onUpdate:checked":a=>F.value=a,label:"实时预览"}),ye(Me,{checked:K.value,"onUpdate:checked":a=>K.value=a,label:"表情包自动收起"})];return A.userData.binggan.admin!==0&&A.checkAdminForums(I.forumId)&&T.push(ye(Me,{checked:o.value,"onUpdate:checked":a=>o.value=a,label:"管理员"})),ye(E,{style:"padding:6px 8px",vertical:!0},()=>T)}const u=[{key:"funcOption",type:"render",render:q}],P=[{label:"涂鸦板",key:"draw",icon:Ee(mt,{size:"1.5rem"})},{label:"屏蔽词",key:"mute",icon:Ee(ft,{size:"1.5rem"})}];function fe(T){var a,H;switch(T){case"mute":(a=m.value)==null||a.show();break;case"draw":(H=D.value)==null||H.show();break}}Le(o,T=>k.value=T?"管理员":"= =");function xe(T){return T.selectionStart!=null?T.selectionStart:0}function Te(T,a){const H=xe(T),V=T.value,Ge=V.substring(0,H)+a+V.substring(H);n.value=Ge,setTimeout(()=>{T.selectionStart=H+a.length,T.selectionEnd=H+a.length},0)}function he(T){const a=document.getElementById("content-input");Te(a,T),be(),a.focus()}function $e(){ht({title:"要清空内容吗？",onPositiveClick:()=>n.value=""})}const ue=g([""]);function ge(){ue.value.length>1&&(ue.value.pop(),n.value=ue.value.slice(-1)[0])}function be(){var T;ue.value.push((T=n.value)!=null?T:""),ue.value.length>20&&ue.value.shift()}function p(T,a){he(`<img src='${T}' class='${a?"custom-emoji-img":"emoji-img"}'>`)}function s(T){he(T)}function w(T){he(`<img src='${T}' />`)}function M(T){var a;n.value=T,be(),(a=C.value)==null||a.focus()}const B=R;function Ie(T){if(!T.isTrusted){const H={title:"错误",closable:!1,content:"请不要用脚本回复喔，可能会被系统判断为脚本并碎饼干。",positiveText:"确定"};window.$dialog.warning(H);return}new Promise(function(H,V){B("contentCommit",{contentInput:n.value,nicknameInput:k.value,postWithAdmin:o.value,titleInput:v.value,isDelay:f.value,ist:T.isTrusted},H)}).then(Fe)}function Fe(){v.value="",n.value="",f.value=!1}const De=g(!1);return X({quoteHandle:M,isTyping:De,resetInput:z}),(T,a)=>(U(),N(e(E),{vertical:""},{default:l(()=>[F.value?(U(),le(ve,{key:0},[x.mode==="thread"?(U(),N(e(de),{class:"thread-title-container",size:"small",key:"title-card"},{default:l(()=>[Z("span",{class:"thread-title",style:Q({fontSize:e(r).userCustom.fontSizeThreadList+"px"})},se(v.value||"标题预览")+" [0] ",5)]),_:1})):te("",!0),t(It,{"post-data":G.value,"forum-id":0,"preview-mode":!0},null,8,["post-data"])],64)):te("",!0),t(e(E),{size:"small",wrap:!1,align:"center",style:Q({paddingRight:e(r).isMobile?"24px":"0px"})},{default:l(()=>[t(e(j),{style:{"max-width":"300px"}},{default:l(()=>[t(e(_),{style:{width:"3.2rem"}},{default:l(()=>[...a[15]||(a[15]=[i("昵称",-1)])]),_:1}),t(e(ee),{maxlength:30,value:k.value,"onUpdate:value":a[0]||(a[0]=H=>k.value=H),"show-count":"","input-props":W.value},null,8,["value","input-props"])]),_:1}),t(e(_e),{trigger:e(r).isMobile?"click":"hover",options:u,placement:"bottom-start"},{default:l(()=>[t(e(Y),{size:"medium",style:{"flex-shrink":"0"},secondary:!1},{default:l(()=>[...a[16]||(a[16]=[i("功能",-1)])]),_:1})]),_:1},8,["trigger"])]),_:1},8,["style"]),x.mode==="thread"?(U(),N(e(j),{key:1},{default:l(()=>[t(e(_),{style:{width:"3.2rem"}},{default:l(()=>[...a[17]||(a[17]=[i("标题",-1)])]),_:1}),t(e(ee),{maxlength:100,value:v.value,"onUpdate:value":a[1]||(a[1]=H=>v.value=H),"show-count":"",placeholder:"标题内容"},null,8,["value"])]),_:1})):te("",!0),t(Rt,{"auto-hide":e(K),"random-heads-group":x.randomHeadsGroup,onAppendEmoji:p},null,8,["auto-hide","random-heads-group"]),t(e(E),{size:e(r).isMobile?"small":"medium",justify:"end",align:"center",style:Q({paddingRight:e(r).isMobile?"24px":"0px"})},{default:l(()=>[t(e(_e),{trigger:"click",options:P,onSelect:fe,size:e(r).isMobile?"medium":"large"},{default:l(()=>[t(e(oe),{size:e(r).isMobile?20:24,style:{cursor:"pointer"}},{default:l(()=>[t(e(at))]),_:1},8,["size"])]),_:1},8,["size"]),x.mode==="post"?(U(),N(e(re),{key:0,placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(nt),{style:{cursor:"pointer"},onClick:a[2]||(a[2]=H=>{var V;return(V=$.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:l(()=>[a[18]||(a[18]=i(" 发红包 ",-1))]),_:1},8,["trigger"])):te("",!0),x.mode==="post"?(U(),N(e(re),{key:1,placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(ut),{style:{cursor:"pointer"},onClick:a[3]||(a[3]=H=>{var V;return(V=L.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:l(()=>[a[19]||(a[19]=i(" 大乱斗 ",-1))]),_:1},8,["trigger"])):te("",!0),x.mode==="post"?(U(),N(e(re),{key:2,placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(ot),{style:{cursor:"pointer"},onClick:a[4]||(a[4]=H=>{var V;return(V=y.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:l(()=>[a[20]||(a[20]=i(" Roll点 ",-1))]),_:1},8,["trigger"])):te("",!0),t(e(re),{placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(st),{style:{cursor:"pointer"},onClick:a[5]||(a[5]=H=>{var V;return(V=c.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:l(()=>[a[21]||(a[21]=i(" 快捷代码 ",-1))]),_:1},8,["trigger"]),t(e(it),{vertical:""}),t(e(re),{placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(rt),{style:{cursor:"pointer"},onClick:ge})]),_:1},8,["size"])]),default:l(()=>[a[22]||(a[22]=i(" 撤销 ",-1))]),_:1},8,["trigger"]),t(e(re),{placement:"bottom-start",trigger:e(r).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(r).isMobile?28:32},{default:l(()=>[t(e(dt),{style:{cursor:"pointer"},onClick:$e})]),_:1},8,["size"])]),default:l(()=>[a[23]||(a[23]=i(" 清空 ",-1))]),_:1},8,["trigger"])]),_:1},8,["size","style"]),t(e(vt),{value:n.value,"onUpdate:value":a[6]||(a[6]=H=>n.value=H),type:"textarea",placeholder:b.value,rows:d.value,ref_key:"contentInputDom",ref:C,style:Q(S.value),"input-props":{id:"content-input"},disabled:h.value,onChange:be,onKeyup:a[7]||(a[7]=ce(Ae(H=>Ie(H),["ctrl"]),["enter"])),onBlur:a[8]||(a[8]=H=>De.value=!1),onFocus:a[9]||(a[9]=H=>De.value=!0)},null,8,["value","placeholder","rows","style","disabled"]),t(e(E),{justify:"end",align:"center"},{default:l(()=>[t(_t,{"user-is-locked":h.value,"forum-id":x.forumId,"thread-id":x.threadId,onInsertImage:w},null,8,["user-is-locked","forum-id","thread-id"]),x.mode==="thread"?(U(),N(e(re),{key:0,placement:"bottom-start",trigger:"hover",disabled:e(r).isMobile},{trigger:l(()=>[t(e(Me),{checked:f.value,"onUpdate:checked":a[10]||(a[10]=H=>f.value=H)},{default:l(()=>[...a[24]||(a[24]=[i("延时发送",-1)])]),_:1},8,["checked"])]),default:l(()=>[a[25]||(a[25]=i(" 第二天8点自动发出 ",-1))]),_:1},8,["disabled"])):te("",!0),t(e(re),{placement:"bottom-start",trigger:"hover",disabled:e(r).isMobile},{trigger:l(()=>[t(e(Y),{type:"primary",onClick:a[11]||(a[11]=H=>Ie(H)),loading:x.handling,disabled:x.handling||h.value},{default:l(()=>[...a[26]||(a[26]=[i("提交",-1)])]),_:1},8,["loading","disabled"])]),default:l(()=>[a[27]||(a[27]=i(" 可以Ctrl+Enter ",-1))]),_:1},8,["disabled"])]),_:1}),t(jt,{ref_key:"HongbaoModalCom",ref:$,"thread-id":x.threadId,"forum-id":x.forumId,onRefreshPostsList:a[12]||(a[12]=H=>B("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(Dt,{ref_key:"BattleModalCom",ref:L,"thread-id":x.threadId,"forum-id":x.forumId,"random-heads-group":x.randomHeadsGroup,onRefreshPostsList:a[13]||(a[13]=H=>B("refreshPostsList"))},null,8,["thread-id","forum-id","random-heads-group"]),t(Mt,{ref_key:"RollModalCom",ref:y,"thread-id":x.threadId,"forum-id":x.forumId,onRefreshPostsList:a[14]||(a[14]=H=>B("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(Nt,{ref_key:"PingbiciModalCom",ref:m},null,512),t(zt,{ref_key:"CodeModalCom",ref:c,onInsertCode:s},null,512),t(Pt,{ref_key:"DrawerModalCom",ref:D,onInsertImage:w,"user-is-locked":h.value,"forum-id":x.forumId,"thread-id":x.threadId},null,8,["user-is-locked","forum-id","thread-id"])]),_:1}))}});export{Ft as _,$t as a};
