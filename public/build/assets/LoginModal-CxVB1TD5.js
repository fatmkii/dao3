import{w as I,d as L,$ as y,c as _,bR as O,bS as J,bT as K,o as Q,A as k,M as C,f as t,H as n,a as e,i as X,m as q,k as h,h as U,z as i,s as V,G as Y,n as x,aH as B,aI as $,bB as Z,aJ as ee,j as T}from"./app-BYB32yAm.js";import{n as te}from"./globalSetting-BZn1aMIc.js";import{c as f,_ as A}from"./index-u4XndDaU.js";import{_ as D}from"./FInput.vue_vue_type_script_setup_true_lang-CsJqv-RY.js";import"./_commonjsHelpers-BosuxZz1.js";function ae(u){var o,a,d="",s;for(u+="",o=0,a=u.length;o<a;o++)s=u.charCodeAt(o).toString(16),d+=s.length<2?"0"+s:s;return d}function se(u){var o=document.createElement("canvas"),a=o.getContext("2d"),d=u;a.textBaseline="top",a.font="14px 'Arial'",a.textBaseline="alphabetic",a.fillStyle="#f60",a.fillRect(125,1,62,20),a.fillStyle="#069",a.fillText(d,2,15),a.fillStyle="rgba(102, 204, 0, 0.7)",a.fillText(d,4,17);var s=o.toDataURL().replace("data:image/png;base64,",""),p=atob(s),c=ae(p.slice(-16,-12));return c}function ne(){const u="XiaoHuoGuoCpttmm",o="abcdef0123456789",a=f.enc.Utf8.parse(u);var s={iv:f.enc.Utf8.parse(o),mode:f.mode.CBC,padding:f.pad.Pkcs7};const p=se("BrowserLeaks,com <canvas> 1.0"),c=f.MD5(navigator.userAgent).toString().substr(0,8);return f.AES.encrypt("XiaoHuoGuo"+p+c,a,s).toString()}const re=T("div",null,[i("这里是私人论坛，欢迎来玩！"),T("br"),i("QQ小火锅避难群：156840110 "),T("br"),i("使用前需要在下面申请或者导入饼干喔")],-1),ce=I({__name:"LoginModal",emits:["submitRegister"],setup(u,{expose:o,emit:a}){const d=L(()=>{const l=window.innerWidth;return l>=532?"500px":l-32+"px"}),s=y(!1);o({show:()=>s.value=!0});const c=y(""),v=y(""),{data:S}=_(te,{initialData:!1}),{data:m}=_(O(),{initialData:{reg_record_TTL:-2}}),E=L(()=>{var l,r;if(!(((l=m.value)==null?void 0:l.reg_record_TTL)<=0))return`在${Math.floor(((r=m.value)==null?void 0:r.reg_record_TTL)/3600)}小时后才能再次领取饼干。`}),b=()=>{M(c.value,v.value),v.value=""},{loading:G,onSuccess:H,data:R,send:M}=_(J,{immediate:!1});H(()=>{localStorage.Token=R.value.token,localStorage.Binggan=R.value.binggan,window.location.href="/"});const N=()=>{z(ne())},{loading:j,onSuccess:P,onError:W,data:w,send:z}=_(K,{immediate:!1});P(()=>{const l=Q();l.binggan=w.value.binggan,localStorage.Token=w.value.token,localStorage.Binggan=w.value.binggan,s.value=!1,F("submitRegister")}),W(l=>{window.$dialog.error({title:"申请饼干失败",content:l.error.message})});const F=a;return(l,r)=>(k(),C(e(ee),{show:s.value,"onUpdate:show":r[4]||(r[4]=g=>s.value=g),"display-directive":"if"},{default:t(()=>[n(e(X),{style:q({maxWidth:d.value}),title:"欢迎来到小火锅！",closable:"",onClose:r[3]||(r[3]=g=>s.value=!1),size:"small"},{action:t(()=>[n(e(h),{justify:"end"},{default:t(()=>[e(m).reg_record_TTL>0?(k(),C(e(U),{key:0,style:{"margin-right":"auto"}},{default:t(()=>[i(V(E.value),1)]),_:1})):Y("",!0),n(e(x),{onClick:r[2]||(r[2]=g=>s.value=!1)},{default:t(()=>[i("关闭")]),_:1})]),_:1})]),default:t(()=>[n(e(h),{vertical:""},{default:t(()=>[re,n(e(B),null,{default:t(()=>[n(e(A),{style:{width:"3.2rem"}},{default:t(()=>[i("饼干")]),_:1}),n(e(D),{value:c.value,"onUpdate:value":r[0]||(r[0]=g=>c.value=g),placeholder:"请输入饼干",maxlength:"9","show-count":"",onKeyup:$(b,["enter"])},null,8,["value"])]),_:1}),n(e(B),null,{default:t(()=>[n(e(A),{style:{width:"3.2rem"},class:"round"},{default:t(()=>[i("密码")]),_:1}),n(e(D),{type:"password",placeholder:"（可留空）请输入密码","show-password-on":"mousedown",value:v.value,"onUpdate:value":r[1]||(r[1]=g=>v.value=g),onKeyup:$(b,["enter"])},null,8,["value"])]),_:1}),n(e(h),null,{default:t(()=>[n(e(Z),{placement:"bottom",trigger:"hover",disabled:e(S)},{trigger:t(()=>[n(e(x),{type:"warning",disabled:e(j)||!e(S)||e(m).reg_record_TTL>0,onClick:N},{default:t(()=>[i(" 我想领取新饼干！ ")]),_:1},8,["disabled"])]),default:t(()=>[n(e(U),null,{default:t(()=>[i("嗷！很抱歉，领取新饼干目前暂停中…… ")]),_:1})]),_:1},8,["disabled"]),n(e(x),{style:{"margin-left":"auto"},type:"primary",onClick:b,disabled:e(G)},{default:t(()=>[i("导入饼干")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}});export{ce as default};
