import{w as A,P as X,o as e,W as V,$ as z,X as ne,b as q,ao as K,i as L,A as m,M as x,q as a,K as G,H as t,x as _,z as o,F as w,a2 as H,Q as E,O as C,r as ue,C as N,y as c,a_ as se,az as D,_ as ee,a0 as ae,ay as R,ax as oe,aw as ie,e as te,b0 as re,aH as de,bi as le,bj as me,S as B,at as F,bl as j,B as M,ak as pe,b4 as ge,b3 as fe,ab as ve}from"./vendor-CGtf6mcl.js";import{a as I,u as O,b as T,_ as Z,c as W}from"./app-BOV-nWxe.js";import{s as ce,g as _e,h as be,i as ye,j as he,k as xe}from"./admin-CDDcLWCm.js";import{u as Y}from"./forums-DsZODWnl.js";import{i as ke,a as Se}from"./inputNumberFormat-DaYmlx6U.js";const ze={class:"banner-box-sm"},$e=["src"],we=["src","onClick"],Ce=A({__name:"TabBanners",setup(P){X(r=>({"6a1c8eac":e(y).textColor1}));const v=I();O();const b=Y(),y=V(),l=z(0);ne(()=>{u.value.length>0&&(l.value=u.value[0].value)});const u=q(()=>v.binggan===null||v.userData.binggan.admin_forums===void 0?[]:b.forumsData.reduce((r,n)=>(v.checkAdminForums(n.id)&&r.push({value:n.id,label:n.name,forumId:n.id}),r),[])),d=z([]);K(l,r=>{var n,S;r===void 0?d.value=[]:d.value=[...(S=(n=b.forumData(r))==null?void 0:n.banners)!=null?S:[]]});const i=z(!1),p=z(),g=q(()=>{var r,n;return(n=(r=p.value)==null?void 0:r.split(/[\n,，]+/).filter(S=>S!=""))!=null?n:[]});function U(){i.value=!1,d.value=d.value.concat(g.value),p.value=void 0,s()}function k(r){var n;(n=d.value)==null||n.splice(r,1)}const{loading:f,send:h,onSuccess:$}=L(r=>ce(r),{immediate:!1});$(()=>{b.getForumsData()});function s(){const r={binggan:v.binggan,forum_id:l.value,banners:d.value};h(r)}return(r,n)=>(m(),x(e(_),{vertical:""},{default:a(()=>[i.value?(m(),x(e(G),{key:0,title:"待追加的版头",size:"small",class:"dash-line"},{"header-extra":a(()=>[t(e(_),{size:"small"},{default:a(()=>[t(e(T),{type:"primary",onClick:U},{default:a(()=>[o("追加")]),_:1}),t(e(T),{type:"default",onClick:n[0]||(n[0]=S=>{i.value=!1,p.value=void 0})},{default:a(()=>[o("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(_),{size:"small"},{default:a(()=>[(m(!0),w(H,null,E(g.value,(S,Q,J)=>(m(),w("div",ze,[C("img",{src:S,style:{width:"100%"}},null,8,$e)]))),256))]),_:1}),t(e(ue),{type:"textarea",value:p.value,"onUpdate:value":n[1]||(n[1]=S=>p.value=S),placeholder:"在这里贴网址追加版头。可以一次多个，每行一个。",style:{"border-radius":"10px","margin-top":"6px"},autosize:{minRows:3,maxRows:5}},null,8,["value"])]),_:1})):N("",!0),t(e(G),{title:"版头设定",size:"small"},{"header-extra":a(()=>[t(e(_),{size:"small",align:"center",wrap:!0},{default:a(()=>[t(e(c),{depth:3},{default:a(()=>[o("选择小岛")]),_:1}),t(e(se),{value:l.value,"onUpdate:value":n[2]||(n[2]=S=>l.value=S),options:u.value,"consistent-menu-width":!1,style:{width:"100px"}},null,8,["value","options"]),i.value?N("",!0):(m(),x(e(T),{key:0,type:"primary",onClick:n[3]||(n[3]=S=>i.value=!0)},{default:a(()=>[o("追加")]),_:1}))]),_:1})]),default:a(()=>[t(e(c),{depth:3},{default:a(()=>[o("点击图片移除")]),_:1}),t(e(_),{wrap:!0,size:[4,4]},{default:a(()=>[(m(!0),w(H,null,E(d.value,(S,Q)=>{var J;return m(),w("div",{key:Q+((J=l.value)!=null?J:0)*1e3,class:"banner-box"},[C("img",{src:S,class:"banner-img",onClick:Ve=>k(Q)},null,8,we)])}),128))]),_:1})]),_:1}),t(e(_),{align:"center",justify:"end"},{default:a(()=>[t(e(c),{depth:3,style:{"font-size":"0.875rem"}},{default:a(()=>[o("各个小岛的变更要分别提交喔")]),_:1}),t(e(T),{type:"primary",loading:e(f),disable:e(f),onClick:s},{default:a(()=>[o("提交")]),_:1},8,["loading","disable"])]),_:1})]),_:1}))}}),Me=Z(Ce,[["__scopeId","data-v-35893c7d"]]),Ne=A({__name:"TabGlobal",setup(P){X(i=>({a7c75f86:e(b).textColor1}));const v=I();O(),Y();const b=V(),y=z(!1),l=z(!1),u=z(!1);v.admin.isSuperAdmin===!0&&_e().then(i=>{y.value=i.new_binggan,l.value=i.new_loudspeaker,u.value=!0});function d(i,p){const g={binggan:v.binggan,key:i,value:JSON.stringify(p)};be(g).then()}return(i,p)=>(m(),x(e(_),{vertical:"",size:[6,12]},{default:a(()=>[t(e(_),{size:"small"},{default:a(()=>[t(e(c),{style:{width:"6.2rem"}},{default:a(()=>[o("领取饼干开关")]),_:1}),t(e(D),{value:y.value,"onUpdate:value":p[0]||(p[0]=g=>y.value=g),disabled:!u.value,onUpdateValue:p[1]||(p[1]=g=>d("new_binggan",g))},null,8,["value","disabled"]),ee(t(e(c),{depth:3},{default:a(()=>[o("读取中")]),_:1},512),[[ae,!u.value]])]),_:1}),t(e(_),{size:"small"},{default:a(()=>[t(e(c),{style:{width:"6.2rem"}},{default:a(()=>[o("大喇叭开关")]),_:1}),t(e(D),{value:l.value,"onUpdate:value":p[2]||(p[2]=g=>l.value=g),disabled:!u.value,onUpdateValue:p[3]||(p[3]=g=>d("new_loudspeaker",g))},null,8,["value","disabled"]),ee(t(e(c),{depth:3},{default:a(()=>[o("读取中")]),_:1},512),[[ae,!u.value]])]),_:1})]),_:1}))}}),Ue=Z(Ne,[["__scopeId","data-v-44dcccc7"]]),Te=A({__name:"TabMedal",setup(P){const v=I(),b=O();Y(),V();const y=z(null),l=z({binggan:"",medalId:181}),u={binggan:{required:!0,message:"请填写目标饼干",trigger:"blur"},medalId:{required:!0,message:"请选择要发放的成就",type:"number",trigger:"blur"}},d=[{value:181,label:"皇家御用画宗"},{value:182,label:"小火锅守护者"}],{loading:i,send:p,onSuccess:g,onError:U}=L(f=>ye(f),{immediate:!1});g(()=>{l.value.binggan=""}),U(()=>{l.value.binggan=""});function k(){var f;(f=y.value)==null||f.validate(h=>{if(h){window.$message.error("请确认信息填写完整");return}else{const $={binggan:v.binggan,binggan_target:l.value.binggan,medal_id:l.value.medalId},s=d.find(n=>n.value===l.value.medalId),r={title:"发放成就",closable:!1,content:`对象饼干：${l.value.binggan}  发放成就：${s==null?void 0:s.label}`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{p($)}};window.$dialog.warning(r)}})}return(f,h)=>(m(),x(e(oe),{ref_key:"formRef",ref:y,model:l.value,"label-placement":"left","label-width":"auto",rules:u,size:e(b).isMobile?"small":"medium",style:{"max-width":"300px"}},{default:a(()=>[t(e(R),{label:"目标饼干",path:"binggan"},{default:a(()=>[t(e(W),{value:l.value.binggan,"onUpdate:value":h[0]||(h[0]=$=>l.value.binggan=$)},null,8,["value"])]),_:1}),t(e(R),{label:"发放成就",path:"medalId"},{default:a(()=>[t(e(se),{value:l.value.medalId,"onUpdate:value":h[1]||(h[1]=$=>l.value.medalId=$),options:d,"menu-props":{style:{borderRadius:"10px"}}},null,8,["value"])]),_:1}),t(e(T),{type:"primary",loading:e(i),disabled:e(i),onClick:k},{default:a(()=>[o("提交")]),_:1},8,["loading","disabled"])]),_:1},8,["model","size"]))}}),Ae=A({__name:"TabCoin",setup(P){const v=I(),b=O(),y=z(null),l=z({binggan:"",olo:void 0,message:""}),u={binggan:{required:!0,message:"请填写目标饼干",trigger:"blur"},message:{required:!1},olo:{required:!0,message:"请选择要奖罚的olo",type:"number",trigger:"blur"}},{loading:d,send:i,onSuccess:p,onError:g}=L(k=>he(k),{immediate:!1});p(()=>{l.value.binggan=""}),g(()=>{l.value.binggan=""});function U(){var k;(k=y.value)==null||k.validate(f=>{if(f){window.$message.error("请确认信息填写完整");return}else{const h={binggan:v.binggan,binggan_target:l.value.binggan,olo_num:l.value.olo,olo_message:l.value.message},$=l.value.olo>0?"奖励":"罚款",s={title:"奖罚olo",closable:!1,content:`对象饼干：${l.value.binggan} ${$}${l.value.olo}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{i(h)}};window.$dialog.warning(s)}})}return(k,f)=>(m(),x(e(oe),{ref_key:"formRef",ref:y,model:l.value,"label-placement":"left","label-width":"auto",rules:u,size:e(b).isMobile?"small":"medium",style:{"max-width":"300px"}},{default:a(()=>[t(e(R),{label:"目标饼干",path:"binggan"},{default:a(()=>[t(e(W),{value:l.value.binggan,"onUpdate:value":f[0]||(f[0]=h=>l.value.binggan=h)},null,8,["value"])]),_:1}),t(e(R),{label:"奖罚olo",path:"olo"},{default:a(()=>[t(e(ie),{value:l.value.olo,"onUpdate:value":f[1]||(f[1]=h=>l.value.olo=h),max:1e6,min:-1e6,step:1e3,parse:e(ke),format:e(Se),placeholder:"正数是奖励，负数是罚款"},null,8,["value","parse","format"])]),_:1}),t(e(R),{label:"附带留言",path:"message"},{default:a(()=>[t(e(W),{value:l.value.message,"onUpdate:value":f[2]||(f[2]=h=>l.value.message=h),placeholder:"将显示在收支记录"},null,8,["value"])]),_:1}),t(e(T),{type:"primary",loading:e(d),disabled:e(d),onClick:U},{default:a(()=>[o("提交")]),_:1},8,["loading","disabled"])]),_:1},8,["model","size"]))}}),Ie={class:"actives-item"},Oe={style:{"margin-left":"auto"}},Pe={key:0,style:{"margin-top":"6px"}},Be={style:{"margin-top":"6px"}},Fe={style:{"margin-top":"6px"}},He=A({__name:"TabActives",setup(P){X(s=>({"4a42d8bc":e(y).dividerColor}));const v=I(),b=O(),y=V(),l=z(te().format("YYYY-MM-DD"));K(l,()=>k());const u=z(1);K(u,()=>k()),ne(()=>k());function d(s){return te().isBefore(s)}const i=[{title:"时间",key:"created_at",resizable:!0},{title:"管理员",key:"name",resizable:!0},{title:"罚款",key:"olo",resizable:!0},{title:"操作",key:"active",resizable:!0},{title:"原因",key:"content",resizable:!0},{title:"主题",key:"thread_title",render:h,resizable:!0},{title:"回复",key:"post_content",render:$,resizable:!0}],{loading:p,data:g,send:U}=L(s=>xe(s),{immediate:!1,initialData:{data:[],last_page:1}});function k(){const s={binggan:v.binggan,date:l.value,page:u.value};U(s)}function f(s){return{name:"thread",params:{threadId:s.thread_id,page:s.floor===null?1:Math.ceil((s.floor+1)/200)},hash:s.floor===null?void 0:"#f_"+s.floor}}function h(s,r){return s.thread_id!==null?B(j,{to:f(s),target:"_blank"},()=>B(F,{style:"max-width: 120px"},()=>s.thread_title)):B(F,{style:"max-width: 120px"},()=>s.thread_title)}function $(s,r){return s.thread_id!==null?B(j,{to:f(s),target:"_blank"},()=>B(F,{style:"max-width: 120px"},()=>s.post_content)):B(F,{style:"max-width: 120px"},()=>s.post_content)}return(s,r)=>(m(),x(e(_),{size:"small"},{default:a(()=>[t(e(re),{"formatted-value":l.value,"onUpdate:formattedValue":r[0]||(r[0]=n=>l.value=n),"value-format":"yyyy-MM-dd",type:"date",size:e(b).isMobile?"small":"medium","is-date-disabled":d},null,8,["formatted-value","size"]),t(e(T),{type:"primary",onClick:r[1]||(r[1]=n=>k())},{default:a(()=>[o(" 查询 ")]),_:1}),t(e(G),{title:"管理员操作记录",size:"small"},{default:a(()=>[e(b).isMobile?N("",!0):(m(),x(e(_),{key:0},{default:a(()=>[t(e(de),{columns:i,data:e(g).data,bordered:!1,loading:e(p),style:{height:"100%"}},null,8,["data","loading"]),t(e(le),{page:u.value,"onUpdate:page":r[2]||(r[2]=n=>u.value=n),"page-count":e(g).last_page,size:"medium",style:{"margin-left":"auto"}},null,8,["page","page-count"])]),_:1})),e(b).isMobile?(m(),w(H,{key:1},[e(g).data.length>0?(m(),x(e(_),{key:0,vertical:"",align:"start",size:"small"},{default:a(()=>[e(p)?N("",!0):(m(!0),w(H,{key:0},E(e(g).data,n=>(m(),w("div",Ie,[t(e(_),null,{default:a(()=>[C("div",null,[t(e(c),{depth:3},{default:a(()=>[o("时间：")]),_:1}),t(e(c),null,{default:a(()=>[o(M(n.created_at),1)]),_:2},1024)]),C("div",Oe,[t(e(c),{depth:3},{default:a(()=>[o("管理员：")]),_:1}),t(e(c),null,{default:a(()=>[o(M(n.name),1)]),_:2},1024)])]),_:2},1024),n.olo?(m(),w("div",Pe,[t(e(c),{depth:3},{default:a(()=>[o("罚款：")]),_:1}),t(e(c),null,{default:a(()=>[o(M(n.olo),1)]),_:2},1024)])):N("",!0),C("div",Be,[t(e(c),{depth:3},{default:a(()=>[o("操作：")]),_:1}),t(e(c),null,{default:a(()=>[o(M(n.active),1)]),_:2},1024)]),C("div",Fe,[t(e(c),{depth:3},{default:a(()=>[o("原因：")]),_:1}),t(e(c),null,{default:a(()=>[o(M(n.content),1)]),_:2},1024)]),n.thread_title!==null?(m(),x(e(_),{key:1,style:{"margin-top":"6px"},wrap:!1},{default:a(()=>[t(e(c),{depth:3},{default:a(()=>[o("主题：")]),_:1}),t(e(j),{to:f(n),style:{"max-width":"80%"}},{default:a(()=>[t(e(F),null,{default:a(()=>[o(M(n.thread_title),1)]),_:2},1024)]),_:2},1032,["to"])]),_:2},1024)):N("",!0),n.post_content!==null?(m(),x(e(_),{key:2,style:{"margin-top":"6px"},wrap:!1},{default:a(()=>[t(e(c),{depth:3},{default:a(()=>[o("主题：")]),_:1}),t(e(j),{to:f(n),style:{"max-width":"80%"}},{default:a(()=>[t(e(F),null,{default:a(()=>[o(M(n.post_content),1)]),_:2},1024)]),_:2},1032,["to"])]),_:2},1024)):N("",!0)]))),256)),t(e(le),{page:u.value,"onUpdate:page":r[3]||(r[3]=n=>u.value=n),"page-count":e(g).last_page,size:"small",style:{"margin-left":"auto"}},null,8,["page","page-count"])]),_:1})):(m(),x(e(me),{key:1}))],64)):N("",!0)]),_:1})]),_:1}))}}),Re=Z(He,[["__scopeId","data-v-cf881a3c"]]),Ee=C("img",{src:"https://www.freeimg.cn/i/2024/05/15/6644aedee642d.png",style:{"max-width":"50px","max-height":"50px"}},null,-1),je=C("span",null,"管理员中心",-1),qe=A({__name:"AdminCard",setup(P){const v=I(),b=O(),y=Y(),l=q(()=>v.binggan===null||v.userData.binggan.admin_forums===void 0?[]:y.forumsData.reduce((u,d)=>(v.checkAdminForums(d.id)&&u.push({value:d.id,label:d.name,forumId:d.id}),u),[]));return(u,d)=>(m(),x(e(G),{hoverable:"",size:"small"},{default:a(()=>[t(e(_),{vertical:e(b).isMobile},{default:a(()=>[t(e(_),{size:"small",align:"center"},{default:a(()=>[Ee,je]),_:1}),C("div",null,[t(e(c),{depth:3},{default:a(()=>[o("我管理的板块")]),_:1}),t(e(_),null,{default:a(()=>[(m(!0),w(H,null,E(l.value,i=>(m(),x(e(pe),null,{default:a(()=>[o(M(i.forumId)+". "+M(i.label),1)]),_:2},1024))),256))]),_:1})])]),_:1},8,["vertical"])]),_:1}))}}),Ge=C("div",{style:{height:"50px"}},null,-1),We=A({__name:"AdminCenter",setup(P){const v=I(),b=O(),y=z();document.title="管理员中心";const l=q(()=>{const u=[{name:"banners",tab:"版头设定",component:Me}];return v.admin.isNormalAdmin&&u.unshift({name:"actives",tab:"管理状况",component:Re}),v.admin.isSuperAdmin?u.concat([{name:"global",tab:"全局设置",component:Ue},{name:"medals",tab:"发放成就",component:Te},{name:"olo",tab:"奖罚olo",component:Ae}]):u});return(u,d)=>(m(),x(e(_),{vertical:"",style:{"margin-top":"8px"}},{default:a(()=>[t(e(qe)),t(e(ge),{type:"line","bar-width":e(b).isMobile?0:void 0,animated:"",size:e(b).isMobile?"small":"large",value:y.value,"onUpdate:value":d[0]||(d[0]=i=>y.value=i)},{default:a(()=>[(m(!0),w(H,null,E(l.value,i=>(m(),x(e(fe),{name:i.name,tab:i.tab,key:i.name},{default:a(()=>[(m(),x(ve(i.component)))]),_:2},1032,["name","tab"]))),128))]),_:1},8,["bar-width","size","value"]),Ge]),_:1}))}});export{We as default};
