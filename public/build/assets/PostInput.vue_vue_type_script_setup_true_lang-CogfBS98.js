import{w as Z,b as X,$ as v,i as ve,A as P,M as O,q as a,H as t,o as e,x as N,z as n,y as J,B as se,D as E,aw as be,J as q,K as ie,L as de,F as Q,O as K,aq as Ke,E as me,C as ee,ao as Le,a_ as we,_ as Ae,a0 as Ue,X as Oe,b5 as De,aX as Be,a$ as qe,aY as He,aE as Je,Q as _e,a2 as re,b6 as Pe,b3 as Re,b4 as Qe,S as he,p as je,N as oe,b1 as Ze,b2 as et,v as tt,an as at,f as lt,a1 as Ne,aP as nt,I as ue,b7 as ot,b8 as st,b9 as ut,aZ as it,ba as rt,bb as dt,r as ct,bc as vt}from"./vendor-CGtf6mcl.js";import{u as ae,a as le,b as F,e as W,c as te,g as Me,j as mt,w as pt,p as ft,r as Ee,d as xe}from"./app-BOV-nWxe.js";import{s as gt}from"./showDialog-CMWWja4w.js";import{b as ht,c as bt,d as Se,e as wt,g as _t,f as yt,_ as Ct}from"./PostItem.vue_vue_type_script_setup_true_lang-DtTwkGi9.js";import{i as Xe,a as Fe}from"./inputNumberFormat-DaYmlx6U.js";import{e as kt}from"./emojiData-CmSvr5Em.js";const It=Z({__name:"RollModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(M,{expose:$,emit:H}){const U=ae(),l=le(),y=M,z=X(()=>{let m=[];if(s.value>0&&f.value>0){for(var u=0;u<s.value;u++)m[u]=Math.floor(Math.random()*f.value)+1;return m.join()}else return null}),L=v(),w=v(),s=v(1),f=v(100),T=v(!1);function D(){T.value=!0}$({show:D});const B=H,{loading:r,send:h,onSuccess:o}=ve(m=>ht(m),{immediate:!1});function I(){if(!s.value){window.$message.error("请填写骰子数量");return}if(!f.value){window.$message.error("请填写骰子数量");return}const m={binggan:l.binggan,thread_id:y.threadId,forum_id:y.forumId,roll_name:L.value,roll_event:w.value,roll_num:s.value,roll_range:f.value};h(m)}return o(()=>{B("refreshPostsList"),T.value=!1}),(m,u)=>(P(),O(e(de),{show:T.value,"onUpdate:show":u[6]||(u[6]=d=>T.value=d),"display-directive":"if"},{default:a(()=>[t(e(ie),{style:q({maxWidth:e(U).modalMaxWidth}),title:"Roll点",closable:"",onClose:u[5]||(u[5]=d=>T.value=!1),size:"small"},{action:a(()=>[t(e(N),{justify:"end"},{default:a(()=>[t(e(F),{type:"primary",onClick:I,disabled:e(r)},{default:a(()=>[n("Roll it!")]),_:1},8,["disabled"]),t(e(F),{onClick:u[4]||(u[4]=d=>T.value=!1)},{default:a(()=>[n("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(N),{vertical:""},{default:a(()=>[t(e(J),null,{default:a(()=>[n(" 输出参考： ")]),_:1}),t(e(J),null,{default:a(()=>[n(se(L.value?`「${L.value}」，`:"")+" "+se(w.value?`「${w.value}」的结果：`:"")+" "+se(`${s.value} d ${f.value} = 「${z.value}」`),1)]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"},class:"round"},{default:a(()=>[n("Roll点昵称")]),_:1}),t(e(te),{placeholder:"可留空",maxlength:100,value:L.value,"onUpdate:value":u[0]||(u[0]=d=>L.value=d)},null,8,["value"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"},class:"round"},{default:a(()=>[n("Roll点事件")]),_:1}),t(e(te),{placeholder:"可留空",maxlength:100,value:w.value,"onUpdate:value":u[1]||(u[1]=d=>w.value=d)},null,8,["value"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"},class:"round"},{default:a(()=>[n("骰子数量")]),_:1}),t(e(be),{max:100,min:1,placeholder:"必须填写",value:s.value,"onUpdate:value":u[2]||(u[2]=d=>s.value=d)},null,8,["value"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"},class:"round"},{default:a(()=>[n("骰子大小")]),_:1}),t(e(be),{max:1e4,min:1,placeholder:"必须填写",value:f.value,"onUpdate:value":u[3]||(u[3]=d=>f.value=d)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),xt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Mt=K("defs",null,null,-1),$t=K("path",{d:"M682 455V311l-76 76v68c-.1 50.7-42 92.1-94 92c-19.1.1-36.8-5.4-52-15l-54 55c29.1 22.4 65.9 36 106 36c93.8 0 170-75.1 170-168z",fill:"currentColor"},null,-1),zt=K("path",{d:"M833 446h-60c-4.4 0-8 3.6-8 8c0 140.3-113.7 254-254 254c-63 0-120.7-23-165-61l-54 54c48.9 43.2 110.8 72.3 179 81v102H326c-13.9 0-24.9 14.3-25 32v36c.1 4.4 2.9 8 6 8h408c3.2 0 6-3.6 6-8v-36c0-17.7-11-32-25-32H547V782c165.3-17.9 294-157.9 294-328c0-4.4-3.6-8-8-8zm13.1-377.7l-43.5-41.9c-3.1-3-8.1-3-11.2.1l-129 129C634.3 101.2 577 64 511 64c-93.9 0-170 75.3-170 168v224c0 6.7.4 13.3 1.2 19.8l-68 68c-10.5-27.9-16.3-58.2-16.2-89.8c-.2-4.4-3.8-8-8-8h-60c-4.4 0-8 3.6-8 8c0 53 12.5 103 34.6 147.4l-137 137c-3.1 3.1-3.1 8.2 0 11.3l42.7 42.7c3.1 3.1 8.2 3.1 11.3 0L846.2 79.8l.1-.1c3.1-3.2 3-8.3-.2-11.4zM417 401V232c0-50.6 41.9-92 94-92c46 0 84.1 32.3 92.3 74.7L417 401z",fill:"currentColor"},null,-1),Tt=[Mt,$t,zt],Ht=Z({name:"AudioMutedOutlined",render:function($,H){return P(),Q("svg",xt,Tt)}}),St={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Dt=K("path",{d:"M911.5 700.7a8 8 0 0 0-10.3-4.8L840 718.2V180c0-37.6-30.4-68-68-68H252c-37.6 0-68 30.4-68 68v538.2l-61.3-22.3c-.9-.3-1.8-.5-2.7-.5c-4.4 0-8 3.6-8 8V763c0 3.3 2.1 6.3 5.3 7.5L501 910.1c7.1 2.6 14.8 2.6 21.9 0l383.8-139.5c3.2-1.2 5.3-4.2 5.3-7.5v-59.6c0-1-.2-1.9-.5-2.8zM512 837.5l-256-93.1V184h512v560.4l-256 93.1zM660.6 312h-54.5c-3 0-5.8 1.7-7.1 4.4l-84.7 168.8H511l-84.7-168.8a8 8 0 0 0-7.1-4.4h-55.7c-1.3 0-2.6.3-3.8 1c-3.9 2.1-5.3 7-3.2 10.8l103.9 191.6h-57c-4.4 0-8 3.6-8 8v27.1c0 4.4 3.6 8 8 8h76v39h-76c-4.4 0-8 3.6-8 8v27.1c0 4.4 3.6 8 8 8h76V704c0 4.4 3.6 8 8 8h49.9c4.4 0 8-3.6 8-8v-63.5h76.3c4.4 0 8-3.6 8-8v-27.1c0-4.4-3.6-8-8-8h-76.3v-39h76.3c4.4 0 8-3.6 8-8v-27.1c0-4.4-3.6-8-8-8H564l103.7-191.6c.6-1.2 1-2.5 1-3.8c-.1-4.3-3.7-7.9-8.1-7.9z",fill:"currentColor"},null,-1),Pt=[Dt],Lt=Z({name:"MoneyCollectOutlined",render:function($,H){return P(),Q("svg",St,Pt)}}),At=le(),We=()=>{const M=Me.Get("api/captcha",{name:"postGetter",params:{},localCache:null,hitSource:[]});return M.meta={shouldRemind:!1},M},Ge=M=>{const $=new FormData;$.append("file",M.file),$.append("mode",M.mode),$.append("binggan",M.binggan),$.append("thread_id",String(M.thread_id)),$.append("forum_id",String(M.forum_id));const H=Me.Post("api/img_upload",$,{name:"uploadImagePoster",params:{},localCache:null,hitSource:[]});return H.meta={shouldRemind:!0},H},Ut=M=>{const $=new FormData;$.append("file",M.file);const H=mt.Post(M.url,$,{name:"uploadImageToPublicPoster",params:{},localCache:null,hitSource:[]});return H.meta={shouldRemind:!0},H},ua=M=>{const $=Me.Post("api/store_pool",M,{name:"poolStorePoster",params:{},localCache:null,hitSource:[]});return $.meta={shouldRemind:!0},$},ia=()=>{const M=Me.Get("api/get_pool",{name:"poolDataGetter",params:{binggan:At.binggan},localCache:null,hitSource:[]});return M.meta={shouldRemind:!1},M},Bt=["src"],Rt=Z({__name:"CaptchaModal",emits:["waterUnlockOnSuccess"],setup(M,{expose:$,emit:H}){const U=ae(),l=le(),y=v(),z=X(()=>f.value.captcha_key),L=v(!1);function w(){L.value=!0,D()}$({show:w});const s=H,{data:f,loading:T,send:D}=ve(We,{immediate:!1}),{fetch:B}=Ke();function r(){B(We())}const{loading:h,send:o,onSuccess:I,onError:m}=ve(d=>pt(d),{immediate:!1});function u(){if(!y.value){window.$message.error("验证码不能为空");return}const d={binggan:l.binggan,captcha_code:y.value,captcha_key:z.value};o(d),I(()=>{y.value="",L.value=!1,s("waterUnlockOnSuccess")}),m(()=>{y.value="",r()})}return(d,b)=>(P(),O(e(de),{show:L.value,"onUpdate:show":b[3]||(b[3]=C=>L.value=C),"display-directive":"if"},{default:a(()=>[t(e(ie),{style:q({maxWidth:e(U).modalMaxWidth}),title:"验证码",closable:"",onClose:b[2]||(b[2]=C=>L.value=!1),size:"small"},{action:a(()=>[t(e(N),{justify:"end"},{default:a(()=>[t(e(F),{type:"primary",onClick:u,loading:e(h),disabled:e(h)},{default:a(()=>[n("提交")]),_:1},8,["loading","disabled"]),t(e(F),{onClick:b[1]||(b[1]=C=>L.value=!1)},{default:a(()=>[n("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(N),{vertical:""},{default:a(()=>[t(e(J),null,{default:a(()=>[n(" 嗷……你可能刷太多了，休息一下吧。 ")]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"3.2rem"},class:"round"},{default:a(()=>[n("输入")]),_:1}),t(e(te),{placeholder:"请输入验证码",maxlength:"4","show-count":"",value:y.value,"onUpdate:value":b[0]||(b[0]=C=>y.value=C),onKeyup:me(u,["enter"])},null,8,["value"])]),_:1}),e(T)?ee("",!0):(P(),Q("img",{key:0,src:"data:image/png;base64,"+e(f).captcha_img,style:{"max-width":"200px"},onClick:r},null,8,Bt)),t(e(J),null,{default:a(()=>[n(" 点击可更换验证码。不区分大小写。 ")]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),jt=Z({__name:"BattleModal",props:{threadId:{},forumId:{},randomHeadsGroup:{}},emits:["refreshPostsList"],setup(M,{expose:$,emit:H}){const U=ae(),l=le(),y=v(null),z=M,L=X(()=>{const d=[{value:1,label:"共通",available:!0}];return bt.forEach(b=>{b.value===z.randomHeadsGroup&&d.push(b)}),d}),w=X(()=>{const d=Se[f.value-1];if(f.value===1){const b=l.userData.my_battle_chara.filter(C=>!C.not_use).map((C,Y)=>({value:Y+240,label:C.name}));return d.concat(b)}else return d}),s=v(1),f=v(z.randomHeadsGroup),T=v(100);Le(f,d=>{d===1?s.value=Se[d-1][8].value:s.value=Se[d-1][0].value},{immediate:!0});const{loading:D,send:B,onSuccess:r,onError:h}=ve(d=>wt(d),{immediate:!1});function o(d){var G;const{timestamp:b,newPostKey:C}=_t((G=d==null?void 0:d.isTrusted)!=null?G:!0,z.threadId,l.binggan),Y={binggan:l.binggan,forum_id:z.forumId,thread_id:z.threadId,battle_olo:T.value,chara_id:s.value>=240?s.value-240:s.value,is_custom_chara:s.value>=240,chara_group:f.value-1,new_post_key:C,timestamp:b};B(Y)}r(()=>{u("refreshPostsList"),I.value=!1}),h(d=>{var b;d.error.cause!==void 0&&d.error.cause.code===244291&&((b=y.value)==null||b.show())});const I=v(!1);function m(){I.value=!0}$({show:m});const u=H;return(d,b)=>(P(),O(e(de),{show:I.value,"onUpdate:show":b[5]||(b[5]=C=>I.value=C),"display-directive":"if"},{default:a(()=>[t(e(ie),{style:q({maxWidth:e(U).modalMaxWidth}),title:"表情包大乱斗！",closable:"",onClose:b[4]||(b[4]=C=>I.value=!1),size:"small"},{action:a(()=>[t(e(N),{justify:"end"},{default:a(()=>[t(e(F),{type:"primary",onClick:o,loading:e(D)},{default:a(()=>[n("提交")]),_:1},8,["loading"]),t(e(F),{onClick:b[3]||(b[3]=C=>I.value=!1)},{default:a(()=>[n("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(N),{vertical:""},{default:a(()=>[t(e(J),null,{default:a(()=>[n("小斗怡情，大斗伤身，强斗奥飞湮灭")]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"3.2rem"}},{default:a(()=>[n("主题")]),_:1}),t(e(we),{value:f.value,"onUpdate:value":b[0]||(b[0]=C=>f.value=C),options:L.value},null,8,["value","options"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"3.2rem"}},{default:a(()=>[n("角色")]),_:1}),t(e(we),{value:s.value,"onUpdate:value":b[1]||(b[1]=C=>s.value=C),options:w.value},null,8,["value","options"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"3.2rem"}},{default:a(()=>[n("下注")]),_:1}),t(e(be),{value:T.value,"onUpdate:value":b[2]||(b[2]=C=>T.value=C),max:1e6,min:1,step:100,parse:e(Xe),format:e(Fe),onKeyup:me(o,["enter"])},null,8,["value","parse","format"])]),_:1})]),_:1}),t(Rt,{ref_key:"CaptchaModalCom",ref:y,onWaterUnlockOnSuccess:o},null,512)]),_:1},8,["style"])]),_:1},8,["show"]))}}),Nt=Z({__name:"CodeModal",emits:["insertCode"],setup(M,{expose:$,emit:H}){const U=ae(),l=v(0),y=v(),z=v(),L=[{value:0,label:"折叠内容"},{value:1,label:"超链接"},{value:2,label:"图片"}],w=X(()=>[{prepend_1:"显示内容",prepend_2:"隐藏内容",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"显示内容",inputDefault_2:"隐藏内容",insertText:`<details><summary>${y.value}</summary>${z.value}</details>`},{prepend_1:"显示文字",prepend_2:"链接网址",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"点我跳转",inputDefault_2:"",insertText:`<a href="${z.value}">${y.value}</a>`},{prepend_1:"图片链接",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<img src="${y.value}">`}]);Le(l,()=>{y.value=w.value[l.value].inputDefault_1,z.value=w.value[l.value].inputDefault_2},{immediate:!0});function s(){D("insertCode",w.value[l.value].insertText),y.value=w.value[l.value].inputDefault_1,z.value=w.value[l.value].inputDefault_2,f.value=!1}const f=v(!1);function T(){f.value=!0}$({show:T});const D=H;return(B,r)=>(P(),O(e(de),{show:f.value,"onUpdate:show":r[5]||(r[5]=h=>f.value=h),"display-directive":"if"},{default:a(()=>[t(e(ie),{style:q({maxWidth:e(U).modalMaxWidth}),title:"快捷代码",closable:"",onClose:r[4]||(r[4]=h=>f.value=!1),size:"small"},{action:a(()=>[t(e(N),{justify:"end"},{default:a(()=>[t(e(F),{type:"primary",onClick:s},{default:a(()=>[n("插入")]),_:1}),t(e(F),{onClick:r[3]||(r[3]=h=>f.value=!1)},{default:a(()=>[n("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(N),{vertical:""},{default:a(()=>[t(e(J),null,{default:a(()=>[n("代码预览：")]),_:1}),t(e(J),null,{default:a(()=>[n(se(w.value[l.value].insertText),1)]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n("代码内容")]),_:1}),t(e(we),{value:l.value,"onUpdate:value":r[0]||(r[0]=h=>l.value=h),options:L},null,8,["value"])]),_:1}),Ae(t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n(se(w.value[l.value].prepend_1),1)]),_:1}),t(e(te),{value:y.value,"onUpdate:value":r[1]||(r[1]=h=>y.value=h),onKeyup:me(s,["enter"])},null,8,["value"])]),_:1},512),[[Ue,w.value[l.value].inputEnable_1]]),Ae(t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n(se(w.value[l.value].prepend_2),1)]),_:1}),t(e(te),{value:z.value,"onUpdate:value":r[2]||(r[2]=h=>z.value=h),onKeyup:me(s,["enter"])},null,8,["value"])]),_:1},512),[[Ue,w.value[l.value].inputEnable_2]])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Et=["width","height"],Wt=["width","height"],Ot=K("div",null,"颜色",-1),Xt=K("div",null,"画笔",-1),Ft=["onClick"],Gt=K("div",null,"操作",-1),Yt=["title","innerHTML","onClick"],Vt=Z({__name:"DrawerModal",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(M,{expose:$,emit:H}){const U=le();ae();const l=M,y=v(!1);function z(){y.value=!0}$({show:z});const L=H,w=v(),s=X(()=>{var i;return(i=w.value)==null?void 0:i.getContext("2d")}),f=v(),T=X(()=>{var i;return(i=f.value)==null?void 0:i.getContext("2d")}),D=new Image;let B=!1;const r={x:0,y:0,width:0,height:0},h=v([]),o=v([]),I=v([]),m=v({lineWidth:3,lineColor:"#111111",shadowBlur:1}),u=v(!1),d=v(!1);let b=0,C=0;const Y=X(()=>window.innerWidth>836?796:window.innerWidth-36),G=X(()=>window.innerHeight>580?400:window.innerHeight-212),j=X(()=>[{title:"上一步",action:"prev",className:h.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>'},{title:"下一步",action:"next",className:o.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/></svg>'},{title:"橡皮擦",action:"eraser",className:h.value.length||o.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"/></svg>'},{title:"清除",action:"clear",className:h.value.length||o.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/><path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/></svg>'},{title:"拖动背景",action:"drag",className:d.value?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor"  viewBox="0 0 16 16"> <path d="M6.75 1a.75.75 0 0 1 .75.75V8a.5.5 0 0 0 1 0V5.467l.086-.004c.317-.012.637-.008.816.027.134.027.294.096.448.182.077.042.15.147.15.314V8a.5.5 0 1 0 1 0V6.435a4.9 4.9 0 0 1 .106-.01c.316-.024.584-.01.708.04.118.046.3.207.486.43.081.096.15.19.2.259V8.5a.5.5 0 0 0 1 0v-1h.342a1 1 0 0 1 .995 1.1l-.271 2.715a2.5 2.5 0 0 1-.317.991l-1.395 2.442a.5.5 0 0 1-.434.252H6.035a.5.5 0 0 1-.416-.223l-1.433-2.15a1.5 1.5 0 0 1-.243-.666l-.345-3.105a.5.5 0 0 1 .399-.546L5 8.11V9a.5.5 0 0 0 1 0V1.75A.75.75 0 0 1 6.75 1zM8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v5.34l-1.2.24a1.5 1.5 0 0 0-1.196 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.271-2.715a2 2 0 0 0-1.99-2.199h-.581a5.114 5.114 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.632 2.632 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002zm2.094 2.025z"/></svg>'}]),x=[{lineWidth:3,innerHTML:"🖌️",font_size:12},{lineWidth:6,innerHTML:"🖌️",font_size:16},{lineWidth:12,innerHTML:"🖌️",font_size:20}];function A(){const i=new ImageData(Y.value,G.value);I.value.push(i)}Oe(()=>{A()});function pe(){s.value.lineWidth=m.value.lineWidth,s.value.shadowBlur=m.value.shadowBlur,s.value.shadowColor=m.value.lineColor,s.value.strokeStyle=m.value.lineColor,s.value.lineCap="round",s.value.lineJoin="round"}function ye(i){if(B)if(d.value){const c=i.target;let _,k;i instanceof MouseEvent?(_=i.clientX-c.getBoundingClientRect().x,k=i.clientY-c.getBoundingClientRect().y):(_=i.changedTouches[0].clientX-c.getBoundingClientRect().x,k=i.changedTouches[0].clientY-c.getBoundingClientRect().y),f.value.height=f.value.height;let R={x:r.x+(_-b),y:r.y+(k-C),width:r.width,height:r.height};ne(D,R)}else{s.value.beginPath(),s.value.moveTo(b,C);const c=i.target;let _,k;i instanceof MouseEvent?(_=i.clientX-c.getBoundingClientRect().x,k=i.clientY-c.getBoundingClientRect().y):(_=i.changedTouches[0].clientX-c.getBoundingClientRect().x,k=i.changedTouches[0].clientY-c.getBoundingClientRect().y),s.value.globalCompositeOperation=u.value?"destination-out":"source-over",s.value.lineTo(_,k),[b,C]=[_,k],s.value.stroke()}}function Ce(i){if(d.value){const c=i.target;let _,k;i instanceof MouseEvent?(_=i.clientX-c.getBoundingClientRect().x,k=i.clientY-c.getBoundingClientRect().y):(_=i.changedTouches[0].clientX-c.getBoundingClientRect().x,k=i.changedTouches[0].clientY-c.getBoundingClientRect().y),r.x+=_-b,r.y+=k-C,B=!1}else{const c=s.value.getImageData(0,0,w.value.width,w.value.height);o.value.length?(I.value=[],I.value=I.value.concat(h.value),I.value.push(c),o.value=[]):I.value.push(c),B=!1}}function ke(i){if(d.value){const c=i.target;let _,k;i instanceof MouseEvent?(_=i.clientX-c.getBoundingClientRect().x,k=i.clientY-c.getBoundingClientRect().y):(_=i.changedTouches[0].clientX-c.getBoundingClientRect().x,k=i.changedTouches[0].clientY-c.getBoundingClientRect().y),b=_,C=k,B=!0}else{B=!0;const c=i.target;let _,k;i instanceof MouseEvent?(_=i.clientX-c.getBoundingClientRect().x,k=i.clientY-c.getBoundingClientRect().y):(_=i.changedTouches[0].clientX-c.getBoundingClientRect().x,k=i.changedTouches[0].clientY-c.getBoundingClientRect().y),pe(),b=_,C=k;const R=s.value.getImageData(0,0,w.value.width,w.value.height);h.value.push(R)}}function $e(i){m.value.lineWidth=i,u.value=!1,d.value=!1}function fe(i){switch(i){case"prev":if(h.value.length){const c=h.value.pop(),_=I.value[h.value.length+1];o.value.push(_),s.value.putImageData(c,0,0)}break;case"next":if(o.value.length){const c=o.value.pop(),_=I.value[I.value.length-o.value.length-2];h.value.push(_),s.value.putImageData(c,0,0)}break;case"clear":s.value.clearRect(0,0,w.value.width,w.value.height),h.value=[],o.value=[],I.value=[I.value[0]];break;case"eraser":u.value=!0;break;case"drag":d.value=!0;break}}function ze(i){if(i.file.file){var c=new FileReader;c.readAsDataURL(i.file.file),c.onload=_=>{D.src=_.target.result,D.onload=function(){var k=f,R=D;r.width=R.width,r.height=R.height,R.width/R.height>=k.value.width/k.value.height?R.width>k.value.width&&(r.width=k.value.width,r.height=R.height*k.value.width/R.width):R.height>k.value.height&&(r.width=R.width*k.value.height/R.height,r.height=k.value.height),ne(R,r)}}}}function ne(i,c){T.value.drawImage(i,c.x,c.y,c.width,c.height)}const ce=v(!1);function ge(){let i=new Image;i.src=w.value.toDataURL("image/png"),i.onload=()=>{T.value.drawImage(i,0,0),c(f.value)};function c(k){k.toBlob(R=>{R&&_(R)},"image/png")}function _(k){const R={binggan:U.binggan,file:k,mode:"img",thread_id:l.threadId,forum_id:l.forumId};ce.value=!0,Ge(R).then(Ie=>{L("insertImage",Ie.file_url),ce.value=!1,y.value=!1}).catch(()=>{ce.value=!1})}}return(i,c)=>(P(),O(e(de),{show:y.value,"onUpdate:show":c[5]||(c[5]=_=>y.value=_),"display-directive":"show"},{default:a(()=>[t(e(ie),{style:q({maxWidth:Y.value+4+"px"}),title:"涂鸦板",closable:"",onClose:c[4]||(c[4]=_=>y.value=!1),size:"small","content-style":{padding:"0px"}},{default:a(()=>[K("div",{id:"canvas-container",style:q({width:Y.value+"px",height:G.value+"px"})},[K("canvas",{id:"drawer-canvas-background",ref_key:"canvasBackground",ref:f,width:Y.value,height:G.value,onTouchmove:c[0]||(c[0]=De(()=>{},["prevent"]))},null,40,Et),K("canvas",{id:"drawer-canvas",ref_key:"canvas",ref:w,class:Be({painting:!d.value,dragging:d.value}),width:Y.value,height:G.value,onTouchmove:[c[1]||(c[1]=De(()=>{},["prevent"])),ye],onMousedown:ke,onMouseup:Ce,onMousemove:ye,onTouchstart:ke,onTouchend:Ce},null,42,Wt)],4),t(e(qe),{"x-gap":"6",cols:4},{default:a(()=>[t(e(He),{span:"1"},{default:a(()=>[Ot,t(e(Je),{value:m.value.lineColor,"onUpdate:value":c[2]||(c[2]=_=>m.value.lineColor=_),modes:["hex"],"show-alpha":!1},null,8,["value"])]),_:1}),t(e(He),{span:"1"},{default:a(()=>[Xt,t(e(N),{id:"canvas-brush",size:"small",align:"center"},{default:a(()=>[(P(),Q(re,null,_e(x,(_,k)=>K("span",{key:k,style:q({fontSize:_.font_size+"px"}),onClick:R=>$e(_.lineWidth)},se(_.innerHTML),13,Ft)),64))]),_:1})]),_:1}),t(e(He),{span:"2"},{default:a(()=>[Gt,t(e(N),{id:"canvas-control",size:"small"},{default:a(()=>[(P(!0),Q(re,null,_e(j.value,(_,k)=>(P(),Q("span",{key:k,title:_.title,class:Be([_.className]),innerHTML:_.innerHTML,onClick:R=>fe(_.action)},null,10,Yt))),128))]),_:1})]),_:1})]),_:1})]),action:a(()=>[t(e(N),{justify:"end"},{default:a(()=>[t(e(Pe),{"default-upload":!1,onChange:ze,"show-file-list":!1},{default:a(()=>[t(e(F),null,{default:a(()=>[n("加载图片")]),_:1})]),_:1}),t(e(F),{type:"primary",onClick:ge,disabled:i.userIsLocked,loading:ce.value},{default:a(()=>[n("上传")]),_:1},8,["disabled","loading"]),t(e(F),{onClick:c[3]||(c[3]=_=>y.value=!1)},{default:a(()=>[n("关闭")]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Kt=["onClick"],qt=["src"],Jt=Z({__name:"EmojiTab",props:{randomHeadsGroup:{default:1},autoHide:{type:Boolean,default:!0}},emits:["appendEmoji"],setup(M,{emit:$}){const H=le(),U=ae(),l=M,y=X(()=>{let r=0,h=0;return U.isMobile&&(U.userCustom.sidebarLeft?r=20:h=20),{paddingLeft:r+"px",paddingRight:h+"px"}}),z=v(),L=X(()=>{const r=kt.filter(h=>!H.userData.emoji_excluded.includes(h.id)&&(h.headsId===0||h.headsId===l.randomHeadsGroup));return H.userData.my_emoji&&r.unshift({id:0,headsId:0,name:"自定义",emojis:H.userData.my_emoji}),r}),w=$;function s(r,h){w("appendEmoji",r,h==="自定义"),l.autoHide&&(z.value=-1)}let f=!1;function T(r,h){return he("span",{onClick:()=>D(h),innerHTML:r})}function D(r){r===z.value&&(f=!0,z.value=-1)}function B(r,h){return f?(f=!1,!1):!0}return(r,h)=>(P(),O(e(Qe),{type:"line","bar-width":0,animated:"",onBeforeLeave:B,size:e(U).isMobile?"small":"medium","default-value":-1,value:z.value,"onUpdate:value":h[0]||(h[0]=o=>z.value=o)},{default:a(()=>[(P(!0),Q(re,null,_e(L.value,(o,I,m)=>(P(),O(e(Re),{name:o.id,tab:T(o.name,o.id)},{default:a(()=>[t(e(N),{size:"small",class:"emoji-container",style:q(y.value)},{default:a(()=>[(P(!0),Q(re,null,_e(o.emojis,(u,d,b)=>(P(),Q("div",{class:"emoji-box",onClick:C=>s(u,o.name)},[K("img",{src:u,class:"emoji-in-box"},null,8,qt)],8,Kt))),256))]),_:2},1032,["style"])]),_:2},1032,["name","tab"]))),256)),t(e(Re),{name:-1,tab:"隐藏"})]),_:1},8,["size","value"]))}}),Qt=Z({__name:"HongbaoModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(M,{expose:$,emit:H}){const U=ae(),l=le(),y=M,z=[{value:1,label:"口令红包 直接公开口令"},{value:2,label:"抢答红包 回复答对才公开口令"},{value:3,label:"暗号红包 抢完红包才公开口令"}],L=[{value:1,label:"随机olo"},{value:2,label:"定额olo"}],w=v(3e3),s=v(10),f=v(1),T=v(1),D=v(),B=v(),r=v([]),h=v(!1),o=v(1);function I(j){j===1&&o.value<5&&(o.value+=1),j===-1&&o.value>1&&(r.value.splice(o.value-1,1),o.value-=1)}const{loading:m,send:u,onSuccess:d}=ve(j=>yt(j),{immediate:!1});function b(){if(D.value===void 0){window.$message.error("必须填写“红包口令”喔");return}if(B.value===void 0&&[2,3].includes(T.value)){window.$message.error("抢答红包或者暗号红包时，必须填写“口令提示”喔");return}if(f.value===2&&w.value%s.value!==0){window.$message.error("选择定额红包时，总额要是红包数量的整倍数喔");return}const j={binggan:l.binggan,forum_id:y.forumId,thread_id:y.threadId,hongbao_olo:w.value,hongbao_num:s.value,type:f.value,key_word_type:T.value,hongbao_key_word:D.value,hongbao_question:B.value,hongbao_message_json:r.value,hongbao_olo_hide:h.value};u(j)}d(()=>{G("refreshPostsList"),C.value=!1});const C=v(!1);function Y(){C.value=!0}$({show:Y});const G=H;return(j,x)=>(P(),O(e(de),{show:C.value,"onUpdate:show":x[11]||(x[11]=A=>C.value=A),"display-directive":"if"},{default:a(()=>[t(e(ie),{style:q({maxWidth:e(U).modalMaxWidth}),title:"发起红包",closable:"",onClose:x[10]||(x[10]=A=>C.value=!1),size:"small"},{action:a(()=>[t(e(N),{justify:"end"},{default:a(()=>[t(e(F),{type:"primary",onClick:b,disabled:e(m),loading:e(m)},{default:a(()=>[n("提交")]),_:1},8,["disabled","loading"]),t(e(F),{onClick:x[9]||(x[9]=A=>C.value=!1)},{default:a(()=>[n("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(N),{vertical:""},{default:a(()=>[K("div",null,[t(e(J),{depth:3},{default:a(()=>[n("温馨提示：")]),_:1}),n("在红包总额以外，会追加扣除7%手续费。 ")]),K("div",null,[t(e(J),{depth:3},{default:a(()=>[n("总共扣除：")]),_:1}),t(e(J),{type:"warning"},{default:a(()=>[n(se(Math.ceil(w.value*(e(U).isDouble11?1.02:1.07))),1)]),_:1}),n("个奥利奥 ")]),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n("红包类型")]),_:1}),t(e(we),{value:T.value,"onUpdate:value":x[0]||(x[0]=A=>T.value=A),options:z},null,8,["value"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n("olo类型")]),_:1}),t(e(we),{value:f.value,"onUpdate:value":x[1]||(x[1]=A=>f.value=A),options:L},null,8,["value"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n("红包个数")]),_:1}),t(e(be),{value:s.value,"onUpdate:value":x[2]||(x[2]=A=>s.value=A),max:50,min:5,step:5},null,8,["value"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n("olo总额")]),_:1}),t(e(be),{value:w.value,"onUpdate:value":x[3]||(x[3]=A=>w.value=A),max:1e6,min:3e3,step:1e3,parse:e(Xe),format:e(Fe)},null,8,["value","parse","format"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n("红包口令")]),_:1}),t(e(te),{value:D.value,"onUpdate:value":x[4]||(x[4]=A=>D.value=A),placeholder:"必填"},null,8,["value"])]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n("口令提示")]),_:1}),t(e(te),{value:B.value,"onUpdate:value":x[5]||(x[5]=A=>B.value=A),placeholder:"抢答红包或者暗号红包时，必填"},null,8,["value"])]),_:1}),(P(!0),Q(re,null,_e(o.value,A=>(P(),O(e(E),null,{default:a(()=>[t(e(W),{style:{width:"5.2rem"}},{default:a(()=>[n("回复留言")]),_:1}),t(e(te),{value:r.value[A-1],"onUpdate:value":pe=>r.value[A-1]=pe,placeholder:`#${A}（可选） 多个留言时随机抽取一个`,maxlength:255},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024))),256)),t(e(N),{size:"small",align:"center"},{default:a(()=>[t(e(J),{depth:3},{default:a(()=>[n("留言数量")]),_:1}),t(e(je),{size:"tiny",circle:"",disabled:o.value===5,onClick:x[6]||(x[6]=A=>I(1))},{icon:a(()=>[t(e(oe),null,{default:a(()=>[t(e(Ze))]),_:1})]),_:1},8,["disabled"]),t(e(je),{size:"tiny",circle:"",disabled:o.value===1,onClick:x[7]||(x[7]=A=>{I(-1)})},{icon:a(()=>[t(e(oe),null,{default:a(()=>[t(e(et))]),_:1})]),_:1},8,["disabled"]),t(e(tt),{checked:h.value,"onUpdate:checked":x[8]||(x[8]=A=>h.value=A),label:"隐藏olo总额",style:{"margin-left":"auto"}},null,8,["checked"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Zt=Z({__name:"ImageUpload",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(M,{emit:$}){const H=ae(),U=le(),l=v(null),y=M,z=$,L=["mjj","imgbb","freeimage","picgo","tutu"],w=["imge","imgtbl"],s=X(()=>y.forumId===419?0:L.includes(H.userCustom.imgHost)?1:w.includes(H.userCustom.imgHost)?2:1),f=v(!1),T=({file:o,data:I,headers:m,withCredentials:u,action:d,onFinish:b,onError:C,onProgress:Y})=>{var G;if(o.file!==null){if(o.file.size>1024e3){window.$message.error("图片大小不能超过10M喔"),(G=l.value)==null||G.clear();return}const j={binggan:U.binggan,file:o.file,mode:"img",thread_id:y.threadId,forum_id:y.forumId};f.value=!0,Ge(j).then(x=>{var A;z("insertImage",x.file_url),(A=l.value)==null||A.clear(),f.value=!1}).catch(()=>{var x;(x=l.value)==null||x.clear(),f.value=!1})}};function D(o){var I=document.getElementsByTagName("body")[0],m=document.createElement("script");m.setAttribute("id","image-upload-js");var u=document.getElementById("upload-button");o=="mjj"&&(m.setAttribute("async","true"),m.setAttribute("data-mode","manual"),m.setAttribute("src","https://mjj.today/sdk/pup.js"),m.setAttribute("data-url","https://mjj.today/upload"),m.setAttribute("data-auto-insert","html-embed"),u==null||u.setAttribute("data-chevereto-pup-trigger","")),o=="imgbb"&&(m.setAttribute("async","true"),m.setAttribute("data-mode","manual"),m.setAttribute("src","https://imgbb.com/upload.js"),m.setAttribute("data-url","https://imgbb.com/upload"),m.setAttribute("data-auto-insert","html-embed-medium"),u==null||u.setAttribute("data-imgbb-trigger","")),o=="freeimage"&&(m.setAttribute("async","true"),m.setAttribute("data-mode","manual"),m.setAttribute("src","https://freeimage.host/sdk/pup.js"),m.setAttribute("data-url","https://freeimage.host/upload"),m.setAttribute("data-auto-insert","html-embed-medium"),u==null||u.setAttribute("data-chevereto-pup-trigger","")),o=="picgo"&&(m.setAttribute("async","true"),m.setAttribute("data-mode","manual"),m.setAttribute("src","https://www.picgo.net/sdk/pup.js"),m.setAttribute("data-url","https://www.picgo.net/upload"),m.setAttribute("data-auto-insert","html-embed"),u==null||u.setAttribute("data-chevereto-pup-trigger","")),I.appendChild(m)}const B=X(()=>({imge:"https://imge.cc/api/v1/upload",imgtbl:"https://imgtbl.com/api/v1/upload"})[H.userCustom.imgHost]||""),r=({file:o,data:I,headers:m,withCredentials:u,action:d,onFinish:b,onError:C,onProgress:Y})=>{if(o.file!==null){const G={file:o.file,url:B.value};f.value=!0,Ut(G).then(j=>{var x;console.log(j.data),j.status===!0?z("insertImage",j.data.links.url):window.$message.error(j.message),(x=l.value)==null||x.clear(),f.value=!1}).catch(()=>{var j;(j=l.value)==null||j.clear(),f.value=!1})}};function h(){const o=document.getElementById("image-upload-js");o==null||o.remove()}return Oe(()=>{L.includes(H.userCustom.imgHost)&&D(H.userCustom.imgHost)}),at(()=>{h()}),(o,I)=>(P(),Q(re,null,[s.value===0?(P(),O(e(Pe),{key:0,accept:"image/*",action:"/api/img_upload","custom-request":T,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:l},{default:a(()=>[t(e(F),{style:{"margin-right":"auto"},disabled:o.userIsLocked,loading:f.value},{default:a(()=>[n("上传图片")]),_:1},8,["disabled","loading"])]),_:1},512)):ee("",!0),s.value===1?(P(),O(e(F),{key:1,style:{"margin-right":"auto"},disabled:o.userIsLocked,"data-target":"#content-input",id:"upload-button"},{default:a(()=>[n("上传图片")]),_:1},8,["disabled"])):ee("",!0),s.value===2?(P(),O(e(Pe),{key:2,accept:"image/*",action:"imgHostType2Url","custom-request":r,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:l},{default:a(()=>[t(e(F),{style:{"margin-right":"auto"},disabled:o.userIsLocked,loading:f.value},{default:a(()=>[n("上传图片")]),_:1},8,["disabled","loading"])]),_:1},512)):ee("",!0)],64))}}),ea=Z({__name:"PingbiciModal",setup(M,{expose:$}){const H=ae(),U=le(),l=v(),{loading:y,send:z,onSuccess:L}=ve(T=>ft(T),{immediate:!1});function w(){if(!l.value){window.$message.error("请填写屏蔽词");return}const T={binggan:U.binggan,content_pingbici:l.value};z(T)}L(()=>{U.refreshUserData(),s.value=!1});const s=v(!1);function f(){s.value=!0}return $({show:f}),(T,D)=>(P(),O(e(de),{show:s.value,"onUpdate:show":D[3]||(D[3]=B=>s.value=B),"display-directive":"if"},{default:a(()=>[t(e(ie),{style:q({maxWidth:e(H).modalMaxWidth}),title:"追加屏蔽词",closable:"",onClose:D[2]||(D[2]=B=>s.value=!1),size:"small"},{action:a(()=>[t(e(N),{justify:"end"},{default:a(()=>[t(e(F),{type:"primary",onClick:w,loading:e(y),disabled:!l.value||e(y)},{default:a(()=>[n("提交")]),_:1},8,["loading","disabled"]),t(e(F),{onClick:D[1]||(D[1]=B=>s.value=!1)},{default:a(()=>[n("关闭")]),_:1})]),_:1})]),default:a(()=>[t(e(N),{vertical:""},{default:a(()=>[t(e(J),null,{default:a(()=>[n("暂时只做了“内容屏蔽词”的追加")]),_:1}),t(e(E),null,{default:a(()=>[t(e(W),{style:{width:"4.2rem"}},{default:a(()=>[n("屏蔽词")]),_:1}),t(e(te),{value:l.value,"onUpdate:value":D[0]||(D[0]=B=>l.value=B),max:255,onKeyup:me(w,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),ra=Z({__name:"PostInput",props:{mode:{},disabled:{type:Boolean},handling:{type:Boolean},forumId:{default:0},threadId:{default:0},randomHeadsGroup:{default:1}},emits:["contentCommit","refreshPostsList"],setup(M,{expose:$,emit:H}){const U=le(),l=ae(),y=v(null),z=v(null),L=v(null),w=v(null),s=v(null),f=v(null),T=v(null),D=M,B=X(()=>({fontSize:l.userCustom.fontSizeInput+"px",borderRadius:"10px"})),r=X(()=>{const p=(u.value.match(/\r?\n|\r/g)||[]).length+2;return p<5?5:p>10?10:p}),h=X(()=>U.userData.binggan.locked_ttl>0?`你的饼干封禁中，将于${Math.floor(U.userData.binggan.locked_ttl/3600)+1}小时后解封`:"正文内容"),o=X(()=>U.userData.binggan.locked_ttl>0),I=v(U.userData.binggan.nickname||"= ="),m=v(""),u=v(""),d=v(!1),b=v(!1);function C(){I.value=U.userData.binggan.nickname||"= =",m.value="",u.value="",d.value=!1,b.value=!1}const Y=X(()=>({id:0,created_at:"预览模式",is_deleted:0,thread_id:0,battle_id:null,hongbao_id:null,floor:0,random_head:1,created_by_admin:0,content:u.value,nickname:I.value,is_your_post:!0,hongbao_data:null})),G=X(()=>({class:{"nickname-input":!0,admin:b.value}})),j=v(!1),x=lt("emoji_auto_hide",!1);function A(){let p=[he(xe,{checked:j.value,"onUpdate:checked":g=>j.value=g,label:"实时预览"}),he(xe,{checked:x.value,"onUpdate:checked":g=>x.value=g,label:"表情包自动收起"})];return U.userData.binggan.admin!==0&&U.checkAdminForums(D.forumId)&&p.push(he(xe,{checked:b.value,"onUpdate:checked":g=>b.value=g,label:"管理员"})),he(N,{style:"padding:6px 8px",vertical:!0},()=>p)}const pe=[{key:"funcOption",type:"render",render:A}],ye=[{label:"涂鸦板",key:"draw",icon:Ee(vt,{size:"1.5rem"})},{label:"屏蔽词",key:"mute",icon:Ee(Ht,{size:"1.5rem"})}];function Ce(p){var g,S;switch(p){case"mute":(g=s.value)==null||g.show();break;case"draw":(S=T.value)==null||S.show();break}}Le(b,p=>I.value=p?"管理员":"= =");function ke(p){return p.selectionStart!=null?p.selectionStart:0}function $e(p,g){const S=ke(p),V=p.value,Ve=V.substring(0,S)+g+V.substring(S);u.value=Ve,setTimeout(()=>{p.selectionStart=S+g.length,p.selectionEnd=S+g.length},0)}function fe(p){const g=document.getElementById("content-input");$e(g,p),ge(),g.focus()}function ze(){gt({title:"要清空内容吗？",onPositiveClick:()=>u.value=""})}const ne=v([""]);function ce(){ne.value.length>1&&(ne.value.pop(),u.value=ne.value.slice(-1)[0])}function ge(){var p;ne.value.push((p=u.value)!=null?p:""),ne.value.length>20&&ne.value.shift()}function i(p,g){fe(`<img src='${p}' class='${g?"custom-emoji-img":"emoji-img"}'>`)}function c(p){fe(p)}function _(p){fe(`<img src='${p}' />`)}function k(p){var g;u.value=p,ge(),(g=y.value)==null||g.focus()}const R=H;function Ie(p){if(!p.isTrusted){const S={title:"错误",closable:!1,content:"请不要用脚本回复喔，可能会被系统判断为脚本并碎饼干。",positiveText:"确定"};window.$dialog.warning(S);return}new Promise(function(S,V){R("contentCommit",{contentInput:u.value,nicknameInput:I.value,postWithAdmin:b.value,titleInput:m.value,isDelay:d.value,ist:p.isTrusted},S)}).then(Ye)}function Ye(){m.value="",u.value="",d.value=!1}const Te=v(!1);return $({quoteHandle:k,isTyping:Te,resetInput:C}),(p,g)=>(P(),O(e(N),{vertical:""},{default:a(()=>[j.value?(P(),Q(re,{key:0},[p.mode==="thread"?(P(),O(e(ie),{class:"thread-title-container",size:"small",key:"title-card"},{default:a(()=>[K("span",{class:"thread-title",style:q({fontSize:e(l).userCustom.fontSizeThreadList+"px"})},se(m.value||"标题预览")+" [0] ",5)]),_:1})):ee("",!0),t(Ct,{"post-data":Y.value,"forum-id":0,"preview-mode":!0},null,8,["post-data"])],64)):ee("",!0),t(e(N),{size:"small",wrap:!1,align:"center",style:q({paddingRight:e(l).isMobile?"24px":"0px"})},{default:a(()=>[t(e(E),{style:{"max-width":"300px"}},{default:a(()=>[t(e(W),{style:{width:"3.2rem"}},{default:a(()=>[n("昵称")]),_:1}),t(e(te),{maxlength:30,value:I.value,"onUpdate:value":g[0]||(g[0]=S=>I.value=S),"show-count":"","input-props":G.value},null,8,["value","input-props"])]),_:1}),t(e(Ne),{trigger:e(l).isMobile?"click":"hover",options:pe,placement:"bottom-start"},{default:a(()=>[t(e(F),{size:"medium",style:{"flex-shrink":"0"},secondary:!1},{default:a(()=>[n("功能")]),_:1})]),_:1},8,["trigger"])]),_:1},8,["style"]),p.mode==="thread"?(P(),O(e(E),{key:1},{default:a(()=>[t(e(W),{style:{width:"3.2rem"}},{default:a(()=>[n("标题")]),_:1}),t(e(te),{maxlength:100,value:m.value,"onUpdate:value":g[1]||(g[1]=S=>m.value=S),"show-count":"",placeholder:"标题内容"},null,8,["value"])]),_:1})):ee("",!0),t(Jt,{"auto-hide":e(x),"random-heads-group":p.randomHeadsGroup,onAppendEmoji:i},null,8,["auto-hide","random-heads-group"]),t(e(N),{size:e(l).isMobile?"small":"medium",justify:"end",align:"center",style:q({paddingRight:e(l).isMobile?"24px":"0px"})},{default:a(()=>[t(e(Ne),{trigger:"click",options:ye,onSelect:Ce,size:e(l).isMobile?"medium":"large"},{default:a(()=>[t(e(oe),{size:e(l).isMobile?20:24,style:{cursor:"pointer"}},{default:a(()=>[t(e(nt))]),_:1},8,["size"])]),_:1},8,["size"]),p.mode==="post"?(P(),O(e(ue),{key:0,placement:"bottom-start",trigger:e(l).isMobile?"click":"hover"},{trigger:a(()=>[t(e(oe),{size:e(l).isMobile?28:32},{default:a(()=>[t(e(Lt),{style:{cursor:"pointer"},onClick:g[2]||(g[2]=S=>{var V;return(V=z.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:a(()=>[n(" 发红包 ")]),_:1},8,["trigger"])):ee("",!0),p.mode==="post"?(P(),O(e(ue),{key:1,placement:"bottom-start",trigger:e(l).isMobile?"click":"hover"},{trigger:a(()=>[t(e(oe),{size:e(l).isMobile?28:32},{default:a(()=>[t(e(ot),{style:{cursor:"pointer"},onClick:g[3]||(g[3]=S=>{var V;return(V=L.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:a(()=>[n(" 大乱斗 ")]),_:1},8,["trigger"])):ee("",!0),p.mode==="post"?(P(),O(e(ue),{key:2,placement:"bottom-start",trigger:e(l).isMobile?"click":"hover"},{trigger:a(()=>[t(e(oe),{size:e(l).isMobile?28:32},{default:a(()=>[t(e(st),{style:{cursor:"pointer"},onClick:g[4]||(g[4]=S=>{var V;return(V=w.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:a(()=>[n(" Roll点 ")]),_:1},8,["trigger"])):ee("",!0),t(e(ue),{placement:"bottom-start",trigger:e(l).isMobile?"click":"hover"},{trigger:a(()=>[t(e(oe),{size:e(l).isMobile?28:32},{default:a(()=>[t(e(ut),{style:{cursor:"pointer"},onClick:g[5]||(g[5]=S=>{var V;return(V=f.value)==null?void 0:V.show()})})]),_:1},8,["size"])]),default:a(()=>[n(" 快捷代码 ")]),_:1},8,["trigger"]),t(e(it),{vertical:""}),t(e(ue),{placement:"bottom-start",trigger:e(l).isMobile?"click":"hover"},{trigger:a(()=>[t(e(oe),{size:e(l).isMobile?28:32},{default:a(()=>[t(e(rt),{style:{cursor:"pointer"},onClick:ce})]),_:1},8,["size"])]),default:a(()=>[n(" 撤销 ")]),_:1},8,["trigger"]),t(e(ue),{placement:"bottom-start",trigger:e(l).isMobile?"click":"hover"},{trigger:a(()=>[t(e(oe),{size:e(l).isMobile?28:32},{default:a(()=>[t(e(dt),{style:{cursor:"pointer"},onClick:ze})]),_:1},8,["size"])]),default:a(()=>[n(" 清空 ")]),_:1},8,["trigger"])]),_:1},8,["size","style"]),t(e(ct),{value:u.value,"onUpdate:value":g[6]||(g[6]=S=>u.value=S),type:"textarea",placeholder:h.value,rows:r.value,ref_key:"contentInputDom",ref:y,style:q(B.value),"input-props":{id:"content-input"},disabled:o.value,onChange:ge,onKeyup:g[7]||(g[7]=me(De(S=>Ie(S),["ctrl"]),["enter"])),onBlur:g[8]||(g[8]=S=>Te.value=!1),onFocus:g[9]||(g[9]=S=>Te.value=!0)},null,8,["value","placeholder","rows","style","disabled"]),t(e(N),{justify:"end",align:"center"},{default:a(()=>[t(Zt,{"user-is-locked":o.value,"forum-id":p.forumId,"thread-id":p.threadId,onInsertImage:_},null,8,["user-is-locked","forum-id","thread-id"]),p.mode==="thread"?(P(),O(e(ue),{key:0,placement:"bottom-start",trigger:"hover",disabled:e(l).isMobile},{trigger:a(()=>[t(e(xe),{checked:d.value,"onUpdate:checked":g[10]||(g[10]=S=>d.value=S)},{default:a(()=>[n("延时发送")]),_:1},8,["checked"])]),default:a(()=>[n(" 第二天8点自动发出 ")]),_:1},8,["disabled"])):ee("",!0),t(e(ue),{placement:"bottom-start",trigger:"hover",disabled:e(l).isMobile},{trigger:a(()=>[t(e(F),{type:"primary",onClick:g[11]||(g[11]=S=>Ie(S)),loading:p.handling,disabled:p.handling||o.value},{default:a(()=>[n("提交")]),_:1},8,["loading","disabled"])]),default:a(()=>[n(" 可以Ctrl+Enter ")]),_:1},8,["disabled"])]),_:1}),t(Qt,{ref_key:"HongbaoModalCom",ref:z,"thread-id":p.threadId,"forum-id":p.forumId,onRefreshPostsList:g[12]||(g[12]=S=>R("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(jt,{ref_key:"BattleModalCom",ref:L,"thread-id":p.threadId,"forum-id":p.forumId,"random-heads-group":p.randomHeadsGroup,onRefreshPostsList:g[13]||(g[13]=S=>R("refreshPostsList"))},null,8,["thread-id","forum-id","random-heads-group"]),t(It,{ref_key:"RollModalCom",ref:w,"thread-id":p.threadId,"forum-id":p.forumId,onRefreshPostsList:g[14]||(g[14]=S=>R("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(ea,{ref_key:"PingbiciModalCom",ref:s},null,512),t(Nt,{ref_key:"CodeModalCom",ref:f,onInsertCode:c},null,512),t(Vt,{ref_key:"DrawerModalCom",ref:T,onInsertImage:_,"user-is-locked":o.value,"forum-id":p.forumId,"thread-id":p.threadId},null,8,["user-is-locked","forum-id","thread-id"])]),_:1}))}});export{ra as _,ua as a,Rt as b,ia as p};
