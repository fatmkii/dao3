var se=Object.defineProperty,ne=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var T=(n,t,r)=>t in n?se(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,L=(n,t)=>{for(var r in t||(t={}))re.call(t,r)&&T(n,r,t[r]);if(D)for(var r of D(t))ue.call(t,r)&&T(n,r,t[r]);return n},A=(n,t)=>ne(n,ie(t));import{w as P,A as u,F as c,j as _,n as U,b8 as I,l as de,a as e,b as me,u as ce,$ as F,d as w,aw as H,c as O,M as x,f as l,H as s,k as f,N as pe,s as b,C as M,Q as q,z as m,G as p,h as v,v as j,t as _e,i as ge,_ as be}from"./app-BfTmtkkR.js";import{d as y}from"./dayjs.min-SFkF4JZb.js";import{R as ve}from"./CloseCircleOutline-_Pf-X1zk.js";import{N as fe,a as he,b as we}from"./DataTable-C4T0tUGx.js";import{N as xe}from"./Spin-C-KLI5el.js";import{N as ke}from"./PostInput.vue_vue_type_script_setup_true_lang-RW7Jgga0.js";import{N as ze}from"./InputNumber-CXiFC-pm.js";import"./_commonjsHelpers-CDgoFxsB.js";import"./Input-C5i_M3Sx.js";import"./use-locale-CFDb4tef.js";import"./Ellipsis-Cj_va55S.js";import"./Select-BbGpypib.js";import"./Tag-COjQsRYJ.js";import"./Pagination-BC5oonbg.js";import"./prop-DfVitj0l.js";import"./Forward-BBoKPO9i.js";import"./download-sglA049O.js";import"./showDialog-DL9mDBDS.js";import"./randomHeads-BkUm2b7l.js";import"./FInput.vue_vue_type_script_setup_true_lang-Bj8uTtER.js";import"./FInputGroupLabel.vue_vue_type_script_setup_true_lang-eS7YpKAk.js";import"./InputGroup-DaZmah3D.js";import"./index-CM1ALi7Q.js";import"./inputNumberFormat-DaYmlx6U.js";import"./Grid-B_kGa6lq.js";import"./ColorPicker-Opp0lflh.js";import"./Add-BBepOlgD.js";import"./_createCompounder-CoPvQ65S.js";import"./emojiData-nGA-8XBz.js";import"./Tabs-C7u4nR1b.js";import"./Divider-BHB90_Ne.js";const ye={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},$e=_("path",{d:"M528.1 171.5L382 150.2L316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2L47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103l-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5l105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3l23.7-138.4l-100.6-98l139-20.2l62.2-126l62.2 126l139 20.2l-100.6 98z",fill:"currentColor"},null,-1),Ce=[$e],Ge=P({name:"StarRegular",render:function(t,r){return u(),c("svg",ye,Ce)}}),Se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ne=_("path",{d:"M48 366.92L240 480V284L48 170zM192 288c8.84 0 16 10.75 16 24s-7.16 24-16 24s-16-10.75-16-24s7.16-24 16-24zm-96 32c8.84 0 16 10.75 16 24s-7.16 24-16 24s-16-10.75-16-24s7.16-24 16-24z",fill:"currentColor"},null,-1),Ie=_("path",{d:"M272 284v196l192-113.08V170zm48 140c-8.84 0-16-10.75-16-24s7.16-24 16-24s16 10.75 16 24s-7.16 24-16 24zm0-88c-8.84 0-16-10.75-16-24s7.16-24 16-24s16 10.75 16 24s-7.16 24-16 24zm96 32c-8.84 0-16-10.75-16-24s7.16-24 16-24s16 10.75 16 24s-7.16 24-16 24zm0-88c-8.84 0-16-10.75-16-24s7.16-24 16-24s16 10.75 16 24s-7.16 24-16 24zm32 77.64z",fill:"currentColor"},null,-1),Me=_("path",{d:"M256 32L64 144l192 112l192-112zm0 120c-13.25 0-24-7.16-24-16s10.75-16 24-16s24 7.16 24 16s-10.75 16-24 16z",fill:"currentColor"},null,-1),Pe=[Ne,Ie,Me],Re=P({name:"DiceSharp",render:function(t,r){return u(),c("svg",Se,Pe)}}),De=U(),Te=n=>{const t=I.Get("api/gambles/"+n,{name:"gambleDataGetter-"+n,params:{binggan:De.binggan},localCache:null,hitSource:[]});return t.meta={shouldRemind:!1},t},Le=n=>{const t=I.Post("api/gambles/",n,{name:"userGamblePoster",params:{},localCache:null,hitSource:[]});return t.meta={shouldRemind:!0},t},Ae=n=>{const t=I.Post("api/gambles/close",n,{name:"adminGambleClosePoster",params:{},localCache:null,hitSource:[]});return t.meta={shouldRemind:!0},t},Fe=n=>{const t=I.Post("api/gambles/repeal",n,{name:"adminGambleRepealPoster",params:{},localCache:null,hitSource:[]});return t.meta={shouldRemind:!0},t},He={key:0},Oe={key:1},qe={key:2},je={key:3},Ue={class:"gamble-item"},Ve={style:{"margin-left":"auto"}},Be=P({__name:"GambleComponent",props:{gambleId:{},forumId:{}},setup(n){de(o=>({"19c896f6":e(V).dividerColor}));const t=n,r=U(),k=me(),V=ce(),h=F(),z=F(1e3),B=w(()=>{const o=y(d.value.end_date),i=y(),a=o.diff(i,"hour");return a>=1?`${a}小时后`:`${o.diff(i,"minute")}分钟后`}),Q=w(()=>y(d.value.end_date).format("YY年M月D日 HH:mm")),$=w(()=>y().isAfter(y(d.value.end_date))),Y=[{label:"开奖",key:"close",icon:H(Ge,{size:"1.5rem"})},{label:"中止",key:"repeal",icon:H(ve,{size:"1.5rem"})}];function E(o){switch(o){case"close":ae();break;case"repeal":le();break}}const J=[{title:"我的投注",key:"option_text",resizable:!0},{title:"投注额",key:"betting_olo",resizable:!0},{title:"赔率",key:"odds",render:o=>{var i,a;return(a=(i=o.odds)==null?void 0:i.toFixed(2))!=null?a:"（开奖时确定）"},resizable:!0},{title:"奖金",key:"win_olo",resizable:!0}],{data:C,loading:K,send:W,onSuccess:Qe}=O(Te(t.gambleId),{immediate:!1});function G(){W({binggan:r.binggan})}r.binggan&&G();const d=w(()=>C.value.gamble_question),S=w(()=>C.value.gamble_options),N=w(()=>{var o,i;return(i=(o=C.value.user_choices)==null?void 0:o.map(a=>{var g;return A(L({},a),{option_text:(g=S.value.find(oe=>oe.id===a.option_id))==null?void 0:g.option_text})}))!=null?i:[]}),X=w(()=>{var o;return(o=S.value.find(i=>i.id===d.value.result_option_id))==null?void 0:o.option_text}),{loading:R,send:Z,onSuccess:ee}=O(o=>Le(o),{immediate:!1});ee(()=>{G()});function te(){if(!h.value||!z.value){window.$message.error("请选择选项和输入投注额喔");return}const o={binggan:r.binggan,gamble_question_id:t.gambleId,bet_option:h.value,betting_olo:z.value},i={title:"参加菠菜",closable:!1,content:`确定要参加菠菜吗？将消耗${z.value}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Z(o)}};window.$dialog.warning(i)}function ae(){var a;if(!h.value){window.$message.error("请选择选项喔");return}const o={binggan:r.binggan,gamble_question_id:t.gambleId,result_option:h.value},i={title:"开奖菠菜",closable:!1,content:`确定要开奖吗？开奖选项是：${(a=S.value.find(g=>g.id===h.value))==null?void 0:a.option_text}`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Ae(o).then(()=>{G()})}};window.$dialog.warning(i)}function le(){const o={binggan:r.binggan,gamble_question_id:t.gambleId},i={title:"中止菠菜",closable:!1,content:"确定要中止菠菜吗？已投注的olo将会退回",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Fe(o).then(()=>{G()})}};window.$dialog.warning(i)}return(o,i)=>(u(),x(e(ge),{size:"small",bordered:!0},{default:l(()=>[s(e(xe),{show:e(K)},{default:l(()=>[e(C)!==void 0?(u(),x(e(f),{key:0,vertical:""},{default:l(()=>[s(e(f),{size:"small",align:"center",class:"gamble-title"},{default:l(()=>[s(e(pe),{size:e(k).isMobile?24:32},{default:l(()=>[s(e(Re))]),_:1},8,["size"]),_("span",null,b(d.value.title),1)]),_:1}),s(e(fe),{value:h.value,"onUpdate:value":i[0]||(i[0]=a=>h.value=a)},{default:l(()=>[s(e(f),{vertical:"",size:"large"},{default:l(()=>[(u(!0),c(M,null,q(S.value,(a,g)=>(u(),c("div",{key:a.id},[s(e(he),{value:a.id,label:`（当前赔率 ${a.odds.toFixed(2)}）： ${a.id==d.value.result_option_id?"⭐":""} ${a.option_text}`},null,8,["value","label"]),s(e(ke),{status:"success",type:"line",height:e(k).isMobile?20:24,percentage:Math.floor(a.olo_total/d.value.olo_total*100),"indicator-placement":"inside"},{default:l(()=>[m(b(a.olo_total),1)]),_:2},1032,["height","percentage"])]))),128))]),_:1})]),_:1},8,["value"]),$.value&&d.value.is_closed===0?(u(),c("span",He,"菠菜已经关闭投注")):p("",!0),d.value.is_closed===1?(u(),c("span",Oe,b(`菠菜已开奖，奖金已发放。中奖项是：${X.value}`),1)):p("",!0),d.value.is_closed===2?(u(),c("span",qe,"菠菜已经被管理员中止，投注olo已退回")):p("",!0),!$.value&&d.value.is_closed===0?(u(),c("div",je,[s(e(v),{depth:3},{default:l(()=>[m("结束时间：")]),_:1}),_("span",null,b(Q.value)+" ("+b(B.value)+")",1)])):p("",!0),s(e(f),{size:"small",align:"center"},{default:l(()=>[s(e(ze),{max:1e6,min:1,step:1e3,placeholder:"投注额",disabled:$.value||d.value.is_closed!==0,value:z.value,"onUpdate:value":i[1]||(i[1]=a=>z.value=a)},null,8,["disabled","value"]),s(e(j),{type:"primary",onClick:te,loading:e(R),disabled:e(R)||$.value||d.value.is_closed!==0},{default:l(()=>[m("投注")]),_:1},8,["loading","disabled"]),e(r).checkAdminForums(o.forumId)&&d.value.is_closed===0?(u(),x(e(_e),{key:0,trigger:e(k).isMobile?"click":"hover",options:Y,onSelect:E,placement:"bottom-start"},{default:l(()=>[s(e(j),{type:"warning"},{default:l(()=>[m("管理")]),_:1})]),_:1},8,["trigger"])):p("",!0)]),_:1}),!e(k).isMobile&&N.value.length>0?(u(),x(e(we),{key:4,columns:J,data:N.value,bordered:!1},null,8,["data"])):p("",!0),e(k).isMobile?(u(),c(M,{key:5},[N.value.length>0?(u(),x(e(f),{key:0,vertical:"",align:"start",size:"small"},{default:l(()=>[(u(!0),c(M,null,q(N.value,a=>(u(),c("div",Ue,[s(e(f),{style:{"margin-bottom":"6px"}},{default:l(()=>[_("div",null,[s(e(v),{depth:3},{default:l(()=>[m("我的投注：")]),_:1}),s(e(v),null,{default:l(()=>[m(b(a.option_text),1)]),_:2},1024)])]),_:2},1024),s(e(f),{style:{"margin-bottom":"6px"}},{default:l(()=>[_("div",null,[s(e(v),{depth:3},{default:l(()=>[m("投注额：")]),_:1}),s(e(v),null,{default:l(()=>[m(b(a.betting_olo),1)]),_:2},1024)])]),_:2},1024),a.win_olo?(u(),x(e(f),{key:0,style:{"margin-bottom":"6px"}},{default:l(()=>[_("div",null,[s(e(v),{depth:3},{default:l(()=>[m("赔率：")]),_:1}),s(e(v),null,{default:l(()=>{var g;return[m(b((g=a.odds)==null?void 0:g.toFixed(2)),1)]}),_:2},1024)]),_("div",Ve,[s(e(v),{depth:3},{default:l(()=>[m("奖金：")]),_:1}),s(e(v),null,{default:l(()=>[m(b(a.win_olo),1)]),_:2},1024)])]),_:2},1024)):p("",!0)]))),256))]),_:1})):p("",!0)],64)):p("",!0)]),_:1})):p("",!0)]),_:1},8,["show"])]),_:1}))}}),$t=be(Be,[["__scopeId","data-v-b00ad485"]]);export{$t as default};
