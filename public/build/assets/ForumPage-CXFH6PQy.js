import{R as se,ak as oe,w as ne,$ as p,b as _,u as F,al as ue,am as le,an as ie,A as d,M as b,o,m as e,K as de,L as pe,U as ce,F as k,H as r,af as me,x as w,ag as fe,_ as he,Q as ge,X as E,z as u,N as ve,ao as ye,s as m,B as _e,v as N,ap as be,aq as ke,ah as we,ai as Se,aj as Ie,J as Ce,S as f,ar as Te}from"./vendor-B725aRmw.js";import{u as xe,t as G}from"./forums-B-GyucTm.js";import{s as z}from"./subtitles-DW7M559j.js";import{s as De}from"./shuffle-Bl2z5mvo.js";import{u as H,a as Le,b as c,c as $e,d as O,_ as Fe}from"./app-B1E9hQ9C.js";import{_ as Ne}from"./loudspeaker-DcHNbvVs.js";import{L as ze,S as Oe}from"./LoudspeakerComponent-BHIS05LE.js";import{T as Ue}from"./ThreadList-Q8ctyXhT.js";import"./showDialog-DCDvRIw5.js";import"./browseLogger-CFnKZSj3.js";function Me(){const l=H();se(()=>{l.showTopbarNav=!1}),oe(()=>{l.showTopbarNav=!0})}const Pe=l=>(Se("data-v-4a8d2e30"),l=l(),Ie(),l),Re={key:0,class:"carousel-box"},qe={key:0,class:"carousel-box"},je=["src"],Ae=Pe(()=>Ce("div",{style:{height:"50px"}},null,-1)),Be=ne({__name:"ForumPage",props:{forumId:{},page:{},search:{},delay:{type:Boolean}},setup(l){var A,B;de(a=>({ccc8c86c:e(i).bannerHeight}));const S=Le(),i=H(),h=xe(),g=pe(),W=p(null);p();const U=p();Me();const t=l,K=_(()=>{var a;return De((a=h.forumData(t.forumId))==null?void 0:a.banners)});document.title=(B=(A=h.forumData(t.forumId))==null?void 0:A.name)!=null?B:"小火锅";const I=F("banner_hiden",!1),C=F("new_window_to_post",!1);function Q(){return f(m,{style:"padding:6px 8px",vertical:!0},()=>[f(O,{checked:I.value,"onUpdate:checked":a=>I.value=a,label:"隐藏版头"}),f(O,{checked:C.value,"onUpdate:checked":a=>C.value=a,label:"新窗口打开"})])}const J=[{type:"group",key:"header",label:"功能"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:Q}],T=F("subtitles_included",z),M=_(()=>z.filter(a=>!T.value.includes(a)));function X(){return f(Te,{value:T.value,"onUpdate:value":a=>T.value=a},()=>[f(m,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(z).map(a=>f(O,{value:a,label:a}))])])}const V=[{type:"group",key:"header",label:"筛选"},{key:"header-divider",type:"divider"},{key:"filterOptions",type:"render",render:X}],v=p(t.search),y=p(!!t.search);function P(){g.push({name:"forum",params:{forumId:t.forumId,page:1},query:{search:v.value||void 0}})}function Y(){v.value=void 0,y.value=!1,g.push({name:"forum",params:{forumId:t.forumId,page:1}})}function Z(){g.push({name:"forum",params:{forumId:t.forumId,page:1},query:{delay:t.delay?void 0:"true"}})}const x=p(t.page);function ee(a){g.push({name:"forum",params:{forumId:t.forumId,page:a},query:{search:t.search,delay:t.delay?"true":void 0}})}ue(()=>t.page,a=>x.value=a);const R=_(()=>({forumId:t.forumId,binggan:S.binggan,page:t.page,threadsPerPage:50,subtitlesExcluded:M.value,searchTitle:t.search,delay:t.delay})),{loading:D,data:L,onSuccess:Ee}=le(()=>G(R.value),[()=>t.forumId,()=>t.page,()=>t.search,()=>t.delay,M],{initialData:[],immediate:!0}),q=p(!1),{fetching:Ge,onSuccess:ae,fetch:te}=ie();function j(a=!1){var s;q.value=a,te(G(R.value)),(s=U.value)==null||s.reloadBrowseLogger()}ae(()=>{q.value&&!i.userCustom.lessToast&&window.$message.success("已刷新数据")});const re=_(()=>{if(D.value)return[];if(S.userData.binggan.use_pingbici){const a=i.userCustom.pingbiciIngnoreCase?"gi":"g";return L.value.threads_data.data.filter(s=>{for(let $ of S.userData.pingbici.title_pingbici)if(new RegExp($,a).test(s.title))return!1;return!0})}else return L.value.threads_data.data});return(a,s)=>{const $=ce("router-link");return d(),b(e(m),{vertical:""},{default:o(()=>[e(I)?w("",!0):(d(),k("div",Re,[e(h).forumsDataLoading?(d(),k("div",qe,[r(e(me),{class:"carousel-skeleton",sharp:""})])):w("",!0),e(h).forumsDataLoading?w("",!0):(d(),b(e(fe),{key:1,"show-arrow":"",trigger:e(i).isMobile?"click":"hover",autoplay:"",interval:1e4},{default:o(()=>[(d(!0),k(he,null,ge(K.value,n=>(d(),k("img",{src:n,class:"carousel-img"},null,8,je))),256))]),_:1},8,["trigger"]))])),r(e(m),{style:{"margin-top":"8px"},size:"small"},{default:o(()=>[r(e(E),{trigger:e(i).isMobile?"click":"hover",options:J,placement:"bottom-start"},{default:o(()=>[r(e(c),null,{default:o(()=>[u("功能")]),_:1})]),_:1},8,["trigger"]),r(e(E),{trigger:e(i).isMobile?"click":"hover",options:V,placement:"bottom-start"},{default:o(()=>[r(e(c),null,{default:o(()=>[u("筛选")]),_:1})]),_:1},8,["trigger"]),r(e(ve),{size:e(i).isMobile?28:34},{default:o(()=>[r(e(ye),{style:{cursor:"pointer"},onClick:s[0]||(s[0]=n=>y.value=!y.value)})]),_:1},8,["size"]),r(e(c),{type:"primary",style:{"margin-left":"auto"},onClick:s[1]||(s[1]=n=>a.$router.push({name:"loudspeaker"}))},{default:o(()=>[u("大喇叭")]),_:1}),r(e(c),{type:"primary",onClick:s[2]||(s[2]=n=>a.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},{default:o(()=>[u("新主题")]),_:1})]),_:1}),y.value?(d(),b(e(m),{key:1,wrap:!1},{default:o(()=>[r(e($e),{value:v.value,"onUpdate:value":s[3]||(s[3]=n=>v.value=n),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索标题","auto-size":"",onKeyup:_e(P,["enter"])},null,8,["value"]),r(e(c),{type:"primary",onClick:P},{default:o(()=>[u("搜索")]),_:1}),r(e(c),{type:"default",onClick:Y},{default:o(()=>[u("清空")]),_:1})]),_:1})):w("",!0),r(ze),r(Ue,{ref_key:"ThreadListCom",ref:U,"threads-list-data":re.value,"new-window-to-post":e(C),"show-this":!e(D),onWithdrawDelayThreadSuccess:j},null,8,["threads-list-data","new-window-to-post","show-this"]),r(e(m),{align:"center"},{default:o(()=>[r(e(c),{type:t.delay?"default":"primary",onClick:Z},{default:o(()=>[u(N(t.delay?"关闭延时主题":"查看延时主题"),1)]),_:1},8,["type"]),r(Ne,{page:x.value,"onUpdate:page":[s[4]||(s[4]=n=>x.value=n),ee],"last-page":e(D)?1:e(L).threads_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),Ae,(d(),b(be,{to:"#topbar-nav"},[r($,{to:"/",class:"flex-item-center"},{default:o(()=>[r(e(ke),{tooltip:!1},{default:o(()=>{var n;return[u(N((n=e(h).forumData(a.forumId))==null?void 0:n.name),1)]}),_:1}),r(e(we),{round:"",class:"forum-tag",size:e(i).isMobile?"small":"medium"},{default:o(()=>[u(N(a.forumId),1)]),_:1},8,["size"])]),_:1})])),r(Oe,{mode:"forum",ref_key:"SidebarCom",ref:W,onRefresh:s[5]||(s[5]=n=>j(!0)),onNewThread:s[6]||(s[6]=n=>a.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},null,512)]),_:1})}}}),aa=Fe(Be,[["__scopeId","data-v-4a8d2e30"]]);export{aa as default};
