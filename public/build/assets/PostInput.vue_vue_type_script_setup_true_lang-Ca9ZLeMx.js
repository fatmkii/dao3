import{n as te,l as O,t as m,g as pe,p as E,j as H,q as e,D as de,x as l,E as t,F as ie,H as K,I as j,S as V,L as i,P as oe,M as B,av as be,ao as Ke,i as ee,K as Q,O as fe,am as Ae,a_ as ye,a2 as Le,a3 as Pe,a1 as Oe,b5 as He,J as Z,b6 as Ue,aU as Se,a$ as qe,aY as De,aD as Ve,Q as re,w as we,b3 as Je,b4 as Be,m as he,B as Re,N as ne,b1 as Qe,b2 as Ze,C as et,al as tt,u as lt,a4 as je,aO as at,R as se,b7 as nt,b8 as ot,b9 as ut,ba as st,aZ as it,bb as rt,bc as dt,z as vt,bd as mt,be as pt}from"./vendor-C-2co6ae.js";import{u as le,a as ue,e as R,c as J,b as W,i as Ne,w as ft,j as We,k as gt,p as ct,r as Ee,d as Me}from"./app-CsEnLcBD.js";import{s as ht}from"./showDialog-DillYkkx.js";import{b as bt,c as yt,d as ze,e as wt,g as Ct,f as kt,i as It,_ as Mt}from"./emojiData-DzIUolgl.js";import{i as Ye,a as Xe}from"./inputNumberFormat-BPxWRFt_.js";const xt=te({__name:"RollModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(X,{expose:Y,emit:S}){const U=le(),s=ue(),I=X,$=O(()=>{let p=[];if(v.value>0&&f.value>0){for(var u=0;u<v.value;u++)p[u]=Math.floor(Math.random()*f.value)+1;return p.join()}else return null}),D=m(),C=m(),v=m(1),f=m(100),_=m(!1);function M(){_.value=!0}Y({show:M});const A=S,{loading:r,send:y,onSuccess:g}=pe(p=>bt(p),{immediate:!1});function w(){if(!v.value){window.$message.error("请填写骰子数量");return}if(!f.value){window.$message.error("请填写骰子数量");return}const p={binggan:s.binggan,thread_id:I.threadId,forum_id:I.forumId,roll_name:D.value,roll_event:C.value,roll_num:v.value,roll_range:f.value};y(p)}return g(()=>{A("refreshPostsList"),_.value=!1}),(p,u)=>(H(),E(e(de),{show:_.value,"onUpdate:show":u[6]||(u[6]=c=>_.value=c),"display-directive":"if"},{default:l(()=>[t(e(ie),{style:K({maxWidth:e(U).modalMaxWidth}),title:"Roll点",closable:"",onClose:u[5]||(u[5]=c=>_.value=!1),size:"small"},{action:l(()=>[t(e(j),{justify:"end"},{default:l(()=>[t(e(W),{type:"primary",onClick:w,disabled:e(r)},{default:l(()=>[...u[12]||(u[12]=[i("Roll it!",-1)])]),_:1},8,["disabled"]),t(e(W),{onClick:u[4]||(u[4]=c=>_.value=!1)},{default:l(()=>[...u[13]||(u[13]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(j),{vertical:""},{default:l(()=>[t(e(V),null,{default:l(()=>[...u[7]||(u[7]=[i(" 输出参考： ",-1)])]),_:1}),t(e(V),null,{default:l(()=>[i(oe(D.value?`「${D.value}」，`:"")+" "+oe(C.value?`「${C.value}」的结果：`:"")+" "+oe(`${v.value} d ${f.value} = 「${$.value}」`),1)]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...u[8]||(u[8]=[i("Roll点昵称",-1)])]),_:1}),t(e(J),{placeholder:"可留空",maxlength:100,value:D.value,"onUpdate:value":u[0]||(u[0]=c=>D.value=c)},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...u[9]||(u[9]=[i("Roll点事件",-1)])]),_:1}),t(e(J),{placeholder:"可留空",maxlength:100,value:C.value,"onUpdate:value":u[1]||(u[1]=c=>C.value=c)},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...u[10]||(u[10]=[i("骰子数量",-1)])]),_:1}),t(e(be),{max:100,min:1,placeholder:"必须填写",value:v.value,"onUpdate:value":u[2]||(u[2]=c=>v.value=c)},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...u[11]||(u[11]=[i("骰子大小",-1)])]),_:1}),t(e(be),{max:1e4,min:1,placeholder:"必须填写",value:f.value,"onUpdate:value":u[3]||(u[3]=c=>f.value=c)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Tt=["src"],$t=te({__name:"CaptchaModal",emits:["waterUnlockOnSuccess"],setup(X,{expose:Y,emit:S}){const U=le(),s=ue(),I=m(),$=O(()=>f.value.captcha_key),D=m(!1);function C(){D.value=!0,M()}Y({show:C});const v=S,{data:f,loading:_,send:M}=pe(Ne,{immediate:!1}),{fetch:A}=Ke();function r(){A(Ne())}const{loading:y,send:g,onSuccess:w,onError:p}=pe(c=>ft(c),{immediate:!1});function u(){if(!I.value){window.$message.error("验证码不能为空");return}const c={binggan:s.binggan,captcha_code:I.value,captcha_key:$.value};g(c),w(()=>{I.value="",D.value=!1,v("waterUnlockOnSuccess")}),p(()=>{I.value="",r()})}return(c,n)=>(H(),E(e(de),{show:D.value,"onUpdate:show":n[3]||(n[3]=T=>D.value=T),"display-directive":"if"},{default:l(()=>[t(e(ie),{style:K({maxWidth:e(U).modalMaxWidth}),title:"验证码",closable:"",onClose:n[2]||(n[2]=T=>D.value=!1),size:"small"},{action:l(()=>[t(e(j),{justify:"end"},{default:l(()=>[t(e(W),{type:"primary",onClick:u,loading:e(y),disabled:e(y)},{default:l(()=>[...n[7]||(n[7]=[i("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(W),{onClick:n[1]||(n[1]=T=>D.value=!1)},{default:l(()=>[...n[8]||(n[8]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(j),{vertical:""},{default:l(()=>[t(e(V),null,{default:l(()=>[...n[4]||(n[4]=[i(" 嗷……你可能刷太多了，休息一下吧。 ",-1)])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"3.2rem"},class:"round"},{default:l(()=>[...n[5]||(n[5]=[i("输入",-1)])]),_:1}),t(e(J),{placeholder:"请输入验证码",maxlength:"4","show-count":"",value:I.value,"onUpdate:value":n[0]||(n[0]=T=>I.value=T),onKeyup:fe(u,["enter"])},null,8,["value"])]),_:1}),e(_)?Q("",!0):(H(),ee("img",{key:0,src:"data:image/png;base64,"+e(f).captcha_img,style:{"max-width":"200px"},onClick:r},null,8,Tt)),t(e(V),null,{default:l(()=>[...n[6]||(n[6]=[i(" 点击可更换验证码。不区分大小写。 ",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),_t=te({__name:"BattleModal",props:{threadId:{},forumId:{},randomHeadsGroup:{}},emits:["refreshPostsList"],setup(X,{expose:Y,emit:S}){const U=le(),s=ue(),I=m(null),$=X,D=O(()=>{const c=[{value:1,label:"共通",available:!0}];return yt.forEach(n=>{n.value===$.randomHeadsGroup&&c.push(n)}),c}),C=O(()=>{const c=ze[f.value-1];if(f.value===1){const n=s.userData.my_battle_chara.filter(T=>!T.not_use).map((T,N)=>({value:N+240,label:T.name}));return c.concat(n)}else return c}),v=m(1),f=m($.randomHeadsGroup),_=m(100);Ae(f,c=>{c===1?v.value=ze[c-1][8].value:v.value=ze[c-1][0].value},{immediate:!0});const{loading:M,send:A,onSuccess:r,onError:y}=pe(c=>wt(c),{immediate:!1});function g(c){const{timestamp:n,newPostKey:T}=Ct(c?.isTrusted??!0,$.threadId,s.binggan),N={binggan:s.binggan,forum_id:$.forumId,thread_id:$.threadId,battle_olo:_.value,chara_id:v.value>=240?v.value-240:v.value,is_custom_chara:v.value>=240,chara_group:f.value-1,new_post_key:T,timestamp:n};A(N)}r(()=>{u("refreshPostsList"),w.value=!1}),y(c=>{c.error.cause!==void 0&&c.error.cause.code===244291&&I.value?.show()});const w=m(!1);function p(){w.value=!0}Y({show:p});const u=S;return(c,n)=>(H(),E(e(de),{show:w.value,"onUpdate:show":n[5]||(n[5]=T=>w.value=T),"display-directive":"if"},{default:l(()=>[t(e(ie),{style:K({maxWidth:e(U).modalMaxWidth}),title:"表情包大乱斗！",closable:"",onClose:n[4]||(n[4]=T=>w.value=!1),size:"small"},{action:l(()=>[t(e(j),{justify:"end"},{default:l(()=>[t(e(W),{type:"primary",onClick:g,loading:e(M)},{default:l(()=>[...n[10]||(n[10]=[i("提交",-1)])]),_:1},8,["loading"]),t(e(W),{onClick:n[3]||(n[3]=T=>w.value=!1)},{default:l(()=>[...n[11]||(n[11]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(j),{vertical:""},{default:l(()=>[t(e(V),null,{default:l(()=>[...n[6]||(n[6]=[i("小斗怡情，大斗伤身，强斗奥飞湮灭",-1)])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...n[7]||(n[7]=[i("主题",-1)])]),_:1}),t(e(ye),{value:f.value,"onUpdate:value":n[0]||(n[0]=T=>f.value=T),options:D.value},null,8,["value","options"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...n[8]||(n[8]=[i("角色",-1)])]),_:1}),t(e(ye),{value:v.value,"onUpdate:value":n[1]||(n[1]=T=>v.value=T),options:C.value},null,8,["value","options"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...n[9]||(n[9]=[i("下注",-1)])]),_:1}),t(e(be),{value:_.value,"onUpdate:value":n[2]||(n[2]=T=>_.value=T),max:1e6,min:1,step:100,parse:e(Xe),format:e(Ye),onKeyup:fe(g,["enter"])},null,8,["value","parse","format"])]),_:1})]),_:1}),t($t,{ref_key:"CaptchaModalCom",ref:I,onWaterUnlockOnSuccess:g},null,512)]),_:1},8,["style"])]),_:1},8,["show"]))}}),Dt=te({__name:"CodeModal",emits:["insertCode"],setup(X,{expose:Y,emit:S}){const U=le(),s=m(0),I=m(),$=m(),D=[{value:0,label:"折叠内容"},{value:1,label:"超链接"},{value:2,label:"图片"},{value:3,label:"删除线"}],C=O(()=>[{prepend_1:"显示内容",prepend_2:"隐藏内容",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"显示内容",inputDefault_2:"隐藏内容",insertText:`<details><summary>${I.value}</summary>${$.value}</details>`},{prepend_1:"显示文字",prepend_2:"链接网址",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"点我跳转",inputDefault_2:"",insertText:`<a href="${$.value}">${I.value}</a>`},{prepend_1:"图片链接",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<img src="${I.value}">`},{prepend_1:"删除文字",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<del>${I.value}</del>`}]);Ae(s,()=>{I.value=C.value[s.value].inputDefault_1,$.value=C.value[s.value].inputDefault_2},{immediate:!0});function v(){M("insertCode",C.value[s.value].insertText),I.value=C.value[s.value].inputDefault_1,$.value=C.value[s.value].inputDefault_2,f.value=!1}const f=m(!1);function _(){f.value=!0}Y({show:_});const M=S;return(A,r)=>(H(),E(e(de),{show:f.value,"onUpdate:show":r[5]||(r[5]=y=>f.value=y),"display-directive":"if"},{default:l(()=>[t(e(ie),{style:K({maxWidth:e(U).modalMaxWidth}),title:"快捷代码",closable:"",onClose:r[4]||(r[4]=y=>f.value=!1),size:"small"},{action:l(()=>[t(e(j),{justify:"end"},{default:l(()=>[t(e(W),{type:"primary",onClick:v},{default:l(()=>[...r[8]||(r[8]=[i("插入",-1)])]),_:1}),t(e(W),{onClick:r[3]||(r[3]=y=>f.value=!1)},{default:l(()=>[...r[9]||(r[9]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(j),{vertical:""},{default:l(()=>[t(e(V),null,{default:l(()=>[...r[6]||(r[6]=[i("代码预览：",-1)])]),_:1}),t(e(V),null,{default:l(()=>[i(oe(C.value[s.value].insertText),1)]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...r[7]||(r[7]=[i("代码内容",-1)])]),_:1}),t(e(ye),{value:s.value,"onUpdate:value":r[0]||(r[0]=y=>s.value=y),options:D},null,8,["value"])]),_:1}),Le(t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[i(oe(C.value[s.value].prepend_1),1)]),_:1}),t(e(J),{value:I.value,"onUpdate:value":r[1]||(r[1]=y=>I.value=y),onKeyup:fe(v,["enter"])},null,8,["value"])]),_:1},512),[[Pe,C.value[s.value].inputEnable_1]]),Le(t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[i(oe(C.value[s.value].prepend_2),1)]),_:1}),t(e(J),{value:$.value,"onUpdate:value":r[2]||(r[2]=y=>$.value=y),onKeyup:fe(v,["enter"])},null,8,["value"])]),_:1},512),[[Pe,C.value[s.value].inputEnable_2]])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),zt=["width","height"],Ht=["width","height"],Ut=["onClick"],At=["title","innerHTML","onClick"],Lt=te({__name:"DrawerModal",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(X,{expose:Y,emit:S}){const U=ue();le();const s=X,I=m(!1);function $(){I.value=!0}Y({show:$});const D=S,C=m(),v=O(()=>C.value?.getContext("2d")),f=m(),_=O(()=>f.value?.getContext("2d")),M=new Image;let A=!1;const r={x:0,y:0,width:0,height:0},y=m([]),g=m([]),w=m([]),p=m({lineWidth:3,lineColor:"#111111",shadowBlur:1}),u=m(!1),c=m(!1);let n=0,T=0;const N=O(()=>window.innerWidth>836?796:window.innerWidth-36),q=O(()=>window.innerHeight>580?400:window.innerHeight-212),F=O(()=>[{title:"上一步",action:"prev",className:y.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>'},{title:"下一步",action:"next",className:g.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/></svg>'},{title:"橡皮擦",action:"eraser",className:y.value.length||g.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"/></svg>'},{title:"清除",action:"clear",className:y.value.length||g.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/><path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/></svg>'},{title:"拖动背景",action:"drag",className:c.value?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor"  viewBox="0 0 16 16"> <path d="M6.75 1a.75.75 0 0 1 .75.75V8a.5.5 0 0 0 1 0V5.467l.086-.004c.317-.012.637-.008.816.027.134.027.294.096.448.182.077.042.15.147.15.314V8a.5.5 0 1 0 1 0V6.435a4.9 4.9 0 0 1 .106-.01c.316-.024.584-.01.708.04.118.046.3.207.486.43.081.096.15.19.2.259V8.5a.5.5 0 0 0 1 0v-1h.342a1 1 0 0 1 .995 1.1l-.271 2.715a2.5 2.5 0 0 1-.317.991l-1.395 2.442a.5.5 0 0 1-.434.252H6.035a.5.5 0 0 1-.416-.223l-1.433-2.15a1.5 1.5 0 0 1-.243-.666l-.345-3.105a.5.5 0 0 1 .399-.546L5 8.11V9a.5.5 0 0 0 1 0V1.75A.75.75 0 0 1 6.75 1zM8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v5.34l-1.2.24a1.5 1.5 0 0 0-1.196 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.271-2.715a2 2 0 0 0-1.99-2.199h-.581a5.114 5.114 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.632 2.632 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002zm2.094 2.025z"/></svg>'}]),G=[{lineWidth:3,innerHTML:"🖌️",font_size:12},{lineWidth:6,innerHTML:"🖌️",font_size:16},{lineWidth:12,innerHTML:"🖌️",font_size:20}];function d(){const b=new ImageData(N.value,q.value);w.value.push(b)}Oe(()=>{d()});function L(){v.value.lineWidth=p.value.lineWidth,v.value.shadowBlur=p.value.shadowBlur,v.value.shadowColor=p.value.lineColor,v.value.strokeStyle=p.value.lineColor,v.value.lineCap="round",v.value.lineJoin="round"}function ve(b){if(A)if(c.value){const o=b.target;let k,x;b instanceof MouseEvent?(k=b.clientX-o.getBoundingClientRect().x,x=b.clientY-o.getBoundingClientRect().y):(k=b.changedTouches[0].clientX-o.getBoundingClientRect().x,x=b.changedTouches[0].clientY-o.getBoundingClientRect().y),f.value.height=f.value.height;let P={x:r.x+(k-n),y:r.y+(x-T),width:r.width,height:r.height};ae(M,P)}else{v.value.beginPath(),v.value.moveTo(n,T);const o=b.target;let k,x;b instanceof MouseEvent?(k=b.clientX-o.getBoundingClientRect().x,x=b.clientY-o.getBoundingClientRect().y):(k=b.changedTouches[0].clientX-o.getBoundingClientRect().x,x=b.changedTouches[0].clientY-o.getBoundingClientRect().y),v.value.globalCompositeOperation=u.value?"destination-out":"source-over",v.value.lineTo(k,x),[n,T]=[k,x],v.value.stroke()}}function Ce(b){if(c.value){const o=b.target;let k,x;b instanceof MouseEvent?(k=b.clientX-o.getBoundingClientRect().x,x=b.clientY-o.getBoundingClientRect().y):(k=b.changedTouches[0].clientX-o.getBoundingClientRect().x,x=b.changedTouches[0].clientY-o.getBoundingClientRect().y),r.x+=k-n,r.y+=x-T,A=!1}else{const o=v.value.getImageData(0,0,C.value.width,C.value.height);g.value.length?(w.value=[],w.value=w.value.concat(y.value),w.value.push(o),g.value=[]):w.value.push(o),A=!1}}function ke(b){if(c.value){const o=b.target;let k,x;b instanceof MouseEvent?(k=b.clientX-o.getBoundingClientRect().x,x=b.clientY-o.getBoundingClientRect().y):(k=b.changedTouches[0].clientX-o.getBoundingClientRect().x,x=b.changedTouches[0].clientY-o.getBoundingClientRect().y),n=k,T=x,A=!0}else{A=!0;const o=b.target;let k,x;b instanceof MouseEvent?(k=b.clientX-o.getBoundingClientRect().x,x=b.clientY-o.getBoundingClientRect().y):(k=b.changedTouches[0].clientX-o.getBoundingClientRect().x,x=b.changedTouches[0].clientY-o.getBoundingClientRect().y),L(),n=k,T=x;const P=v.value.getImageData(0,0,C.value.width,C.value.height);y.value.push(P)}}function xe(b){p.value.lineWidth=b,u.value=!1,c.value=!1}function ge(b){switch(b){case"prev":if(y.value.length){const o=y.value.pop(),k=w.value[y.value.length+1];g.value.push(k),v.value.putImageData(o,0,0)}break;case"next":if(g.value.length){const o=g.value.pop(),k=w.value[w.value.length-g.value.length-2];y.value.push(k),v.value.putImageData(o,0,0)}break;case"clear":v.value.clearRect(0,0,C.value.width,C.value.height),y.value=[],g.value=[],w.value=[w.value[0]];break;case"eraser":u.value=!0;break;case"drag":c.value=!0;break}}function Te(b){if(b.file.file){var o=new FileReader;o.readAsDataURL(b.file.file),o.onload=k=>{M.src=k.target.result,M.onload=function(){var x=f,P=M;r.width=P.width,r.height=P.height,P.width/P.height>=x.value.width/x.value.height?P.width>x.value.width&&(r.width=x.value.width,r.height=P.height*x.value.width/P.width):P.height>x.value.height&&(r.width=P.width*x.value.height/P.height,r.height=x.value.height),ae(P,r)}}}}function ae(b,o){_.value.drawImage(b,o.x,o.y,o.width,o.height)}const me=m(!1);function ce(){let b=new Image;b.src=C.value.toDataURL("image/png"),b.onload=()=>{_.value.drawImage(b,0,0),o(f.value)};function o(x){x.toBlob(P=>{P&&k(P)},"image/png")}function k(x){const P={binggan:U.binggan,file:x,mode:"draw",thread_id:s.threadId,forum_id:s.forumId};me.value=!0,We(P).then(Ie=>{D("insertImage",Ie.file_url),me.value=!1,I.value=!1}).catch(()=>{me.value=!1})}}return(b,o)=>(H(),E(e(de),{show:I.value,"onUpdate:show":o[5]||(o[5]=k=>I.value=k),"display-directive":"show"},{default:l(()=>[t(e(ie),{style:K({maxWidth:N.value+4+"px"}),title:"涂鸦板",closable:"",onClose:o[4]||(o[4]=k=>I.value=!1),size:"small","content-style":{padding:"0px"}},{default:l(()=>[Z("div",{id:"canvas-container",style:K({width:N.value+"px",height:q.value+"px"})},[Z("canvas",{id:"drawer-canvas-background",ref_key:"canvasBackground",ref:f,width:N.value,height:q.value,onTouchmove:o[0]||(o[0]=Ue(()=>{},["prevent"]))},null,40,zt),Z("canvas",{id:"drawer-canvas",ref_key:"canvas",ref:C,class:Se({painting:!c.value,dragging:c.value}),width:N.value,height:q.value,onTouchmove:[o[1]||(o[1]=Ue(()=>{},["prevent"])),ve],onMousedown:ke,onMouseup:Ce,onMousemove:ve,onTouchstart:ke,onTouchend:Ce},null,42,Ht)],4),t(e(qe),{"x-gap":"6",cols:4},{default:l(()=>[t(e(De),{span:"1"},{default:l(()=>[o[6]||(o[6]=Z("div",null,"颜色",-1)),t(e(Ve),{value:p.value.lineColor,"onUpdate:value":o[2]||(o[2]=k=>p.value.lineColor=k),modes:["hex"],"show-alpha":!1},null,8,["value"])]),_:1}),t(e(De),{span:"1"},{default:l(()=>[o[7]||(o[7]=Z("div",null,"画笔",-1)),t(e(j),{id:"canvas-brush",size:"small",align:"center"},{default:l(()=>[(H(),ee(re,null,we(G,(k,x)=>Z("span",{key:x,style:K({fontSize:k.font_size+"px"}),onClick:P=>xe(k.lineWidth)},oe(k.innerHTML),13,Ut)),64))]),_:1})]),_:1}),t(e(De),{span:"2"},{default:l(()=>[o[8]||(o[8]=Z("div",null,"操作",-1)),t(e(j),{id:"canvas-control",size:"small"},{default:l(()=>[(H(!0),ee(re,null,we(F.value,(k,x)=>(H(),ee("span",{key:x,title:k.title,class:Se([k.className]),innerHTML:k.innerHTML,onClick:P=>ge(k.action)},null,10,At))),128))]),_:1})]),_:1})]),_:1})]),action:l(()=>[t(e(j),{justify:"end"},{default:l(()=>[t(e(He),{"default-upload":!1,onChange:Te,"show-file-list":!1},{default:l(()=>[t(e(W),null,{default:l(()=>[...o[9]||(o[9]=[i("加载图片",-1)])]),_:1})]),_:1}),t(e(W),{type:"primary",onClick:ce,disabled:b.userIsLocked,loading:me.value},{default:l(()=>[...o[10]||(o[10]=[i("上传",-1)])]),_:1},8,["disabled","loading"]),t(e(W),{onClick:o[3]||(o[3]=k=>I.value=!1)},{default:l(()=>[...o[11]||(o[11]=[i("关闭",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Pt=["onClick"],St=["src"],Bt=te({__name:"EmojiTab",props:{randomHeadsGroup:{default:1},autoHide:{type:Boolean,default:!0}},emits:["appendEmoji"],setup(X,{emit:Y}){const S=ue(),U=le(),s=X,I=O(()=>{let r=0,y=0;return U.isMobile&&(U.userCustom.sidebarLeft?r=20:y=20),{paddingLeft:r+"px",paddingRight:y+"px"}}),$=m(),D=O(()=>{const r=kt.filter(y=>!S.userData.emoji_excluded.includes(y.id)&&(y.headsId===0||y.headsId===s.randomHeadsGroup));return S.userData.my_emoji&&r.unshift({id:0,headsId:0,name:"自定义",emojis:S.userData.my_emoji}),r}),C=Y;function v(r,y){C("appendEmoji",r,y==="自定义"),s.autoHide&&($.value=-1)}let f=!1;function _(r,y){return he("span",{onClick:()=>M(y),innerHTML:r})}function M(r){r===$.value&&(f=!0,$.value=-1)}function A(r,y){return f?(f=!1,!1):!0}return(r,y)=>(H(),E(e(Je),{type:"line","bar-width":0,animated:"",onBeforeLeave:A,size:e(U).isMobile?"small":"medium","default-value":-1,value:$.value,"onUpdate:value":y[0]||(y[0]=g=>$.value=g)},{default:l(()=>[(H(!0),ee(re,null,we(D.value,(g,w,p)=>(H(),E(e(Be),{name:g.id,tab:_(g.name,g.id)},{default:l(()=>[t(e(j),{size:"small",class:"emoji-container",style:K(I.value)},{default:l(()=>[(H(!0),ee(re,null,we(g.emojis,(u,c,n)=>(H(),ee("div",{class:"emoji-box",onClick:T=>v(u,g.name)},[Z("img",{src:u,class:"emoji-in-box"},null,8,St)],8,Pt))),256))]),_:2},1032,["style"])]),_:2},1032,["name","tab"]))),256)),t(e(Be),{name:-1,tab:"隐藏"})]),_:1},8,["size","value"]))}}),Rt=te({__name:"HongbaoModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(X,{expose:Y,emit:S}){const U=le(),s=ue(),I=X,$=[{value:1,label:"口令红包 直接公开口令"},{value:2,label:"抢答红包 回复答对才公开口令"},{value:3,label:"暗号红包 抢完红包才公开口令"}],D=[{value:1,label:"随机olo"},{value:2,label:"定额olo"}],C=m(3e3),v=m(10),f=m(1),_=m(1),M=m(),A=m(),r=m([]),y=m(!1),g=m(),w=m(1);function p(G){G===1&&w.value<5&&(w.value+=1),G===-1&&w.value>1&&(r.value.splice(w.value-1,1),w.value-=1)}const{loading:u,send:c,onSuccess:n}=pe(G=>It(G),{immediate:!1});function T(){function G(){const d={binggan:s.binggan,forum_id:I.forumId,thread_id:I.threadId,hongbao_olo:C.value,hongbao_num:v.value,type:f.value,key_word_type:_.value,hongbao_key_word:M.value,hongbao_question:A.value,hongbao_message_json:r.value,hongbao_olo_hide:y.value,pic_url:g.value};c(d)}if(M.value===void 0){window.$message.error("必须填写“红包口令”喔");return}if(A.value===void 0&&[2,3].includes(_.value)){window.$message.error("抢答红包或者暗号红包时，必须填写“口令提示”喔");return}if(f.value===2&&C.value%v.value!==0){const d={title:"提醒",closable:!1,content:"olo总额不是红包个数的整倍数，多出的余数olo将在最后一个红包发出。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{G()}};window.$dialog.warning(d);return}G()}n(()=>{F("refreshPostsList"),N.value=!1});const N=m(!1);function q(){N.value=!0}Y({show:q});const F=S;return(G,d)=>(H(),E(e(de),{show:N.value,"onUpdate:show":d[12]||(d[12]=L=>N.value=L),"display-directive":"if"},{default:l(()=>[t(e(ie),{style:K({maxWidth:e(U).modalMaxWidth}),title:"发起红包",closable:"",onClose:d[11]||(d[11]=L=>N.value=!1),size:"small"},{action:l(()=>[t(e(j),{justify:"end"},{default:l(()=>[t(e(W),{type:"primary",onClick:T,disabled:e(u),loading:e(u)},{default:l(()=>[...d[26]||(d[26]=[i("提交",-1)])]),_:1},8,["disabled","loading"]),t(e(W),{onClick:d[10]||(d[10]=L=>N.value=!1)},{default:l(()=>[...d[27]||(d[27]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(j),{vertical:""},{default:l(()=>[Z("div",null,[t(e(V),{depth:3},{default:l(()=>[...d[13]||(d[13]=[i("温馨提示：",-1)])]),_:1}),d[14]||(d[14]=i("在红包总额以外，会追加扣除7%手续费。 ",-1))]),Z("div",null,[t(e(V),{depth:3},{default:l(()=>[...d[15]||(d[15]=[i("总共扣除：",-1)])]),_:1}),t(e(V),{type:"warning"},{default:l(()=>[i(oe(Math.ceil(C.value*(e(U).isDouble11?1.02:1.07))),1)]),_:1}),d[16]||(d[16]=i("个奥利奥 ",-1))]),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[17]||(d[17]=[i("红包类型",-1)])]),_:1}),t(e(ye),{value:_.value,"onUpdate:value":d[0]||(d[0]=L=>_.value=L),options:$},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[18]||(d[18]=[i("olo类型",-1)])]),_:1}),t(e(ye),{value:f.value,"onUpdate:value":d[1]||(d[1]=L=>f.value=L),options:D},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[19]||(d[19]=[i("红包个数",-1)])]),_:1}),t(e(be),{value:v.value,"onUpdate:value":d[2]||(d[2]=L=>v.value=L),max:50,min:5,step:5},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[20]||(d[20]=[i("olo总额",-1)])]),_:1}),t(e(be),{value:C.value,"onUpdate:value":d[3]||(d[3]=L=>C.value=L),max:1e6,min:3e3,step:1e3,parse:e(Xe),format:e(Ye)},null,8,["value","parse","format"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[21]||(d[21]=[i("红包口令",-1)])]),_:1}),t(e(J),{value:M.value,"onUpdate:value":d[4]||(d[4]=L=>M.value=L),placeholder:"必填"},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[22]||(d[22]=[i("红包封面",-1)])]),_:1}),t(e(J),{value:g.value,"onUpdate:value":d[5]||(d[5]=L=>g.value=L),placeholder:"（可选）填写图片的完整网址"},null,8,["value"])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[23]||(d[23]=[i("口令提示",-1)])]),_:1}),t(e(J),{value:A.value,"onUpdate:value":d[6]||(d[6]=L=>A.value=L),placeholder:"抢答红包或者暗号红包时，必填"},null,8,["value"])]),_:1}),(H(!0),ee(re,null,we(w.value,L=>(H(),E(e(B),null,{default:l(()=>[t(e(R),{style:{width:"5.2rem"}},{default:l(()=>[...d[24]||(d[24]=[i("回复留言",-1)])]),_:1}),t(e(J),{value:r.value[L-1],"onUpdate:value":ve=>r.value[L-1]=ve,placeholder:`#${L}（可选） 多个留言时随机抽取一个`,maxlength:255},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024))),256)),t(e(j),{size:"small",align:"center"},{default:l(()=>[t(e(V),{depth:3},{default:l(()=>[...d[25]||(d[25]=[i("留言数量",-1)])]),_:1}),t(e(Re),{size:"tiny",circle:"",disabled:w.value===5,onClick:d[7]||(d[7]=L=>p(1))},{icon:l(()=>[t(e(ne),null,{default:l(()=>[t(e(Qe))]),_:1})]),_:1},8,["disabled"]),t(e(Re),{size:"tiny",circle:"",disabled:w.value===1,onClick:d[8]||(d[8]=L=>{p(-1)})},{icon:l(()=>[t(e(ne),null,{default:l(()=>[t(e(Ze))]),_:1})]),_:1},8,["disabled"]),t(e(et),{checked:y.value,"onUpdate:checked":d[9]||(d[9]=L=>y.value=L),label:"隐藏olo总额",style:{"margin-left":"auto"}},null,8,["checked"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),jt=te({__name:"ImageUpload",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(X,{emit:Y}){const S=le(),U=ue(),s=m(null),I=X,$=Y,D=["mjj","imgbb","freeimage","picgo","tutu"],C=["imge","imgtbl","imgimg","helloimg","picui","imgwang"],v=O(()=>I.forumId===419?0:D.includes(S.userCustom.imgHost)?1:C.includes(S.userCustom.imgHost)?2:1),f=m(!1),_=({file:g,data:w,headers:p,withCredentials:u,action:c,onFinish:n,onError:T,onProgress:N})=>{if(g.file!==null){if(g.file.size>1024e3){window.$message.error("图片大小不能超过10M喔"),s.value?.clear();return}const q={binggan:U.binggan,file:g.file,mode:"img",thread_id:I.threadId,forum_id:I.forumId};f.value=!0,We(q).then(F=>{$("insertImage",F.file_url),s.value?.clear(),f.value=!1}).catch(()=>{s.value?.clear(),f.value=!1})}};function M(g){var w=document.getElementsByTagName("body")[0],p=document.createElement("script");p.setAttribute("id","image-upload-js");var u=document.getElementById("upload-button");g=="mjj"&&(p.setAttribute("async","true"),p.setAttribute("data-mode","manual"),p.setAttribute("src","https://mjj.today/sdk/pup.js"),p.setAttribute("data-url","https://mjj.today/upload"),p.setAttribute("data-auto-insert","html-embed"),u?.setAttribute("data-chevereto-pup-trigger","")),g=="imgbb"&&(p.setAttribute("async","true"),p.setAttribute("data-mode","manual"),p.setAttribute("src","https://imgbb.com/upload.js"),p.setAttribute("data-url","https://imgbb.com/upload"),p.setAttribute("data-auto-insert","html-embed-medium"),u?.setAttribute("data-imgbb-trigger","")),g=="freeimage"&&(p.setAttribute("async","true"),p.setAttribute("data-mode","manual"),p.setAttribute("src","https://freeimage.host/sdk/pup.js"),p.setAttribute("data-url","https://freeimage.host/upload"),p.setAttribute("data-auto-insert","html-embed-medium"),u?.setAttribute("data-chevereto-pup-trigger","")),g=="picgo"&&(p.setAttribute("async","true"),p.setAttribute("data-mode","manual"),p.setAttribute("src","https://www.picgo.net/sdk/pup.js"),p.setAttribute("data-url","https://www.picgo.net/upload"),p.setAttribute("data-auto-insert","html-embed"),u?.setAttribute("data-chevereto-pup-trigger","")),w.appendChild(p)}const A=O(()=>({imge:"https://imge.cc/api/v1/upload",imgtbl:"https://imgtbl.com/api/v1/upload",imgimg:"https://imgimg.cc/api/v1/upload",helloimg:"https://www.helloimg.com/api/v1/upload",picui:"https://picui.cn/api/v1/upload",imgwang:"https://img.wang/api/v1/upload"})[S.userCustom.imgHost]||""),r=({file:g,data:w,headers:p,withCredentials:u,action:c,onFinish:n,onError:T,onProgress:N})=>{if(g.file!==null){const q={file:g.file,url:A.value};f.value=!0,gt(q).then(F=>{console.log(F.data),F.status===!0?$("insertImage",F.data.links.url):window.$message.error(F.message),s.value?.clear(),f.value=!1}).catch(()=>{s.value?.clear(),f.value=!1})}};function y(){document.getElementById("image-upload-js")?.remove()}return Oe(()=>{D.includes(S.userCustom.imgHost)&&M(S.userCustom.imgHost)}),tt(()=>{y()}),(g,w)=>(H(),ee(re,null,[v.value===0?(H(),E(e(He),{key:0,accept:"image/*","custom-request":_,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:s},{default:l(()=>[t(e(W),{style:{"margin-right":"auto"},disabled:g.userIsLocked,loading:f.value},{default:l(()=>[...w[0]||(w[0]=[i("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):Q("",!0),v.value===1?(H(),E(e(W),{key:1,style:{"margin-right":"auto"},disabled:g.userIsLocked,"data-target":"#content-input",id:"upload-button"},{default:l(()=>[...w[1]||(w[1]=[i("上传图片",-1)])]),_:1},8,["disabled"])):Q("",!0),v.value===2?(H(),E(e(He),{key:2,accept:"image/*","custom-request":r,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:s},{default:l(()=>[t(e(W),{style:{"margin-right":"auto"},disabled:g.userIsLocked,loading:f.value},{default:l(()=>[...w[2]||(w[2]=[i("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):Q("",!0)],64))}}),Nt=te({__name:"PingbiciModal",setup(X,{expose:Y}){const S=le(),U=ue(),s=m(),{loading:I,send:$,onSuccess:D}=pe(_=>ct(_),{immediate:!1});function C(){if(!s.value){window.$message.error("请填写屏蔽词");return}const _={binggan:U.binggan,content_pingbici:s.value};$(_)}D(()=>{U.refreshUserData(),v.value=!1});const v=m(!1);function f(){v.value=!0}return Y({show:f}),(_,M)=>(H(),E(e(de),{show:v.value,"onUpdate:show":M[3]||(M[3]=A=>v.value=A),"display-directive":"if"},{default:l(()=>[t(e(ie),{style:K({maxWidth:e(S).modalMaxWidth}),title:"追加屏蔽词",closable:"",onClose:M[2]||(M[2]=A=>v.value=!1),size:"small"},{action:l(()=>[t(e(j),{justify:"end"},{default:l(()=>[t(e(W),{type:"primary",onClick:C,loading:e(I),disabled:!s.value||e(I)},{default:l(()=>[...M[6]||(M[6]=[i("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(W),{onClick:M[1]||(M[1]=A=>v.value=!1)},{default:l(()=>[...M[7]||(M[7]=[i("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(j),{vertical:""},{default:l(()=>[t(e(V),null,{default:l(()=>[...M[4]||(M[4]=[i("暂时只做了“内容屏蔽词”的追加",-1)])]),_:1}),t(e(B),null,{default:l(()=>[t(e(R),{style:{width:"4.2rem"}},{default:l(()=>[...M[5]||(M[5]=[i("屏蔽词",-1)])]),_:1}),t(e(J),{value:s.value,"onUpdate:value":M[0]||(M[0]=A=>s.value=A),maxlength:20,"show-count":"",onKeyup:fe(C,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ft=te({__name:"PostInput",props:{mode:{},disabled:{type:Boolean},handling:{type:Boolean},forumId:{default:0},threadId:{default:0},randomHeadsGroup:{default:1}},emits:["contentCommit","refreshPostsList"],setup(X,{expose:Y,emit:S}){const U=ue(),s=le(),I=m(null),$=m(null),D=m(null),C=m(null),v=m(null),f=m(null),_=m(null),M=X,A=O(()=>({fontSize:s.userCustom.fontSizeInput+"px",borderRadius:"10px"})),r=O(()=>{const h=(u.value.match(/\r?\n|\r/g)||[]).length+2;return h<5?5:h>10?10:h}),y=O(()=>U.userData.binggan.locked_ttl>0?`你的饼干封禁中，将于${Math.floor(U.userData.binggan.locked_ttl/3600)+1}小时后解封`:"正文内容"),g=O(()=>U.userData.binggan.locked_ttl>0),w=m(U.userData.binggan.nickname||"= ="),p=m(""),u=m(""),c=m(!1),n=m(!1);function T(){w.value=U.userData.binggan.nickname||"= =",p.value="",u.value="",c.value=!1,n.value=!1}const N=O(()=>({id:0,created_at:"预览模式",is_deleted:0,thread_id:0,battle_id:null,hongbao_id:null,floor:0,random_head:1,created_by_admin:0,content:u.value,nickname:w.value,is_your_post:!0,hongbao_data:null})),q=O(()=>({class:{"nickname-input":!0,admin:n.value}})),F=m(!1),G=lt("emoji_auto_hide",!1);function d(){let h=[he(Me,{checked:F.value,"onUpdate:checked":a=>F.value=a,label:"实时预览"}),he(Me,{checked:G.value,"onUpdate:checked":a=>G.value=a,label:"表情包自动收起"})];return U.userData.binggan.admin!==0&&U.checkAdminForums(M.forumId)&&h.push(he(Me,{checked:n.value,"onUpdate:checked":a=>n.value=a,label:"管理员"})),he(j,{style:"padding:6px 8px",vertical:!0},()=>h)}const L=[{key:"funcOption",type:"render",render:d}],ve=[{label:"涂鸦板",key:"draw",icon:Ee(mt,{size:"1.5rem"})},{label:"屏蔽词",key:"mute",icon:Ee(pt,{size:"1.5rem"})}];function Ce(h){switch(h){case"mute":v.value?.show();break;case"draw":_.value?.show();break}}Ae(n,h=>w.value=h?"管理员":"= =");function ke(h){return h.selectionStart!=null?h.selectionStart:0}function xe(h,a){const z=ke(h),_e=h.value,Ge=_e.substring(0,z)+a+_e.substring(z);u.value=Ge,setTimeout(()=>{h.selectionStart=z+a.length,h.selectionEnd=z+a.length},0)}function ge(h){const a=document.getElementById("content-input");xe(a,h),ce(),a.focus()}function Te(){ht({title:"要清空内容吗？",onPositiveClick:()=>u.value=""})}const ae=m([""]);function me(){ae.value.length>1&&(ae.value.pop(),u.value=ae.value.slice(-1)[0])}function ce(){ae.value.push(u.value??""),ae.value.length>20&&ae.value.shift()}function b(h,a){ge(`<img src='${h}' class='${a?"custom-emoji-img":"emoji-img"}'>`)}function o(h){ge(h)}function k(h){ge(`<img src='${h}' />`)}function x(h){u.value=h,ce(),I.value?.focus()}const P=S;function Ie(h){if(!h.isTrusted){const z={title:"错误",closable:!1,content:"请不要用脚本回复喔，可能会被系统判断为脚本并碎饼干。",positiveText:"确定"};window.$dialog.warning(z);return}new Promise(function(z,_e){P("contentCommit",{contentInput:u.value,nicknameInput:w.value,postWithAdmin:n.value,titleInput:p.value,isDelay:c.value,ist:h.isTrusted},z)}).then(Fe)}function Fe(){p.value="",u.value="",c.value=!1}const $e=m(!1);return Y({quoteHandle:x,isTyping:$e,resetInput:T}),(h,a)=>(H(),E(e(j),{vertical:""},{default:l(()=>[F.value?(H(),ee(re,{key:0},[h.mode==="thread"?(H(),E(e(ie),{class:"thread-title-container",size:"small",key:"title-card"},{default:l(()=>[Z("span",{class:"thread-title",style:K({fontSize:e(s).userCustom.fontSizeThreadList+"px"})},oe(p.value||"标题预览")+" [0] ",5)]),_:1})):Q("",!0),t(Mt,{"post-data":N.value,"forum-id":0,"preview-mode":!0},null,8,["post-data"])],64)):Q("",!0),t(e(j),{size:"small",wrap:!1,align:"center",style:K({paddingRight:e(s).isMobile?"24px":"0px"})},{default:l(()=>[t(e(B),{style:{"max-width":"300px"}},{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...a[15]||(a[15]=[i("昵称",-1)])]),_:1}),t(e(J),{maxlength:30,value:w.value,"onUpdate:value":a[0]||(a[0]=z=>w.value=z),"show-count":"","input-props":q.value},null,8,["value","input-props"])]),_:1}),t(e(je),{trigger:e(s).isMobile?"click":"hover",options:L,placement:"bottom-start"},{default:l(()=>[t(e(W),{size:"medium",style:{"flex-shrink":"0"},secondary:!1},{default:l(()=>[...a[16]||(a[16]=[i("功能",-1)])]),_:1})]),_:1},8,["trigger"])]),_:1},8,["style"]),h.mode==="thread"?(H(),E(e(B),{key:1},{default:l(()=>[t(e(R),{style:{width:"3.2rem"}},{default:l(()=>[...a[17]||(a[17]=[i("标题",-1)])]),_:1}),t(e(J),{maxlength:100,value:p.value,"onUpdate:value":a[1]||(a[1]=z=>p.value=z),"show-count":"",placeholder:"标题内容"},null,8,["value"])]),_:1})):Q("",!0),t(Bt,{"auto-hide":e(G),"random-heads-group":h.randomHeadsGroup,onAppendEmoji:b},null,8,["auto-hide","random-heads-group"]),t(e(j),{size:e(s).isMobile?"small":"medium",justify:"end",align:"center",style:K({paddingRight:e(s).isMobile?"24px":"0px"})},{default:l(()=>[t(e(je),{trigger:"click",options:ve,onSelect:Ce,size:e(s).isMobile?"medium":"large"},{default:l(()=>[t(e(ne),{size:e(s).isMobile?20:24,style:{cursor:"pointer"}},{default:l(()=>[t(e(at))]),_:1},8,["size"])]),_:1},8,["size"]),h.mode==="post"?(H(),E(e(se),{key:0,placement:"bottom-start",trigger:e(s).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ne),{size:e(s).isMobile?28:32},{default:l(()=>[t(e(nt),{style:{cursor:"pointer"},onClick:a[2]||(a[2]=z=>$.value?.show())})]),_:1},8,["size"])]),default:l(()=>[a[18]||(a[18]=i(" 发红包 ",-1))]),_:1},8,["trigger"])):Q("",!0),h.mode==="post"?(H(),E(e(se),{key:1,placement:"bottom-start",trigger:e(s).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ne),{size:e(s).isMobile?28:32},{default:l(()=>[t(e(ot),{style:{cursor:"pointer"},onClick:a[3]||(a[3]=z=>D.value?.show())})]),_:1},8,["size"])]),default:l(()=>[a[19]||(a[19]=i(" 大乱斗 ",-1))]),_:1},8,["trigger"])):Q("",!0),h.mode==="post"?(H(),E(e(se),{key:2,placement:"bottom-start",trigger:e(s).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ne),{size:e(s).isMobile?28:32},{default:l(()=>[t(e(ut),{style:{cursor:"pointer"},onClick:a[4]||(a[4]=z=>C.value?.show())})]),_:1},8,["size"])]),default:l(()=>[a[20]||(a[20]=i(" Roll点 ",-1))]),_:1},8,["trigger"])):Q("",!0),t(e(se),{placement:"bottom-start",trigger:e(s).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ne),{size:e(s).isMobile?28:32},{default:l(()=>[t(e(st),{style:{cursor:"pointer"},onClick:a[5]||(a[5]=z=>f.value?.show())})]),_:1},8,["size"])]),default:l(()=>[a[21]||(a[21]=i(" 快捷代码 ",-1))]),_:1},8,["trigger"]),t(e(it),{vertical:""}),t(e(se),{placement:"bottom-start",trigger:e(s).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ne),{size:e(s).isMobile?28:32},{default:l(()=>[t(e(rt),{style:{cursor:"pointer"},onClick:me})]),_:1},8,["size"])]),default:l(()=>[a[22]||(a[22]=i(" 撤销 ",-1))]),_:1},8,["trigger"]),t(e(se),{placement:"bottom-start",trigger:e(s).isMobile?"click":"hover"},{trigger:l(()=>[t(e(ne),{size:e(s).isMobile?28:32},{default:l(()=>[t(e(dt),{style:{cursor:"pointer"},onClick:Te})]),_:1},8,["size"])]),default:l(()=>[a[23]||(a[23]=i(" 清空 ",-1))]),_:1},8,["trigger"])]),_:1},8,["size","style"]),t(e(vt),{value:u.value,"onUpdate:value":a[6]||(a[6]=z=>u.value=z),type:"textarea",placeholder:y.value,rows:r.value,ref_key:"contentInputDom",ref:I,style:K(A.value),"input-props":{id:"content-input"},disabled:g.value,onChange:ce,onKeyup:a[7]||(a[7]=fe(Ue(z=>Ie(z),["ctrl"]),["enter"])),onBlur:a[8]||(a[8]=z=>$e.value=!1),onFocus:a[9]||(a[9]=z=>$e.value=!0)},null,8,["value","placeholder","rows","style","disabled"]),t(e(j),{justify:"end",align:"center"},{default:l(()=>[t(jt,{"user-is-locked":g.value,"forum-id":h.forumId,"thread-id":h.threadId,onInsertImage:k},null,8,["user-is-locked","forum-id","thread-id"]),h.mode==="thread"?(H(),E(e(se),{key:0,placement:"bottom-start",trigger:"hover",disabled:e(s).isMobile},{trigger:l(()=>[t(e(Me),{checked:c.value,"onUpdate:checked":a[10]||(a[10]=z=>c.value=z)},{default:l(()=>[...a[24]||(a[24]=[i("延时发送",-1)])]),_:1},8,["checked"])]),default:l(()=>[a[25]||(a[25]=i(" 第二天8点自动发出 ",-1))]),_:1},8,["disabled"])):Q("",!0),t(e(se),{placement:"bottom-start",trigger:"hover",disabled:e(s).isMobile},{trigger:l(()=>[t(e(W),{type:"primary",onClick:a[11]||(a[11]=z=>Ie(z)),loading:h.handling,disabled:h.handling||g.value},{default:l(()=>[...a[26]||(a[26]=[i("提交",-1)])]),_:1},8,["loading","disabled"])]),default:l(()=>[a[27]||(a[27]=i(" 可以Ctrl+Enter ",-1))]),_:1},8,["disabled"])]),_:1}),t(Rt,{ref_key:"HongbaoModalCom",ref:$,"thread-id":h.threadId,"forum-id":h.forumId,onRefreshPostsList:a[12]||(a[12]=z=>P("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(_t,{ref_key:"BattleModalCom",ref:D,"thread-id":h.threadId,"forum-id":h.forumId,"random-heads-group":h.randomHeadsGroup,onRefreshPostsList:a[13]||(a[13]=z=>P("refreshPostsList"))},null,8,["thread-id","forum-id","random-heads-group"]),t(xt,{ref_key:"RollModalCom",ref:C,"thread-id":h.threadId,"forum-id":h.forumId,onRefreshPostsList:a[14]||(a[14]=z=>P("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(Nt,{ref_key:"PingbiciModalCom",ref:v},null,512),t(Dt,{ref_key:"CodeModalCom",ref:f,onInsertCode:o},null,512),t(Lt,{ref_key:"DrawerModalCom",ref:_,onInsertImage:k,"user-is-locked":g.value,"forum-id":h.forumId,"thread-id":h.threadId},null,8,["user-is-locked","forum-id","thread-id"])]),_:1}))}});export{Ft as _,$t as a};
