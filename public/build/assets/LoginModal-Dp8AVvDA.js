import{w as O,d as L,$ as y,c as _,bR as I,bS as K,bT as Q,o as X,A as k,M as C,f as t,H as n,a as e,i as q,m as J,k as h,h as U,z as i,s as V,G as Y,n as x,aF as B,bh as Z,aG as ee,j as T}from"./app-Cg7Vcqiz.js";import{a as te}from"./globalSetting-B2Utz0yw.js";import{c as f,_ as $}from"./index-8YCSBjiM.js";import{_ as G}from"./FInput.vue_vue_type_script_setup_true_lang-DoxM4otI.js";import{N as A}from"./InputGroup-CHIfqDYe.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Input-D_UZB_Pc.js";import"./use-locale-Bid7opkP.js";function ae(u){var o,a,d="",s;for(u+="",o=0,a=u.length;o<a;o++)s=u.charCodeAt(o).toString(16),d+=s.length<2?"0"+s:s;return d}function se(u){var o=document.createElement("canvas"),a=o.getContext("2d"),d=u;a.textBaseline="top",a.font="14px 'Arial'",a.textBaseline="alphabetic",a.fillStyle="#f60",a.fillRect(125,1,62,20),a.fillStyle="#069",a.fillText(d,2,15),a.fillStyle="rgba(102, 204, 0, 0.7)",a.fillText(d,4,17);var s=o.toDataURL().replace("data:image/png;base64,",""),v=atob(s),c=ae(v.slice(-16,-12));return c}function ne(){const u="XiaoHuoGuoCpttmm",o="abcdef0123456789",a=f.enc.Utf8.parse(u);var s={iv:f.enc.Utf8.parse(o),mode:f.mode.CBC,padding:f.pad.Pkcs7};const v=se("BrowserLeaks,com <canvas> 1.0"),c=f.MD5(navigator.userAgent).toString().substr(0,8);return f.AES.encrypt("XiaoHuoGuo"+v+c,a,s).toString()}const re=T("div",null,[i("这里是私人论坛，欢迎来玩！"),T("br"),i("QQ小火锅避难群：156840110 "),T("br"),i("使用前需要在下面申请或者导入饼干喔")],-1),pe=O({__name:"LoginModal",emits:["submitRegister"],setup(u,{expose:o,emit:a}){const d=L(()=>{const l=window.innerWidth;return l>=532?"500px":l-32+"px"}),s=y(!1);o({show:()=>s.value=!0});const c=y(""),p=y(""),{data:S}=_(te,{initialData:!1}),{data:m}=_(I(),{initialData:{reg_record_TTL:-2}}),D=L(()=>{var l,r;if(!(((l=m.value)==null?void 0:l.reg_record_TTL)<=0))return`在${Math.floor(((r=m.value)==null?void 0:r.reg_record_TTL)/3600)}小时后才能再次领取饼干。`}),b=()=>{N(c.value,p.value),p.value=""},{loading:E,onSuccess:M,data:R,send:N}=_(K,{immediate:!1});M(()=>{localStorage.Token=R.value.token,localStorage.Binggan=R.value.binggan,window.location.href="/"});const H=()=>{W(ne())},{loading:j,onSuccess:P,onError:F,data:w,send:W}=_(Q,{immediate:!1});P(()=>{const l=X();l.binggan=w.value.binggan,localStorage.Token=w.value.token,localStorage.Binggan=w.value.binggan,s.value=!1,z("submitRegister")}),F(l=>{window.$dialog.error({title:"申请饼干失败",content:l.error.message})});const z=a;return(l,r)=>(k(),C(e(ee),{show:s.value,"onUpdate:show":r[4]||(r[4]=g=>s.value=g),"display-directive":"if"},{default:t(()=>[n(e(q),{style:J({maxWidth:d.value}),title:"欢迎来到小火锅！",closable:"",onClose:r[3]||(r[3]=g=>s.value=!1),size:"small"},{action:t(()=>[n(e(h),{justify:"end"},{default:t(()=>[e(m).reg_record_TTL>0?(k(),C(e(U),{key:0,style:{"margin-right":"auto"}},{default:t(()=>[i(V(D.value),1)]),_:1})):Y("",!0),n(e(x),{onClick:r[2]||(r[2]=g=>s.value=!1)},{default:t(()=>[i("关闭")]),_:1})]),_:1})]),default:t(()=>[n(e(h),{vertical:""},{default:t(()=>[re,n(e(A),null,{default:t(()=>[n(e($),{style:{width:"3.2rem"}},{default:t(()=>[i("饼干")]),_:1}),n(e(G),{value:c.value,"onUpdate:value":r[0]||(r[0]=g=>c.value=g),placeholder:"请输入饼干",maxlength:"9","show-count":"",onKeyup:B(b,["enter"])},null,8,["value"])]),_:1}),n(e(A),null,{default:t(()=>[n(e($),{style:{width:"3.2rem"},class:"round"},{default:t(()=>[i("密码")]),_:1}),n(e(G),{type:"password",placeholder:"（可留空）请输入密码","show-password-on":"mousedown",value:p.value,"onUpdate:value":r[1]||(r[1]=g=>p.value=g),onKeyup:B(b,["enter"])},null,8,["value"])]),_:1}),n(e(h),null,{default:t(()=>[n(e(Z),{placement:"bottom",trigger:"hover",disabled:e(S)},{trigger:t(()=>[n(e(x),{type:"warning",disabled:e(j)||!e(S)||e(m).reg_record_TTL>0,onClick:H},{default:t(()=>[i(" 我想领取新饼干！ ")]),_:1},8,["disabled"])]),default:t(()=>[n(e(U),null,{default:t(()=>[i("嗷！很抱歉，领取新饼干目前暂停中…… ")]),_:1})]),_:1},8,["disabled"]),n(e(x),{style:{"margin-left":"auto"},type:"primary",onClick:b,disabled:e(E)},{default:t(()=>[i("导入饼干")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}});export{pe as default};
