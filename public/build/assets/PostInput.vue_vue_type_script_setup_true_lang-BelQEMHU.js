import{x as te,q as V,b as f,w as fe,F as O,A as H,t as e,Q as ve,K as l,R as t,S as re,T as J,U as N,a1 as Q,X as r,_ as se,Y as R,au as we,z as ee,V as q,ao as Ge,W as le,Z as ge,i as Le,aM as ye,a8 as Ae,a9 as Pe,r as We,aR as De,aS as Ue,aI as Se,aN as Ke,aK as ze,aB as qe,$ as de,J as Ce,aP as Je,aQ as Be,C as be,G as Re,N as oe,P as Qe,u as Ze,aa as je,a0 as ie,aL as et,M as tt}from"./vendor-DKSliaeX.js";import{u as ae,c as ue,g as j,e as Z,d as X,n as Ne,w as lt,o as Oe,P as at,M as nt,p as ot,q as st,b as ut,r as Ee,D as it,s as rt,t as dt,v as vt,x as mt,E as pt,f as Me,y as ft}from"./app-BS5C2Xv4.js";import{s as gt}from"./showDialog-CR-FesH4.js";import{b as ct,c as ht,d as He,e as bt,g as wt,f as yt,i as Ct,_ as kt}from"./emojiData-Cp3MIFP-.js";import{i as Ve,a as Xe}from"./inputNumberFormat-BPxWRFt_.js";const It=te({__name:"RollModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(Y,{expose:E,emit:P}){const U=ae(),i=ue(),I=Y,$=V(()=>{let c=[];if(v.value>0&&b.value>0){for(var n=0;n<v.value;n++)c[n]=Math.floor(Math.random()*b.value)+1;return c.join()}else return null}),D=f(),C=f(),v=f(1),b=f(100),T=f(!1);function x(){T.value=!0}E({show:x});const L=P,{loading:d,send:w,onSuccess:m}=fe(c=>ct(c),{immediate:!1});function y(){if(!v.value){window.$message.error("请填写骰子数量");return}if(!b.value){window.$message.error("请填写骰子数量");return}const c={binggan:i.binggan,thread_id:I.threadId,forum_id:I.forumId,roll_name:D.value,roll_event:C.value,roll_num:v.value,roll_range:b.value};w(c)}return m(()=>{L("refreshPostsList"),T.value=!1}),(c,n)=>(H(),O(e(ve),{show:T.value,"onUpdate:show":n[6]||(n[6]=g=>T.value=g),"display-directive":"if"},{default:l(()=>[t(e(re),{style:J({maxWidth:e(U).modalMaxWidth}),title:"Roll点",closable:"",onClose:n[5]||(n[5]=g=>T.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(X),{type:"primary",onClick:y,disabled:e(d)},{default:l(()=>[...n[12]||(n[12]=[r("Roll it!",-1)])]),_:1},8,["disabled"]),t(e(X),{onClick:n[4]||(n[4]=g=>T.value=!1)},{default:l(()=>[...n[13]||(n[13]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(Q),null,{default:l(()=>[...n[7]||(n[7]=[r(" 输出参考： ",-1)])]),_:1}),t(e(Q),null,{default:l(()=>[r(se(D.value?`「${D.value}」，`:"")+" "+se(C.value?`「${C.value}」的结果：`:"")+" "+se(`${v.value} d ${b.value} = 「${$.value}」`),1)]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[8]||(n[8]=[r("Roll点昵称",-1)])]),_:1}),t(e(Z),{placeholder:"可留空",maxlength:100,value:D.value,"onUpdate:value":n[0]||(n[0]=g=>D.value=g)},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[9]||(n[9]=[r("Roll点事件",-1)])]),_:1}),t(e(Z),{placeholder:"可留空",maxlength:100,value:C.value,"onUpdate:value":n[1]||(n[1]=g=>C.value=g)},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[10]||(n[10]=[r("骰子数量",-1)])]),_:1}),t(e(we),{max:100,min:1,placeholder:"必须填写",value:v.value,"onUpdate:value":n[2]||(n[2]=g=>v.value=g)},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"},class:"round"},{default:l(()=>[...n[11]||(n[11]=[r("骰子大小",-1)])]),_:1}),t(e(we),{max:1e4,min:1,placeholder:"必须填写",value:b.value,"onUpdate:value":n[3]||(n[3]=g=>b.value=g)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),xt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Mt=q("defs",null,null,-1),_t=q("path",{d:"M682 455V311l-76 76v68c-.1 50.7-42 92.1-94 92c-19.1.1-36.8-5.4-52-15l-54 55c29.1 22.4 65.9 36 106 36c93.8 0 170-75.1 170-168z",fill:"currentColor"},null,-1),$t=q("path",{d:"M833 446h-60c-4.4 0-8 3.6-8 8c0 140.3-113.7 254-254 254c-63 0-120.7-23-165-61l-54 54c48.9 43.2 110.8 72.3 179 81v102H326c-13.9 0-24.9 14.3-25 32v36c.1 4.4 2.9 8 6 8h408c3.2 0 6-3.6 6-8v-36c0-17.7-11-32-25-32H547V782c165.3-17.9 294-157.9 294-328c0-4.4-3.6-8-8-8zm13.1-377.7l-43.5-41.9c-3.1-3-8.1-3-11.2.1l-129 129C634.3 101.2 577 64 511 64c-93.9 0-170 75.3-170 168v224c0 6.7.4 13.3 1.2 19.8l-68 68c-10.5-27.9-16.3-58.2-16.2-89.8c-.2-4.4-3.8-8-8-8h-60c-4.4 0-8 3.6-8 8c0 53 12.5 103 34.6 147.4l-137 137c-3.1 3.1-3.1 8.2 0 11.3l42.7 42.7c3.1 3.1 8.2 3.1 11.3 0L846.2 79.8l.1-.1c3.1-3.2 3-8.3-.2-11.4zM417 401V232c0-50.6 41.9-92 94-92c46 0 84.1 32.3 92.3 74.7L417 401z",fill:"currentColor"},null,-1),Tt=[Mt,_t,$t],zt=te({name:"AudioMutedOutlined",render:function(E,P){return H(),ee("svg",xt,Tt)}}),Ht={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Dt=q("path",{d:"M911.5 700.7a8 8 0 0 0-10.3-4.8L840 718.2V180c0-37.6-30.4-68-68-68H252c-37.6 0-68 30.4-68 68v538.2l-61.3-22.3c-.9-.3-1.8-.5-2.7-.5c-4.4 0-8 3.6-8 8V763c0 3.3 2.1 6.3 5.3 7.5L501 910.1c7.1 2.6 14.8 2.6 21.9 0l383.8-139.5c3.2-1.2 5.3-4.2 5.3-7.5v-59.6c0-1-.2-1.9-.5-2.8zM512 837.5l-256-93.1V184h512v560.4l-256 93.1zM660.6 312h-54.5c-3 0-5.8 1.7-7.1 4.4l-84.7 168.8H511l-84.7-168.8a8 8 0 0 0-7.1-4.4h-55.7c-1.3 0-2.6.3-3.8 1c-3.9 2.1-5.3 7-3.2 10.8l103.9 191.6h-57c-4.4 0-8 3.6-8 8v27.1c0 4.4 3.6 8 8 8h76v39h-76c-4.4 0-8 3.6-8 8v27.1c0 4.4 3.6 8 8 8h76V704c0 4.4 3.6 8 8 8h49.9c4.4 0 8-3.6 8-8v-63.5h76.3c4.4 0 8-3.6 8-8v-27.1c0-4.4-3.6-8-8-8h-76.3v-39h76.3c4.4 0 8-3.6 8-8v-27.1c0-4.4-3.6-8-8-8H564l103.7-191.6c.6-1.2 1-2.5 1-3.8c-.1-4.3-3.7-7.9-8.1-7.9z",fill:"currentColor"},null,-1),Ut=[Dt],Lt=te({name:"MoneyCollectOutlined",render:function(E,P){return H(),ee("svg",Ht,Ut)}}),At=["src"],Pt=te({__name:"CaptchaModal",emits:["waterUnlockOnSuccess"],setup(Y,{expose:E,emit:P}){const U=ae(),i=ue(),I=f(),$=V(()=>b.value.captcha_key),D=f(!1);function C(){D.value=!0,x()}E({show:C});const v=P,{data:b,loading:T,send:x}=fe(Ne,{immediate:!1}),{fetch:L}=Ge();function d(){L(Ne())}const{loading:w,send:m,onSuccess:y,onError:c}=fe(g=>lt(g),{immediate:!1});function n(){if(!I.value){window.$message.error("验证码不能为空");return}const g={binggan:i.binggan,captcha_code:I.value,captcha_key:$.value};m(g),y(()=>{I.value="",D.value=!1,v("waterUnlockOnSuccess")}),c(()=>{I.value="",d()})}return(g,o)=>(H(),O(e(ve),{show:D.value,"onUpdate:show":o[3]||(o[3]=_=>D.value=_),"display-directive":"if"},{default:l(()=>[t(e(re),{style:J({maxWidth:e(U).modalMaxWidth}),title:"验证码",closable:"",onClose:o[2]||(o[2]=_=>D.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(X),{type:"primary",onClick:n,loading:e(w),disabled:e(w)},{default:l(()=>[...o[7]||(o[7]=[r("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(X),{onClick:o[1]||(o[1]=_=>D.value=!1)},{default:l(()=>[...o[8]||(o[8]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(Q),null,{default:l(()=>[...o[4]||(o[4]=[r(" 嗷……你可能刷太多了，休息一下吧。 ",-1)])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"3.2rem"},class:"round"},{default:l(()=>[...o[5]||(o[5]=[r("输入",-1)])]),_:1}),t(e(Z),{placeholder:"请输入验证码",maxlength:"4","show-count":"",value:I.value,"onUpdate:value":o[0]||(o[0]=_=>I.value=_),onKeyup:ge(n,["enter"])},null,8,["value"])]),_:1}),e(T)?le("",!0):(H(),ee("img",{key:0,src:"data:image/png;base64,"+e(b).captcha_img,style:{"max-width":"200px"},onClick:d},null,8,At)),t(e(Q),null,{default:l(()=>[...o[6]||(o[6]=[r(" 点击可更换验证码。不区分大小写。 ",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),St=te({__name:"BattleModal",props:{threadId:{},forumId:{},randomHeadsGroup:{}},emits:["refreshPostsList"],setup(Y,{expose:E,emit:P}){const U=ae(),i=ue(),I=f(null),$=Y,D=V(()=>{const g=[{value:1,label:"共通",available:!0}];return ht.forEach(o=>{o.value===$.randomHeadsGroup&&g.push(o)}),g}),C=V(()=>{const g=He[b.value-1];if(b.value===1){const o=i.userData.my_battle_chara.filter(_=>!_.not_use).map((_,W)=>({value:W+240,label:_.name}));return g.concat(o)}else return g}),v=f(1),b=f($.randomHeadsGroup),T=f(100);Le(b,g=>{g===1?v.value=He[g-1][8].value:v.value=He[g-1][0].value},{immediate:!0});const{loading:x,send:L,onSuccess:d,onError:w}=fe(g=>bt(g),{immediate:!1});function m(g){var G;const{timestamp:o,newPostKey:_}=wt((G=g==null?void 0:g.isTrusted)!=null?G:!0,$.threadId,i.binggan),W={binggan:i.binggan,forum_id:$.forumId,thread_id:$.threadId,battle_olo:T.value,chara_id:v.value>=240?v.value-240:v.value,is_custom_chara:v.value>=240,chara_group:b.value-1,new_post_key:_,timestamp:o};L(W)}d(()=>{n("refreshPostsList"),y.value=!1}),w(g=>{var o;g.error.cause!==void 0&&g.error.cause.code===244291&&((o=I.value)==null||o.show())});const y=f(!1);function c(){y.value=!0}E({show:c});const n=P;return(g,o)=>(H(),O(e(ve),{show:y.value,"onUpdate:show":o[5]||(o[5]=_=>y.value=_),"display-directive":"if"},{default:l(()=>[t(e(re),{style:J({maxWidth:e(U).modalMaxWidth}),title:"表情包大乱斗！",closable:"",onClose:o[4]||(o[4]=_=>y.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(X),{type:"primary",onClick:m,loading:e(x)},{default:l(()=>[...o[10]||(o[10]=[r("提交",-1)])]),_:1},8,["loading"]),t(e(X),{onClick:o[3]||(o[3]=_=>y.value=!1)},{default:l(()=>[...o[11]||(o[11]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(Q),null,{default:l(()=>[...o[6]||(o[6]=[r("小斗怡情，大斗伤身，强斗奥飞湮灭",-1)])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...o[7]||(o[7]=[r("主题",-1)])]),_:1}),t(e(ye),{value:b.value,"onUpdate:value":o[0]||(o[0]=_=>b.value=_),options:D.value},null,8,["value","options"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...o[8]||(o[8]=[r("角色",-1)])]),_:1}),t(e(ye),{value:v.value,"onUpdate:value":o[1]||(o[1]=_=>v.value=_),options:C.value},null,8,["value","options"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...o[9]||(o[9]=[r("下注",-1)])]),_:1}),t(e(we),{value:T.value,"onUpdate:value":o[2]||(o[2]=_=>T.value=_),max:1e6,min:1,step:100,parse:e(Xe),format:e(Ve),onKeyup:ge(m,["enter"])},null,8,["value","parse","format"])]),_:1})]),_:1}),t(Pt,{ref_key:"CaptchaModalCom",ref:I,onWaterUnlockOnSuccess:m},null,512)]),_:1},8,["style"])]),_:1},8,["show"]))}}),Bt=te({__name:"CodeModal",emits:["insertCode"],setup(Y,{expose:E,emit:P}){const U=ae(),i=f(0),I=f(),$=f(),D=[{value:0,label:"折叠内容"},{value:1,label:"超链接"},{value:2,label:"图片"},{value:3,label:"删除线"}],C=V(()=>[{prepend_1:"显示内容",prepend_2:"隐藏内容",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"显示内容",inputDefault_2:"隐藏内容",insertText:`<details><summary>${I.value}</summary>${$.value}</details>`},{prepend_1:"显示文字",prepend_2:"链接网址",inputEnable_1:!0,inputEnable_2:!0,inputDefault_1:"点我跳转",inputDefault_2:"",insertText:`<a href="${$.value}">${I.value}</a>`},{prepend_1:"图片链接",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<img src="${I.value}">`},{prepend_1:"删除文字",prepend_2:"",inputEnable_1:!0,inputEnable_2:!1,inputDefault_1:"",inputDefault_2:"",insertText:`<del>${I.value}</del>`}]);Le(i,()=>{I.value=C.value[i.value].inputDefault_1,$.value=C.value[i.value].inputDefault_2},{immediate:!0});function v(){x("insertCode",C.value[i.value].insertText),I.value=C.value[i.value].inputDefault_1,$.value=C.value[i.value].inputDefault_2,b.value=!1}const b=f(!1);function T(){b.value=!0}E({show:T});const x=P;return(L,d)=>(H(),O(e(ve),{show:b.value,"onUpdate:show":d[5]||(d[5]=w=>b.value=w),"display-directive":"if"},{default:l(()=>[t(e(re),{style:J({maxWidth:e(U).modalMaxWidth}),title:"快捷代码",closable:"",onClose:d[4]||(d[4]=w=>b.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(X),{type:"primary",onClick:v},{default:l(()=>[...d[8]||(d[8]=[r("插入",-1)])]),_:1}),t(e(X),{onClick:d[3]||(d[3]=w=>b.value=!1)},{default:l(()=>[...d[9]||(d[9]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(Q),null,{default:l(()=>[...d[6]||(d[6]=[r("代码预览：",-1)])]),_:1}),t(e(Q),null,{default:l(()=>[r(se(C.value[i.value].insertText),1)]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...d[7]||(d[7]=[r("代码内容",-1)])]),_:1}),t(e(ye),{value:i.value,"onUpdate:value":d[0]||(d[0]=w=>i.value=w),options:D},null,8,["value"])]),_:1}),Ae(t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[r(se(C.value[i.value].prepend_1),1)]),_:1}),t(e(Z),{value:I.value,"onUpdate:value":d[1]||(d[1]=w=>I.value=w),onKeyup:ge(v,["enter"])},null,8,["value"])]),_:1},512),[[Pe,C.value[i.value].inputEnable_1]]),Ae(t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[r(se(C.value[i.value].prepend_2),1)]),_:1}),t(e(Z),{value:$.value,"onUpdate:value":d[2]||(d[2]=w=>$.value=w),onKeyup:ge(v,["enter"])},null,8,["value"])]),_:1},512),[[Pe,C.value[i.value].inputEnable_2]])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Rt=["width","height"],jt=["width","height"],Nt=["onClick"],Et=["title","innerHTML","onClick"],Wt=te({__name:"DrawerModal",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(Y,{expose:E,emit:P}){const U=ue();ae();const i=Y,I=f(!1);function $(){I.value=!0}E({show:$});const D=P,C=f(),v=V(()=>{var p;return(p=C.value)==null?void 0:p.getContext("2d")}),b=f(),T=V(()=>{var p;return(p=b.value)==null?void 0:p.getContext("2d")}),x=new Image;let L=!1;const d={x:0,y:0,width:0,height:0},w=f([]),m=f([]),y=f([]),c=f({lineWidth:3,lineColor:"#111111",shadowBlur:1}),n=f(!1),g=f(!1);let o=0,_=0;const W=V(()=>window.innerWidth>836?796:window.innerWidth-36),G=V(()=>window.innerHeight>580?400:window.innerHeight-212),F=V(()=>[{title:"上一步",action:"prev",className:w.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>'},{title:"下一步",action:"next",className:m.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/></svg>'},{title:"橡皮擦",action:"eraser",className:w.value.length||m.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"/></svg>'},{title:"清除",action:"clear",className:w.value.length||m.value.length?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/><path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/></svg>'},{title:"拖动背景",action:"drag",className:g.value?"active":"",innerHTML:'<svg width="20" height="20" fill="currentColor"  viewBox="0 0 16 16"> <path d="M6.75 1a.75.75 0 0 1 .75.75V8a.5.5 0 0 0 1 0V5.467l.086-.004c.317-.012.637-.008.816.027.134.027.294.096.448.182.077.042.15.147.15.314V8a.5.5 0 1 0 1 0V6.435a4.9 4.9 0 0 1 .106-.01c.316-.024.584-.01.708.04.118.046.3.207.486.43.081.096.15.19.2.259V8.5a.5.5 0 0 0 1 0v-1h.342a1 1 0 0 1 .995 1.1l-.271 2.715a2.5 2.5 0 0 1-.317.991l-1.395 2.442a.5.5 0 0 1-.434.252H6.035a.5.5 0 0 1-.416-.223l-1.433-2.15a1.5 1.5 0 0 1-.243-.666l-.345-3.105a.5.5 0 0 1 .399-.546L5 8.11V9a.5.5 0 0 0 1 0V1.75A.75.75 0 0 1 6.75 1zM8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v5.34l-1.2.24a1.5 1.5 0 0 0-1.196 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.271-2.715a2 2 0 0 0-1.99-2.199h-.581a5.114 5.114 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.632 2.632 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002zm2.094 2.025z"/></svg>'}]),B=[{lineWidth:3,innerHTML:"🖌️",font_size:12},{lineWidth:6,innerHTML:"🖌️",font_size:16},{lineWidth:12,innerHTML:"🖌️",font_size:20}];function u(){const p=new ImageData(W.value,G.value);y.value.push(p)}We(()=>{u()});function A(){v.value.lineWidth=c.value.lineWidth,v.value.shadowBlur=c.value.shadowBlur,v.value.shadowColor=c.value.lineColor,v.value.strokeStyle=c.value.lineColor,v.value.lineCap="round",v.value.lineJoin="round"}function me(p){if(L)if(g.value){const s=p.target;let k,M;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),b.value.height=b.value.height;let S={x:d.x+(k-o),y:d.y+(M-_),width:d.width,height:d.height};ne(x,S)}else{v.value.beginPath(),v.value.moveTo(o,_);const s=p.target;let k,M;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),v.value.globalCompositeOperation=n.value?"destination-out":"source-over",v.value.lineTo(k,M),[o,_]=[k,M],v.value.stroke()}}function ke(p){if(g.value){const s=p.target;let k,M;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),d.x+=k-o,d.y+=M-_,L=!1}else{const s=v.value.getImageData(0,0,C.value.width,C.value.height);m.value.length?(y.value=[],y.value=y.value.concat(w.value),y.value.push(s),m.value=[]):y.value.push(s),L=!1}}function Ie(p){if(g.value){const s=p.target;let k,M;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),o=k,_=M,L=!0}else{L=!0;const s=p.target;let k,M;p instanceof MouseEvent?(k=p.clientX-s.getBoundingClientRect().x,M=p.clientY-s.getBoundingClientRect().y):(k=p.changedTouches[0].clientX-s.getBoundingClientRect().x,M=p.changedTouches[0].clientY-s.getBoundingClientRect().y),A(),o=k,_=M;const S=v.value.getImageData(0,0,C.value.width,C.value.height);w.value.push(S)}}function _e(p){c.value.lineWidth=p,n.value=!1,g.value=!1}function ce(p){switch(p){case"prev":if(w.value.length){const s=w.value.pop(),k=y.value[w.value.length+1];m.value.push(k),v.value.putImageData(s,0,0)}break;case"next":if(m.value.length){const s=m.value.pop(),k=y.value[y.value.length-m.value.length-2];w.value.push(k),v.value.putImageData(s,0,0)}break;case"clear":v.value.clearRect(0,0,C.value.width,C.value.height),w.value=[],m.value=[],y.value=[y.value[0]];break;case"eraser":n.value=!0;break;case"drag":g.value=!0;break}}function $e(p){if(p.file.file){var s=new FileReader;s.readAsDataURL(p.file.file),s.onload=k=>{x.src=k.target.result,x.onload=function(){var M=b,S=x;d.width=S.width,d.height=S.height,S.width/S.height>=M.value.width/M.value.height?S.width>M.value.width&&(d.width=M.value.width,d.height=S.height*M.value.width/S.width):S.height>M.value.height&&(d.width=S.width*M.value.height/S.height,d.height=M.value.height),ne(S,d)}}}}function ne(p,s){T.value.drawImage(p,s.x,s.y,s.width,s.height)}const pe=f(!1);function he(){let p=new Image;p.src=C.value.toDataURL("image/png"),p.onload=()=>{T.value.drawImage(p,0,0),s(b.value)};function s(M){M.toBlob(S=>{S&&k(S)},"image/png")}function k(M){const S={binggan:U.binggan,file:M,mode:"draw",thread_id:i.threadId,forum_id:i.forumId};pe.value=!0,Oe(S).then(xe=>{D("insertImage",xe.file_url),pe.value=!1,I.value=!1}).catch(()=>{pe.value=!1})}}return(p,s)=>(H(),O(e(ve),{show:I.value,"onUpdate:show":s[5]||(s[5]=k=>I.value=k),"display-directive":"show"},{default:l(()=>[t(e(re),{style:J({maxWidth:W.value+4+"px"}),title:"涂鸦板",closable:"",onClose:s[4]||(s[4]=k=>I.value=!1),size:"small","content-style":{padding:"0px"}},{default:l(()=>[q("div",{id:"canvas-container",style:J({width:W.value+"px",height:G.value+"px"})},[q("canvas",{id:"drawer-canvas-background",ref_key:"canvasBackground",ref:b,width:W.value,height:G.value,onTouchmove:s[0]||(s[0]=Ue(()=>{},["prevent"]))},null,40,Rt),q("canvas",{id:"drawer-canvas",ref_key:"canvas",ref:C,class:Se({painting:!g.value,dragging:g.value}),width:W.value,height:G.value,onTouchmove:[s[1]||(s[1]=Ue(()=>{},["prevent"])),me],onMousedown:Ie,onMouseup:ke,onMousemove:me,onTouchstart:Ie,onTouchend:ke},null,42,jt)],4),t(e(Ke),{"x-gap":"6",cols:4},{default:l(()=>[t(e(ze),{span:"1"},{default:l(()=>[s[6]||(s[6]=q("div",null,"颜色",-1)),t(e(qe),{value:c.value.lineColor,"onUpdate:value":s[2]||(s[2]=k=>c.value.lineColor=k),modes:["hex"],"show-alpha":!1},null,8,["value"])]),_:1}),t(e(ze),{span:"1"},{default:l(()=>[s[7]||(s[7]=q("div",null,"画笔",-1)),t(e(N),{id:"canvas-brush",size:"small",align:"center"},{default:l(()=>[(H(),ee(de,null,Ce(B,(k,M)=>q("span",{key:M,style:J({fontSize:k.font_size+"px"}),onClick:S=>_e(k.lineWidth)},se(k.innerHTML),13,Nt)),64))]),_:1})]),_:1}),t(e(ze),{span:"2"},{default:l(()=>[s[8]||(s[8]=q("div",null,"操作",-1)),t(e(N),{id:"canvas-control",size:"small"},{default:l(()=>[(H(!0),ee(de,null,Ce(F.value,(k,M)=>(H(),ee("span",{key:M,title:k.title,class:Se([k.className]),innerHTML:k.innerHTML,onClick:S=>ce(k.action)},null,10,Et))),128))]),_:1})]),_:1})]),_:1})]),action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(De),{"default-upload":!1,onChange:$e,"show-file-list":!1},{default:l(()=>[t(e(X),null,{default:l(()=>[...s[9]||(s[9]=[r("加载图片",-1)])]),_:1})]),_:1}),t(e(X),{type:"primary",onClick:he,disabled:p.userIsLocked,loading:pe.value},{default:l(()=>[...s[10]||(s[10]=[r("上传",-1)])]),_:1},8,["disabled","loading"]),t(e(X),{onClick:s[3]||(s[3]=k=>I.value=!1)},{default:l(()=>[...s[11]||(s[11]=[r("关闭",-1)])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ot=["onClick"],Vt=["src"],Xt=te({__name:"EmojiTab",props:{randomHeadsGroup:{default:1},autoHide:{type:Boolean,default:!0}},emits:["appendEmoji"],setup(Y,{emit:E}){const P=ue(),U=ae(),i=Y,I=V(()=>{let d=0,w=0;return U.isMobile&&(U.userCustom.sidebarLeft?d=20:w=20),{paddingLeft:d+"px",paddingRight:w+"px"}}),$=f(),D=V(()=>{const d=yt.filter(w=>!P.userData.emoji_excluded.includes(w.id)&&(w.headsId===0||w.headsId===i.randomHeadsGroup));return P.userData.my_emoji&&d.unshift({id:0,headsId:0,name:"自定义",emojis:P.userData.my_emoji}),d}),C=E;function v(d,w){C("appendEmoji",d,w==="自定义"),i.autoHide&&($.value=-1)}let b=!1;function T(d,w){return be("span",{onClick:()=>x(w),innerHTML:d})}function x(d){d===$.value&&(b=!0,$.value=-1)}function L(d,w){return b?(b=!1,!1):!0}return(d,w)=>(H(),O(e(Je),{type:"line","bar-width":0,animated:"",onBeforeLeave:L,size:e(U).isMobile?"small":"medium","default-value":-1,value:$.value,"onUpdate:value":w[0]||(w[0]=m=>$.value=m)},{default:l(()=>[(H(!0),ee(de,null,Ce(D.value,(m,y,c)=>(H(),O(e(Be),{name:m.id,tab:T(m.name,m.id)},{default:l(()=>[t(e(N),{size:"small",class:"emoji-container",style:J(I.value)},{default:l(()=>[(H(!0),ee(de,null,Ce(m.emojis,(n,g,o)=>(H(),ee("div",{class:"emoji-box",onClick:_=>v(n,m.name)},[q("img",{src:n,class:"emoji-in-box"},null,8,Vt)],8,Ot))),256))]),_:2},1032,["style"])]),_:2},1032,["name","tab"]))),256)),t(e(Be),{name:-1,tab:"隐藏"})]),_:1},8,["size","value"]))}}),Yt=te({__name:"HongbaoModal",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(Y,{expose:E,emit:P}){const U=ae(),i=ue(),I=Y,$=[{value:1,label:"口令红包 直接公开口令"},{value:2,label:"抢答红包 回复答对才公开口令"},{value:3,label:"暗号红包 抢完红包才公开口令"}],D=[{value:1,label:"随机olo"},{value:2,label:"定额olo"}],C=f(3e3),v=f(10),b=f(1),T=f(1),x=f(),L=f(),d=f([]),w=f(!1),m=f(),y=f(1);function c(B){B===1&&y.value<5&&(y.value+=1),B===-1&&y.value>1&&(d.value.splice(y.value-1,1),y.value-=1)}const{loading:n,send:g,onSuccess:o}=fe(B=>Ct(B),{immediate:!1});function _(){function B(){const u={binggan:i.binggan,forum_id:I.forumId,thread_id:I.threadId,hongbao_olo:C.value,hongbao_num:v.value,type:b.value,key_word_type:T.value,hongbao_key_word:x.value,hongbao_question:L.value,hongbao_message_json:d.value,hongbao_olo_hide:w.value,pic_url:m.value};g(u)}if(x.value===void 0){window.$message.error("必须填写“红包口令”喔");return}if(L.value===void 0&&[2,3].includes(T.value)){window.$message.error("抢答红包或者暗号红包时，必须填写“口令提示”喔");return}if(b.value===2&&C.value%v.value!==0){const u={title:"提醒",closable:!1,content:"olo总额不是红包个数的整倍数，多出的余数olo将在最后一个红包发出。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{B()}};window.$dialog.warning(u);return}B()}o(()=>{F("refreshPostsList"),W.value=!1});const W=f(!1);function G(){W.value=!0}E({show:G});const F=P;return(B,u)=>(H(),O(e(ve),{show:W.value,"onUpdate:show":u[12]||(u[12]=A=>W.value=A),"display-directive":"if"},{default:l(()=>[t(e(re),{style:J({maxWidth:e(U).modalMaxWidth}),title:"发起红包",closable:"",onClose:u[11]||(u[11]=A=>W.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(X),{type:"primary",onClick:_,disabled:e(n),loading:e(n)},{default:l(()=>[...u[26]||(u[26]=[r("提交",-1)])]),_:1},8,["disabled","loading"]),t(e(X),{onClick:u[10]||(u[10]=A=>W.value=!1)},{default:l(()=>[...u[27]||(u[27]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[q("div",null,[t(e(Q),{depth:3},{default:l(()=>[...u[13]||(u[13]=[r("温馨提示：",-1)])]),_:1}),u[14]||(u[14]=r("在红包总额以外，会追加扣除7%手续费。 ",-1))]),q("div",null,[t(e(Q),{depth:3},{default:l(()=>[...u[15]||(u[15]=[r("总共扣除：",-1)])]),_:1}),t(e(Q),{type:"warning"},{default:l(()=>[r(se(Math.ceil(C.value*(e(U).isDouble11?1.02:1.07))),1)]),_:1}),u[16]||(u[16]=r("个奥利奥 ",-1))]),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[17]||(u[17]=[r("红包类型",-1)])]),_:1}),t(e(ye),{value:T.value,"onUpdate:value":u[0]||(u[0]=A=>T.value=A),options:$},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[18]||(u[18]=[r("olo类型",-1)])]),_:1}),t(e(ye),{value:b.value,"onUpdate:value":u[1]||(u[1]=A=>b.value=A),options:D},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[19]||(u[19]=[r("红包个数",-1)])]),_:1}),t(e(we),{value:v.value,"onUpdate:value":u[2]||(u[2]=A=>v.value=A),max:50,min:5,step:5},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[20]||(u[20]=[r("olo总额",-1)])]),_:1}),t(e(we),{value:C.value,"onUpdate:value":u[3]||(u[3]=A=>C.value=A),max:1e6,min:3e3,step:1e3,parse:e(Xe),format:e(Ve)},null,8,["value","parse","format"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[21]||(u[21]=[r("红包口令",-1)])]),_:1}),t(e(Z),{value:x.value,"onUpdate:value":u[4]||(u[4]=A=>x.value=A),placeholder:"必填"},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[22]||(u[22]=[r("红包封面",-1)])]),_:1}),t(e(Z),{value:m.value,"onUpdate:value":u[5]||(u[5]=A=>m.value=A),placeholder:"（可选）填写图片的完整网址"},null,8,["value"])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[23]||(u[23]=[r("口令提示",-1)])]),_:1}),t(e(Z),{value:L.value,"onUpdate:value":u[6]||(u[6]=A=>L.value=A),placeholder:"抢答红包或者暗号红包时，必填"},null,8,["value"])]),_:1}),(H(!0),ee(de,null,Ce(y.value,A=>(H(),O(e(R),null,{default:l(()=>[t(e(j),{style:{width:"5.2rem"}},{default:l(()=>[...u[24]||(u[24]=[r("回复留言",-1)])]),_:1}),t(e(Z),{value:d.value[A-1],"onUpdate:value":me=>d.value[A-1]=me,placeholder:`#${A}（可选） 多个留言时随机抽取一个`,maxlength:255},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024))),256)),t(e(N),{size:"small",align:"center"},{default:l(()=>[t(e(Q),{depth:3},{default:l(()=>[...u[25]||(u[25]=[r("留言数量",-1)])]),_:1}),t(e(Re),{size:"tiny",circle:"",disabled:y.value===5,onClick:u[7]||(u[7]=A=>c(1))},{icon:l(()=>[t(e(oe),null,{default:l(()=>[t(e(at))]),_:1})]),_:1},8,["disabled"]),t(e(Re),{size:"tiny",circle:"",disabled:y.value===1,onClick:u[8]||(u[8]=A=>{c(-1)})},{icon:l(()=>[t(e(oe),null,{default:l(()=>[t(e(nt))]),_:1})]),_:1},8,["disabled"]),t(e(Qe),{checked:w.value,"onUpdate:checked":u[9]||(u[9]=A=>w.value=A),label:"隐藏olo总额",style:{"margin-left":"auto"}},null,8,["checked"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Ft=te({__name:"ImageUpload",props:{userIsLocked:{type:Boolean},forumId:{},threadId:{}},emits:["insertImage"],setup(Y,{emit:E}){const P=ae(),U=ue(),i=f(null),I=Y,$=E,D=["mjj","imgbb","freeimage","picgo","tutu"],C=["imge","imgtbl","imgimg","helloimg","picui","imgwang"],v=V(()=>I.forumId===419?0:D.includes(P.userCustom.imgHost)?1:C.includes(P.userCustom.imgHost)?2:1),b=f(!1),T=({file:m,data:y,headers:c,withCredentials:n,action:g,onFinish:o,onError:_,onProgress:W})=>{var G;if(m.file!==null){if(m.file.size>1024e3){window.$message.error("图片大小不能超过10M喔"),(G=i.value)==null||G.clear();return}const F={binggan:U.binggan,file:m.file,mode:"img",thread_id:I.threadId,forum_id:I.forumId};b.value=!0,Oe(F).then(B=>{var u;$("insertImage",B.file_url),(u=i.value)==null||u.clear(),b.value=!1}).catch(()=>{var B;(B=i.value)==null||B.clear(),b.value=!1})}};function x(m){var y=document.getElementsByTagName("body")[0],c=document.createElement("script");c.setAttribute("id","image-upload-js");var n=document.getElementById("upload-button");m=="mjj"&&(c.setAttribute("async","true"),c.setAttribute("data-mode","manual"),c.setAttribute("src","https://mjj.today/sdk/pup.js"),c.setAttribute("data-url","https://mjj.today/upload"),c.setAttribute("data-auto-insert","html-embed"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),m=="imgbb"&&(c.setAttribute("async","true"),c.setAttribute("data-mode","manual"),c.setAttribute("src","https://imgbb.com/upload.js"),c.setAttribute("data-url","https://imgbb.com/upload"),c.setAttribute("data-auto-insert","html-embed-medium"),n==null||n.setAttribute("data-imgbb-trigger","")),m=="freeimage"&&(c.setAttribute("async","true"),c.setAttribute("data-mode","manual"),c.setAttribute("src","https://freeimage.host/sdk/pup.js"),c.setAttribute("data-url","https://freeimage.host/upload"),c.setAttribute("data-auto-insert","html-embed-medium"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),m=="picgo"&&(c.setAttribute("async","true"),c.setAttribute("data-mode","manual"),c.setAttribute("src","https://www.picgo.net/sdk/pup.js"),c.setAttribute("data-url","https://www.picgo.net/upload"),c.setAttribute("data-auto-insert","html-embed"),n==null||n.setAttribute("data-chevereto-pup-trigger","")),y.appendChild(c)}const L=V(()=>({imge:"https://imge.cc/api/v1/upload",imgtbl:"https://imgtbl.com/api/v1/upload",imgimg:"https://imgimg.cc/api/v1/upload",helloimg:"https://www.helloimg.com/api/v1/upload",picui:"https://picui.cn/api/v1/upload",imgwang:"https://img.wang/api/v1/upload"})[P.userCustom.imgHost]||""),d=({file:m,data:y,headers:c,withCredentials:n,action:g,onFinish:o,onError:_,onProgress:W})=>{if(m.file!==null){const G={file:m.file,url:L.value};b.value=!0,ot(G).then(F=>{var B;console.log(F.data),F.status===!0?$("insertImage",F.data.links.url):window.$message.error(F.message),(B=i.value)==null||B.clear(),b.value=!1}).catch(()=>{var F;(F=i.value)==null||F.clear(),b.value=!1})}};function w(){const m=document.getElementById("image-upload-js");m==null||m.remove()}return We(()=>{D.includes(P.userCustom.imgHost)&&x(P.userCustom.imgHost)}),Ze(()=>{w()}),(m,y)=>(H(),ee(de,null,[v.value===0?(H(),O(e(De),{key:0,accept:"image/*","custom-request":T,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:i},{default:l(()=>[t(e(X),{style:{"margin-right":"auto"},disabled:m.userIsLocked,loading:b.value},{default:l(()=>[...y[0]||(y[0]=[r("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):le("",!0),v.value===1?(H(),O(e(X),{key:1,style:{"margin-right":"auto"},disabled:m.userIsLocked,"data-target":"#content-input",id:"upload-button"},{default:l(()=>[...y[1]||(y[1]=[r("上传图片",-1)])]),_:1},8,["disabled"])):le("",!0),v.value===2?(H(),O(e(De),{key:2,accept:"image/*","custom-request":d,"show-file-list":!1,max:1,ref_key:"NUploadCom",ref:i},{default:l(()=>[t(e(X),{style:{"margin-right":"auto"},disabled:m.userIsLocked,loading:b.value},{default:l(()=>[...y[2]||(y[2]=[r("上传图片",-1)])]),_:1},8,["disabled","loading"])]),_:1},512)):le("",!0)],64))}}),Gt=te({__name:"PingbiciModal",setup(Y,{expose:E}){const P=ae(),U=ue(),i=f(),{loading:I,send:$,onSuccess:D}=fe(T=>st(T),{immediate:!1});function C(){if(!i.value){window.$message.error("请填写屏蔽词");return}const T={binggan:U.binggan,content_pingbici:i.value};$(T)}D(()=>{U.refreshUserData(),v.value=!1});const v=f(!1);function b(){v.value=!0}return E({show:b}),(T,x)=>(H(),O(e(ve),{show:v.value,"onUpdate:show":x[3]||(x[3]=L=>v.value=L),"display-directive":"if"},{default:l(()=>[t(e(re),{style:J({maxWidth:e(P).modalMaxWidth}),title:"追加屏蔽词",closable:"",onClose:x[2]||(x[2]=L=>v.value=!1),size:"small"},{action:l(()=>[t(e(N),{justify:"end"},{default:l(()=>[t(e(X),{type:"primary",onClick:C,loading:e(I),disabled:!i.value||e(I)},{default:l(()=>[...x[6]||(x[6]=[r("提交",-1)])]),_:1},8,["loading","disabled"]),t(e(X),{onClick:x[1]||(x[1]=L=>v.value=!1)},{default:l(()=>[...x[7]||(x[7]=[r("关闭",-1)])]),_:1})]),_:1})]),default:l(()=>[t(e(N),{vertical:""},{default:l(()=>[t(e(Q),null,{default:l(()=>[...x[4]||(x[4]=[r("暂时只做了“内容屏蔽词”的追加",-1)])]),_:1}),t(e(R),null,{default:l(()=>[t(e(j),{style:{width:"4.2rem"}},{default:l(()=>[...x[5]||(x[5]=[r("屏蔽词",-1)])]),_:1}),t(e(Z),{value:i.value,"onUpdate:value":x[0]||(x[0]=L=>i.value=L),maxlength:20,"show-count":"",onKeyup:ge(C,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),el=te({__name:"PostInput",props:{mode:{},disabled:{type:Boolean},handling:{type:Boolean},forumId:{default:0},threadId:{default:0},randomHeadsGroup:{default:1}},emits:["contentCommit","refreshPostsList"],setup(Y,{expose:E,emit:P}){const U=ue(),i=ae(),I=f(null),$=f(null),D=f(null),C=f(null),v=f(null),b=f(null),T=f(null),x=Y,L=V(()=>({fontSize:i.userCustom.fontSizeInput+"px",borderRadius:"10px"})),d=V(()=>{const h=(n.value.match(/\r?\n|\r/g)||[]).length+2;return h<5?5:h>10?10:h}),w=V(()=>U.userData.binggan.locked_ttl>0?`你的饼干封禁中，将于${Math.floor(U.userData.binggan.locked_ttl/3600)+1}小时后解封`:"正文内容"),m=V(()=>U.userData.binggan.locked_ttl>0),y=f(U.userData.binggan.nickname||"= ="),c=f(""),n=f(""),g=f(!1),o=f(!1);function _(){y.value=U.userData.binggan.nickname||"= =",c.value="",n.value="",g.value=!1,o.value=!1}const W=V(()=>({id:0,created_at:"预览模式",is_deleted:0,thread_id:0,battle_id:null,hongbao_id:null,floor:0,random_head:1,created_by_admin:0,content:n.value,nickname:y.value,is_your_post:!0,hongbao_data:null})),G=V(()=>({class:{"nickname-input":!0,admin:o.value}})),F=f(!1),B=ut("emoji_auto_hide",!1);function u(){let h=[be(Me,{checked:F.value,"onUpdate:checked":a=>F.value=a,label:"实时预览"}),be(Me,{checked:B.value,"onUpdate:checked":a=>B.value=a,label:"表情包自动收起"})];return U.userData.binggan.admin!==0&&U.checkAdminForums(x.forumId)&&h.push(be(Me,{checked:o.value,"onUpdate:checked":a=>o.value=a,label:"管理员"})),be(N,{style:"padding:6px 8px",vertical:!0},()=>h)}const A=[{key:"funcOption",type:"render",render:u}],me=[{label:"涂鸦板",key:"draw",icon:Ee(ft,{size:"1.5rem"})},{label:"屏蔽词",key:"mute",icon:Ee(zt,{size:"1.5rem"})}];function ke(h){var a,z;switch(h){case"mute":(a=v.value)==null||a.show();break;case"draw":(z=T.value)==null||z.show();break}}Le(o,h=>y.value=h?"管理员":"= =");function Ie(h){return h.selectionStart!=null?h.selectionStart:0}function _e(h,a){const z=Ie(h),K=h.value,Fe=K.substring(0,z)+a+K.substring(z);n.value=Fe,setTimeout(()=>{h.selectionStart=z+a.length,h.selectionEnd=z+a.length},0)}function ce(h){const a=document.getElementById("content-input");_e(a,h),he(),a.focus()}function $e(){gt({title:"要清空内容吗？",onPositiveClick:()=>n.value=""})}const ne=f([""]);function pe(){ne.value.length>1&&(ne.value.pop(),n.value=ne.value.slice(-1)[0])}function he(){var h;ne.value.push((h=n.value)!=null?h:""),ne.value.length>20&&ne.value.shift()}function p(h,a){ce(`<img src='${h}' class='${a?"custom-emoji-img":"emoji-img"}'>`)}function s(h){ce(h)}function k(h){ce(`<img src='${h}' />`)}function M(h){var a;n.value=h,he(),(a=I.value)==null||a.focus()}const S=P;function xe(h){if(!h.isTrusted){const z={title:"错误",closable:!1,content:"请不要用脚本回复喔，可能会被系统判断为脚本并碎饼干。",positiveText:"确定"};window.$dialog.warning(z);return}new Promise(function(z,K){S("contentCommit",{contentInput:n.value,nicknameInput:y.value,postWithAdmin:o.value,titleInput:c.value,isDelay:g.value,ist:h.isTrusted},z)}).then(Ye)}function Ye(){c.value="",n.value="",g.value=!1}const Te=f(!1);return E({quoteHandle:M,isTyping:Te,resetInput:_}),(h,a)=>(H(),O(e(N),{vertical:""},{default:l(()=>[F.value?(H(),ee(de,{key:0},[h.mode==="thread"?(H(),O(e(re),{class:"thread-title-container",size:"small",key:"title-card"},{default:l(()=>[q("span",{class:"thread-title",style:J({fontSize:e(i).userCustom.fontSizeThreadList+"px"})},se(c.value||"标题预览")+" [0] ",5)]),_:1})):le("",!0),t(kt,{"post-data":W.value,"forum-id":0,"preview-mode":!0},null,8,["post-data"])],64)):le("",!0),t(e(N),{size:"small",wrap:!1,align:"center",style:J({paddingRight:e(i).isMobile?"24px":"0px"})},{default:l(()=>[t(e(R),{style:{"max-width":"300px"}},{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...a[15]||(a[15]=[r("昵称",-1)])]),_:1}),t(e(Z),{maxlength:30,value:y.value,"onUpdate:value":a[0]||(a[0]=z=>y.value=z),"show-count":"","input-props":G.value},null,8,["value","input-props"])]),_:1}),t(e(je),{trigger:e(i).isMobile?"click":"hover",options:A,placement:"bottom-start"},{default:l(()=>[t(e(X),{size:"medium",style:{"flex-shrink":"0"},secondary:!1},{default:l(()=>[...a[16]||(a[16]=[r("功能",-1)])]),_:1})]),_:1},8,["trigger"])]),_:1},8,["style"]),h.mode==="thread"?(H(),O(e(R),{key:1},{default:l(()=>[t(e(j),{style:{width:"3.2rem"}},{default:l(()=>[...a[17]||(a[17]=[r("标题",-1)])]),_:1}),t(e(Z),{maxlength:100,value:c.value,"onUpdate:value":a[1]||(a[1]=z=>c.value=z),"show-count":"",placeholder:"标题内容"},null,8,["value"])]),_:1})):le("",!0),t(Xt,{"auto-hide":e(B),"random-heads-group":h.randomHeadsGroup,onAppendEmoji:p},null,8,["auto-hide","random-heads-group"]),t(e(N),{size:e(i).isMobile?"small":"medium",justify:"end",align:"center",style:J({paddingRight:e(i).isMobile?"24px":"0px"})},{default:l(()=>[t(e(je),{trigger:"click",options:me,onSelect:ke,size:e(i).isMobile?"medium":"large"},{default:l(()=>[t(e(oe),{size:e(i).isMobile?20:24,style:{cursor:"pointer"}},{default:l(()=>[t(e(it))]),_:1},8,["size"])]),_:1},8,["size"]),h.mode==="post"?(H(),O(e(ie),{key:0,placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(Lt),{style:{cursor:"pointer"},onClick:a[2]||(a[2]=z=>{var K;return(K=$.value)==null?void 0:K.show()})})]),_:1},8,["size"])]),default:l(()=>[a[18]||(a[18]=r(" 发红包 ",-1))]),_:1},8,["trigger"])):le("",!0),h.mode==="post"?(H(),O(e(ie),{key:1,placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(rt),{style:{cursor:"pointer"},onClick:a[3]||(a[3]=z=>{var K;return(K=D.value)==null?void 0:K.show()})})]),_:1},8,["size"])]),default:l(()=>[a[19]||(a[19]=r(" 大乱斗 ",-1))]),_:1},8,["trigger"])):le("",!0),h.mode==="post"?(H(),O(e(ie),{key:2,placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(dt),{style:{cursor:"pointer"},onClick:a[4]||(a[4]=z=>{var K;return(K=C.value)==null?void 0:K.show()})})]),_:1},8,["size"])]),default:l(()=>[a[20]||(a[20]=r(" Roll点 ",-1))]),_:1},8,["trigger"])):le("",!0),t(e(ie),{placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(vt),{style:{cursor:"pointer"},onClick:a[5]||(a[5]=z=>{var K;return(K=b.value)==null?void 0:K.show()})})]),_:1},8,["size"])]),default:l(()=>[a[21]||(a[21]=r(" 快捷代码 ",-1))]),_:1},8,["trigger"]),t(e(et),{vertical:""}),t(e(ie),{placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(mt),{style:{cursor:"pointer"},onClick:pe})]),_:1},8,["size"])]),default:l(()=>[a[22]||(a[22]=r(" 撤销 ",-1))]),_:1},8,["trigger"]),t(e(ie),{placement:"bottom-start",trigger:e(i).isMobile?"click":"hover"},{trigger:l(()=>[t(e(oe),{size:e(i).isMobile?28:32},{default:l(()=>[t(e(pt),{style:{cursor:"pointer"},onClick:$e})]),_:1},8,["size"])]),default:l(()=>[a[23]||(a[23]=r(" 清空 ",-1))]),_:1},8,["trigger"])]),_:1},8,["size","style"]),t(e(tt),{value:n.value,"onUpdate:value":a[6]||(a[6]=z=>n.value=z),type:"textarea",placeholder:w.value,rows:d.value,ref_key:"contentInputDom",ref:I,style:J(L.value),"input-props":{id:"content-input"},disabled:m.value,onChange:he,onKeyup:a[7]||(a[7]=ge(Ue(z=>xe(z),["ctrl"]),["enter"])),onBlur:a[8]||(a[8]=z=>Te.value=!1),onFocus:a[9]||(a[9]=z=>Te.value=!0)},null,8,["value","placeholder","rows","style","disabled"]),t(e(N),{justify:"end",align:"center"},{default:l(()=>[t(Ft,{"user-is-locked":m.value,"forum-id":h.forumId,"thread-id":h.threadId,onInsertImage:k},null,8,["user-is-locked","forum-id","thread-id"]),h.mode==="thread"?(H(),O(e(ie),{key:0,placement:"bottom-start",trigger:"hover",disabled:e(i).isMobile},{trigger:l(()=>[t(e(Me),{checked:g.value,"onUpdate:checked":a[10]||(a[10]=z=>g.value=z)},{default:l(()=>[...a[24]||(a[24]=[r("延时发送",-1)])]),_:1},8,["checked"])]),default:l(()=>[a[25]||(a[25]=r(" 第二天8点自动发出 ",-1))]),_:1},8,["disabled"])):le("",!0),t(e(ie),{placement:"bottom-start",trigger:"hover",disabled:e(i).isMobile},{trigger:l(()=>[t(e(X),{type:"primary",onClick:a[11]||(a[11]=z=>xe(z)),loading:h.handling,disabled:h.handling||m.value},{default:l(()=>[...a[26]||(a[26]=[r("提交",-1)])]),_:1},8,["loading","disabled"])]),default:l(()=>[a[27]||(a[27]=r(" 可以Ctrl+Enter ",-1))]),_:1},8,["disabled"])]),_:1}),t(Yt,{ref_key:"HongbaoModalCom",ref:$,"thread-id":h.threadId,"forum-id":h.forumId,onRefreshPostsList:a[12]||(a[12]=z=>S("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(St,{ref_key:"BattleModalCom",ref:D,"thread-id":h.threadId,"forum-id":h.forumId,"random-heads-group":h.randomHeadsGroup,onRefreshPostsList:a[13]||(a[13]=z=>S("refreshPostsList"))},null,8,["thread-id","forum-id","random-heads-group"]),t(It,{ref_key:"RollModalCom",ref:C,"thread-id":h.threadId,"forum-id":h.forumId,onRefreshPostsList:a[14]||(a[14]=z=>S("refreshPostsList"))},null,8,["thread-id","forum-id"]),t(Gt,{ref_key:"PingbiciModalCom",ref:v},null,512),t(Bt,{ref_key:"CodeModalCom",ref:b,onInsertCode:s},null,512),t(Wt,{ref_key:"DrawerModalCom",ref:T,onInsertImage:k,"user-is-locked":m.value,"forum-id":h.forumId,"thread-id":h.threadId},null,8,["user-is-locked","forum-id","thread-id"])]),_:1}))}});export{el as _,Pt as a};
