import{r as te,u as re,x as se,a3 as oe,a5 as le,b as d,q as b,i as ue,am as ne,an as ie,a2 as de,F as k,A as i,K as o,z as w,W as _,R as s,V as pe,t as e,aj as me,ak as fe,$ as ce,J as ge,U as m,a9 as E,X as u,N as ve,Z as he,_ as N,ao as ye,ap as be,al as ke,C as f,aq as we}from"./vendor-DamaS_bj.js";import{u as _e,t as W}from"./forums-DgGzAUO0.js";import{s as F}from"./subtitles-DW7M559j.js";import{s as Ie}from"./shuffle-Bl2z5mvo.js";import{u as j,b as Se,a as U,c as p,d as Ce,e as O,_ as Te}from"./app-CRZ7Digb.js";import{_ as xe}from"./loudspeaker-Dtgrv2yY.js";import{S as De,L as Le,a as $e}from"./LoudspeakerComponent-wzXM4NPN.js";import{T as Ne}from"./ThreadList-Bo6iCZru.js";import"./showDialog-DfAZGtWi.js";import"./browseLogger-C2_cwgCY.js";function Fe(){const g=j();te(()=>{g.showTopbarNav=!1}),re(()=>{g.showTopbarNav=!0})}const Ue={key:0,class:"carousel-box"},Oe={key:0,class:"carousel-box"},ze=["src"],Me=se({__name:"ForumPage",props:{forumId:{},page:{},search:{},delay:{type:Boolean}},setup(g){oe(r=>({"366ac772":e(n).bannerHeight}));const I=Se(),n=j(),c=_e(),v=le(),B=d(null);d();const z=d();Fe();const t=g,G=b(()=>Ie(c.forumData(t.forumId)?.banners).slice(0,5));document.title=c.forumData(t.forumId)?.name??"小火锅";const S=U("banner_hiden",!1),C=U("new_window_to_post",!1);function K(){return f(m,{style:"padding:6px 8px",vertical:!0},()=>[f(O,{checked:S.value,"onUpdate:checked":r=>S.value=r,label:"隐藏版头"}),f(O,{checked:C.value,"onUpdate:checked":r=>C.value=r,label:"新窗口打开"})])}const H=[{type:"group",key:"header",label:"功能"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:K}],T=U("subtitles_included",F),M=b(()=>F.filter(r=>!T.value.includes(r)));function J(){return f(we,{value:T.value,"onUpdate:value":r=>T.value=r},()=>[f(m,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(F).map(r=>f(O,{value:r,label:r}))])])}const V=[{type:"group",key:"header",label:"筛选"},{key:"header-divider",type:"divider"},{key:"filterOptions",type:"render",render:J}],h=d(t.search),y=d(!!t.search);function P(){v.push({name:"forum",params:{forumId:t.forumId,page:1},query:{search:h.value||void 0}})}function X(){h.value=void 0,y.value=!1,v.push({name:"forum",params:{forumId:t.forumId,page:1}})}function Z(){v.push({name:"forum",params:{forumId:t.forumId,page:1},query:{delay:t.delay?void 0:"true"}})}const x=d(t.page);function Q(r){v.push({name:"forum",params:{forumId:t.forumId,page:r},query:{search:t.search,delay:t.delay?"true":void 0}})}ue(()=>t.page,r=>x.value=r);const q=b(()=>({forumId:t.forumId,binggan:I.binggan,page:t.page,threadsPerPage:50,subtitlesExcluded:M.value,searchTitle:t.search,delay:t.delay})),{loading:D,data:L,onSuccess:Pe}=ne(()=>W(q.value),[()=>t.forumId,()=>t.page,()=>t.search,()=>t.delay,M],{initialData:[],immediate:!0}),A=d(!1),{onSuccess:Y,fetch:ee}=ie();function R(r=!1){A.value=r,ee(W(q.value)),z.value?.reloadBrowseLogger()}Y(()=>{A.value&&!n.userCustom.lessToast&&window.$message.success("已刷新数据")});const ae=b(()=>{if(D.value)return[];if(I.userData.binggan.use_pingbici){const r=n.userCustom.pingbiciIngnoreCase?"gi":"g";return L.value.threads_data.data.filter(a=>{for(let $ of I.userData.pingbici.title_pingbici)if(new RegExp($,r).test(a.title))return!1;return!0})}else return L.value.threads_data.data});return(r,a)=>{const $=de("router-link");return i(),k(e(m),{vertical:""},{default:o(()=>[e(S)?_("",!0):(i(),w("div",Ue,[e(c).forumsDataLoading?(i(),w("div",Oe,[s(e(me),{class:"carousel-skeleton",sharp:""})])):_("",!0),e(c).forumsDataLoading?_("",!0):(i(),k(e(fe),{key:1,"show-arrow":"",trigger:e(n).isMobile?"click":"hover",autoplay:"",interval:1e4},{default:o(()=>[(i(!0),w(ce,null,ge(G.value,l=>(i(),w("img",{src:l,class:"carousel-img"},null,8,ze))),256))]),_:1},8,["trigger"]))])),s(e(m),{style:{"margin-top":"8px"},size:"small"},{default:o(()=>[s(e(E),{trigger:e(n).isMobile?"click":"hover",options:H,placement:"bottom-start"},{default:o(()=>[s(e(p),null,{default:o(()=>[...a[7]||(a[7]=[u("功能",-1)])]),_:1})]),_:1},8,["trigger"]),s(e(E),{trigger:e(n).isMobile?"click":"hover",options:V,placement:"bottom-start"},{default:o(()=>[s(e(p),null,{default:o(()=>[...a[8]||(a[8]=[u("筛选",-1)])]),_:1})]),_:1},8,["trigger"]),s(e(ve),{size:e(n).isMobile?28:34},{default:o(()=>[s(e(De),{style:{cursor:"pointer"},onClick:a[0]||(a[0]=l=>y.value=!y.value)})]),_:1},8,["size"]),s(e(p),{type:"primary",style:{"margin-left":"auto"},onClick:a[1]||(a[1]=l=>r.$router.push({name:"loudspeaker"}))},{default:o(()=>[...a[9]||(a[9]=[u("大喇叭",-1)])]),_:1}),s(e(p),{type:"primary",onClick:a[2]||(a[2]=l=>r.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},{default:o(()=>[...a[10]||(a[10]=[u("新主题",-1)])]),_:1})]),_:1}),y.value?(i(),k(e(m),{key:1,wrap:!1},{default:o(()=>[s(e(Ce),{value:h.value,"onUpdate:value":a[3]||(a[3]=l=>h.value=l),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索标题","auto-size":"",onKeyup:he(P,["enter"])},null,8,["value"]),s(e(p),{type:"primary",onClick:P},{default:o(()=>[...a[11]||(a[11]=[u("搜索",-1)])]),_:1}),s(e(p),{type:"default",onClick:X},{default:o(()=>[...a[12]||(a[12]=[u("清空",-1)])]),_:1})]),_:1})):_("",!0),s(Le),s(Ne,{ref_key:"ThreadListCom",ref:z,"threads-list-data":ae.value,"new-window-to-post":e(C),"show-this":!e(D),onWithdrawDelayThreadSuccess:R},null,8,["threads-list-data","new-window-to-post","show-this"]),s(e(m),{align:"center"},{default:o(()=>[s(e(p),{type:t.delay?"default":"primary",onClick:Z},{default:o(()=>[u(N(t.delay?"关闭延时主题":"查看延时主题"),1)]),_:1},8,["type"]),s(xe,{page:x.value,"onUpdate:page":[a[4]||(a[4]=l=>x.value=l),Q],"last-page":e(D)?1:e(L).threads_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),a[13]||(a[13]=pe("div",{style:{height:"50px"}},null,-1)),(i(),k(ye,{to:"#topbar-nav"},[s($,{to:"/",class:"flex-item-center"},{default:o(()=>[s(e(be),{tooltip:!1},{default:o(()=>[u(N(e(c).forumData(r.forumId)?.name),1)]),_:1}),s(e(ke),{round:"",class:"forum-tag",size:e(n).isMobile?"small":"medium"},{default:o(()=>[u(N(r.forumId),1)]),_:1},8,["size"])]),_:1})])),s($e,{mode:"forum",ref_key:"SidebarCom",ref:B,onRefresh:a[5]||(a[5]=l=>R(!0)),onNewThread:a[6]||(a[6]=l=>r.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},null,512)]),_:1})}}}),Je=Te(Me,[["__scopeId","data-v-e58df8a9"]]);export{Je as default};
