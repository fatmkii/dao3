import{at as fe,au as Ot,n as ne,t as y,p as h,j as r,x as t,E as o,q as e,F as se,H as ie,I,J as N,S as P,L as s,P as T,D as Se,X as Fe,M as Ee,av as Ne,O as he,l as D,K as w,aw as Et,ax as at,ay as ct,g as X,Y as ft,am as ke,az as je,aA as Ce,aB as pe,T as pt,aC as jt,aD as Ut,U as gt,W as vt,b as W,aE as _e,N as ge,aF as Ft,i as j,aG as Ve,a4 as Ae,aH as ht,aI as bt,aJ as Vt,aK as Bt,Q as ae,w as Ie,aL as Wt,aM as Kt,aN as Yt,as as Qt,C as Jt,u as J,an as Xt,ao as Zt,a2 as nt,ap as eo,aO as to,R as oo,aP as ao,a3 as st,aq as lt,ar as no,ak as so,m as He,aQ as lo,aR as ro,aS as io,aT as uo}from"./vendor-C-2co6ae.js";import{h as mo,a as co,g as _t,n as fo,_ as rt,p as po}from"./emojiData-DzIUolgl.js";import{t as go,p as it}from"./showDialog-DillYkkx.js";import{u as le,b as V,e as Ue,a as Z,c as be,f as vo,g as re,r as ve,_ as Pe,d as ut}from"./app-CsEnLcBD.js";import{_ as dt}from"./loudspeaker-B409tdOb.js";import{_ as ho,a as bo}from"./PostInput.vue_vue_type_script_setup_true_lang-Ca9ZLeMx.js";import{L as Oe,S as _o}from"./LoudspeakerComponent-P4rW1-Oq.js";import{u as wo,t as yo,a as Co,d as ko,r as Io,b as So,c as Po,e as $o,f as xo}from"./admin-ejhZ9tk1.js";import{i as Mo,a as Lo}from"./inputNumberFormat-BPxWRFt_.js";import{u as Do}from"./browseLogger-CQ2mW6GL.js";import"./forums-BGaTqZw2.js";window.Pusher=Ot;class To{_echoConnector;constructor(){this._echoConnector=null}connect(){if(this._echoConnector===null){const n=window.location.hostname;this._echoConnector=new fe({broadcaster:"reverb",key:"h1gdqae9h4rihjohv1vv",wsHost:n,wsPort:"8090",wssPort:"8090",forceTLS:!0,enabledTransports:["ws","wss"],namespace:""})}else throw new Error("Echo实例已经连接过了")}disconnect(){if(this._echoConnector instanceof fe)this._echoConnector.disconnect(),this._echoConnector=null;else throw new Error("Echo实例已经删除过了")}channel(n){if(this._echoConnector instanceof fe)return this._echoConnector.channel(n);throw new Error("Echo实例需要先连接.connect()")}leaveChannel(n){if(this._echoConnector instanceof fe)this._echoConnector.leaveChannel(n);else throw new Error("Echo实例需要先连接.connect()")}leaveAllChannels(){if(this._echoConnector instanceof fe)this._echoConnector.leaveAllChannels();else throw new Error("Echo实例需要先连接.connect()")}get isConnected(){return this._echoConnector instanceof fe}get pusher(){return this._echoConnector instanceof fe?this._echoConnector.connector.pusher:null}}function zo(){return new To}const Ro={0:{name:"空白占位",ImgSrc:""},23410:{name:"已日清",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97cf647.png"},23401:{name:"olo不足",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef9811f04.png"},234011:{name:"私密主题",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97ce810.png"},23404:{name:"板块or主题不存在",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef9818836.png"},21404:{name:"需要饼干",ImgSrc:"https://wmimg.com/i/1547/2025/02/67adef97e42d8.png"}},Ho=["src"],Ao=ne({__name:"ForbiddenModal",setup(b,{expose:n}){const m=y(0),z=y(""),g=le(),v=y(!1);function S(f){m.value=f.errorCode,z.value=f.message,v.value=!0}return n({show:S}),(f,i)=>(r(),h(e(Se),{show:v.value,"onUpdate:show":i[2]||(i[2]=p=>v.value=p),"display-directive":"if"},{default:t(()=>[o(e(se),{style:ie({maxWidth:e(g).modalMaxWidth}),closable:"",onClose:i[1]||(i[1]=p=>v.value=!1),size:"small"},{action:t(()=>[o(e(I),{justify:"end"},{default:t(()=>[o(e(V),{onClick:i[0]||(i[0]=p=>v.value=!1)},{default:t(()=>[...i[3]||(i[3]=[s("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(I),{vertical:""},{default:t(()=>[N("img",{style:{width:"100%"},src:e(Ro)[m.value].ImgSrc},null,8,Ho),o(e(P),null,{default:t(()=>[s(T(z.value),1)]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),No=ne({__name:"JumpModal",props:{threadId:{},postsNum:{},page:{}},setup(b,{expose:n}){const m=le(),z=Fe(),g=b,v=y(),S=y(!1);function f(){S.value=!0}n({show:f});function i(){if(v.value!==void 0){const p=Math.ceil((v.value+1)/200),C="#f_"+v.value;if(z.push({name:"thread",params:{threadId:g.threadId,page:p},hash:C}),p===g.page){const x=document.querySelector(C);x?.scrollIntoView({block:"center",behavior:"auto"}),x?.classList.add("on-focus")}S.value=!1}}return(p,C)=>(r(),h(e(Se),{show:S.value,"onUpdate:show":C[3]||(C[3]=x=>S.value=x),"display-directive":"if"},{default:t(()=>[o(e(se),{style:ie({maxWidth:e(m).modalMaxWidth}),title:"跳楼机",closable:"",onClose:C[2]||(C[2]=x=>S.value=!1),size:"small"},{action:t(()=>[o(e(I),{justify:"end"},{default:t(()=>[o(e(V),{type:"primary",onClick:i,disabled:!v.value},{default:t(()=>[...C[5]||(C[5]=[s("Jump!",-1)])]),_:1},8,["disabled"]),o(e(V),{onClick:C[1]||(C[1]=x=>S.value=!1)},{default:t(()=>[...C[6]||(C[6]=[s("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(I),{vertical:""},{default:t(()=>[o(e(P),null,{default:t(()=>[s(" 最大高度："+T(p.postsNum)+"楼 ",1)]),_:1}),o(e(Ee),null,{default:t(()=>[o(e(Ue),{style:{width:"3.2rem"},class:"round"},{default:t(()=>[...C[4]||(C[4]=[s("跳楼",-1)])]),_:1}),o(e(Ne),{placeholder:"请输入楼层号",max:p.postsNum,value:v.value,"onUpdate:value":C[0]||(C[0]=x=>v.value=x),onKeyup:he(i,["enter"])},null,8,["max","value"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),qo=ne({__name:"AdminActionModal",props:{threadId:{},forumId:{default:0}},emits:["refreshPostsList"],setup(b,{expose:n,emit:m}){const z=le(),g=Z(),v=Fe(),S=y(null),f=b,i=y({contentInput:void 0,switchInput:!1}),p=y("hint"),C=y(!0),x=y();let _;const O=D(()=>({contentInput:{required:$.value.requireContent,message:"请填写理由"},switchInput:{required:!1}})),K={hint:{requireContent:!1,contentMessage:!1,requireSwitch:!1},ban:{requireContent:!0,contentMessage:"你要永久粉碎这个饼干吗？",requireSwitch:!1},lock:{requireContent:!0,contentMessage:`要封禁这个饼干吗？
第1次3天、2次6天、3次9天、4次碎饼`,requireSwitch:!1},deleteAll:{requireContent:!0,contentMessage:`要用管理员权限删除该饼干全部回复吗？
此功能请谨慎使用，仅在有恶意刷屏时。`,requireSwitch:!0},delete:{requireContent:!0,contentMessage:"要用管理员权限删除这个回复吗？",requireSwitch:!0},recovery:{requireContent:!0,contentMessage:"要用管理员权限恢复这个回复吗？",requireSwitch:!1},deleteThread:{requireContent:!0,contentMessage:"要用管理员权限删除这个主题吗？",requireSwitch:!1},setTop:{requireContent:!1,contentMessage:"要设为置顶吗？",requireSwitch:!1},cancelTop:{requireContent:!1,contentMessage:"要取消置顶吗？",requireSwitch:!1}},$=D(()=>K[p.value]),u=y(!1);function k(M){p.value=M.action,_=M.postId??0,x.value=void 0,u.value=!0,M.action==="hint"?(C.value=!1,A("hint")):C.value=!0}n({show:k});const R=m;function A(M){if(M==="hint"){x.value="查询中……";const c={binggan:g.binggan,thread_id:f.threadId,post_id:_};wo(c).then(d=>{x.value=`此饼干状态：${d.user_status}。已被锁定过${d.locked_count}次。`});return}S.value?.validate(c=>{if(c){window.$message.error("请确认信息填写完整");return}else switch(M){case"ban":const d={binggan:g.binggan,thread_id:f.threadId,post_id:_,content:i.value.contentInput};xo(d).then(()=>{u.value=!1,R("refreshPostsList")});break;case"lock":const q={binggan:g.binggan,thread_id:f.threadId,post_id:_,content:i.value.contentInput};$o(q).then(()=>{u.value=!1,R("refreshPostsList")});break;case"deleteAll":const ee={binggan:g.binggan,thread_id:f.threadId,post_id:_,content:i.value.contentInput,reduce_olo:i.value.switchInput};Po(ee).then(()=>{u.value=!1,R("refreshPostsList")});break;case"delete":const B={binggan:g.binggan,thread_id:f.threadId,post_id:_,content:i.value.contentInput,reduce_olo:i.value.switchInput};So(B).then(()=>{u.value=!1,R("refreshPostsList")});break;case"recovery":const E={binggan:g.binggan,thread_id:f.threadId,post_id:_,content:i.value.contentInput};Io(E).then(()=>{u.value=!1,R("refreshPostsList")});break;case"deleteThread":const te={binggan:g.binggan,thread_id:f.threadId,content:i.value.contentInput};ko(te).then(()=>{u.value=!1,v.push({name:"forum",params:{forumId:f.forumId,page:1}})});break;case"setTop":const G={binggan:g.binggan,thread_id:f.threadId};Co(G).then(()=>{u.value=!1,R("refreshPostsList")});break;case"cancelTop":const H={binggan:g.binggan,thread_id:f.threadId};yo(H).then(()=>{u.value=!1,R("refreshPostsList")});break}})}return(M,c)=>(r(),h(e(Se),{show:u.value,"onUpdate:show":c[5]||(c[5]=d=>u.value=d),"display-directive":"if",size:"small"},{default:t(()=>[o(e(se),{style:ie({maxWidth:e(z).modalMaxWidth}),title:"管理员操作",closable:"",onClose:c[4]||(c[4]=d=>u.value=!1),size:"small"},{action:t(()=>[o(e(I),{justify:"end"},{default:t(()=>[C.value?(r(),h(e(V),{key:0,type:"warning",onClick:c[2]||(c[2]=d=>A(p.value))},{default:t(()=>[...c[7]||(c[7]=[s("提交",-1)])]),_:1})):w("",!0),o(e(V),{onClick:c[3]||(c[3]=d=>u.value=!1)},{default:t(()=>[...c[8]||(c[8]=[s("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(I),{vertical:""},{default:t(()=>[$.value.contentMessage?(r(),h(e(P),{key:0,style:{"white-space":"pre-wrap"}},{default:t(()=>[s(T($.value.contentMessage),1)]),_:1})):w("",!0),x.value?(r(),h(e(P),{key:1},{default:t(()=>[s(T(x.value),1)]),_:1})):w("",!0),o(e(Et),{ref_key:"formRef",ref:S,model:i.value,"label-placement":"left","label-width":"auto",rules:O.value,size:e(z).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:t(()=>[$.value.requireContent?(r(),h(e(at),{key:0,label:"理由",path:"contentInput"},{default:t(()=>[o(e(be),{placeholder:"必填",value:i.value.contentInput,"onUpdate:value":c[0]||(c[0]=d=>i.value.contentInput=d)},null,8,["value"])]),_:1})):w("",!0),$.value.requireSwitch?(r(),h(e(at),{key:1,label:"罚款olo",path:"switchInput"},{default:t(()=>[o(e(ct),{value:i.value.switchInput,"onUpdate:value":c[1]||(c[1]=d=>i.value.switchInput=d)},null,8,["value"]),o(e(P),{style:{"margin-left":"6px"}},{default:t(()=>[...c[6]||(c[6]=[s("每个帖子罚款500，封顶5000个olo",-1)])]),_:1})]),_:1})):w("",!0)]),_:1},8,["model","rules","size"])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Go=ne({__name:"RewardModal",emits:["refreshPostsList"],setup(b,{expose:n,emit:m}){const z=le(),g=Z(),v=y(100),S=y(),f=y(!1),i=y();function p($){i.value=$,f.value=!0}n({show:p});const C=m;function x(){const $={binggan:g.binggan,post_floor_message:"@"+i.value.postFloorMessage,forum_id:i.value.forumId,thread_id:i.value.threadId,post_id:i.value.postId,coin:v.value,content:S.value};O($)}const{loading:_,send:O,onSuccess:K}=X($=>vo($),{immediate:!1});return K(()=>{f.value=!1,C("refreshPostsList")}),($,u)=>(r(),h(e(Se),{show:f.value,"onUpdate:show":u[4]||(u[4]=k=>f.value=k),"display-directive":"if"},{default:t(()=>[o(e(se),{style:ie({maxWidth:e(z).modalMaxWidth}),title:`打赏给№${i.value?.floor}`,closable:"",onClose:u[3]||(u[3]=k=>f.value=!1),size:"small"},{action:t(()=>[o(e(I),{justify:"end"},{default:t(()=>[o(e(V),{type:"primary",onClick:x,loading:e(_)},{default:t(()=>[...u[12]||(u[12]=[s("打赏",-1)])]),_:1},8,["loading"]),o(e(V),{onClick:u[2]||(u[2]=k=>f.value=!1)},{default:t(()=>[...u[13]||(u[13]=[s("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(I),{vertical:""},{default:t(()=>[N("div",null,[e(z).isDouble11?(r(),h(e(P),{key:1},{default:t(()=>[...u[6]||(u[6]=[N("del",null,"友情提示：在打赏额以外，会追加扣除7%手续费。",-1),N("br",null,null,-1),s(" 活动期间限时手续费2%！ ",-1)])]),_:1})):(r(),h(e(P),{key:0},{default:t(()=>[...u[5]||(u[5]=[s(" 友情提示：在打赏额以外，会追加扣除7%手续费。",-1)])]),_:1})),u[9]||(u[9]=N("br",null,null,-1)),o(e(P),null,{default:t(()=>[...u[7]||(u[7]=[s("总共扣除：",-1)])]),_:1}),o(e(P),{type:"error"},{default:t(()=>[s(T(Math.ceil(v.value*(e(z).isDouble11?1.02:1.07))),1)]),_:1}),o(e(P),null,{default:t(()=>[...u[8]||(u[8]=[s("块奥利奥。",-1)])]),_:1})]),o(e(Ee),null,{default:t(()=>[o(e(Ue),{style:{width:"3.2rem"}},{default:t(()=>[...u[10]||(u[10]=[s("打赏",-1)])]),_:1}),o(e(Ne),{type:"password",placeholder:"olo数量","show-password-on":"mousedown",clearable:"",value:v.value,"onUpdate:value":u[0]||(u[0]=k=>v.value=k),onKeyup:he(x,["enter"]),max:1e6,min:1,step:1e3,parse:e(Lo),format:e(Mo)},null,8,["value","parse","format"])]),_:1}),o(e(Ee),null,{default:t(()=>[o(e(Ue),{style:{width:"3.2rem"},class:"round"},{default:t(()=>[...u[11]||(u[11]=[s("留言",-1)])]),_:1}),o(e(be),{value:S.value,"onUpdate:value":u[1]||(u[1]=k=>S.value=k),placeholder:"（可留空）",onKeyup:he(x,["enter"])},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["style","title"])]),_:1},8,["show"]))}});let mt;function Oo(b,n=500){return function(...m){clearTimeout(mt),mt=setTimeout(()=>{b(...m)},n)}}const Eo=ne({__name:"BrowseLogger",props:{postsListLoading:{type:Boolean},disableScroll:{type:Boolean,default:!1},isSearch:{type:Boolean},threadId:{},page:{}},setup(b){const n=b,m=y(!1),z=ft(),g=Do();function v(){function f(){const p=window.innerWidth/2;return document.elementsFromPoint(p,100)}Oo(()=>{const p=f(),C=g.get(n.threadId);p.forEach(x=>{const _=Number(x.getAttribute("floor"));_&&_>C.floor&&g.log(n.threadId,_)})},100)()}function S(){if(!z.hash&&g.get(n.threadId)){const f=g.get(n.threadId),i=Math.ceil((f.floor+1)/200);if(i===n.page&&f.floor!==0){const p=document.getElementById("f_"+f.floor);p!==null&&(p.scrollIntoView({behavior:"auto",block:"center"}),window.$message.success(`已自动滚到上次浏览进度${f.floor}楼`))}i>n.page&&(m.value=!0)}}return ke(()=>n.postsListLoading,f=>{f===!1&&!n.disableScroll&&je(()=>S())}),Ce(()=>{g.initThread(n.threadId),window.addEventListener("scroll",v)}),pe(()=>{m.value=!1,window.removeEventListener("scroll",v)}),(f,i)=>{const p=pt("router-link");return m.value&&!f.isSearch?(r(),h(e(jt),{key:0,type:"success",closable:"",style:{"border-radius":"10px"}},{default:t(()=>[s(" 你上次已经浏览到"+T(e(g).get(f.threadId).floor)+"楼， ",1),o(p,{onClick:i[0]||(i[0]=C=>m.value=!1),to:{name:"thread",params:{threadId:f.threadId,page:Math.ceil((e(g).get(f.threadId).floor+1)/200)}}},{default:t(()=>[...i[1]||(i[1]=[s(" 点击这里 ",-1)])]),_:1},8,["to"]),i[2]||(i[2]=s(" 跳转 ",-1))]),_:1})):w("",!0)}}}),jo=ne({__name:"ChangeColorModal",props:{threadId:{}},emits:["refreshPostsList"],setup(b,{expose:n,emit:m}){const z=le(),g=Z(),v=b,S=y(),f=["#b65954","#c78878","#9b7e70","#de7562","#fca44b","#f1c727","#f6da79","#fbda97","#9fc778","#78c79f","#8ab185","#98c0d9","#8691db","#7878c7","#566b7c","#9678c7","#9f78c7","#ca95e9","#ecacc6","#a86fa2","#7e3749"],i=y(!1);function p(){i.value=!0}n({show:p});const{loading:C,send:x,onSuccess:_}=X(K=>go(K),{immediate:!1});function O(){if(!S.value){window.$message.error("颜色输入不能为空");return}const K={binggan:g.binggan,thread_id:v.threadId,color:S.value};x(K),_(()=>i.value=!1)}return(K,$)=>(r(),h(e(Se),{show:i.value,"onUpdate:show":$[3]||($[3]=u=>i.value=u),"display-directive":"if"},{default:t(()=>[o(e(se),{style:ie({maxWidth:e(z).modalMaxWidth}),title:"标题改色",closable:"",onClose:$[2]||($[2]=u=>i.value=!1),size:"small"},{action:t(()=>[o(e(I),{justify:"end"},{default:t(()=>[o(e(V),{type:"primary",onClick:O,disabled:e(C),loading:e(C)},{default:t(()=>[...$[5]||($[5]=[s("提交",-1)])]),_:1},8,["disabled","loading"]),o(e(V),{onClick:$[1]||($[1]=u=>i.value=!1)},{default:t(()=>[...$[6]||($[6]=[s("关闭",-1)])]),_:1})]),_:1})]),default:t(()=>[o(e(I),{vertical:""},{default:t(()=>[o(e(P),null,{default:t(()=>[...$[4]||($[4]=[s(" 要更换标题颜色吗？每次收费500个olo喔 ",-1)])]),_:1}),o(e(Ut),{value:S.value,"onUpdate:value":$[0]||($[0]=u=>S.value=u),modes:["hex"],"show-alpha":!1,style:{"max-width":"8.2rem"},swatches:f},null,8,["value"])]),_:1})]),_:1},8,["style"])]),_:1},8,["show"]))}}),Uo=Z(),Fo=b=>{const n=re.Get("api/crowds/"+b,{name:"crowdDataGetter-"+b,params:{binggan:Uo.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},Vo=b=>{const n=re.Post("api/crowds/",b,{name:"userCrowdPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Bo=b=>{const n=re.Post("api/crowds/repeal",b,{name:"adminCrowdRepealPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Wo={style:{"text-align":"center"}},Ko={key:0},Yo={key:1},Qo={key:2},Jo={key:3},Xo=ne({__name:"CrowdComponent",props:{crowdId:{},forumId:{}},setup(b){gt(B=>({"02a8d6e9":e(g).dividerColor}));const n=b,m=Z(),z=le(),g=vt(),v=y(1e3),S=D(()=>{const B=W.tz(k.value.end_date),E=W(),te=B.diff(E,"hour");return te>=1?`${te}小时后`:`${B.diff(E,"minute")}分钟后`}),f=D(()=>W.tz(k.value.end_date).format("YY年M月D日 HH:mm")),i=D(()=>W().isAfter(W.tz(k.value.end_date))),p=[{label:"中止",key:"repeal",icon:ve(bt,{size:"1.5rem"})}];function C(B){switch(B){case"repeal":ee();break}}const x=[{title:"我支持的olo",key:"olo",resizable:!0},{title:"参与时间",key:"created_at",resizable:!0}],{data:_,loading:O,send:K,onSuccess:$}=X(Fo(n.crowdId),{immediate:!1});function u(){K({binggan:m.binggan})}m.binggan&&u();const k=D(()=>_.value?.crowd),R=D(()=>_.value?.crowd_record??[]),A=D(()=>Math.round(k.value.olo_total/k.value.olo_target*100)),{loading:M,send:c,onSuccess:d}=X(B=>Vo(B),{immediate:!1});d(()=>{u()});function q(){if(!v.value){window.$message.error("请输入众筹金额喔");return}const B={binggan:m.binggan,crowd_olo:v.value,crowd_id:n.crowdId},E={title:"参加众筹",closable:!1,content:`确定要参加众筹吗？将消耗${v.value}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{c(B)}};window.$dialog.warning(E)}function ee(){const B={binggan:m.binggan,crowd_id:n.crowdId},E={title:"中止众筹",closable:!1,content:"确定要中止众筹吗？已投注的olo将会退回",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{Bo(B).then(()=>{u()})}};window.$dialog.warning(E)}return(B,E)=>(r(),h(e(se),{size:"small",bordered:!0},{default:t(()=>[o(e(_e),{show:e(O)},{default:t(()=>[k.value!==void 0?(r(),h(e(I),{key:0,vertical:""},{default:t(()=>[o(e(I),{size:"small",align:"center",class:"crowd-title"},{default:t(()=>[o(e(ge),{size:e(z).isMobile?24:32},{default:t(()=>[o(e(Ft))]),_:1},8,["size"]),N("span",null,T(k.value.title),1)]),_:1}),o(e(I),{vertical:"",align:"center"},{default:t(()=>[o(e(Ve),{type:"dashboard",status:"success",percentage:A.value},{default:t(()=>[N("span",Wo,"进度"+T(A.value)+"% ",1)]),_:1},8,["percentage"]),i.value&&k.value.is_closed===0?(r(),j("span",Ko,"众筹已经过期了")):w("",!0),k.value.is_closed===1?(r(),j("span",Yo,"众筹已达成目标！谢谢各位参与~")):w("",!0),k.value.is_closed===2?(r(),j("span",Qo,"众筹已经被管理员中止，olo已退回")):w("",!0),!i.value&&k.value.is_closed===0?(r(),j("div",Jo,[o(e(P),{depth:3},{default:t(()=>[...E[1]||(E[1]=[s("结束时间：",-1)])]),_:1}),N("span",null,T(f.value)+" ("+T(S.value)+")",1)])):w("",!0),N("div",null,[o(e(P),{depth:3},{default:t(()=>[...E[2]||(E[2]=[s("众筹目标：",-1)])]),_:1}),N("span",null,T(`${k.value.olo_target.toLocaleString("en-us")} 个olo`),1)]),N("div",null,[o(e(P),{depth:3},{default:t(()=>[...E[3]||(E[3]=[s("已众筹到：",-1)])]),_:1}),N("span",null,T(`${k.value.olo_total.toLocaleString("en-us")} 个olo`),1)]),o(e(I),{size:"small",align:"center"},{default:t(()=>[o(e(Ne),{max:1e6,min:1,step:1e3,placeholder:"投入额",disabled:i.value||k.value.is_closed!==0,value:v.value,"onUpdate:value":E[0]||(E[0]=te=>v.value=te)},null,8,["disabled","value"]),o(e(V),{type:"primary",onClick:q,loading:e(M),disabled:e(M)||i.value||k.value.is_closed!==0},{default:t(()=>[...E[4]||(E[4]=[s("投入",-1)])]),_:1},8,["loading","disabled"]),e(m).checkAdminForums(B.forumId)&&k.value.is_closed===0?(r(),h(e(Ae),{key:0,trigger:e(z).isMobile?"click":"hover",options:p,onSelect:C,placement:"bottom-start"},{default:t(()=>[o(e(V),{type:"warning"},{default:t(()=>[...E[5]||(E[5]=[s("管理",-1)])]),_:1})]),_:1},8,["trigger"])):w("",!0)]),_:1})]),_:1}),R.value.length>0?(r(),h(e(ht),{key:0,columns:x,data:R.value,bordered:!1},null,8,["data"])):w("",!0)]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),Zo=Pe(Xo,[["__scopeId","data-v-c8ea6852"]]),ea=Z(),ta=b=>{const n=re.Get("api/gambles/"+b,{name:"gambleDataGetter-"+b,params:{binggan:ea.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},oa=b=>{const n=re.Post("api/gambles/",b,{name:"userGamblePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},aa=b=>{const n=re.Post("api/gambles/close",b,{name:"adminGambleClosePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},na=b=>{const n=re.Post("api/gambles/repeal",b,{name:"adminGambleRepealPoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},sa={key:0},la={key:1},ra={key:2},ia={key:3},ua={class:"gamble-item"},da={style:{"margin-left":"auto"}},ma=ne({__name:"GambleComponent",props:{gambleId:{},forumId:{}},setup(b){gt(G=>({"8196b06e":e(g).dividerColor}));const n=b,m=Z(),z=le(),g=vt(),v=y(),S=y(1e3),f=D(()=>{const G=W.tz(R.value.end_date),H=W(),U=G.diff(H,"hour");return U>=1?`${U}小时后`:`${G.diff(H,"minute")}分钟后`}),i=D(()=>W.tz(R.value.end_date).format("YY年M月D日 HH:mm")),p=D(()=>W().isAfter(W.tz(R.value.end_date))),C=[{label:"开奖",key:"close",icon:ve(Wt,{size:"1.5rem"})},{label:"中止",key:"repeal",icon:ve(bt,{size:"1.5rem"})}];function x(G){switch(G){case"close":E();break;case"repeal":te();break}}const _=[{title:"我的投注",key:"option_text",resizable:!0},{title:"投注额",key:"betting_olo",resizable:!0},{title:"赔率",key:"odds",render:G=>G.odds?.toFixed(2)??"（开奖时确定）",resizable:!0},{title:"奖金",key:"win_olo",resizable:!0}],{data:O,loading:K,send:$,onSuccess:u}=X(ta(n.gambleId),{immediate:!1});function k(){$({binggan:m.binggan})}m.binggan&&k();const R=D(()=>O.value.gamble_question),A=D(()=>O.value.gamble_options),M=D(()=>O.value.user_choices?.map(G=>({...G,option_text:A.value.find(H=>H.id===G.option_id)?.option_text}))??[]),c=D(()=>A.value.find(G=>G.id===R.value.result_option_id)?.option_text),{loading:d,send:q,onSuccess:ee}=X(G=>oa(G),{immediate:!1});ee(()=>{k()});function B(){if(!v.value||!S.value){window.$message.error("请选择选项和输入投注额喔");return}const G={binggan:m.binggan,gamble_question_id:n.gambleId,bet_option:v.value,betting_olo:S.value},H={title:"参加菠菜",closable:!1,content:`确定要参加菠菜吗？将消耗${S.value}个olo`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{q(G)}};window.$dialog.warning(H)}function E(){if(!v.value){window.$message.error("请选择选项喔");return}const G={binggan:m.binggan,gamble_question_id:n.gambleId,result_option:v.value},H={title:"开奖菠菜",closable:!1,content:`确定要开奖吗？开奖选项是：${A.value.find(U=>U.id===v.value)?.option_text}`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{aa(G).then(()=>{k()})}};window.$dialog.warning(H)}function te(){const G={binggan:m.binggan,gamble_question_id:n.gambleId},H={title:"中止菠菜",closable:!1,content:"确定要中止菠菜吗？已投注的olo将会退回",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{na(G).then(()=>{k()})}};window.$dialog.warning(H)}return(G,H)=>(r(),h(e(se),{size:"small",bordered:!0},{default:t(()=>[o(e(_e),{show:e(K)},{default:t(()=>[e(O)!==void 0?(r(),h(e(I),{key:0,vertical:""},{default:t(()=>[o(e(I),{size:"small",align:"center",class:"gamble-title"},{default:t(()=>[o(e(ge),{size:e(z).isMobile?24:32},{default:t(()=>[o(e(Vt))]),_:1},8,["size"]),N("span",null,T(R.value.title),1)]),_:1}),o(e(Bt),{value:v.value,"onUpdate:value":H[0]||(H[0]=U=>v.value=U)},{default:t(()=>[o(e(I),{vertical:"",size:"large"},{default:t(()=>[(r(!0),j(ae,null,Ie(A.value,(U,$e)=>(r(),j("div",{key:U.id},[o(e(Kt),{value:U.id,label:`（当前赔率 ${U.odds.toFixed(2)}）： ${U.id==R.value.result_option_id?"⭐":""} ${U.option_text}`},null,8,["value","label"]),o(e(Ve),{status:"success",type:"line",height:e(z).isMobile?20:24,percentage:Math.floor(U.olo_total/R.value.olo_total*100),"indicator-placement":"inside"},{default:t(()=>[s(T(U.olo_total),1)]),_:2},1032,["height","percentage"])]))),128))]),_:1})]),_:1},8,["value"]),p.value&&R.value.is_closed===0?(r(),j("span",sa,"菠菜已经关闭投注")):w("",!0),R.value.is_closed===1?(r(),j("span",la,T(`菠菜已开奖，奖金已发放。中奖项是：${c.value}`),1)):w("",!0),R.value.is_closed===2?(r(),j("span",ra,"菠菜已经被管理员中止，投注olo已退回")):w("",!0),!p.value&&R.value.is_closed===0?(r(),j("div",ia,[o(e(P),{depth:3},{default:t(()=>[...H[2]||(H[2]=[s("结束时间：",-1)])]),_:1}),N("span",null,T(i.value)+" ("+T(f.value)+")",1)])):w("",!0),o(e(I),{size:"small",align:"center"},{default:t(()=>[o(e(Ne),{max:1e6,min:1,step:1e3,placeholder:"投注额",disabled:p.value||R.value.is_closed!==0,value:S.value,"onUpdate:value":H[1]||(H[1]=U=>S.value=U)},null,8,["disabled","value"]),o(e(V),{type:"primary",onClick:B,loading:e(d),disabled:e(d)||p.value||R.value.is_closed!==0},{default:t(()=>[...H[3]||(H[3]=[s("投注",-1)])]),_:1},8,["loading","disabled"]),e(m).checkAdminForums(G.forumId)&&R.value.is_closed===0?(r(),h(e(Ae),{key:0,trigger:e(z).isMobile?"click":"hover",options:C,onSelect:x,placement:"bottom-start"},{default:t(()=>[o(e(V),{type:"warning"},{default:t(()=>[...H[4]||(H[4]=[s("管理",-1)])]),_:1})]),_:1},8,["trigger"])):w("",!0)]),_:1}),!e(z).isMobile&&M.value.length>0?(r(),h(e(ht),{key:4,columns:_,data:M.value,bordered:!1},null,8,["data"])):w("",!0),e(z).isMobile?(r(),j(ae,{key:5},[M.value.length>0?(r(),h(e(I),{key:0,vertical:"",align:"start",size:"small"},{default:t(()=>[(r(!0),j(ae,null,Ie(M.value,U=>(r(),j("div",ua,[o(e(I),{style:{"margin-bottom":"6px"}},{default:t(()=>[N("div",null,[o(e(P),{depth:3},{default:t(()=>[...H[5]||(H[5]=[s("我的投注：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[s(T(U.option_text),1)]),_:2},1024)])]),_:2},1024),o(e(I),{style:{"margin-bottom":"6px"}},{default:t(()=>[N("div",null,[o(e(P),{depth:3},{default:t(()=>[...H[6]||(H[6]=[s("投注额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[s(T(U.betting_olo),1)]),_:2},1024)])]),_:2},1024),U.win_olo?(r(),h(e(I),{key:0,style:{"margin-bottom":"6px"}},{default:t(()=>[N("div",null,[o(e(P),{depth:3},{default:t(()=>[...H[7]||(H[7]=[s("赔率：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[s(T(U.odds?.toFixed(2)),1)]),_:2},1024)]),N("div",da,[o(e(P),{depth:3},{default:t(()=>[...H[8]||(H[8]=[s("奖金：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[s(T(U.win_olo),1)]),_:2},1024)])]),_:2},1024)):w("",!0)]))),256))]),_:1})):w("",!0)],64)):w("",!0)]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),ca=Pe(ma,[["__scopeId","data-v-d08fb987"]]),fa={key:0},pa=ne({__name:"HongbaoComponent",props:{hongbaoId:{},threadId:{},forumId:{},noHongbaoPicMode:{type:Boolean}},emits:["refreshPostsList"],setup(b,{emit:n}){const m=Z(),z=le(),g=b,v=D(()=>p.value.pic_url&&!g.noHongbaoPicMode),S=D(()=>v.value?{backgroundImage:`linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)), url(${p.value.pic_url})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{}),f=y(),i=D(()=>({1:"随机olo",2:"定额olo"})[p.value.type]),{data:p,loading:C,send:x,onSuccess:_}=X(mo(g.hongbaoId),{immediate:!1,initialData:{}});_(A=>{f.value=A.data.key_word});function O(){x({binggan:m.binggan})}m.binggan&&O();const{loading:K,send:$,onSuccess:u}=X(A=>co(A),{immediate:!1});u(()=>{R("refreshPostsList")});function k(A){if(!A.isTrusted){const q={title:"错误",closable:!1,content:"请不要用脚本抢红包喔",positiveText:"确定"};window.$dialog.warning(q);return}const{timestamp:M,newPostKey:c}=_t(A.isTrusted,g.threadId,m.binggan),d={binggan:m.binggan,forum_id:g.forumId,thread_id:g.threadId,content:"--红包口令: "+f.value,nickname:"= =",post_with_admin:!1,new_post_key:c,timestamp:M,hongbao_id:g.hongbaoId,hongbao_key_word:f.value};$(d).then(()=>{O()})}const R=n;return(A,M)=>(r(),h(e(se),{size:"small",bordered:!0,class:"hongbao-card",style:ie(S.value)},{default:t(()=>[o(e(_e),{show:e(C)},{default:t(()=>[o(e(I),{vertical:"",align:"center"},{default:t(()=>[o(e(I),{align:"center",size:"small"},{default:t(()=>[o(e(P),{style:{"font-size":"1rem"}},{default:t(()=>[...M[1]||(M[1]=[s("口令红包",-1)])]),_:1}),v.value?w("",!0):(r(),j("img",{key:0,src:"/hongbao.svg",style:ie({height:e(z).isMobile?"30px":"36px"})},null,4))]),_:1}),N("div",null,[e(p).key_word?(r(),h(e(P),{key:0,depth:3},{default:t(()=>[...M[2]||(M[2]=[s("口令：",-1)])]),_:1})):w("",!0),o(e(P),null,{default:t(()=>[s(T(e(p).key_word),1)]),_:1})]),N("div",null,[o(e(P),{depth:3},{default:t(()=>[...M[3]||(M[3]=[s("数量：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[s(T(e(p).num_remains)+" /"+T(e(p).num_total)+" （"+T(i.value)+"）",1)]),_:1})]),e(p).olo_hide?w("",!0):(r(),j("div",fa,[o(e(P),{depth:3},{default:t(()=>[...M[4]||(M[4]=[s("总额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[s(T(e(p).olo_total?.toLocaleString("en-us"))+" olo ",1)]),_:1})])),o(e(I),{size:"small",wrap:!1},{default:t(()=>[e(p).hongbao_user===null?(r(),h(e(be),{key:0,value:f.value,"onUpdate:value":M[0]||(M[0]=c=>f.value=c),maxlength:255,onKeyup:he(k,["enter"]),style:{"max-width":"328px"},placeholder:e(p).num_remains===0?"已经抢光啦":"请输入口令","auto-size":"",disabled:e(p).hongbao_user!==null||e(p).num_remains===0},null,8,["value","placeholder","disabled"])):(r(),h(e(be),{key:1,value:`你抢到了${e(p).hongbao_user?.olo.toLocaleString("en-us")}个olo`,maxlength:255,style:{"max-width":"328px"},"auto-size":"",disabled:""},null,8,["value"])),o(e(V),{type:"primary",onClick:k,disabled:e(p).hongbao_user!==null||e(K)||e(p).num_remains===0},{default:t(()=>[...M[5]||(M[5]=[s("抢！",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1},8,["style"]))}}),ga=Pe(pa,[["__scopeId","data-v-d0fedc06"]]),va=Z(),ha=b=>{const n=re.Get("api/votes/"+b,{name:"voteDataGetter-"+b,params:{binggan:va.binggan},localCache:null,hitSource:[]});return n.meta={shouldRemind:!1},n},ba=b=>{const n=re.Post("api/votes/",b,{name:"userVotePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},_a={key:0},wa=ne({__name:"VoteComponent",props:{voteId:{}},setup(b){const n=b,m=Z(),z=le(),g=y([]);ke(g,(c,d)=>{c.length>O.value.max_choices&&(window.$message.error(`最多只能选择${O.value.max_choices}个选项喔`),g.value=d)});const v=D(()=>{const c=W.tz(O.value.end_date),d=W(),q=c.diff(d,"hour");return q>=1?`${q}小时后`:`${c.diff(d,"minute")}分钟后`}),S=D(()=>W.tz(O.value.end_date).format("YY年M月D日 HH:mm")),f=D(()=>W().isAfter(W.tz(O.value.end_date))),{data:i,loading:p,send:C,onSuccess:x}=X(ha(n.voteId),{immediate:!1});x(c=>{c.data.user_choices&&(g.value=c.data.user_choices.options_id)});function _(){C({binggan:m.binggan})}m.binggan&&_();const O=D(()=>i.value.vote_question),K=D(()=>i.value.vote_options),$=D(()=>i.value.user_choices),u=D(()=>$.value!==null),{loading:k,send:R,onSuccess:A}=X(c=>ba(c),{immediate:!1});A(()=>{_()});function M(){const c={binggan:m.binggan,vote_question_id:n.voteId,vote_options:g.value};R(c)}return(c,d)=>(r(),h(e(se),{size:"small",bordered:!0},{default:t(()=>[o(e(_e),{show:e(p)},{default:t(()=>[e(i)!==void 0?(r(),h(e(I),{key:0,vertical:""},{default:t(()=>[o(e(I),{size:"small",align:"center",class:"vote-title"},{default:t(()=>[o(e(ge),{size:e(z).isMobile?24:32},{default:t(()=>[o(e(Yt))]),_:1},8,["size"]),N("span",null,T(e(i).vote_question.title),1)]),_:1}),o(e(Qt),{value:g.value,"onUpdate:value":d[0]||(d[0]=q=>g.value=q),disabled:u.value},{default:t(()=>[o(e(I),{vertical:"",size:"large"},{default:t(()=>[(r(!0),j(ae,null,Ie(K.value,(q,ee)=>(r(),j("div",{key:q.id},[o(e(Jt),{value:q.id,label:`${ee+1}. ${q.option_text}`},null,8,["value","label"]),o(e(Ve),{status:"success",type:"line",height:e(z).isMobile?20:24,percentage:Math.floor(q.vote_total/O.value.vote_total*100),"indicator-placement":"inside"},{default:t(()=>[s(T(q.vote_total)+"票 ",1)]),_:2},1032,["height","percentage"])]))),128))]),_:1})]),_:1},8,["value","disabled"]),f.value?(r(),j("span",_a,"投票已经结束了")):(r(),j(ae,{key:1},[N("div",null,[o(e(P),{depth:3},{default:t(()=>[...d[1]||(d[1]=[s("最多选择：",-1)])]),_:1}),N("span",null,T(O.value.max_choices)+"个选项",1)]),N("div",null,[o(e(P),{depth:3},{default:t(()=>[...d[2]||(d[2]=[s("结束时间：",-1)])]),_:1}),N("span",null,T(S.value)+" ("+T(v.value)+")",1)])],64)),o(e(I),{size:"small",align:"center"},{default:t(()=>[o(e(V),{type:"primary",onClick:M,loading:e(k),disabled:e(k)||u.value||f.value},{default:t(()=>[...d[3]||(d[3]=[s("投票",-1)])]),_:1},8,["loading","disabled"]),u.value?(r(),h(e(P),{key:0,depth:3},{default:t(()=>[...d[4]||(d[4]=[s("你已经投过票了，谢谢参与！",-1)])]),_:1})):w("",!0)]),_:1})]),_:1})):w("",!0)]),_:1},8,["show"])]),_:1}))}}),ya=Pe(wa,[["__scopeId","data-v-467006fa"]]),Ca=Z(),ka=b=>{const n=re.Post("api/store_pool",b,{name:"poolStorePoster",params:{},localCache:null,hitSource:[]});return n.meta={shouldRemind:!0},n},Ia=()=>{const b=re.Get("api/get_pool",{name:"poolDataGetter",params:{binggan:Ca.binggan},localCache:null,hitSource:[]});return b.meta={shouldRemind:!1},b},Sa=ne({__name:"PoolComponent",props:{threadId:{},forumId:{}},emits:["refreshPostsList"],setup(b,{emit:n}){const m=b,z=Z(),g=le(),v=W.tz("2025-1-29 00:00"),S=W.tz("2025-2-1 00:00"),f=D(()=>{const c=W.tz();return c<v?0:c>S?2:1}),i=D(()=>({0:`活动将于 ${v.format("M月D日H点")} 开始`,1:`请投入你的祝福~~，活动将于${S.format("M月D日H点")}结束。（${p.value}）`,2:"祝福池已关闭，请等待开奖。"})[f.value]),p=D(()=>{const c=W.tz(),d=S.diff(c,"hour"),q=S.diff(c,"minute")-60*d;return`剩余${d}小时${q}分钟`}),C=y(),{data:x,loading:_,send:O,onSuccess:K}=X(Ia(),{immediate:!1,initialData:{}});function $(){O()}z.binggan&&$();const{loading:u,send:k,onSuccess:R}=X(c=>ka(c),{immediate:!1});function A(c){if(C.value===void 0){const q={title:"错误",closable:!1,content:"请输入祝福语喔",positiveText:"确定"};window.$dialog.warning(q);return}const d={binggan:z.binggan,forum_id:m.forumId,thread_id:m.threadId,message:C.value,olo:c?3e5:1e3,admin:c};k(d).then(()=>{$(),M("refreshPostsList")})}const M=n;return(c,d)=>(r(),h(e(se),{size:"small",bordered:!0},{default:t(()=>[o(e(_e),{show:e(_)},{default:t(()=>[o(e(I),{vertical:"",align:"center"},{default:t(()=>[o(e(I),{align:"center",size:"small"},{default:t(()=>[o(e(P),{style:{"font-size":"1rem"}},{default:t(()=>[...d[4]||(d[4]=[s("祝福池",-1)])]),_:1}),N("img",{src:"/hongbao.svg",style:ie({height:e(g).isMobile?"30px":"36px"})},null,4)]),_:1}),N("div",null,[o(e(P),{depth:3},{default:t(()=>[...d[5]||(d[5]=[s("祝福池总额：",-1)])]),_:1}),o(e(P),null,{default:t(()=>[s(T(e(x).olo_total?.toLocaleString("en-us"))+" olo ",1)]),_:1})]),o(e(I),{size:"small",wrap:!1},{default:t(()=>[o(e(be),{value:C.value,"onUpdate:value":d[0]||(d[0]=q=>C.value=q),maxlength:255,onKeyup:d[1]||(d[1]=he(q=>A(!1),["enter"])),style:{"max-width":"328px"},placeholder:e(x).user_pool===null?"请留下祝福语":"已经投过祝福啦","auto-size":"",disabled:e(x).user_pool!==null},null,8,["value","placeholder","disabled"]),o(e(V),{type:"primary",onClick:d[2]||(d[2]=q=>A(!1)),disabled:e(x).user_pool!==null||e(u)||f.value!==1},{default:t(()=>[...d[6]||(d[6]=[s("投入祝福",-1)])]),_:1},8,["disabled"]),e(z).admin.isSuperAdmin?(r(),h(e(V),{key:0,type:"warning",onClick:d[3]||(d[3]=q=>A(!0))},{default:t(()=>[...d[7]||(d[7]=[s("投入30w",-1)])]),_:1})):w("",!0)]),_:1}),o(e(I),{align:"center",size:"small"},{default:t(()=>[N("span",null,T(i.value),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1}))}}),Pa={bordered:!0,class:"post-item-skeleton"},$a=ne({__name:"ThreadPage",props:{threadId:{},page:{},search:{}},setup(b){const n=Z(),m=le(),z=ft(),g=Fe(),v=y(null),S=y([]),f=y(null),i=y(null),p=y(null),C=y(null),x=y(null);Ce(()=>{m.showTopbarNav=!1}),pe(()=>{m.showTopbarNav=!0});const _=b,O=y(null),K=y(null),$=y(null),u=y(null),k=y(null),R=y(null),A=y(!0),M=y(!1);Ce(()=>{M.value=!0}),pe(()=>{M.value=!1});const c=D(()=>{const l=W.tz(F.value.nissin_date),a=W(),Y=l.diff(a,"hour"),L=l.diff(a,"minute")-60*Y;return`${Y}小时${L}分钟后`}),d=y(!1),q=y(!1),ee=J("no_video_mode",!1),B=J("no_image_mode",!1),E=J("no_emoji_mode",!1),te=J("no_custom_emoji_mode",!1),G=J("no_head_mode",!1),H=J("no_battle_mode",!1),U=J("no_roll_mode",!1),$e=J("no_reward_mode",!1),Be=J("no_hongbao_mode",!1),xe=J("no_hongbao_pic_mode",!1),Me=J("no_mention_mode",!1),Le=J("use_url_mode",!1),We=J("no_pailou_mode",!1),wt=D(()=>{const l=[{ref:ee,label:"音频视频"},{ref:B,label:"图片"},{ref:E,label:"一般表情包"},{ref:te,label:"自定义表情包"},{ref:G,label:"头像"},{ref:H,label:"大乱斗"},{ref:U,label:"roll点"},{ref:$e,label:"打赏"},{ref:Be,label:"红包结果"},{ref:xe,label:"红包封面"},{ref:Me,label:"关闭@标注"},{ref:We,label:"无内容排楼"}];return n.admin.isSuperAdmin?l.unshift({ref:d,label:"超管模式启动！"}):n.admin.isNormalAdmin&&l.unshift({ref:q,label:"让代码失效"}),l});function yt(){return He(I,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(wt.value).map(l=>He(ut,{checked:l.ref.value,"onUpdate:checked":a=>l.ref.value=a,label:l.label})),He(lo,{keepAliveOnHover:!1,placement:"bottom",style:{width:"max-content"}},{trigger:()=>He(ut,{checked:Le.value,"onUpdate:checked":l=>Le.value=l,label:"自动转换超链接"}),default:()=>"实验性功能，可能会导致回复显示出错"})])}const Ct=[{type:"group",key:"header",label:"屏蔽"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:yt}],kt=D(()=>{const l=[{label:"删除主题",key:"deleteThread",icon:ve(ro,{size:"1.5rem"})}];return F.value.sub_id===0?l.push({label:"设为置顶",key:"setTop",icon:ve(io,{size:"1.5rem"})}):l.push({label:"取消置顶",key:"cancelTop",icon:ve(uo,{size:"1.5rem"})}),l});function It(l){R.value?.show({action:l})}const we=y(_.page);function Ke(l){g.push({name:"thread",params:{threadId:_.threadId,page:l},query:{search:_.search}})}ke(()=>_.page,l=>we.value=l);const Ye=D(()=>({threadId:_.threadId,binggan:n.binggan,page:_.page,searchContent:_.search,noMentionMode:Me.value})),{loading:ue,data:de,onSuccess:St,onError:Pt,send:$t}=Xt(()=>it(Ye.value),[()=>_.threadId,()=>_.page,()=>_.search],{initialData:{},immediate:!0});St(l=>{document.title=l.data.thread_data.title,je(()=>{if(z.hash){const a=document.querySelector(z.hash);a?.scrollIntoView({block:"center",behavior:"auto"}),a?.classList.add("on-focus")}})}),Pt(l=>{A.value=!1,l.error.cause!==void 0&&l.error.cause.code!==401&&u.value?.show({errorCode:l.error.cause.code,message:l.error.message})}),Ce(()=>{$t(),A.value=!0}),pe(()=>{ue.value=!0,v.value?.resetInput()});const Qe=y(!1),{fetching:qe,onSuccess:xt,onError:Mt,fetch:Lt}=Zt();function oe(l=!1){qe.value!==!0&&(Qe.value=l,Lt(it(Ye.value)))}xt(()=>{S.value.forEach(l=>{l.refreshBattleData()}),Qe.value&&!m.userCustom.lessToast&&window.$message.success("已刷新数据")}),Mt(l=>{A.value=!1,l.error.cause!==void 0&&u.value?.show({errorCode:l.error.cause.code,message:l.error.message})});const Dt=D(()=>de.value.posts_data.data),F=D(()=>de.value.thread_data),Q=D(()=>de.value.forum_data),De=D(()=>de.value.your_post_floors),Je=D(()=>{let l;return l=Dt.value.filter(a=>{if(H.value===!0&&a.battle_id!==null||U.value===!0&&a.created_by_admin===2&&a.nickname==="Roll点系统")return!1;if($e.value===!0&&a.created_by_admin===2&&a.nickname==="奥利奥打赏系统"&&!a.is_your_post){if(De.value.length>0){const Y=a.content.match(/@№[0-9]+/g);if(Y===null)return!1;const L=Number(Y[0].slice(2));if(De.value.includes(L))return!0}return!1}if(Be.value===!0){const Y=a.created_by_admin==2&&a.nickname=="红包结果"&&!a.is_your_post,L=/^--红包口令: /.test(a.content)&&!a.is_your_post;if(Y||L)return!1}if(We.value===!0&&!a.is_your_post&&/^<span(.*?)<\/span>$/s.test(a.content))return!1;if(n.userData?.binggan.use_pingbici&&m.userCustom.hidePingbiciFloor){const Y=m.userCustom.pingbiciIngnoreCase?"gi":"g";for(let L of n.userData.pingbici.content_pingbici)if(new RegExp(L,Y).test(a.content))return!1;if(F.value.anti_jingfen){for(let L of n.userData.pingbici.fjf_pingbici)if(new RegExp(L,"g").test(a.created_binggan_hash.slice(0,5)))return!1}for(let L of n.userData.pingbici.fjf_pingbici)if(new RegExp(L,Y).test(a.nickname))return!1}return!0}),l}),Te=y(_.search),ze=y(!!_.search);function Xe(){g.push({name:"thread",params:{threadId:_.threadId,page:1},query:{search:Te.value||void 0}})}function Tt(){Te.value=void 0,ze.value=!1,g.push({name:"thread",params:{threadId:_.threadId,page:1}})}const me=y(!1),Re=y(!1),Ze=D(()=>_.page===(ue.value?_.page:de.value.posts_data.lastPage)),ye=zo();function zt(l){l.post_floor>=_.page*200?(me.value=!1,Re.value=!0):de.value.posts_data.data.find(Y=>Y.id===l.post_id)||Rt(l.thread_id,l.post_id)}function Rt(l,a){const Y={binggan:n.binggan,post_id:a,thread_id:l};po(Y).then(L=>{de.value.posts_data.data.push(L),m.userCustom.hongbaoThenStop&&L.hongbao_id!==null&&(window.$message.info("有红包！停止涮锅！（个人中心开启了红包自动停止涮锅）"),me.value=!1);const ce=document.body.clientHeight-document.documentElement.scrollTop;je(()=>{(v.value?.isTyping||m.userCustom.holdPageWhenListening)&&(document.documentElement.scrollTop=document.body.clientHeight-ce)})})}ke(me,l=>{if(l===!0)try{oe(!1),ye.connect(),ye.channel("thread_"+_.threadId).listen("NewPost",a=>zt(a)),ye.pusher?.connection.bind("state_change",a=>{a.current==="unavailable"&&(window.$message.error("嗷……服务器的自动涮锅服务好像出问题了，暂时不能使用"),me.value=!1)})}catch{window.$message.error("嗷……服务器的自动涮锅服务好像出问题了，暂时不能使用"),me.value=!1}else ye.isConnected&&ye.disconnect()}),pe(()=>{me.value=!1}),ke([()=>_.threadId,()=>_.page,()=>_.search],()=>{me.value=!1,Re.value=!1});let et,Ge;function tt(l,a){const{timestamp:Y,newPostKey:L}=_t(l.ist,F.value.id,n.binggan),ce={binggan:n.binggan,forum_id:Q.value.id,thread_id:F.value.id,content:l.contentInput,nickname:l.nicknameInput,post_with_admin:l.postWithAdmin,new_post_key:L,timestamp:Y};Ge=a,et=l,Nt(ce)}function Ht(){tt(et,Ge)}const{loading:At,send:Nt,onSuccess:qt,onError:Gt}=X(l=>fo(l),{immediate:!1});qt(()=>{Ge("success"),oe(!1)}),Gt(l=>{l.error.cause!==void 0&&l.error.cause.code===244291&&K.value?.show()});function ot(l){l.ctrlKey&&l.key==="x"&&oe(!0)}return Ce(()=>{window.addEventListener("keyup",ot)}),pe(()=>{window.removeEventListener("keyup",ot)}),(l,a)=>{const Y=pt("router-link");return r(),j(ae,null,[o(e(I),{vertical:""},{default:t(()=>[A.value?(r(),j(ae,{key:0},[o(e(I),{align:"center",style:{"margin-top":"8px"}},{default:t(()=>[o(e(ge),{size:e(m).isMobile?28:34},{default:t(()=>[o(e(eo),{style:{cursor:"pointer"},onClick:a[0]||(a[0]=L=>ze.value=!ze.value)})]),_:1},8,["size"]),o(dt,{page:we.value,"onUpdate:page":[a[1]||(a[1]=L=>we.value=L),Ke],"last-page":e(ue)?1:e(de).posts_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),ze.value?(r(),h(e(I),{key:0,wrap:!1},{default:t(()=>[o(e(be),{value:Te.value,"onUpdate:value":a[2]||(a[2]=L=>Te.value=L),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索回复内容","auto-size":"",onKeyup:he(Xe,["enter"])},null,8,["value"]),o(e(V),{type:"primary",onClick:Xe},{default:t(()=>[...a[15]||(a[15]=[s("搜索",-1)])]),_:1}),o(e(V),{type:"default",onClick:Tt},{default:t(()=>[...a[16]||(a[16]=[s("清空",-1)])]),_:1})]),_:1})):w("",!0),e(m).userCustom.loudspeakerPosition==="top"?(r(),h(Oe,{key:1})):w("",!0),o(Eo,{page:l.page,"thread-id":l.threadId,"posts-list-loading":e(ue),"disable-scroll":!!l.search,"is-search":!!l.search},null,8,["page","thread-id","posts-list-loading","disable-scroll","is-search"])],64)):w("",!0),!e(ue)&&A.value?(r(),j(ae,{key:1},[o(e(se),{class:"thread-title-container",size:"small",key:"title-card"},{default:t(()=>[N("span",{class:"thread-title",style:ie({fontSize:e(m).userCustom.fontSizeThreadList+"px"})},T(F.value?.title)+" ["+T(F.value?.posts_num)+"] ",5),e(n).checkAdminForums(Q.value?.id)?(r(),h(e(Ae),{key:0,trigger:"click",options:kt.value,onSelect:It,size:e(m).isMobile?"medium":"large"},{default:t(()=>[o(e(ge),{size:e(m).isMobile?20:24,style:{cursor:"pointer",float:"right","margin-left":"0.5rem"}},{default:t(()=>[o(e(to))]),_:1},8,["size"])]),_:1},8,["options","size"])):w("",!0),F.value?.is_your_thread?(r(),h(e(V),{key:1,size:"small",type:"primary",style:{float:"right","margin-left":"0.5rem"},onClick:a[3]||(a[3]=L=>O.value?.show())},{default:t(()=>[...a[17]||(a[17]=[s(" 变色 ",-1)])]),_:1})):w("",!0)]),_:1}),o(e(I),{vertical:"",size:2},{default:t(()=>[o(rt,{"post-data":Je.value[0],"your-posts-list":De.value,"anti-jingfen":F.value?.anti_jingfen,"forum-id":Q.value.id,"no-custom-emoji-mode":e(te),"no-emoji-mode":e(E),"no-head-mode":e(G),"no-image-mode":e(B),"no-video-mode":e(ee),"use-url-mode":e(Le),"random-head-group-index":F.value.random_heads_group,"super-admin-mode":d.value,"no-mention-mode":e(Me),onShowRewardModal:k.value?.show,"no-hongbao-pic-mode":e(xe),onQuoteClick:v.value?.quoteHandle,onRefreshPostsList:a[4]||(a[4]=L=>oe(!1)),onAdminHandle:R.value?.show},null,8,["post-data","your-posts-list","anti-jingfen","forum-id","no-custom-emoji-mode","no-emoji-mode","no-head-mode","no-image-mode","no-video-mode","use-url-mode","random-head-group-index","super-admin-mode","no-mention-mode","onShowRewardModal","no-hongbao-pic-mode","onQuoteClick","onAdminHandle"]),F.value.vote_question_id!==null?(r(),h(ya,{key:0,ref_key:"VoteComponentCom",ref:f,"vote-id":F.value.vote_question_id},null,8,["vote-id"])):w("",!0),F.value.gamble_question_id!==null?(r(),h(ca,{key:1,ref_key:"GambleComponentCom",ref:i,"gamble-id":F.value.gamble_question_id,"forum-id":Q.value?.id},null,8,["gamble-id","forum-id"])):w("",!0),F.value.crowd_id!==null?(r(),h(Zo,{key:2,ref_key:"CrowdComponentCom",ref:p,"crowd-id":F.value.crowd_id,"forum-id":Q.value?.id},null,8,["crowd-id","forum-id"])):w("",!0),F.value.hongbao_id!==null?(r(),h(ga,{key:3,ref_key:"HongbaoComponentCom",ref:C,"hongbao-id":F.value.hongbao_id,"thread-id":l.threadId,"forum-id":Q.value?.id,"no-hongbao-pic-mode":e(xe),onRefreshPostsList:a[5]||(a[5]=L=>oe(!1))},null,8,["hongbao-id","thread-id","forum-id","no-hongbao-pic-mode"])):w("",!0),l.threadId===138549?(r(),h(Sa,{key:4,ref_key:"PoolComponentCom",ref:x,"thread-id":l.threadId,"forum-id":Q.value?.id,onRefreshPostsList:a[6]||(a[6]=L=>oe(!1))},null,8,["thread-id","forum-id"])):w("",!0),(r(!0),j(ae,null,Ie(Je.value.slice(1),L=>(r(),h(rt,{key:L.id,"post-data":L,"your-posts-list":De.value,"anti-jingfen":F.value?.anti_jingfen,"forum-id":Q.value.id,"no-custom-emoji-mode":e(te),"no-emoji-mode":e(E),"no-head-mode":e(G),"no-image-mode":e(B),"no-video-mode":e(ee),"use-url-mode":e(Le),"random-head-group-index":F.value.random_heads_group,"super-admin-mode":d.value,"admin-mode":q.value,"no-mention-mode":e(Me),onShowRewardModal:k.value?.show,"no-hongbao-pic-mode":e(xe),onQuoteClick:v.value?.quoteHandle,onRefreshPostsList:a[7]||(a[7]=ce=>oe(!1)),onAdminHandle:R.value?.show,ref_for:!0,ref_key:"PostItemComs",ref:S},null,8,["post-data","your-posts-list","anti-jingfen","forum-id","no-custom-emoji-mode","no-emoji-mode","no-head-mode","no-image-mode","no-video-mode","use-url-mode","random-head-group-index","super-admin-mode","admin-mode","no-mention-mode","onShowRewardModal","no-hongbao-pic-mode","onQuoteClick","onAdminHandle"]))),128))]),_:1}),o(e(I),{align:"center",style:{"margin-top":"8px"}},{default:t(()=>[o(e(V),{type:"primary",loading:e(qe),disabled:e(qe),onClick:a[8]||(a[8]=L=>oe(!0))},{default:t(()=>[...a[18]||(a[18]=[s("刷新",-1)])]),_:1},8,["loading","disabled"]),o(e(ct),{value:me.value,"onUpdate:value":a[9]||(a[9]=L=>me.value=L),disabled:!Ze.value||Re.value},{checked:t(()=>[...a[19]||(a[19]=[s(" 涮锅中 ",-1)])]),unchecked:t(()=>[...a[20]||(a[20]=[s(" 自动涮锅 ",-1)])]),_:1},8,["value","disabled"]),Re.value?(r(),h(Y,{key:0,to:{name:"thread",params:{threadId:l.threadId,page:l.page+1}}},{default:t(()=>[...a[21]||(a[21]=[s("回帖已经翻页、点击前往 ",-1)])]),_:1},8,["to"])):w("",!0),Ze.value?w("",!0):(r(),h(e(P),{key:1},{default:t(()=>[...a[22]||(a[22]=[s("在最新一页才能自动涮锅",-1)])]),_:1}))]),_:1}),o(e(I),{align:"center",style:ie([{"margin-top":"8px"},{paddingRight:e(m).isMobile?"24px":"0px"}])},{default:t(()=>[o(e(oo),{placement:"bottom-start",trigger:"hover"},{trigger:t(()=>[o(e(ge),{size:34},{default:t(()=>[o(e(ao),{onClick:a[10]||(a[10]=L=>e(g).push({name:"forum",params:{forumId:Q.value?.id}})),style:{cursor:"pointer"}})]),_:1})]),default:t(()=>[o(e(P),null,{default:t(()=>[...a[23]||(a[23]=[s("返回小岛",-1)])]),_:1})]),_:1}),o(dt,{page:we.value,"onUpdate:page":[a[11]||(a[11]=L=>we.value=L),Ke],"last-page":e(ue)?1:e(de).posts_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1},8,["style"]),e(m).userCustom.loudspeakerPosition==="center"?(r(),h(Oe,{key:0})):w("",!0)],64)):(r(),h(e(I),{key:2,vertical:"",size:2},{default:t(()=>[(r(),j(ae,null,Ie(200,L=>N("div",Pa)),64))]),_:1})),nt(o(ho,{ref_key:"postInputCom",ref:v,mode:"post","forum-id":Q.value?.id,"thread-id":l.threadId,disabled:!1,handling:e(At),"random-heads-group":F.value?.random_heads_group,onContentCommit:tt,onRefreshPostsList:oe},null,8,["forum-id","thread-id","handling","random-heads-group"]),[[st,!e(ue)&&A.value]]),!e(ue)&&A.value?(r(),j(ae,{key:3},[o(e(I),{justify:"end"},{default:t(()=>[Q.value.is_nissin===2&&F.value.sub_id===0?(r(),h(e(P),{key:0},{default:t(()=>[a[24]||(a[24]=s(" 本贴将于 ",-1)),o(e(P),{type:"error"},{default:t(()=>[s(T(c.value),1)]),_:1}),a[25]||(a[25]=s(" 日清，请及时更换帖子喔 ",-1))]),_:1})):w("",!0),Q.value.is_nissin===1&&F.value.sub_id===0?(r(),h(e(P),{key:1},{default:t(()=>[a[27]||(a[27]=s(" 本小岛 ",-1)),o(e(P),{type:"error"},{default:t(()=>[...a[26]||(a[26]=[s(" 每日早上8:00 ",-1)])]),_:1}),a[28]||(a[28]=s(" 日清，请及时更换帖子喔 ",-1))]),_:1})):w("",!0)]),_:1}),o(e(I),null,{default:t(()=>[o(e(V),{type:"primary",onClick:a[12]||(a[12]=L=>e(g).push({name:"forum",params:{forumId:Q.value?.id}}))},{default:t(()=>[...a[29]||(a[29]=[s("返回小岛",-1)])]),_:1})]),_:1}),e(m).userCustom.loudspeakerPosition==="bottom"?(r(),h(Oe,{key:0})):w("",!0),a[31]||(a[31]=N("div",{style:{height:"50px"}},null,-1)),M.value?(r(),j(ae,{key:1},[(r(),h(lt,{to:"#topbar-nav"},[o(Y,{to:{name:"forum",params:{forumId:Q.value?.id}},class:"flex-item-center"},{default:t(()=>[o(e(no),{tooltip:!1},{default:t(()=>[s(T(Q.value?.name),1)]),_:1}),o(e(so),{round:"",class:"forum-tag",size:e(m).isMobile?"small":"medium"},{default:t(()=>[s(T(Q.value?.id),1)]),_:1},8,["size"])]),_:1},8,["to"])])),(r(),h(lt,{to:"#topbar-func"},[o(e(Ae),{trigger:e(m).isMobile?"click":"hover",options:Ct,placement:"bottom-start"},{default:t(()=>[o(e(V),null,{default:t(()=>[...a[30]||(a[30]=[s("屏蔽",-1)])]),_:1})]),_:1},8,["trigger"])]))],64)):w("",!0),o(jo,{ref_key:"ChangeColorModalCom",ref:O,"thread-id":l.threadId},null,8,["thread-id"]),o(bo,{ref_key:"CaptchaModalCom",ref:K,onWaterUnlockOnSuccess:Ht},null,512),o(No,{ref_key:"JumpModalCom",ref:$,"thread-id":l.threadId,"posts-num":F.value.posts_num,page:l.page},null,8,["thread-id","posts-num","page"]),o(Go,{ref_key:"RewardModalCom",ref:k,onRefreshPostsList:oe},null,512)],64)):w("",!0),o(_o,{mode:"thread",onRefresh:a[13]||(a[13]=L=>oe(!0)),onShowJumpModal:a[14]||(a[14]=L=>$.value.show())})]),_:1}),nt(o(e(_e),{size:"large",class:"spin"},null,512),[[st,e(ue)]]),o(Ao,{ref_key:"ForbiddenModalCom",ref:u},null,512),e(n).checkAdminForums(Q.value?.id)?(r(),h(qo,{key:0,ref_key:"AdminActionModalCom",ref:R,onRefreshPostsList:oe,"thread-id":l.threadId,"forum-id":Q.value?.id},null,8,["thread-id","forum-id"])):w("",!0)],64)}}}),Ga=Pe($a,[["__scopeId","data-v-31ce79c6"]]);export{Ga as default};
