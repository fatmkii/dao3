import{a1 as te,al as re,n as se,U as oe,X as le,t as d,l as b,u as $,am as ue,an as ne,ao as ie,T as de,p as k,j as i,x as o,i as w,K as I,E as s,J as pe,q as e,ai as me,aj as fe,Q as ce,w as ge,I as m,a4 as A,L as u,N as ve,ap as he,O as ye,P as F,aq as be,ar as ke,ak as we,m as f,as as Ie}from"./vendor-C-2co6ae.js";import{u as _e,t as R}from"./forums-BGaTqZw2.js";import{s as O}from"./subtitles-DW7M559j.js";import{s as Se}from"./shuffle-Bl2z5mvo.js";import{u as B,a as Ce,b as p,c as Te,d as U,_ as xe}from"./app-CsEnLcBD.js";import{_ as De}from"./loudspeaker-B409tdOb.js";import{L as Le,S as Ne}from"./LoudspeakerComponent-P4rW1-Oq.js";import{T as $e}from"./ThreadList-5hdIrHT8.js";import"./showDialog-DillYkkx.js";import"./browseLogger-CQ2mW6GL.js";function Fe(){const g=B();te(()=>{g.showTopbarNav=!1}),re(()=>{g.showTopbarNav=!0})}const Oe={key:0,class:"carousel-box"},Ue={key:0,class:"carousel-box"},Pe=["src"],Me=se({__name:"ForumPage",props:{forumId:{},page:{},search:{},delay:{type:Boolean}},setup(g){oe(r=>({"366ac772":e(n).bannerHeight}));const _=Ce(),n=B(),c=_e(),v=le(),W=d(null);d();const P=d();Fe();const t=g,G=b(()=>Se(c.forumData(t.forumId)?.banners).slice(0,5));document.title=c.forumData(t.forumId)?.name??"小火锅";const S=$("banner_hiden",!1),C=$("new_window_to_post",!1);function K(){return f(m,{style:"padding:6px 8px",vertical:!0},()=>[f(U,{checked:S.value,"onUpdate:checked":r=>S.value=r,label:"隐藏版头"}),f(U,{checked:C.value,"onUpdate:checked":r=>C.value=r,label:"新窗口打开"})])}const H=[{type:"group",key:"header",label:"功能"},{key:"header-divider",type:"divider"},{key:"funcOption",type:"render",render:K}],T=$("subtitles_included",O),M=b(()=>O.filter(r=>!T.value.includes(r)));function J(){return f(Ie,{value:T.value,"onUpdate:value":r=>T.value=r},()=>[f(m,{style:"padding:6px 8px",vertical:!0},()=>[Array.from(O).map(r=>f(U,{value:r,label:r}))])])}const Q=[{type:"group",key:"header",label:"筛选"},{key:"header-divider",type:"divider"},{key:"filterOptions",type:"render",render:J}],h=d(t.search),y=d(!!t.search);function q(){v.push({name:"forum",params:{forumId:t.forumId,page:1},query:{search:h.value||void 0}})}function X(){h.value=void 0,y.value=!1,v.push({name:"forum",params:{forumId:t.forumId,page:1}})}function V(){v.push({name:"forum",params:{forumId:t.forumId,page:1},query:{delay:t.delay?void 0:"true"}})}const x=d(t.page);function Y(r){v.push({name:"forum",params:{forumId:t.forumId,page:r},query:{search:t.search,delay:t.delay?"true":void 0}})}ue(()=>t.page,r=>x.value=r);const z=b(()=>({forumId:t.forumId,binggan:_.binggan,page:t.page,threadsPerPage:50,subtitlesExcluded:M.value,searchTitle:t.search,delay:t.delay})),{loading:D,data:L,onSuccess:qe}=ne(()=>R(z.value),[()=>t.forumId,()=>t.page,()=>t.search,()=>t.delay,M],{initialData:[],immediate:!0}),E=d(!1),{onSuccess:Z,fetch:ee}=ie();function j(r=!1){E.value=r,ee(R(z.value)),P.value?.reloadBrowseLogger()}Z(()=>{E.value&&!n.userCustom.lessToast&&window.$message.success("已刷新数据")});const ae=b(()=>{if(D.value)return[];if(_.userData.binggan.use_pingbici){const r=n.userCustom.pingbiciIngnoreCase?"gi":"g";return L.value.threads_data.data.filter(a=>{for(let N of _.userData.pingbici.title_pingbici)if(new RegExp(N,r).test(a.title))return!1;return!0})}else return L.value.threads_data.data});return(r,a)=>{const N=de("router-link");return i(),k(e(m),{vertical:""},{default:o(()=>[e(S)?I("",!0):(i(),w("div",Oe,[e(c).forumsDataLoading?(i(),w("div",Ue,[s(e(me),{class:"carousel-skeleton",sharp:""})])):I("",!0),e(c).forumsDataLoading?I("",!0):(i(),k(e(fe),{key:1,"show-arrow":"",trigger:e(n).isMobile?"click":"hover",autoplay:"",interval:1e4},{default:o(()=>[(i(!0),w(ce,null,ge(G.value,l=>(i(),w("img",{src:l,class:"carousel-img"},null,8,Pe))),256))]),_:1},8,["trigger"]))])),s(e(m),{style:{"margin-top":"8px"},size:"small"},{default:o(()=>[s(e(A),{trigger:e(n).isMobile?"click":"hover",options:H,placement:"bottom-start"},{default:o(()=>[s(e(p),null,{default:o(()=>[...a[7]||(a[7]=[u("功能",-1)])]),_:1})]),_:1},8,["trigger"]),s(e(A),{trigger:e(n).isMobile?"click":"hover",options:Q,placement:"bottom-start"},{default:o(()=>[s(e(p),null,{default:o(()=>[...a[8]||(a[8]=[u("筛选",-1)])]),_:1})]),_:1},8,["trigger"]),s(e(ve),{size:e(n).isMobile?28:34},{default:o(()=>[s(e(he),{style:{cursor:"pointer"},onClick:a[0]||(a[0]=l=>y.value=!y.value)})]),_:1},8,["size"]),s(e(p),{type:"primary",style:{"margin-left":"auto"},onClick:a[1]||(a[1]=l=>r.$router.push({name:"loudspeaker"}))},{default:o(()=>[...a[9]||(a[9]=[u("大喇叭",-1)])]),_:1}),s(e(p),{type:"primary",onClick:a[2]||(a[2]=l=>r.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},{default:o(()=>[...a[10]||(a[10]=[u("新主题",-1)])]),_:1})]),_:1}),y.value?(i(),k(e(m),{key:1,wrap:!1},{default:o(()=>[s(e(Te),{value:h.value,"onUpdate:value":a[3]||(a[3]=l=>h.value=l),maxlength:100,style:{"max-width":"400px"},placeholder:"搜索标题","auto-size":"",onKeyup:ye(q,["enter"])},null,8,["value"]),s(e(p),{type:"primary",onClick:q},{default:o(()=>[...a[11]||(a[11]=[u("搜索",-1)])]),_:1}),s(e(p),{type:"default",onClick:X},{default:o(()=>[...a[12]||(a[12]=[u("清空",-1)])]),_:1})]),_:1})):I("",!0),s(Le),s($e,{ref_key:"ThreadListCom",ref:P,"threads-list-data":ae.value,"new-window-to-post":e(C),"show-this":!e(D),onWithdrawDelayThreadSuccess:j},null,8,["threads-list-data","new-window-to-post","show-this"]),s(e(m),{align:"center"},{default:o(()=>[s(e(p),{type:t.delay?"default":"primary",onClick:V},{default:o(()=>[u(F(t.delay?"关闭延时主题":"查看延时主题"),1)]),_:1},8,["type"]),s(De,{page:x.value,"onUpdate:page":[a[4]||(a[4]=l=>x.value=l),Y],"last-page":e(D)?1:e(L).threads_data.lastPage,style:{"margin-left":"auto"}},null,8,["page","last-page"])]),_:1}),a[13]||(a[13]=pe("div",{style:{height:"50px"}},null,-1)),(i(),k(be,{to:"#topbar-nav"},[s(N,{to:"/",class:"flex-item-center"},{default:o(()=>[s(e(ke),{tooltip:!1},{default:o(()=>[u(F(e(c).forumData(r.forumId)?.name),1)]),_:1}),s(e(we),{round:"",class:"forum-tag",size:e(n).isMobile?"small":"medium"},{default:o(()=>[u(F(r.forumId),1)]),_:1},8,["size"])]),_:1})])),s(Ne,{mode:"forum",ref_key:"SidebarCom",ref:W,onRefresh:a[5]||(a[5]=l=>j(!0)),onNewThread:a[6]||(a[6]=l=>r.$router.push({name:"new-thread",params:{forumId:t.forumId}}))},null,512)]),_:1})}}}),Je=xe(Me,[["__scopeId","data-v-e58df8a9"]]);export{Je as default};
