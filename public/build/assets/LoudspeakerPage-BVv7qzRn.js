import{ak as Q,ar as M,Y as K,w as F,L as J,d as w,b5 as X,a7 as W,al as G,a8 as Z,S as ee,b as A,o as B,$ as h,c as U,A as k,M as S,f as a,H as t,a as e,k as D,n as P,z as m,ac as te,ad as ae,G as j,m as R,i as O,aG as le,j as I,bh as oe,h as N,F as re,Q as ne,C as se,aR as ie,s as E,N as de}from"./app-Bnyjg8n9.js";import{D as ue,g as me}from"./Delete-CjG5_T7f.js";import{n as fe}from"./globalSetting-SwhS8U6Y.js";import{n as pe,l as ce,_ as ge,r as ve}from"./loudspeaker-BXfgzKow.js";import{d as V}from"./dayjs.min-BIwLhz4I.js";import{_ as q}from"./FInput.vue_vue_type_script_setup_true_lang-7KhV1qPh.js";import{N as Y}from"./DatePicker-DfvgXS7O.js";import{a as ye,b as $,N as be}from"./InputNumber-Dh3twx-8.js";import{N as H}from"./Switch-CJ_6LAkX.js";import{N as he}from"./ColorPicker-uWpy5v9N.js";import{u as ke}from"./use-houdini-CTm8x736.js";import"./Pagination-R7XvQXNn.js";import"./use-locale-BQY9tv8Y.js";import"./prop-DfVitj0l.js";import"./Input-CmwnIxYN.js";import"./Select-Bfh_Ts2K.js";import"./Tag-BQ-nihl-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Add-fXet-zDs.js";import"./InputGroup-BNNkvZRm.js";const xe=u=>{const{primaryColor:i,successColor:p,warningColor:f,errorColor:c,infoColor:g,fontWeightStrong:r}=u;return{fontWeight:r,rotate:"252deg",colorStartPrimary:M(i,{alpha:.6}),colorEndPrimary:i,colorStartInfo:M(g,{alpha:.6}),colorEndInfo:g,colorStartWarning:M(f,{alpha:.6}),colorEndWarning:f,colorStartError:M(c,{alpha:.6}),colorEndError:c,colorStartSuccess:M(p,{alpha:.6}),colorEndSuccess:p}},_e={name:"GradientText",common:Q,self:xe},we=_e,Se=K("gradient-text",`
 display: inline-block;
 font-weight: var(--n-font-weight);
 -webkit-background-clip: text;
 background-clip: text;
 color: #0000;
 white-space: nowrap;
 background-image: linear-gradient(var(--n-rotate), var(--n-color-start) 0%, var(--n-color-end) 100%);
 transition:
 --n-color-start .3s var(--n-bezier),
 --n-color-end .3s var(--n-bezier);
`),Ce=Object.assign(Object.assign({},W.props),{size:[String,Number],fontSize:[String,Number],type:{type:String,default:"primary"},color:[Object,String],gradient:[Object,String]}),ze=F({name:"GradientText",props:Ce,setup(u){ke();const{mergedClsPrefixRef:i,inlineThemeDisabled:p}=J(u),f=w(()=>{const{type:l}=u;return l==="danger"?"error":l}),c=w(()=>{let l=u.size||u.fontSize;return l&&(l=X(l)),l||void 0}),g=w(()=>{const l=u.color||u.gradient;if(typeof l=="string")return l;if(l){const C=l.deg||0,x=l.from,b=l.to;return`linear-gradient(${C}deg, ${x} 0%, ${b} 100%)`}}),r=W("GradientText","-gradient-text",Se,we,u,i),v=w(()=>{const{value:l}=f,{common:{cubicBezierEaseInOut:C},self:{rotate:x,[G("colorStart",l)]:b,[G("colorEnd",l)]:z,fontWeight:L}}=r.value;return{"--n-bezier":C,"--n-rotate":x,"--n-color-start":b,"--n-color-end":z,"--n-font-weight":L}}),y=p?Z("gradient-text",w(()=>f.value[0]),v,u):void 0;return{mergedClsPrefix:i,compatibleType:f,styleFontSize:c,styleBgImage:g,cssVars:p?void 0:v,themeClass:y==null?void 0:y.themeClass,onRender:y==null?void 0:y.onRender}},render(){const{mergedClsPrefix:u,onRender:i}=this;return i==null||i(),ee("span",{class:[`${u}-gradient-text`,`${u}-gradient-text--${this.compatibleType}-type`,this.themeClass],style:[{fontSize:this.styleFontSize,backgroundImage:this.styleBgImage},this.cssVars]},this.$slots)}}),Le=I("div",null,[m(" 价格暂定为5000个olo（每天）"),I("br"),m(" 禁止发布辱骂、诅咒、黑锦鲤等方面情绪。 ")],-1),Ne=F({__name:"NewLoudspeakerModal",emits:["refreshLoudspeaker"],setup(u,{expose:i,emit:p}){const f=A(),c=B(),g=h(null),r=h({subId:"1",content:void 0,color:void 0,threadId:void 0,days:1,effectiveDate:V().format("YYYY-MM-DD 00:00:00")}),v=h(!1),y={effectiveDate:{required:!0,message:"请选择生效日期和时间"},days:{required:!0,message:"请填写生效天数",type:"number"},content:{required:!0,message:"请填写内容"},color:{required:!1},threadId:{required:!1},subId:{required:!1}},l=h(!1);function C(){l.value=!0}i({show:C});const x=p,{loading:b,send:z}=U(_=>pe(_),{immediate:!1});function L(){var _;(_=g.value)==null||_.validate(n=>{if(n)window.$message.error("请确认信息填写完整");else{const o={binggan:c.binggan,sub_id:r.value.subId,content:r.value.content,color:v?r.value.color:void 0,thread_id:r.value.threadId,effective_date:r.value.effectiveDate,days:r.value.days};z(o).then(()=>{x("refreshLoudspeaker"),l.value=!1})}})}return(_,n)=>(k(),S(e(le),{show:l.value,"onUpdate:show":n[9]||(n[9]=o=>l.value=o),"display-directive":"if"},{default:a(()=>[t(e(O),{style:R({maxWidth:e(f).modalMaxWidth}),title:"发布大喇叭",closable:"",onClose:n[8]||(n[8]=o=>l.value=!1),size:"small"},{action:a(()=>[t(e(D),{justify:"end"},{default:a(()=>[t(e(P),{type:"primary",disable:e(b),loading:e(b),onClick:L},{default:a(()=>[m("发布")]),_:1},8,["disable","loading"]),t(e(P),{onClick:n[7]||(n[7]=o=>l.value=!1)},{default:a(()=>[m("关闭")]),_:1})]),_:1})]),default:a(()=>[Le,t(e(ye),{ref_key:"formRef",ref:g,model:r.value,"label-placement":"left","label-width":"auto",rules:y,size:e(f).isMobile?"small":"medium",style:{"margin-top":"10px"}},{default:a(()=>[t(e($),{label:"生效日期",path:"effectiveDate"},{default:a(()=>[t(e(Y),{"formatted-value":r.value.effectiveDate,"onUpdate:formattedValue":n[0]||(n[0]=o=>r.value.effectiveDate=o),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",size:e(f).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),t(e($),{label:"生效天数",path:"days"},{default:a(()=>[t(e(be),{value:r.value.days,"onUpdate:value":n[1]||(n[1]=o=>r.value.days=o),max:3,min:1,step:1,placeholder:"1-3天"},null,8,["value"])]),_:1}),t(e($),{label:"内容",path:"content"},{default:a(()=>[t(e(q),{placeholder:"最多100字",type:"textarea",maxlength:"100","show-count":"",autosize:{minRows:3,maxRows:5},value:r.value.content,"onUpdate:value":n[2]||(n[2]=o=>r.value.content=o)},null,8,["value"])]),_:1}),t(e($),{label:"设定颜色",path:"color"},{default:a(()=>[t(e(H),{value:v.value,"onUpdate:value":n[3]||(n[3]=o=>v.value=o)},null,8,["value"]),te(t(e(he),{value:r.value.color,"onUpdate:value":n[4]||(n[4]=o=>r.value.color=o),modes:["hex"],"show-alpha":!1,style:{"max-width":"7rem","margin-left":"12px"}},null,8,["value"]),[[ae,v.value]])]),_:1}),t(e($),{label:"链接主题",path:"threadId"},{default:a(()=>[t(e(q),{value:r.value.threadId,"onUpdate:value":n[5]||(n[5]=o=>r.value.threadId=o),placeholder:"主题网址的ID（可留空）"},null,8,["value"])]),_:1}),e(c).admin.isSuperAdmin?(k(),S(e($),{key:0,label:"设为置顶",path:"subId"},{default:a(()=>[t(e(H),{"onUpdate:value":n[6]||(n[6]=o=>r.value.subId=o),"checked-value":10,"unchecked-value":"1"})]),_:1})):j("",!0)]),_:1},8,["model","size"])]),_:1},8,["style"])]),_:1},8,["show"]))}}),$e=I("div",{style:{"margin-left":"auto"}},null,-1),Ke=F({__name:"LoudspeakerPage",setup(u){const i=B(),p=A(),f=h(),c=h(),g=h(!1),r=h(1),v=h(30),y=w(()=>(r.value-1)*v.value),l={binggan:i.binggan,mode:"all"},{loading:C,data:x,send:b}=U(o=>ce(o),{immediate:!1,initialData:[]});b(l);const z=w(()=>x.value.filter(o=>!(g.value&&!o.is_your_loudspeaker||c.value&&!V(c.value).isSame(o.effective_date,"day")))),{data:L}=U(fe);function _(o){const d={title:"强制删除大喇叭",closable:!1,content:"要强制删除这个大喇叭吗？这是管理员功能。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{me({binggan:i.binggan,loudspeaker_id:o}).then(()=>b(l))}};window.$dialog.warning(d)}function n(o){const d={title:"撤回大喇叭",closable:!1,content:"要撤回这个大喇叭吗？花费的奥利奥不会退回喔",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{ve({binggan:i.binggan,loudspeaker_id:o}).then(()=>b(l))}};window.$dialog.warning(d)}return(o,d)=>(k(),S(e(D),{vertical:"",style:{"margin-top":"8px"}},{default:a(()=>[t(e(D),{size:"small",align:"center"},{default:a(()=>[I("img",{style:R({height:e(p).isMobile?"48px":"64px"}),src:"https://oss.cpttmm.com/xhg_other/miku_loudspeaker.png"},null,4),t(e(ze),{style:R({fontSize:e(p).isMobile?"16px":"20px"}),gradient:{from:"#7fcab9",to:"#99b1c5"}},{default:a(()=>[m(" 爱乃是盲目～🎵 ")]),_:1},8,["style"]),t(e(oe),{placement:"bottom",trigger:"hover",disabled:e(L)},{trigger:a(()=>[t(e(P),{type:"primary",disabled:!e(L),onClick:d[0]||(d[0]=s=>{var T;return(T=f.value)==null?void 0:T.show()}),style:{"margin-left":"auto"}},{default:a(()=>[m("发布大喇叭")]),_:1},8,["disabled"])]),default:a(()=>[t(e(N),null,{default:a(()=>[m("嗷！目前暂停发布大喇叭…… ")]),_:1})]),_:1},8,["disabled"])]),_:1}),t(e(D),{size:"small",justify:"end",align:"center"},{default:a(()=>[t(e(N),null,{default:a(()=>[m("只看自己")]),_:1}),t(e(H),{value:g.value,"onUpdate:value":d[1]||(d[1]=s=>g.value=s)},null,8,["value"]),t(e(Y),{"formatted-value":c.value,"onUpdate:formattedValue":d[2]||(d[2]=s=>c.value=s),"value-format":"yyyy-MM-dd",type:"date",clearable:"",placeholder:"筛选生效日期",size:e(p).isMobile?"small":"medium"},null,8,["formatted-value","size"])]),_:1}),t(ge,{page:r.value,"onUpdate:page":[d[3]||(d[3]=s=>r.value=s),d[4]||(d[4]=s=>r.value=s)],"last-page":Math.floor(z.value.length/v.value),style:{"margin-right":"auto"}},null,8,["page","last-page"]),(k(!0),re(se,null,ne(z.value.slice(y.value,y.value+v.value),s=>(k(),S(e(O),{key:s.id,size:"small",bordered:!0,class:"loudspeaker-card"},{default:a(()=>[(k(),S(ie(s.thread_id?"router-link":"span"),{style:R({color:s.color}),to:s.thread_id!==null?`/thread/${s.thread_id}/1`:void 0},{default:a(()=>[m(E(s.content),1)]),_:2},1032,["style","to"])),t(e(D),{size:"small"},{default:a(()=>[I("span",null,[t(e(N),{depth:3},{default:a(()=>[m("生效：")]),_:1}),t(e(N),null,{default:a(()=>[m(E(s.effective_date),1)]),_:2},1024)]),I("span",null,[t(e(N),{depth:3},{default:a(()=>[m("到期：")]),_:1}),t(e(N),null,{default:a(()=>[m(E(s.expire_date),1)]),_:2},1024)]),$e,s.is_your_loudspeaker?(k(),S(e(de),{key:0,size:e(p).isMobile?20:24,style:{cursor:"pointer"},onClick:T=>n(s.id)},{default:a(()=>[t(e(ue))]),_:2},1032,["size","onClick"])):j("",!0),e(i).admin.isNormalAdmin?(k(),S(e(P),{key:1,size:"tiny",type:"warning",onClick:T=>_(s.id)},{default:a(()=>[m("强制删除")]),_:2},1032,["onClick"])):j("",!0)]),_:2},1024)]),_:2},1024))),128)),t(Ne,{ref_key:"NewLoudspeakerModalCom",ref:f,onRefreshLoudspeaker:d[5]||(d[5]=s=>e(b)(l))},null,512)]),_:1}))}});export{Ke as default};
